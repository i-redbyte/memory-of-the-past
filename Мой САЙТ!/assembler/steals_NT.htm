<html>

<head>
<meta http-equiv="Content-Type" content="text/html; charset=windows-1252">
<meta name="GENERATOR" content="Microsoft FrontPage 4.0">
<meta name="ProgId" content="FrontPage.Editor.Document">
<title>New Page 1</title>
<meta name="Microsoft Theme" content="zero 011">
</head>

<body background="zertxtr.gif" bgcolor="#000000" text="#FFFFFF" link="#6699CC" vlink="#669966" alink="#999999">

<!--mstheme--><font face="Arial, Arial, Helvetica"><!--mstheme--></font>
<h3 align="center"><!--mstheme--><font face="Arial, Arial, Helvetica" color="#CCCCCC"><font color="#00FF00" size="6"><b>&#1050;&#1072;&#1082;
&#1089;&#1090;&#1072;&#1090;&#1100;
&#1085;&#1077;&#1074;&#1080;&#1076;&#1080;&#1084;&#1099;&#1084; &#1074; Windows
NT</b></font><!--mstheme--></font></h3>
<!--mstheme--><font face="Arial, Arial, Helvetica">
<ol type="1">
  <li><a href="http://www.wasm.ru/article.php?article=hidingnt#1">&#1057;&#1086;&#1076;&#1077;&#1088;&#1078;&#1072;&#1085;&#1080;&#1077;</a>
  <li><a href="http://www.wasm.ru/article.php?article=hidingnt#2">&#1042;&#1089;&#1090;&#1091;&#1087;&#1083;&#1077;&#1085;&#1080;&#1077;</a>
  <li><a href="http://www.wasm.ru/article.php?article=hidingnt#3">&#1060;&#1072;&#1081;&#1083;&#1099;</a>
    <ol type="1">
      <li><a href="http://www.wasm.ru/article.php?article=hidingnt#3_1">NtQueryDirectoryFile</a>
      <li><a href="http://www.wasm.ru/article.php?article=hidingnt#3_2">NtVdmControl</a></li>
    </ol>
  <li><a href="http://www.wasm.ru/article.php?article=hidingnt#4">&#1055;&#1088;&#1086;&#1094;&#1077;&#1089;&#1089;&#1099;</a>
  <li><a href="http://www.wasm.ru/article.php?article=hidingnt#5">&#1056;&#1077;&#1077;&#1089;&#1090;&#1088;</a>
    <ol type="1">
      <li><a href="http://www.wasm.ru/article.php?article=hidingnt#5_1">NtEnumerateKey</a>
      <li><a href="http://www.wasm.ru/article.php?article=hidingnt#5_2">NtEnumerateValueKey</a></li>
    </ol>
  <li><a href="http://www.wasm.ru/article.php?article=hidingnt#6">&#1057;&#1077;&#1088;&#1074;&#1080;&#1089;&#1099;
    &#1080; &#1076;&#1088;&#1072;&#1081;&#1074;&#1077;&#1088;&#1099;</a>
  <li><a href="http://www.wasm.ru/article.php?article=hidingnt#7">&#1055;&#1077;&#1088;&#1077;&#1093;&#1074;&#1072;&#1090;
    &#1080;
    &#1088;&#1072;&#1089;&#1087;&#1088;&#1086;&#1089;&#1090;&#1088;&#1072;&#1085;&#1077;&#1085;&#1080;&#1077;</a>
    <ol type="1">
      <li><a href="http://www.wasm.ru/article.php?article=hidingnt#7_1">&#1055;&#1088;&#1080;&#1074;&#1080;&#1083;&#1077;&#1075;&#1080;&#1080;</a>
      <li><a href="http://www.wasm.ru/article.php?article=hidingnt#7_2">&#1055;&#1077;&#1088;&#1077;&#1093;&#1074;&#1072;&#1090;</a>
      <li><a href="http://www.wasm.ru/article.php?article=hidingnt#7_3">&#1053;&#1086;&#1074;&#1099;&#1077;
        &#1087;&#1088;&#1086;&#1094;&#1077;&#1089;&#1089;&#1099;</a>
      <li><a href="http://www.wasm.ru/article.php?article=hidingnt#7_4">DLL</a></li>
    </ol>
  <li><a href="http://www.wasm.ru/article.php?article=hidingnt#8">&#1055;&#1072;&#1084;&#1103;&#1090;&#1100;</a>
  <li><a href="http://www.wasm.ru/article.php?article=hidingnt#9">&#1061;&#1101;&#1085;&#1076;&#1083;&#1099;</a>
    <ol type="1">
      <li><a href="http://www.wasm.ru/article.php?article=hidingnt#9_1">&#1048;&#1084;&#1077;&#1085;&#1086;&#1074;&#1072;&#1085;&#1080;&#1077;
        &#1093;&#1101;&#1085;&#1076;&#1083;&#1086;&#1074; &#1080;
        &#1087;&#1086;&#1083;&#1091;&#1095;&#1077;&#1085;&#1080;&#1077;
        &#1090;&#1080;&#1087;&#1072;</a></li>
    </ol>
  <li><a href="http://www.wasm.ru/article.php?article=hidingnt#10">&#1055;&#1086;&#1088;&#1090;&#1099;</a>
    <ol type="1">
      <li><a href="http://www.wasm.ru/article.php?article=hidingnt#10_1">Netstat,
        OpPorts &#1074; WinXP, FPort &#1074; WinXP</a>
      <li><a href="http://www.wasm.ru/article.php?article=hidingnt#10_2">OpPorts
        &#1074; Win2k &#1080; NT4, FPort &#1074; Win2k</a></li>
    </ol>
  <li><a href="http://www.wasm.ru/article.php?article=hidingnt#11">&#1054;&#1082;&#1086;&#1085;&#1095;&#1072;&#1085;&#1080;&#1077;</a></li>
</ol>
<a name="2"></a>
<p align="center">=====[ 2.
&#1042;&#1089;&#1090;&#1091;&#1087;&#1083;&#1077;&#1085;&#1080;&#1077; ]=====</p>
<p>&#1069;&#1090;&#1072; &#1089;&#1090;&#1072;&#1090;&#1100;&#1103;
&#1086;&#1087;&#1080;&#1089;&#1099;&#1074;&#1072;&#1077;&#1090;
&#1090;&#1077;&#1093;&#1085;&#1080;&#1082;&#1080;
&#1089;&#1082;&#1088;&#1099;&#1090;&#1080;&#1103;
&#1086;&#1073;&#1098;&#1077;&#1082;&#1090;&#1086;&#1074;,
&#1092;&#1072;&#1081;&#1083;&#1086;&#1074;,
&#1089;&#1077;&#1088;&#1074;&#1080;&#1089;&#1086;&#1074;,
&#1087;&#1088;&#1086;&#1094;&#1077;&#1089;&#1089;&#1086;&#1074; &#1080; &#1090;.&#1076;.
&#1074; &#1054;&#1057; Windows NT. &#1069;&#1090;&#1080;
&#1084;&#1077;&#1090;&#1086;&#1076;&#1099;
&#1086;&#1089;&#1085;&#1086;&#1074;&#1072;&#1085;&#1099; &#1085;&#1072;
&#1087;&#1077;&#1088;&#1077;&#1093;&#1074;&#1072;&#1090;&#1077;
&#1092;&#1091;&#1085;&#1082;&#1094;&#1080;&#1081; Windows API,
&#1095;&#1090;&#1086; &#1086;&#1087;&#1080;&#1089;&#1072;&#1085;&#1086; &#1074;
&#1084;&#1086;&#1077;&#1081; &#1089;&#1090;&#1072;&#1090;&#1100;&#1077; &quot;Hooking
Windows API&quot;.
<p>&#1044;&#1072;&#1085;&#1085;&#1072;&#1103;
&#1080;&#1085;&#1092;&#1086;&#1088;&#1084;&#1072;&#1094;&#1080;&#1103;
&#1073;&#1099;&#1083;&#1072;
&#1087;&#1086;&#1083;&#1091;&#1095;&#1077;&#1085;&#1072;
&#1084;&#1085;&#1086;&#1102; &#1074;
&#1087;&#1088;&#1086;&#1094;&#1077;&#1089;&#1089;&#1077;
&#1085;&#1072;&#1087;&#1080;&#1089;&#1072;&#1085;&#1080;&#1103; rootkit'&#1072;,
&#1087;&#1086;&#1101;&#1090;&#1086;&#1084;&#1091; &#1077;&#1089;&#1090;&#1100;
&#1074;&#1077;&#1088;&#1086;&#1103;&#1090;&#1085;&#1086;&#1089;&#1090;&#1100;,
&#1095;&#1090;&#1086; &#1101;&#1090;&#1086; &#1084;&#1086;&#1078;&#1077;&#1090;
&#1073;&#1099;&#1090;&#1100;
&#1088;&#1077;&#1072;&#1083;&#1080;&#1079;&#1086;&#1074;&#1072;&#1085;&#1086;
&#1073;&#1086;&#1083;&#1077;&#1077;
&#1101;&#1092;&#1092;&#1077;&#1082;&#1090;&#1080;&#1074;&#1085;&#1086;
&#1080;&#1083;&#1080; &#1085;&#1072;&#1084;&#1085;&#1086;&#1075;&#1086;
&#1073;&#1086;&#1083;&#1077;&#1077; &#1087;&#1088;&#1086;&#1089;&#1090;&#1086;.
<p>&#1055;&#1086;&#1076;
&#1089;&#1082;&#1088;&#1099;&#1090;&#1080;&#1077;&#1084;
&#1086;&#1073;&#1098;&#1077;&#1082;&#1090;&#1086;&#1074; &#1074;
&#1101;&#1090;&#1086;&#1081; &#1089;&#1090;&#1072;&#1090;&#1100;&#1077;
&#1087;&#1086;&#1076;&#1088;&#1072;&#1079;&#1091;&#1084;&#1077;&#1074;&#1072;&#1077;&#1090;&#1089;&#1103;
&#1079;&#1072;&#1084;&#1077;&#1085;&#1072;
&#1085;&#1077;&#1082;&#1086;&#1090;&#1086;&#1088;&#1099;&#1093;
&#1089;&#1080;&#1089;&#1090;&#1077;&#1084;&#1085;&#1099;&#1093;
&#1092;&#1091;&#1085;&#1082;&#1094;&#1080;&#1081;,
&#1082;&#1086;&#1090;&#1086;&#1088;&#1099;&#1077;
&#1088;&#1072;&#1073;&#1086;&#1090;&#1072;&#1102;&#1090; &#1089;
&#1101;&#1090;&#1080;&#1084;
&#1086;&#1073;&#1098;&#1077;&#1082;&#1090;&#1086;&#1084;
&#1090;&#1072;&#1082;&#1080;&#1084;
&#1086;&#1073;&#1088;&#1072;&#1079;&#1086;&#1084;,
&#1095;&#1090;&#1086;&#1073;&#1099; &#1086;&#1085;&#1080; &#1077;&#1075;&#1086;
&#1087;&#1088;&#1086;&#1087;&#1091;&#1089;&#1082;&#1072;&#1083;&#1080;. &#1042;
&#1089;&#1083;&#1091;&#1095;&#1072;&#1077;, &#1077;&#1089;&#1083;&#1080;
&#1086;&#1073;&#1098;&#1077;&#1082;&#1090; - &#1074;&#1089;&#1077;&#1075;&#1086;
&#1083;&#1080;&#1096;&#1100;
&#1074;&#1086;&#1079;&#1074;&#1088;&#1072;&#1097;&#1072;&#1077;&#1084;&#1086;&#1077;
&#1079;&#1085;&#1072;&#1095;&#1077;&#1085;&#1080;&#1077;
&#1092;&#1091;&#1085;&#1082;&#1094;&#1080;&#1080;, &#1084;&#1099;
&#1087;&#1088;&#1086;&#1089;&#1090;&#1086;
&#1074;&#1086;&#1079;&#1074;&#1088;&#1072;&#1090;&#1080;&#1084;
&#1079;&#1085;&#1072;&#1095;&#1077;&#1085;&#1080;&#1077;, &#1082;&#1072;&#1082;
&#1073;&#1091;&#1076;&#1090;&#1086; &#1073;&#1099;
&#1086;&#1073;&#1098;&#1077;&#1082;&#1090;&#1072; &#1085;&#1077;
&#1089;&#1091;&#1097;&#1077;&#1089;&#1090;&#1074;&#1091;&#1077;&#1090;.
<p>&#1055;&#1088;&#1086;&#1089;&#1090;&#1077;&#1081;&#1096;&#1080;&#1081;
&#1084;&#1077;&#1090;&#1086;&#1076; (&#1080;&#1089;&#1082;&#1083;&#1102;&#1095;&#1072;&#1103;
&#1089;&#1083;&#1091;&#1095;&#1072;&#1080;, &#1082;&#1086;&#1075;&#1076;&#1072;
&#1089;&#1082;&#1072;&#1079;&#1072;&#1085;&#1086;
&#1086;&#1073;&#1088;&#1072;&#1090;&#1085;&#1086;&#1077;) -
&#1101;&#1090;&#1086; &#1074;&#1099;&#1079;&#1086;&#1074;
&#1086;&#1088;&#1080;&#1075;&#1080;&#1085;&#1072;&#1083;&#1100;&#1085;&#1086;&#1081;
&#1092;&#1091;&#1085;&#1082;&#1094;&#1080;&#1080; &#1089;
&#1086;&#1088;&#1080;&#1075;&#1080;&#1085;&#1072;&#1083;&#1100;&#1085;&#1099;&#1084;&#1080;
&#1072;&#1088;&#1075;&#1091;&#1084;&#1077;&#1085;&#1090;&#1072;&#1084;&#1080;
&#1080; &#1079;&#1072;&#1084;&#1077;&#1085;&#1072; &#1077;&#1077;
&#1074;&#1099;&#1093;&#1086;&#1076;&#1085;&#1099;&#1093;
&#1076;&#1072;&#1085;&#1085;&#1099;&#1093;.
<p>&#1042; &#1101;&#1090;&#1086;&#1081;
&#1074;&#1077;&#1088;&#1089;&#1080;&#1080;
&#1089;&#1090;&#1072;&#1090;&#1100;&#1080;
&#1086;&#1087;&#1080;&#1089;&#1072;&#1085;&#1099;
&#1084;&#1077;&#1090;&#1086;&#1076;&#1099;
&#1089;&#1082;&#1088;&#1099;&#1090;&#1080;&#1103;
&#1092;&#1072;&#1081;&#1083;&#1086;&#1074;,
&#1087;&#1088;&#1086;&#1094;&#1077;&#1089;&#1089;&#1086;&#1074;,
&#1082;&#1083;&#1102;&#1095;&#1077;&#1081; &#1080;
&#1079;&#1085;&#1072;&#1095;&#1077;&#1085;&#1080;&#1081;
&#1088;&#1077;&#1077;&#1089;&#1090;&#1088;&#1072;,
&#1089;&#1080;&#1089;&#1090;&#1077;&#1084;&#1085;&#1099;&#1093;
&#1089;&#1077;&#1088;&#1074;&#1080;&#1089;&#1086;&#1074; &#1080;
&#1076;&#1088;&#1072;&#1081;&#1074;&#1077;&#1088;&#1086;&#1074;,
&#1074;&#1099;&#1076;&#1077;&#1083;&#1077;&#1085;&#1085;&#1086;&#1081;
&#1087;&#1072;&#1084;&#1103;&#1090;&#1080; &#1080;
&#1093;&#1101;&#1085;&#1076;&#1083;&#1086;&#1074;. <a name="3"></a>
<p align="center">=====[ 3. &#1060;&#1072;&#1081;&#1083;&#1099; ]=====</p>
<p align="center">&#1057;&#1091;&#1097;&#1077;&#1089;&#1090;&#1074;&#1091;&#1077;&#1090;
&#1085;&#1077;&#1089;&#1082;&#1086;&#1083;&#1100;&#1082;&#1086;
&#1089;&#1087;&#1086;&#1089;&#1086;&#1073;&#1086;&#1074;
&#1089;&#1082;&#1088;&#1099;&#1090;&#1080;&#1103;
&#1092;&#1072;&#1081;&#1083;&#1086;&#1074;, &#1095;&#1090;&#1086;&#1073;&#1099;
&#1054;&#1057; &#1085;&#1077; &#1084;&#1086;&#1075;&#1083;&#1072; &#1080;&#1093;
&#1074;&#1080;&#1076;&#1077;&#1090;&#1100;. &#1052;&#1099;
&#1089;&#1082;&#1086;&#1085;&#1094;&#1077;&#1085;&#1090;&#1088;&#1080;&#1088;&#1091;&#1077;&#1084;&#1089;&#1103;
&#1085;&#1072; &#1080;&#1079;&#1084;&#1077;&#1085;&#1077;&#1085;&#1080;&#1080;
API &#1080; &#1086;&#1090;&#1073;&#1088;&#1086;&#1089;&#1080;&#1084;
&#1090;&#1072;&#1082;&#1080;&#1077;
&#1090;&#1077;&#1093;&#1085;&#1080;&#1082;&#1080;, &#1082;&#1072;&#1082;
&#1080;&#1089;&#1087;&#1086;&#1083;&#1100;&#1079;&#1086;&#1074;&#1072;&#1085;&#1080;&#1077;
&#1074;&#1086;&#1079;&#1084;&#1086;&#1078;&#1085;&#1086;&#1089;&#1090;&#1077;&#1081;
&#1092;&#1072;&#1081;&#1083;&#1086;&#1074;&#1086;&#1081;
&#1089;&#1080;&#1089;&#1090;&#1077;&#1084;&#1099;. &#1050;
&#1090;&#1086;&#1084;&#1091; &#1078;&#1077; &#1101;&#1090;&#1086;
&#1085;&#1072;&#1084;&#1085;&#1086;&#1075;&#1086;
&#1087;&#1088;&#1086;&#1097;&#1077;, &#1090;.&#1082;. &#1074;
&#1101;&#1090;&#1086;&#1084; &#1089;&#1083;&#1091;&#1095;&#1072;&#1077;
&#1085;&#1072;&#1084; &#1085;&#1077; &#1085;&#1091;&#1078;&#1085;&#1086;
&#1079;&#1085;&#1072;&#1090;&#1100; &#1082;&#1072;&#1082;
&#1088;&#1072;&#1073;&#1086;&#1090;&#1072;&#1077;&#1090;
&#1082;&#1086;&#1085;&#1082;&#1088;&#1077;&#1090;&#1085;&#1072;&#1103;
&#1092;&#1072;&#1081;&#1083;&#1086;&#1074;&#1072;&#1103;
&#1089;&#1080;&#1089;&#1090;&#1077;&#1084;&#1072;. <a name="3_1"></a>
<p align="center">=====[ 3.1 NtQueryDirectoryFile ]====</p>
<p>&#1055;&#1086;&#1080;&#1089;&#1082; &#1092;&#1072;&#1081;&#1083;&#1072;
&#1074; wNT &#1074; &#1082;&#1072;&#1082;&#1086;&#1081;-&#1083;&#1080;&#1073;&#1086;
&#1076;&#1080;&#1088;&#1077;&#1082;&#1090;&#1086;&#1088;&#1080;&#1080;
&#1079;&#1072;&#1082;&#1083;&#1102;&#1095;&#1072;&#1077;&#1090;&#1089;&#1103;
&#1074; &#1087;&#1088;&#1086;&#1089;&#1084;&#1086;&#1090;&#1088;&#1077;
&#1074;&#1089;&#1077;&#1093; &#1092;&#1072;&#1081;&#1083;&#1086;&#1074;
&#1101;&#1090;&#1086;&#1081;
&#1076;&#1080;&#1088;&#1077;&#1082;&#1090;&#1086;&#1088;&#1080;&#1080; &#1080;
&#1092;&#1072;&#1081;&#1083;&#1086;&#1074; &#1074;&#1089;&#1077;&#1093;
&#1077;&#1077;
&#1087;&#1086;&#1076;&#1076;&#1080;&#1088;&#1077;&#1082;&#1090;&#1086;&#1088;&#1080;&#1081;.
&#1044;&#1083;&#1103;
&#1087;&#1077;&#1088;&#1077;&#1095;&#1080;&#1089;&#1083;&#1077;&#1085;&#1080;&#1103;
&#1092;&#1072;&#1081;&#1083;&#1086;&#1074;
&#1080;&#1089;&#1087;&#1086;&#1083;&#1100;&#1079;&#1091;&#1077;&#1090;&#1089;&#1103;
&#1092;&#1091;&#1085;&#1082;&#1094;&#1080;&#1103; NtQueryDirectoryFile.
<p><code><!--mstheme--></font>
<pre>        NTSTATUS NtQueryDirectoryFile(
                IN HANDLE FileHandle,
                IN HANDLE Event OPTIONAL,
                IN PIO_APC_ROUTINE ApcRoutine OPTIONAL,
                IN PVOID ApcContext OPTIONAL,
                OUT PIO_STATUS_BLOCK IoStatusBlock,
                OUT PVOID FileInformation,
                IN ULONG FileInformationLength,
                IN FILE_INFORMATION_CLASS FileInformationClass,
                IN BOOLEAN ReturnSingleEntry,
                IN PUNICODE_STRING FileName OPTIONAL,
                IN BOOLEAN RestartScan
        );</pre>
<!--mstheme--><font face="Arial, Arial, Helvetica"></code>
<p>&#1044;&#1083;&#1103; &#1085;&#1072;&#1089;
&#1074;&#1072;&#1078;&#1085;&#1099;
&#1087;&#1072;&#1088;&#1072;&#1084;&#1077;&#1090;&#1088;&#1099; FileHandle,
FileInformation &#1080; FileInformationClass. FileHandle -
&#1093;&#1101;&#1085;&#1076;&#1083;
&#1086;&#1073;&#1098;&#1077;&#1082;&#1090;&#1072;
&#1076;&#1080;&#1088;&#1077;&#1082;&#1090;&#1086;&#1088;&#1080;&#1080;,
&#1082;&#1086;&#1090;&#1086;&#1088;&#1099;&#1081;
&#1084;&#1086;&#1078;&#1077;&#1090; &#1073;&#1099;&#1090;&#1100;
&#1087;&#1086;&#1083;&#1091;&#1095;&#1077;&#1085; &#1089;
&#1080;&#1089;&#1087;&#1086;&#1083;&#1100;&#1079;&#1086;&#1074;&#1072;&#1085;&#1080;&#1077;&#1084;
&#1092;&#1091;&#1085;&#1082;&#1094;&#1080;&#1080; NtOpenFile. FileInformation -
&#1091;&#1082;&#1072;&#1079;&#1072;&#1090;&#1077;&#1083;&#1100; &#1085;&#1072;
&#1074;&#1099;&#1076;&#1077;&#1083;&#1077;&#1085;&#1085;&#1091;&#1102;
&#1087;&#1072;&#1084;&#1103;&#1090;&#1100;, &#1082;&#1091;&#1076;&#1072;
&#1092;&#1091;&#1085;&#1082;&#1094;&#1080;&#1103;
&#1079;&#1072;&#1087;&#1080;&#1096;&#1077;&#1090;
&#1085;&#1077;&#1086;&#1073;&#1093;&#1086;&#1076;&#1080;&#1084;&#1099;&#1077;
&#1076;&#1072;&#1085;&#1085;&#1099;&#1077;. FileInformationClass
&#1086;&#1087;&#1088;&#1077;&#1076;&#1077;&#1083;&#1103;&#1077;&#1090;
&#1090;&#1080;&#1087; &#1079;&#1072;&#1087;&#1080;&#1089;&#1077;&#1081; &#1074;
FileInformation.
<p>FileInformationClass
&#1087;&#1077;&#1088;&#1077;&#1095;&#1080;&#1089;&#1083;&#1080;&#1084;&#1086;&#1075;&#1086;
&#1090;&#1080;&#1087;&#1072;, &#1085;&#1086; &#1085;&#1072;&#1084;
&#1085;&#1077;&#1086;&#1073;&#1093;&#1086;&#1076;&#1080;&#1084;&#1099;
&#1090;&#1086;&#1083;&#1100;&#1082;&#1086;
&#1095;&#1077;&#1090;&#1099;&#1088;&#1077; &#1077;&#1075;&#1086;
&#1079;&#1085;&#1072;&#1095;&#1077;&#1085;&#1080;&#1103;,
&#1080;&#1089;&#1087;&#1086;&#1083;&#1100;&#1079;&#1091;&#1077;&#1084;&#1099;&#1077;
&#1076;&#1083;&#1103;
&#1087;&#1088;&#1086;&#1089;&#1084;&#1086;&#1090;&#1088;&#1072;
&#1089;&#1086;&#1076;&#1077;&#1088;&#1078;&#1080;&#1084;&#1086;&#1075;&#1086;
&#1076;&#1080;&#1088;&#1077;&#1082;&#1090;&#1086;&#1088;&#1080;&#1080;.
<p><code><!--mstheme--></font>
<pre>        #define FileDirectoryInformation 1
        #define FileFullDirectoryInformation 2
        #define FileBothDirectoryInformation 3
        #define FileNamesInformation 12</pre>
<!--mstheme--><font face="Arial, Arial, Helvetica"></code>
<p>&#1089;&#1090;&#1088;&#1091;&#1082;&#1090;&#1091;&#1088;&#1072;
&#1079;&#1072;&#1087;&#1080;&#1089;&#1080; &#1074; FileInformation
&#1076;&#1083;&#1103; FileDirectoryInformation:
<p><code><!--mstheme--></font>
<pre>        typedef struct _FILE_DIRECTORY_INFORMATION { 
                ULONG NextEntryOffset;
                ULONG Unknown;
                LARGE_INTEGER CreationTime;
                LARGE_INTEGER LastAccessTime;
                LARGE_INTEGER LastWriteTime;
                LARGE_INTEGER ChangeTime;
                LARGE_INTEGER EndOfFile;
                LARGE_INTEGER AllocationSize; 
                ULONG FileAttributes;
                ULONG FileNameLength;
                WCHAR FileName[1];
        } FILE_DIRECTORY_INFORMATION, *PFILE_DIRECTORY_INFORMATION;</pre>
<!--mstheme--><font face="Arial, Arial, Helvetica"></code>
<p>&#1076;&#1083;&#1103; FileFullDirectoryInformation:
<p><code><!--mstheme--></font>
<pre>        typedef struct _FILE_FULL_DIRECTORY_INFORMATION {
                ULONG NextEntryOffset;
                ULONG Unknown;
                LARGE_INTEGER CreationTime;
                LARGE_INTEGER LastAccessTime;
                LARGE_INTEGER LastWriteTime;
                LARGE_INTEGER ChangeTime;
                LARGE_INTEGER EndOfFile;
                LARGE_INTEGER AllocationSize;
                ULONG FileAttributes;
                ULONG FileNameLength;
                ULONG EaInformationLength;
                WCHAR FileName[1];
        } FILE_FULL_DIRECTORY_INFORMATION, *PFILE_FULL_DIRECTORY_INFORMATION;</pre>
<!--mstheme--><font face="Arial, Arial, Helvetica"></code>
<p>&#1076;&#1083;&#1103; FileBothDirectoryInformation:
<p><code><!--mstheme--></font>
<pre>        typedef struct _FILE_BOTH_DIRECTORY_INFORMATION { 
                ULONG NextEntryOffset;
                ULONG Unknown;
                LARGE_INTEGER CreationTime;
                LARGE_INTEGER LastAccessTime;
                LARGE_INTEGER LastWriteTime;
                LARGE_INTEGER ChangeTime;
                LARGE_INTEGER EndOfFile;
                LARGE_INTEGER AllocationSize;
                ULONG FileAttributes;
                ULONG FileNameLength;
                ULONG EaInformationLength;
                UCHAR AlternateNameLength;
                WCHAR AlternateName[12];
                WCHAR FileName[1];
        } FILE_BOTH_DIRECTORY_INFORMATION, *PFILE_BOTH_DIRECTORY_INFORMATION; </pre>
<!--mstheme--><font face="Arial, Arial, Helvetica"></code>
<p>&#1080; &#1076;&#1083;&#1103; FileNamesInformation:
<p><code><!--mstheme--></font>
<pre>        typedef struct _FILE_NAMES_INFORMATION {
                ULONG NextEntryOffset;
                ULONG Unknown;
                ULONG FileNameLength;
                WCHAR FileName[1];
        } FILE_NAMES_INFORMATION, *PFILE_NAMES_INFORMATION;</pre>
<!--mstheme--><font face="Arial, Arial, Helvetica"></code>
<p>&#1060;&#1091;&#1085;&#1082;&#1094;&#1080;&#1103;
&#1079;&#1072;&#1087;&#1080;&#1089;&#1099;&#1074;&#1072;&#1077;&#1090;
&#1085;&#1072;&#1073;&#1086;&#1088; &#1101;&#1090;&#1080;&#1093;
&#1089;&#1090;&#1088;&#1091;&#1082;&#1090;&#1091;&#1088; &#1074;
&#1073;&#1091;&#1092;&#1077;&#1088; FileInformation. &#1042;&#1086;
&#1074;&#1089;&#1077;&#1093; &#1101;&#1090;&#1080;&#1093;
&#1090;&#1080;&#1087;&#1072;&#1093;
&#1089;&#1090;&#1088;&#1091;&#1082;&#1090;&#1091;&#1088; &#1076;&#1083;&#1103;
&#1085;&#1072;&#1089; &#1074;&#1072;&#1078;&#1085;&#1099;
&#1090;&#1086;&#1083;&#1100;&#1082;&#1086; &#1090;&#1088;&#1080;
&#1087;&#1077;&#1088;&#1077;&#1084;&#1077;&#1085;&#1085;&#1099;&#1093;.
<p>NextEntryOffset - &#1088;&#1072;&#1079;&#1084;&#1077;&#1088;
&#1076;&#1072;&#1085;&#1085;&#1086;&#1075;&#1086;
&#1101;&#1083;&#1077;&#1084;&#1077;&#1085;&#1090;&#1072;
&#1089;&#1087;&#1080;&#1089;&#1082;&#1072;.
&#1055;&#1077;&#1088;&#1074;&#1099;&#1081;
&#1101;&#1083;&#1077;&#1084;&#1077;&#1085;&#1090;
&#1088;&#1072;&#1089;&#1087;&#1086;&#1083;&#1086;&#1078;&#1077;&#1085;
&#1087;&#1086; &#1072;&#1076;&#1088;&#1077;&#1089;&#1091; FileInformation + 0,
&#1072; &#1074;&#1090;&#1086;&#1088;&#1086;&#1081;
&#1101;&#1083;&#1077;&#1084;&#1077;&#1085;&#1090; &#1087;&#1086;
&#1072;&#1076;&#1088;&#1077;&#1089;&#1091; FileInformation + NextEntryOffset
&#1087;&#1077;&#1088;&#1074;&#1086;&#1075;&#1086;
&#1101;&#1083;&#1077;&#1084;&#1077;&#1085;&#1090;&#1072;. &#1059;
&#1087;&#1086;&#1089;&#1083;&#1077;&#1076;&#1085;&#1077;&#1075;&#1086;
&#1101;&#1083;&#1077;&#1084;&#1077;&#1085;&#1090;&#1072;
&#1087;&#1086;&#1083;&#1077; NextEntryOffset
&#1089;&#1086;&#1076;&#1077;&#1088;&#1078;&#1080;&#1090;
&#1085;&#1091;&#1083;&#1100;.
<p>FileName - &#1101;&#1090;&#1086; &#1087;&#1086;&#1083;&#1085;&#1086;&#1077;
&#1080;&#1084;&#1103; &#1092;&#1072;&#1081;&#1083;&#1072;.<br>
FileNameLength - &#1101;&#1090;&#1086; &#1076;&#1083;&#1080;&#1085;&#1072;
&#1080;&#1084;&#1077;&#1085;&#1080; &#1092;&#1072;&#1081;&#1083;&#1072;.
<p>&#1044;&#1083;&#1103; &#1089;&#1082;&#1088;&#1099;&#1090;&#1080;&#1103;
&#1092;&#1072;&#1081;&#1083;&#1072;,
&#1085;&#1077;&#1086;&#1073;&#1093;&#1086;&#1076;&#1080;&#1084;&#1086;
&#1089;&#1088;&#1072;&#1074;&#1085;&#1080;&#1090;&#1100; &#1080;&#1084;&#1103;
&#1082;&#1072;&#1078;&#1076;&#1086;&#1081;
&#1074;&#1086;&#1079;&#1074;&#1088;&#1072;&#1097;&#1072;&#1077;&#1084;&#1086;&#1081;
&#1079;&#1072;&#1087;&#1080;&#1089;&#1080; &#1080; &#1080;&#1084;&#1103;
&#1092;&#1072;&#1081;&#1083;&#1072;,
&#1082;&#1086;&#1090;&#1086;&#1088;&#1099;&#1081; &#1084;&#1099;
&#1093;&#1086;&#1090;&#1080;&#1084; &#1089;&#1082;&#1088;&#1099;&#1090;&#1100;.
&#1045;&#1089;&#1083;&#1080; &#1084;&#1099; &#1093;&#1086;&#1090;&#1080;&#1084;
&#1089;&#1082;&#1088;&#1099;&#1090;&#1100;
&#1087;&#1077;&#1088;&#1074;&#1091;&#1102;
&#1079;&#1072;&#1087;&#1080;&#1089;&#1100;, &#1085;&#1091;&#1078;&#1085;&#1086;
&#1089;&#1076;&#1074;&#1080;&#1085;&#1091;&#1090;&#1100;
&#1089;&#1083;&#1077;&#1076;&#1091;&#1102;&#1097;&#1080;&#1077; &#1079;&#1072;
&#1085;&#1077;&#1081;
&#1089;&#1090;&#1088;&#1091;&#1082;&#1090;&#1091;&#1088;&#1099; &#1085;&#1072;
&#1088;&#1072;&#1079;&#1084;&#1077;&#1088;
&#1087;&#1077;&#1088;&#1074;&#1086;&#1081;
&#1079;&#1072;&#1087;&#1080;&#1089;&#1080;. &#1069;&#1090;&#1086;
&#1087;&#1088;&#1080;&#1074;&#1077;&#1076;&#1077;&#1090; &#1082;
&#1090;&#1086;&#1084;&#1091;, &#1095;&#1090;&#1086;
&#1087;&#1077;&#1088;&#1074;&#1072;&#1103;
&#1079;&#1072;&#1087;&#1080;&#1089;&#1100; &#1073;&#1091;&#1076;&#1077;&#1090;
&#1079;&#1072;&#1090;&#1077;&#1088;&#1090;&#1072;. &#1045;&#1089;&#1083;&#1080;
&#1084;&#1099; &#1093;&#1086;&#1090;&#1080;&#1084;
&#1089;&#1082;&#1088;&#1099;&#1090;&#1100;
&#1076;&#1088;&#1091;&#1075;&#1091;&#1102;
&#1079;&#1072;&#1087;&#1080;&#1089;&#1100;, &#1084;&#1099;
&#1084;&#1086;&#1078;&#1077;&#1084; &#1087;&#1088;&#1086;&#1089;&#1090;&#1086;
&#1080;&#1079;&#1084;&#1077;&#1085;&#1080;&#1090;&#1100;
&#1079;&#1085;&#1072;&#1095;&#1077;&#1085;&#1080;&#1077; NextEntryOffset
&#1087;&#1088;&#1077;&#1076;&#1099;&#1076;&#1091;&#1097;&#1077;&#1081;
&#1079;&#1072;&#1087;&#1080;&#1089;&#1080;. &#1053;&#1086;&#1074;&#1086;&#1077;
&#1079;&#1085;&#1072;&#1095;&#1077;&#1085;&#1080;&#1077; NextEntryOffset
&#1073;&#1091;&#1076;&#1077;&#1090; &#1085;&#1091;&#1083;&#1100;,
&#1077;&#1089;&#1083;&#1080; &#1084;&#1099; &#1093;&#1086;&#1090;&#1080;&#1084;
&#1089;&#1082;&#1088;&#1099;&#1090;&#1100;
&#1087;&#1086;&#1089;&#1083;&#1077;&#1076;&#1085;&#1102;&#1102;
&#1079;&#1072;&#1087;&#1080;&#1089;&#1100;, &#1080;&#1085;&#1072;&#1095;&#1077;
&#1079;&#1085;&#1072;&#1095;&#1077;&#1085;&#1080;&#1077;
&#1073;&#1091;&#1076;&#1077;&#1090; &#1089;&#1091;&#1084;&#1084;&#1086;&#1081;
&#1087;&#1086;&#1083;&#1077;&#1081; NextEntryOffset
&#1079;&#1072;&#1087;&#1080;&#1089;&#1080;,
&#1082;&#1086;&#1090;&#1086;&#1088;&#1091;&#1102; &#1084;&#1099;
&#1093;&#1086;&#1090;&#1080;&#1084; &#1089;&#1082;&#1088;&#1099;&#1090;&#1100;
&#1080; &#1087;&#1088;&#1077;&#1076;&#1099;&#1076;&#1091;&#1097;&#1077;&#1081;
&#1079;&#1072;&#1087;&#1080;&#1089;&#1080;. &#1047;&#1072;&#1090;&#1077;&#1084;
&#1085;&#1077;&#1086;&#1073;&#1093;&#1086;&#1076;&#1080;&#1084;&#1086;
&#1080;&#1079;&#1084;&#1077;&#1085;&#1080;&#1090;&#1100;
&#1079;&#1085;&#1072;&#1095;&#1077;&#1085;&#1080;&#1077;
&#1087;&#1086;&#1083;&#1103; Unknown
&#1087;&#1088;&#1077;&#1076;&#1099;&#1076;&#1091;&#1097;&#1077;&#1081;
&#1079;&#1072;&#1087;&#1080;&#1089;&#1080;,
&#1082;&#1086;&#1090;&#1086;&#1088;&#1086;&#1077;
&#1087;&#1088;&#1077;&#1076;&#1086;&#1089;&#1090;&#1072;&#1074;&#1083;&#1103;&#1077;&#1090;
&#1080;&#1085;&#1076;&#1077;&#1082;&#1089; &#1076;&#1083;&#1103;
&#1087;&#1086;&#1089;&#1083;&#1077;&#1076;&#1091;&#1102;&#1097;&#1077;&#1075;&#1086;
&#1087;&#1086;&#1080;&#1089;&#1082;&#1072;.
&#1047;&#1085;&#1072;&#1095;&#1077;&#1085;&#1080;&#1077;
&#1087;&#1086;&#1083;&#1103; Unknown
&#1087;&#1088;&#1077;&#1076;&#1099;&#1076;&#1091;&#1097;&#1077;&#1081;
&#1079;&#1072;&#1087;&#1080;&#1089;&#1080;
&#1076;&#1086;&#1083;&#1078;&#1085;&#1086;
&#1088;&#1072;&#1074;&#1085;&#1103;&#1090;&#1100;&#1089;&#1103;
&#1079;&#1085;&#1072;&#1095;&#1077;&#1085;&#1080;&#1102;
&#1087;&#1086;&#1083;&#1103; Unknown &#1079;&#1072;&#1087;&#1080;&#1089;&#1080;,
&#1082;&#1086;&#1090;&#1086;&#1088;&#1091;&#1102; &#1084;&#1099;
&#1093;&#1086;&#1090;&#1080;&#1084; &#1089;&#1082;&#1088;&#1099;&#1090;&#1100;.
<p>&#1045;&#1089;&#1083;&#1080; &#1085;&#1077;&#1090;
&#1085;&#1080;&#1086;&#1076;&#1085;&#1086;&#1081;
&#1079;&#1072;&#1087;&#1080;&#1089;&#1080;,
&#1082;&#1086;&#1090;&#1086;&#1088;&#1091;&#1102;
&#1084;&#1086;&#1078;&#1085;&#1086; &#1074;&#1080;&#1076;&#1077;&#1090;&#1100;,
&#1084;&#1099; &#1076;&#1086;&#1083;&#1078;&#1085;&#1099;
&#1074;&#1077;&#1088;&#1085;&#1091;&#1090;&#1100;
&#1086;&#1096;&#1080;&#1073;&#1082;&#1091; STATUS_NO_SUCH_FILE.
<p><code><!--mstheme--></font>
<pre>        #define STATUS_NO_SUCH_FILE 0xC000000F</pre>
<!--mstheme--><font face="Arial, Arial, Helvetica"></code><a name="3_2"></a>
<p align="center">=====[ 3.2 NtVdmControl ]=====</p>
<p>&#1055;&#1086;
&#1085;&#1077;&#1080;&#1079;&#1074;&#1077;&#1089;&#1090;&#1085;&#1086;&#1081;
&#1087;&#1088;&#1080;&#1095;&#1080;&#1085;&#1077;
&#1101;&#1084;&#1091;&#1083;&#1103;&#1094;&#1080;&#1103; DOS - NTVDM
&#1084;&#1086;&#1078;&#1077;&#1090;
&#1087;&#1086;&#1083;&#1091;&#1095;&#1080;&#1090;&#1100;
&#1089;&#1087;&#1080;&#1089;&#1086;&#1082;
&#1092;&#1072;&#1081;&#1083;&#1086;&#1074; &#1077;&#1097;&#1077; &#1080; &#1089;
&#1087;&#1086;&#1084;&#1086;&#1097;&#1100;&#1102;
&#1092;&#1091;&#1085;&#1082;&#1094;&#1080;&#1080; NtVdmControl.
<p><code><!--mstheme--></font>
<pre>        NTSTATUS NtVdmControl(        
                IN ULONG ControlCode,
                IN PVOID ControlData
        );</pre>
<!--mstheme--><font face="Arial, Arial, Helvetica"></code>
<p>ControlCode &#1091;&#1082;&#1072;&#1079;&#1099;&#1074;&#1072;&#1077;&#1090;
&#1087;&#1086;&#1076;&#1092;&#1091;&#1085;&#1082;&#1094;&#1080;&#1102;,
&#1082;&#1086;&#1090;&#1086;&#1088;&#1072;&#1103;
&#1073;&#1091;&#1076;&#1077;&#1090;
&#1087;&#1088;&#1080;&#1084;&#1077;&#1085;&#1077;&#1085;&#1072; &#1082;
&#1076;&#1072;&#1085;&#1085;&#1099;&#1084; &#1074;
&#1073;&#1091;&#1092;&#1077;&#1088;&#1077; ControlData.
&#1045;&#1089;&#1083;&#1080; ControlCode
&#1088;&#1072;&#1074;&#1085;&#1103;&#1077;&#1090;&#1089;&#1103; VdmDirectoryFile,
&#1101;&#1090;&#1072; &#1092;&#1091;&#1085;&#1082;&#1094;&#1080;&#1103;
&#1076;&#1077;&#1083;&#1072;&#1077;&#1090; &#1090;&#1086; &#1078;&#1077;,
&#1095;&#1090;&#1086; &#1080; NtQueryDirectoryFile &#1089; FileInformationClass
&#1088;&#1072;&#1074;&#1085;&#1099;&#1084; FileBothDirectoryInformation.
<p><code><!--mstheme--></font>
<pre>        #define VdmDirectoryFile 6</pre>
<!--mstheme--><font face="Arial, Arial, Helvetica"></code>
<p>&#1058;&#1086;&#1075;&#1076;&#1072; &#1073;&#1091;&#1092;&#1077;&#1088;
ControlData
&#1080;&#1089;&#1087;&#1086;&#1083;&#1100;&#1079;&#1091;&#1077;&#1090;&#1089;&#1103;
&#1082;&#1072;&#1082; FileInformation.
&#1045;&#1076;&#1080;&#1085;&#1089;&#1090;&#1074;&#1077;&#1085;&#1085;&#1072;&#1103;
&#1088;&#1072;&#1079;&#1085;&#1080;&#1094;&#1072; &#1074; &#1090;&#1086;&#1084;,
&#1095;&#1090;&#1086; &#1084;&#1099; &#1085;&#1077;
&#1079;&#1085;&#1072;&#1077;&#1084; &#1076;&#1083;&#1080;&#1085;&#1091;
&#1101;&#1090;&#1086;&#1075;&#1086; &#1073;&#1091;&#1092;&#1077;&#1088;&#1072;.
&#1055;&#1086;&#1101;&#1090;&#1086;&#1084;&#1091; &#1084;&#1099;
&#1076;&#1086;&#1083;&#1078;&#1085;&#1099;
&#1074;&#1099;&#1095;&#1080;&#1089;&#1083;&#1080;&#1090;&#1100; &#1077;&#1077;
&#1074;&#1088;&#1091;&#1095;&#1085;&#1091;&#1102;. &#1052;&#1099;
&#1084;&#1086;&#1078;&#1077;&#1084;
&#1089;&#1083;&#1086;&#1078;&#1080;&#1090;&#1100; NextEntryOffset
&#1074;&#1089;&#1077;&#1093; &#1079;&#1072;&#1087;&#1080;&#1089;&#1077;&#1081;,
FileNameLength &#1087;&#1086;&#1089;&#1083;&#1077;&#1076;&#1085;&#1077;&#1081;
&#1079;&#1072;&#1087;&#1080;&#1089;&#1080; &#1080; 0x5E (&#1076;&#1083;&#1080;&#1085;&#1072;
&#1087;&#1086;&#1089;&#1083;&#1077;&#1076;&#1085;&#1077;&#1081;
&#1079;&#1072;&#1087;&#1080;&#1089;&#1080;
&#1080;&#1089;&#1082;&#1083;&#1102;&#1095;&#1072;&#1103;
&#1076;&#1083;&#1080;&#1085;&#1091; &#1080;&#1084;&#1077;&#1085;&#1080;
&#1092;&#1072;&#1081;&#1083;&#1072;). &#1052;&#1077;&#1090;&#1086;&#1076;&#1099;
&#1089;&#1082;&#1088;&#1099;&#1090;&#1080;&#1103;
&#1090;&#1072;&#1082;&#1080;&#1077; &#1078;&#1077; &#1082;&#1072;&#1082; &#1080;
&#1074; &#1089;&#1083;&#1091;&#1095;&#1072;&#1077; &#1089; NtQueryDirectoryFile.
<a name="4"></a>
<p align="center">=====[ 4.
&#1055;&#1088;&#1086;&#1094;&#1077;&#1089;&#1089;&#1099; ]=====</p>
<p>&#1056;&#1072;&#1079;&#1083;&#1080;&#1095;&#1085;&#1072;&#1103;
&#1089;&#1080;&#1089;&#1090;&#1077;&#1084;&#1085;&#1072;&#1103;
&#1080;&#1085;&#1092;&#1086;&#1088;&#1084;&#1072;&#1094;&#1080;&#1103;
&#1076;&#1086;&#1089;&#1090;&#1091;&#1087;&#1085;&#1072;
&#1095;&#1077;&#1088;&#1077;&#1079; NtQuerySystemInformation.
<p><code><!--mstheme--></font>
<pre>        NTSTATUS NtQuerySystemInformation(
                IN SYSTEM_INFORMATION_CLASS SystemInformationClass,
                IN OUT PVOID SystemInformation,
                IN ULONG SystemInformationLength,
                OUT PULONG ReturnLength OPTIONAL
        );</pre>
<!--mstheme--><font face="Arial, Arial, Helvetica"></code>
<p>SystemInformationClass
&#1091;&#1082;&#1072;&#1079;&#1099;&#1074;&#1072;&#1077;&#1090;
&#1090;&#1080;&#1087;
&#1080;&#1085;&#1092;&#1086;&#1088;&#1084;&#1072;&#1094;&#1080;&#1080;,
&#1082;&#1086;&#1090;&#1086;&#1088;&#1091;&#1102; &#1084;&#1099;
&#1093;&#1086;&#1090;&#1080;&#1084;
&#1087;&#1086;&#1083;&#1091;&#1095;&#1080;&#1090;&#1100;, SystemInformation -
&#1101;&#1090;&#1086;
&#1091;&#1082;&#1072;&#1079;&#1072;&#1090;&#1077;&#1083;&#1100; &#1085;&#1072;
&#1088;&#1077;&#1079;&#1091;&#1083;&#1100;&#1090;&#1080;&#1088;&#1091;&#1102;&#1097;&#1080;&#1081;
&#1073;&#1091;&#1092;&#1077;&#1088;, SystemInformationLength -
&#1088;&#1072;&#1079;&#1084;&#1077;&#1088; &#1101;&#1090;&#1086;&#1075;&#1086;
&#1073;&#1091;&#1092;&#1077;&#1088;&#1072; &#1080; ReturnLength -
&#1082;&#1086;&#1083;&#1080;&#1095;&#1077;&#1089;&#1090;&#1074;&#1086;
&#1079;&#1072;&#1087;&#1080;&#1089;&#1072;&#1085;&#1085;&#1099;&#1093;
&#1073;&#1072;&#1081;&#1090;.
<p>&#1044;&#1083;&#1103;
&#1087;&#1077;&#1088;&#1077;&#1095;&#1080;&#1089;&#1083;&#1077;&#1085;&#1080;&#1103;
&#1079;&#1072;&#1087;&#1091;&#1097;&#1077;&#1085;&#1085;&#1099;&#1093;
&#1087;&#1088;&#1086;&#1094;&#1077;&#1089;&#1089;&#1086;&#1074; &#1084;&#1099;
&#1091;&#1089;&#1090;&#1072;&#1085;&#1072;&#1074;&#1083;&#1080;&#1074;&#1072;&#1077;&#1084;
&#1074; &#1087;&#1072;&#1088;&#1072;&#1084;&#1077;&#1090;&#1088;
SystemInformationClass &#1079;&#1085;&#1072;&#1095;&#1077;&#1085;&#1080;&#1077;
SystemProcessesAndThreadsInformation.
<p><code><!--mstheme--></font>
<pre>        #define SystemInformationClass 5</pre>
<!--mstheme--><font face="Arial, Arial, Helvetica"></code>
<p>&#1042;&#1086;&#1079;&#1074;&#1088;&#1072;&#1097;&#1072;&#1077;&#1084;&#1072;&#1103;
&#1089;&#1090;&#1088;&#1091;&#1082;&#1090;&#1091;&#1088;&#1072; &#1074;
&#1073;&#1091;&#1092;&#1077;&#1088;&#1077; SystemInformation:
<p><code><!--mstheme--></font>
<pre>        typedef struct _SYSTEM_PROCESSES { 
                ULONG NextEntryDelta;
                ULONG ThreadCount;
                ULONG Reserved1[6];
                LARGE_INTEGER CreateTime;
                LARGE_INTEGER UserTime;
                LARGE_INTEGER KernelTime;
                UNICODE_STRING ProcessName; 
                KPRIORITY BasePriority;
                ULONG ProcessId;
                ULONG InheritedFromProcessId;
                ULONG HandleCount;
                ULONG Reserved2[2];
                VM_COUNTERS VmCounters;
                IO_COUNTERS IoCounters;  // &#1090;&#1086;&#1083;&#1100;&#1082;&#1086; Windows 2000
                SYSTEM_THREADS Threads[1];
        } SYSTEM_PROCESSES, *PSYSTEM_PROCESSES;</pre>
<!--mstheme--><font face="Arial, Arial, Helvetica"></code>
<p>&#1057;&#1082;&#1088;&#1099;&#1090;&#1080;&#1077;
&#1087;&#1088;&#1086;&#1094;&#1077;&#1089;&#1089;&#1086;&#1074;
&#1087;&#1086;&#1093;&#1086;&#1078;&#1077; &#1085;&#1072;
&#1089;&#1082;&#1088;&#1099;&#1090;&#1080;&#1077;
&#1092;&#1072;&#1081;&#1083;&#1086;&#1074;. &#1052;&#1099;
&#1076;&#1086;&#1083;&#1078;&#1085;&#1099;
&#1080;&#1079;&#1084;&#1077;&#1085;&#1080;&#1090;&#1100; NextEntryDelta
&#1079;&#1072;&#1087;&#1080;&#1089;&#1080;
&#1087;&#1088;&#1077;&#1076;&#1096;&#1077;&#1089;&#1090;&#1074;&#1091;&#1102;&#1097;&#1077;&#1081;
&#1079;&#1072;&#1087;&#1080;&#1089;&#1080;
&#1089;&#1082;&#1088;&#1099;&#1074;&#1072;&#1077;&#1084;&#1086;&#1075;&#1086;
&#1087;&#1088;&#1086;&#1094;&#1077;&#1089;&#1089;&#1072;.
&#1054;&#1073;&#1099;&#1095;&#1085;&#1086; &#1085;&#1077;
&#1090;&#1088;&#1077;&#1073;&#1091;&#1077;&#1090;&#1089;&#1103;
&#1089;&#1082;&#1088;&#1099;&#1074;&#1072;&#1090;&#1100;
&#1087;&#1077;&#1088;&#1074;&#1091;&#1102;
&#1079;&#1072;&#1087;&#1080;&#1089;&#1100;, &#1090;.&#1082;.
&#1101;&#1090;&#1086; &#1087;&#1088;&#1086;&#1094;&#1077;&#1089;&#1089; Idle. <a name="5"></a>
<p align="center">=====[ 5. &#1056;&#1077;&#1077;&#1089;&#1090;&#1088; ]=====</p>
<p>&#1056;&#1077;&#1077;&#1089;&#1090;&#1088; Windows - &#1101;&#1090;&#1086;
&#1076;&#1086;&#1089;&#1090;&#1072;&#1090;&#1086;&#1095;&#1085;&#1086;
&#1073;&#1086;&#1083;&#1100;&#1096;&#1072;&#1103;
&#1076;&#1088;&#1077;&#1074;&#1086;&#1074;&#1080;&#1076;&#1085;&#1072;&#1103;
&#1089;&#1090;&#1088;&#1091;&#1082;&#1090;&#1091;&#1088;&#1072;,
&#1089;&#1086;&#1076;&#1077;&#1088;&#1078;&#1072;&#1097;&#1072;&#1103;
&#1076;&#1074;&#1072; &#1074;&#1072;&#1078;&#1085;&#1099;&#1093;
&#1090;&#1080;&#1087;&#1072; &#1079;&#1072;&#1087;&#1080;&#1089;&#1077;&#1081;,
&#1082;&#1086;&#1090;&#1086;&#1088;&#1099;&#1077; &#1084;&#1099;
&#1084;&#1086;&#1078;&#1077;&#1084;
&#1079;&#1072;&#1093;&#1086;&#1090;&#1077;&#1090;&#1100;
&#1089;&#1082;&#1088;&#1099;&#1090;&#1100;.
&#1055;&#1077;&#1088;&#1074;&#1099;&#1081; &#1090;&#1080;&#1087; -
&#1082;&#1083;&#1102;&#1095;&#1080;
&#1088;&#1077;&#1077;&#1089;&#1090;&#1088;&#1072;,
&#1074;&#1090;&#1086;&#1088;&#1086;&#1081; -
&#1079;&#1085;&#1072;&#1095;&#1077;&#1085;&#1080;&#1103;
&#1088;&#1077;&#1077;&#1089;&#1090;&#1088;&#1072;.
&#1041;&#1083;&#1072;&#1075;&#1086;&#1076;&#1072;&#1088;&#1103;
&#1089;&#1090;&#1088;&#1091;&#1082;&#1090;&#1091;&#1088;&#1077;
&#1088;&#1077;&#1077;&#1089;&#1090;&#1088;&#1072;
&#1089;&#1082;&#1088;&#1099;&#1090;&#1080;&#1077; &#1077;&#1075;&#1086;
&#1082;&#1083;&#1102;&#1095;&#1077;&#1081; &#1085;&#1077; &#1090;&#1072;&#1082;
&#1090;&#1088;&#1080;&#1074;&#1080;&#1072;&#1083;&#1100;&#1085;&#1086;,
&#1082;&#1072;&#1082; &#1089;&#1082;&#1088;&#1099;&#1090;&#1080;&#1077;
&#1092;&#1072;&#1081;&#1083;&#1086;&#1074; &#1080;&#1083;&#1080;
&#1087;&#1088;&#1086;&#1094;&#1077;&#1089;&#1089;&#1086;&#1074;. <a name="5_1"></a>
<p align="center">=====[ 5.1 NtEnumerateKey ]=====</p>
<p>&#1041;&#1083;&#1072;&#1075;&#1086;&#1076;&#1072;&#1088;&#1103;
&#1089;&#1090;&#1088;&#1091;&#1082;&#1090;&#1091;&#1088;&#1077;
&#1088;&#1077;&#1077;&#1089;&#1090;&#1088;&#1072;, &#1084;&#1099; &#1085;&#1077;
&#1084;&#1086;&#1078;&#1077;&#1084;
&#1079;&#1072;&#1087;&#1088;&#1086;&#1089;&#1080;&#1090;&#1100;
&#1089;&#1087;&#1080;&#1089;&#1086;&#1082; &#1074;&#1089;&#1077;&#1093;
&#1082;&#1083;&#1102;&#1095;&#1077;&#1081; &#1074;
&#1082;&#1072;&#1082;&#1086;&#1081;-&#1083;&#1080;&#1073;&#1086;
&#1077;&#1075;&#1086; &#1095;&#1072;&#1089;&#1090;&#1080;. &#1052;&#1099;
&#1084;&#1086;&#1078;&#1077;&#1084;
&#1087;&#1086;&#1083;&#1091;&#1095;&#1080;&#1090;&#1100;
&#1080;&#1085;&#1092;&#1086;&#1088;&#1084;&#1072;&#1094;&#1080;&#1102;
&#1090;&#1086;&#1083;&#1100;&#1082;&#1086; &#1086;&#1073;
&#1086;&#1076;&#1085;&#1086;&#1084; &#1082;&#1083;&#1102;&#1095;&#1077;,
&#1091;&#1082;&#1072;&#1079;&#1072;&#1085;&#1085;&#1086;&#1084;
&#1077;&#1075;&#1086; &#1080;&#1085;&#1076;&#1077;&#1082;&#1089;&#1086;&#1084;.
&#1048;&#1089;&#1087;&#1086;&#1083;&#1100;&#1079;&#1091;&#1077;&#1090;&#1089;&#1103;
&#1092;&#1091;&#1085;&#1082;&#1094;&#1080;&#1103; NtEnumerateKey.
<p><code><!--mstheme--></font>
<pre>        NTSTATUS NtEnumerateKey(
                IN HANDLE KeyHandle,
                IN ULONG Index,
                IN KEY_INFORMATION_CLASS KeyInformationClass, 
                OUT PVOID KeyInformation,
                IN ULONG KeyInformationLength,
                OUT PULONG ResultLength
        );</pre>
<!--mstheme--><font face="Arial, Arial, Helvetica"></code>
<p>KeyHandle - &#1101;&#1090;&#1086;
&#1076;&#1077;&#1089;&#1082;&#1088;&#1080;&#1087;&#1090;&#1086;&#1088;
&#1082;&#1083;&#1102;&#1095;&#1072;, &#1074;
&#1082;&#1086;&#1090;&#1086;&#1088;&#1086;&#1084; &#1084;&#1099;
&#1093;&#1086;&#1090;&#1080;&#1084;
&#1087;&#1086;&#1083;&#1091;&#1095;&#1080;&#1090;&#1100;
&#1080;&#1085;&#1092;&#1086;&#1088;&#1084;&#1072;&#1094;&#1080;&#1102; &#1086;
&#1087;&#1086;&#1076;&#1082;&#1083;&#1102;&#1095;&#1077;,
&#1091;&#1082;&#1072;&#1079;&#1072;&#1085;&#1085;&#1086;&#1084;
&#1087;&#1072;&#1088;&#1072;&#1084;&#1077;&#1090;&#1088;&#1086;&#1084; Index.
&#1058;&#1080;&#1087;
&#1087;&#1086;&#1083;&#1091;&#1095;&#1077;&#1085;&#1085;&#1086;&#1081;
&#1080;&#1085;&#1092;&#1086;&#1088;&#1084;&#1072;&#1094;&#1080;&#1080;
&#1086;&#1087;&#1088;&#1077;&#1076;&#1077;&#1083;&#1103;&#1077;&#1090;&#1089;&#1103;
&#1087;&#1086;&#1083;&#1077;&#1084; KeyInformationClass.
&#1044;&#1072;&#1085;&#1085;&#1099;&#1077;
&#1079;&#1072;&#1087;&#1080;&#1089;&#1099;&#1074;&#1072;&#1102;&#1090;&#1089;&#1103;
&#1074; &#1073;&#1091;&#1092;&#1092;&#1077;&#1088; KeyInformation,
&#1076;&#1083;&#1080;&#1085;&#1072;
&#1082;&#1086;&#1090;&#1086;&#1088;&#1086;&#1075;&#1086;
&#1091;&#1082;&#1072;&#1079;&#1072;&#1085;&#1072; &#1074;
&#1087;&#1072;&#1088;&#1072;&#1084;&#1077;&#1090;&#1088;&#1077;
KeyInformationLength.
&#1050;&#1086;&#1083;&#1080;&#1095;&#1077;&#1089;&#1090;&#1074;&#1086;
&#1079;&#1072;&#1087;&#1080;&#1089;&#1072;&#1085;&#1085;&#1099;&#1093;
&#1073;&#1072;&#1081;&#1090;
&#1074;&#1086;&#1079;&#1074;&#1088;&#1072;&#1097;&#1072;&#1077;&#1090;&#1089;&#1103;
&#1074; ResultLength.
<p>&#1053;&#1072;&#1080;&#1073;&#1086;&#1083;&#1077;&#1077;
&#1074;&#1072;&#1078;&#1085;&#1099;&#1084;
&#1103;&#1074;&#1083;&#1103;&#1077;&#1090;&#1089;&#1103;
&#1087;&#1086;&#1085;&#1080;&#1084;&#1072;&#1085;&#1080;&#1077;
&#1090;&#1086;&#1075;&#1086;, &#1095;&#1090;&#1086; &#1077;&#1089;&#1083;&#1080;
&#1084;&#1099; &#1089;&#1082;&#1088;&#1086;&#1077;&#1084;
&#1082;&#1083;&#1102;&#1095;, &#1090;&#1086;
&#1080;&#1085;&#1076;&#1077;&#1082;&#1089;&#1099; &#1074;&#1089;&#1077;&#1093;
&#1087;&#1086;&#1089;&#1083;&#1077;&#1076;&#1091;&#1102;&#1097;&#1080;&#1093;
&#1082;&#1083;&#1102;&#1095;&#1077;&#1081; &#1073;&#1091;&#1076;&#1091;&#1090;
&#1089;&#1076;&#1074;&#1080;&#1085;&#1091;&#1090;&#1099;. &#1048;
&#1090;&#1072;&#1082; &#1082;&#1072;&#1082; &#1085;&#1072;&#1084;
&#1087;&#1088;&#1080;&#1076;&#1077;&#1090;&#1089;&#1103;
&#1087;&#1086;&#1083;&#1091;&#1095;&#1072;&#1090;&#1100;
&#1080;&#1085;&#1092;&#1086;&#1088;&#1084;&#1072;&#1094;&#1080;&#1102; &#1086;
&#1082;&#1083;&#1102;&#1095;&#1077; &#1089;
&#1073;&#1086;&#1083;&#1100;&#1096;&#1080;&#1084;
&#1080;&#1085;&#1076;&#1077;&#1082;&#1089;&#1086;&#1084;
&#1079;&#1072;&#1087;&#1088;&#1072;&#1096;&#1080;&#1074;&#1072;&#1103;
&#1082;&#1083;&#1102;&#1095; &#1089;
&#1084;&#1077;&#1085;&#1100;&#1096;&#1080;&#1084;
&#1080;&#1085;&#1076;&#1077;&#1082;&#1089;&#1086;&#1084;, &#1084;&#1099;
&#1076;&#1086;&#1083;&#1078;&#1085;&#1099;
&#1087;&#1086;&#1076;&#1089;&#1095;&#1080;&#1090;&#1072;&#1090;&#1100;
&#1082;&#1086;&#1083;&#1080;&#1095;&#1077;&#1089;&#1090;&#1074;&#1086;
&#1079;&#1072;&#1087;&#1080;&#1089;&#1077;&#1081; &#1076;&#1086;
&#1089;&#1082;&#1088;&#1099;&#1090;&#1086;&#1081; &#1080;
&#1074;&#1077;&#1088;&#1085;&#1091;&#1090;&#1100;
&#1087;&#1088;&#1072;&#1074;&#1080;&#1083;&#1100;&#1085;&#1086;&#1077;
&#1079;&#1085;&#1072;&#1095;&#1077;&#1085;&#1080;&#1077;.
<p>&#1044;&#1072;&#1074;&#1072;&#1081;&#1090;&#1077;
&#1088;&#1072;&#1079;&#1073;&#1077;&#1088;&#1077;&#1084;
&#1087;&#1088;&#1080;&#1084;&#1077;&#1088;.
&#1044;&#1086;&#1087;&#1091;&#1089;&#1090;&#1080;&#1084; &#1074;
&#1082;&#1072;&#1082;&#1086;&#1081;-&#1090;&#1086;
&#1095;&#1072;&#1089;&#1090;&#1080;
&#1088;&#1077;&#1077;&#1089;&#1090;&#1088;&#1072; &#1077;&#1089;&#1090;&#1100;
&#1082;&#1083;&#1102;&#1095;&#1080; &#1089;
&#1080;&#1084;&#1077;&#1085;&#1072;&#1084;&#1080; A, B, C, D, E &#1080; F.
&#1048;&#1085;&#1076;&#1077;&#1082;&#1089;
&#1085;&#1072;&#1095;&#1080;&#1085;&#1072;&#1077;&#1090;&#1089;&#1103; &#1089;
&#1085;&#1091;&#1083;&#1103;, &#1101;&#1090;&#1086;
&#1086;&#1079;&#1085;&#1072;&#1095;&#1072;&#1077;&#1090;, &#1095;&#1090;&#1086;
&#1082;&#1083;&#1102;&#1095; E &#1080;&#1084;&#1077;&#1077;&#1090;
&#1080;&#1085;&#1076;&#1077;&#1082;&#1089; 4.
&#1058;&#1077;&#1087;&#1077;&#1088;&#1100;, &#1077;&#1089;&#1083;&#1080;
&#1084;&#1099; &#1093;&#1086;&#1090;&#1080;&#1084;
&#1089;&#1082;&#1088;&#1099;&#1090;&#1100; &#1082;&#1083;&#1102;&#1095; B
&#1080; &#1087;&#1088;&#1080;&#1083;&#1086;&#1078;&#1077;&#1085;&#1080;&#1077;
&#1074;&#1099;&#1079;&#1074;&#1072;&#1083;&#1086; NtEnumerateKey &#1089; Index
&#1088;&#1072;&#1074;&#1085;&#1099;&#1084; 4, &#1084;&#1099;
&#1076;&#1086;&#1083;&#1078;&#1085;&#1099;
&#1074;&#1077;&#1088;&#1085;&#1091;&#1090;&#1100;
&#1080;&#1085;&#1092;&#1086;&#1088;&#1084;&#1072;&#1094;&#1080;&#1102; &#1086;
&#1082;&#1083;&#1102;&#1095;&#1077; F, &#1090;&#1072;&#1082;
&#1082;&#1072;&#1082; &#1080;&#1085;&#1076;&#1077;&#1082;&#1089;
&#1089;&#1076;&#1074;&#1080;&#1085;&#1091;&#1090;.
&#1055;&#1088;&#1086;&#1073;&#1083;&#1077;&#1084;&#1072; &#1074;
&#1090;&#1086;&#1084;, &#1095;&#1090;&#1086; &#1085;&#1072;&#1084;
&#1085;&#1077;&#1080;&#1079;&#1074;&#1077;&#1089;&#1090;&#1085;&#1086;,
&#1095;&#1090;&#1086; &#1085;&#1091;&#1078;&#1085;&#1086;
&#1087;&#1088;&#1086;&#1080;&#1079;&#1074;&#1077;&#1089;&#1090;&#1080;
&#1089;&#1076;&#1074;&#1080;&#1075;. &#1040; &#1077;&#1089;&#1083;&#1080;
&#1084;&#1099; &#1085;&#1077;
&#1087;&#1086;&#1079;&#1072;&#1073;&#1086;&#1090;&#1080;&#1084;&#1089;&#1103;
&#1086; &#1089;&#1076;&#1074;&#1080;&#1075;&#1077;, &#1090;&#1086;
&#1074;&#1077;&#1088;&#1085;&#1077;&#1084; E
&#1074;&#1084;&#1077;&#1089;&#1090;&#1086; F,
&#1082;&#1086;&#1075;&#1076;&#1072; &#1073;&#1091;&#1076;&#1077;&#1090;
&#1079;&#1072;&#1087;&#1088;&#1072;&#1096;&#1080;&#1074;&#1072;&#1090;&#1100;&#1089;&#1103;
&#1082;&#1083;&#1102;&#1095; &#1089;
&#1080;&#1085;&#1076;&#1077;&#1082;&#1089;&#1086;&#1084; 4,
&#1080;&#1083;&#1080; &#1085;&#1080;&#1095;&#1077;&#1075;&#1086; &#1085;&#1077;
&#1074;&#1077;&#1088;&#1085;&#1077;&#1084; &#1076;&#1083;&#1103;
&#1082;&#1083;&#1102;&#1095;&#1072; &#1089;
&#1080;&#1085;&#1076;&#1077;&#1082;&#1089;&#1086;&#1084; 1,
&#1093;&#1086;&#1090;&#1103; &#1076;&#1086;&#1083;&#1078;&#1085;&#1099;
&#1074;&#1077;&#1088;&#1085;&#1091;&#1090;&#1100; C. &#1042;
&#1086;&#1073;&#1086;&#1080;&#1093;
&#1089;&#1083;&#1091;&#1095;&#1072;&#1103;&#1093;
&#1086;&#1096;&#1080;&#1073;&#1082;&#1072;. &#1042;&#1086;&#1090;
&#1087;&#1086;&#1095;&#1077;&#1084;&#1091; &#1084;&#1099;
&#1076;&#1086;&#1083;&#1078;&#1085;&#1099;
&#1087;&#1086;&#1076;&#1091;&#1084;&#1072;&#1090;&#1100; &#1086;
&#1089;&#1076;&#1074;&#1080;&#1075;&#1077;.
<p>&#1045;&#1089;&#1083;&#1080; &#1084;&#1099;
&#1073;&#1091;&#1076;&#1077;&#1084;
&#1074;&#1099;&#1095;&#1080;&#1089;&#1083;&#1103;&#1090;&#1100;
&#1089;&#1076;&#1074;&#1080;&#1075;
&#1074;&#1099;&#1079;&#1086;&#1074;&#1086;&#1084;
&#1092;&#1091;&#1085;&#1082;&#1094;&#1080;&#1080; &#1076;&#1083;&#1103;
&#1082;&#1072;&#1078;&#1076;&#1086;&#1075;&#1086;
&#1080;&#1085;&#1076;&#1077;&#1082;&#1089;&#1072; &#1086;&#1090; 0
&#1076;&#1086; Index, &#1080;&#1085;&#1086;&#1075;&#1076;&#1072;
&#1085;&#1072;&#1084; &#1087;&#1088;&#1080;&#1076;&#1077;&#1090;&#1089;&#1103;
&#1078;&#1076;&#1072;&#1090;&#1100; &#1075;&#1086;&#1076;&#1072;&#1084;&#1080; (&#1085;&#1072;
1&#1043;&#1043;&#1094;
&#1087;&#1088;&#1086;&#1094;&#1077;&#1089;&#1089;&#1086;&#1088;&#1077;
&#1101;&#1090;&#1086; &#1084;&#1086;&#1078;&#1077;&#1090;
&#1079;&#1072;&#1085;&#1103;&#1090;&#1100; &#1076;&#1086; 10
&#1089;&#1077;&#1082;&#1091;&#1085;&#1076; &#1089;&#1086;
&#1089;&#1090;&#1072;&#1085;&#1076;&#1072;&#1088;&#1090;&#1085;&#1099;&#1084;
&#1088;&#1077;&#1077;&#1089;&#1090;&#1088;&#1086;&#1084;,
&#1082;&#1086;&#1090;&#1086;&#1088;&#1099;&#1081;
&#1086;&#1095;&#1077;&#1085;&#1100;
&#1073;&#1086;&#1083;&#1100;&#1096;&#1086;&#1081;).
&#1055;&#1086;&#1101;&#1090;&#1086;&#1084;&#1091; &#1084;&#1099;
&#1076;&#1086;&#1083;&#1078;&#1085;&#1099;
&#1087;&#1088;&#1080;&#1076;&#1091;&#1084;&#1072;&#1090;&#1100;
&#1073;&#1086;&#1083;&#1077;&#1077;
&#1089;&#1086;&#1074;&#1077;&#1088;&#1096;&#1077;&#1085;&#1085;&#1099;&#1081;
&#1084;&#1077;&#1090;&#1086;&#1076;.
<p>&#1052;&#1099; &#1079;&#1085;&#1072;&#1077;&#1084;, &#1095;&#1090;&#1086;
&#1082;&#1083;&#1102;&#1095;&#1080; (&#1080;&#1089;&#1082;&#1083;&#1102;&#1095;&#1072;&#1103;
&#1089;&#1089;&#1099;&#1083;&#1082;&#1080;)
&#1086;&#1090;&#1089;&#1086;&#1088;&#1090;&#1080;&#1088;&#1086;&#1074;&#1072;&#1085;&#1099;
&#1087;&#1086; &#1072;&#1083;&#1092;&#1072;&#1074;&#1080;&#1090;&#1091;.
&#1045;&#1089;&#1083;&#1080; &#1084;&#1099;
&#1087;&#1088;&#1077;&#1085;&#1077;&#1073;&#1088;&#1077;&#1078;&#1077;&#1084;
&#1089;&#1089;&#1099;&#1083;&#1082;&#1072;&#1084;&#1080; (&#1082;&#1086;&#1090;&#1086;&#1088;&#1099;&#1077;
&#1084;&#1099; &#1085;&#1077; &#1093;&#1086;&#1090;&#1080;&#1084;
&#1089;&#1082;&#1088;&#1099;&#1074;&#1072;&#1090;&#1100;), &#1084;&#1099;
&#1089;&#1084;&#1086;&#1078;&#1077;&#1084;
&#1074;&#1099;&#1095;&#1080;&#1089;&#1083;&#1080;&#1090;&#1100;
&#1089;&#1076;&#1074;&#1080;&#1075;
&#1089;&#1083;&#1077;&#1076;&#1091;&#1102;&#1097;&#1080;&#1084;
&#1084;&#1077;&#1090;&#1086;&#1076;&#1086;&#1084;. &#1052;&#1099;
&#1086;&#1090;&#1089;&#1086;&#1088;&#1090;&#1080;&#1088;&#1091;&#1077;&#1084;
&#1087;&#1086; &#1072;&#1083;&#1092;&#1072;&#1074;&#1080;&#1090;&#1091;
&#1089;&#1087;&#1080;&#1089;&#1086;&#1082; &#1080;&#1084;&#1077;&#1085;
&#1082;&#1083;&#1102;&#1095;&#1077;&#1081;,
&#1082;&#1086;&#1090;&#1086;&#1088;&#1099;&#1077;
&#1085;&#1077;&#1086;&#1073;&#1093;&#1086;&#1076;&#1080;&#1084;&#1086;
&#1089;&#1082;&#1088;&#1099;&#1090;&#1100; (&#1080;&#1089;&#1087;&#1086;&#1083;&#1100;&#1079;&#1091;&#1103;
RtlCompareUnicodeString), &#1079;&#1072;&#1090;&#1077;&#1084;,
&#1082;&#1086;&#1075;&#1076;&#1072;
&#1087;&#1088;&#1080;&#1083;&#1086;&#1078;&#1077;&#1085;&#1080;&#1077;
&#1074;&#1099;&#1079;&#1099;&#1074;&#1072;&#1077;&#1090; NtEnumerateKey,
&#1084;&#1099; &#1085;&#1077; &#1073;&#1091;&#1076;&#1077;&#1084;
&#1087;&#1077;&#1088;&#1077;&#1074;&#1099;&#1079;&#1099;&#1074;&#1072;&#1090;&#1100;
&#1077;&#1077; &#1089;
&#1085;&#1077;&#1080;&#1079;&#1084;&#1077;&#1085;&#1077;&#1085;&#1085;&#1099;&#1084;&#1080;
&#1072;&#1088;&#1075;&#1091;&#1084;&#1077;&#1085;&#1090;&#1072;&#1084;&#1080;,
&#1072; &#1086;&#1087;&#1088;&#1077;&#1076;&#1077;&#1083;&#1080;&#1084;
&#1080;&#1084;&#1103; &#1079;&#1072;&#1087;&#1080;&#1089;&#1080;
&#1091;&#1082;&#1072;&#1079;&#1072;&#1085;&#1085;&#1086;&#1081;
&#1087;&#1072;&#1088;&#1072;&#1084;&#1077;&#1090;&#1088;&#1086;&#1084; Index.
<p><code><!--mstheme--></font>
<pre>        NTSTATUS RtlCompareUnicodeString(       
                IN PUNICODE_STRING String1, 
                IN PUNICODE_STRING String2, 
                IN BOOLEAN  CaseInSensitive  
        );</pre>
<!--mstheme--><font face="Arial, Arial, Helvetica"></code>
<p>String1 &#1080; String2 - &#1089;&#1090;&#1088;&#1086;&#1082;&#1080;,
&#1082;&#1086;&#1090;&#1086;&#1088;&#1099;&#1077;
&#1085;&#1077;&#1086;&#1073;&#1093;&#1086;&#1076;&#1080;&#1084;&#1086;
&#1089;&#1088;&#1072;&#1074;&#1085;&#1080;&#1090;&#1100;, CaseInSensitive - True,
&#1077;&#1089;&#1083;&#1080; &#1084;&#1099; &#1093;&#1086;&#1090;&#1080;&#1084;
&#1087;&#1088;&#1086;&#1074;&#1077;&#1089;&#1090;&#1080;
&#1089;&#1088;&#1072;&#1074;&#1085;&#1077;&#1085;&#1080;&#1077;,
&#1080;&#1075;&#1085;&#1086;&#1088;&#1080;&#1088;&#1091;&#1103;
&#1088;&#1077;&#1075;&#1080;&#1089;&#1090;&#1088;.
&#1056;&#1077;&#1079;&#1091;&#1083;&#1100;&#1090;&#1072;&#1090;
&#1092;&#1091;&#1085;&#1082;&#1094;&#1080;&#1080;
&#1086;&#1087;&#1080;&#1089;&#1099;&#1074;&#1072;&#1077;&#1090;
&#1086;&#1090;&#1085;&#1086;&#1096;&#1077;&#1085;&#1080;&#1077;
&#1084;&#1077;&#1078;&#1076;&#1091; String1 &#1080; String2:
<p><code><!--mstheme--></font>
<pre>                result &gt; 0:     String1 &gt; String2
                result = 0:     String1 = String2
                result &lt; 0:     String1 &lt; String2</pre>
<!--mstheme--><font face="Arial, Arial, Helvetica"></code>
<p>&#1058;&#1077;&#1087;&#1077;&#1088;&#1100; &#1084;&#1099;
&#1076;&#1086;&#1083;&#1078;&#1085;&#1099; &#1085;&#1072;&#1081;&#1090;&#1080;
&#1075;&#1088;&#1072;&#1085;&#1080;&#1094;&#1091;. &#1052;&#1099;
&#1089;&#1088;&#1072;&#1074;&#1085;&#1080;&#1084; &#1080;&#1084;&#1103;,
&#1091;&#1082;&#1072;&#1079;&#1072;&#1085;&#1085;&#1086;&#1077;
&#1087;&#1072;&#1088;&#1072;&#1084;&#1077;&#1090;&#1088;&#1086;&#1084; Index
&#1089; &#1080;&#1084;&#1077;&#1085;&#1072;&#1084;&#1080; &#1074;
&#1085;&#1072;&#1096;&#1077;&#1084; &#1089;&#1087;&#1080;&#1089;&#1082;&#1077;.
&#1043;&#1088;&#1072;&#1085;&#1080;&#1094;&#1077;&#1081;
&#1073;&#1091;&#1076;&#1077;&#1090;
&#1087;&#1086;&#1089;&#1083;&#1077;&#1076;&#1085;&#1077;&#1077;
&#1084;&#1077;&#1085;&#1100;&#1096;&#1077;&#1077; &#1080;&#1084;&#1103;
&#1080;&#1079; &#1085;&#1072;&#1096;&#1077;&#1075;&#1086;
&#1089;&#1087;&#1080;&#1089;&#1082;&#1072;. &#1052;&#1099;
&#1079;&#1085;&#1072;&#1077;&#1084;, &#1095;&#1090;&#1086;
&#1089;&#1076;&#1074;&#1080;&#1075; &#1085;&#1077;
&#1087;&#1088;&#1077;&#1074;&#1099;&#1096;&#1072;&#1077;&#1090;
&#1085;&#1086;&#1084;&#1077;&#1088;
&#1075;&#1088;&#1072;&#1085;&#1080;&#1095;&#1085;&#1086;&#1075;&#1086;
&#1101;&#1083;&#1077;&#1084;&#1077;&#1085;&#1090;&#1072; &#1074;
&#1085;&#1072;&#1096;&#1077;&#1084; &#1089;&#1087;&#1080;&#1089;&#1082;&#1077;.
&#1053;&#1086; &#1085;&#1077; &#1074;&#1089;&#1077;
&#1101;&#1083;&#1077;&#1084;&#1077;&#1085;&#1090;&#1099;
&#1089;&#1087;&#1080;&#1089;&#1082;&#1072;
&#1103;&#1074;&#1083;&#1103;&#1102;&#1090;&#1089;&#1103;
&#1076;&#1077;&#1081;&#1089;&#1090;&#1074;&#1080;&#1090;&#1077;&#1083;&#1100;&#1085;&#1099;&#1084;&#1080;
&#1082;&#1083;&#1102;&#1095;&#1072;&#1084;&#1080; &#1074; &#1090;&#1086;&#1081;
&#1095;&#1072;&#1089;&#1090;&#1080;
&#1088;&#1077;&#1077;&#1089;&#1090;&#1088;&#1072;, &#1075;&#1076;&#1077;
&#1084;&#1099; &#1085;&#1072;&#1093;&#1086;&#1076;&#1080;&#1084;&#1089;&#1103;.
&#1055;&#1086;&#1101;&#1090;&#1086;&#1084;&#1091; &#1084;&#1099;
&#1076;&#1086;&#1083;&#1078;&#1085;&#1099;
&#1086;&#1087;&#1088;&#1077;&#1076;&#1077;&#1083;&#1080;&#1090;&#1100;
&#1101;&#1083;&#1077;&#1084;&#1077;&#1085;&#1090;&#1099;
&#1089;&#1087;&#1080;&#1089;&#1082;&#1072; &#1076;&#1086;
&#1075;&#1088;&#1072;&#1085;&#1080;&#1094;&#1099;,
&#1082;&#1086;&#1090;&#1086;&#1088;&#1099;&#1077;
&#1103;&#1074;&#1083;&#1103;&#1102;&#1090;&#1089;&#1103;
&#1095;&#1072;&#1089;&#1090;&#1100;&#1102;
&#1088;&#1077;&#1077;&#1089;&#1090;&#1088;&#1072;. &#1052;&#1099;
&#1084;&#1086;&#1078;&#1077;&#1084;
&#1089;&#1076;&#1077;&#1083;&#1072;&#1090;&#1100; &#1101;&#1090;&#1086;
&#1080;&#1089;&#1087;&#1086;&#1083;&#1100;&#1079;&#1091;&#1103; NtOpenKey.
<p><code><!--mstheme--></font>
<pre>        NTSTATUS NtOpenKey(
                OUT PHANDLE KeyHandle,
                IN ACCESS_MASK DesiredAccess,
                IN POBJECT_ATTRIBUTES ObjectAttributes
        );</pre>
<!--mstheme--><font face="Arial, Arial, Helvetica"></code>
<p>KeyHandle - &#1101;&#1090;&#1086; &#1093;&#1101;&#1085;&#1076;&#1083;
&#1088;&#1086;&#1076;&#1080;&#1090;&#1077;&#1083;&#1100;&#1089;&#1082;&#1086;&#1075;&#1086;
&#1082;&#1083;&#1102;&#1095;&#1072;. &#1052;&#1099;
&#1073;&#1091;&#1076;&#1077;&#1084;
&#1080;&#1089;&#1087;&#1086;&#1083;&#1100;&#1079;&#1086;&#1074;&#1072;&#1090;&#1100;
&#1079;&#1085;&#1072;&#1095;&#1077;&#1085;&#1080;&#1077;,
&#1087;&#1077;&#1088;&#1077;&#1076;&#1072;&#1085;&#1085;&#1086;&#1077; &#1074;
NtEnumerateKey. DesiredAccess - &#1087;&#1088;&#1072;&#1074;&#1072;
&#1076;&#1086;&#1089;&#1090;&#1091;&#1087;&#1072;,
&#1080;&#1089;&#1087;&#1086;&#1083;&#1100;&#1079;&#1091;&#1077;&#1084;
&#1079;&#1085;&#1072;&#1095;&#1077;&#1085;&#1080;&#1077; KEY_ENUMERATE_SUB_KEYS.
ObjectAttributes &#1086;&#1087;&#1080;&#1089;&#1099;&#1074;&#1072;&#1102;&#1090;
&#1087;&#1086;&#1076;&#1082;&#1083;&#1102;&#1095;,
&#1082;&#1086;&#1090;&#1086;&#1088;&#1099;&#1093; &#1084;&#1099;
&#1093;&#1086;&#1090;&#1080;&#1084;
&#1086;&#1090;&#1082;&#1088;&#1099;&#1090;&#1100; (&#1074;&#1082;&#1083;&#1102;&#1095;&#1072;&#1103;
&#1077;&#1075;&#1086; &#1080;&#1084;&#1103;).
<p><code><!--mstheme--></font>
<pre>        #define KEY_ENUMERATE_SUB_KEYS 8</pre>
<!--mstheme--><font face="Arial, Arial, Helvetica"></code>
<p>&#1045;&#1089;&#1083;&#1080; NtOpenKey
&#1074;&#1077;&#1088;&#1085;&#1077;&#1090; 0 - &#1082;&#1083;&#1102;&#1095;
&#1073;&#1099;&#1083; &#1086;&#1090;&#1082;&#1088;&#1099;&#1090;
&#1091;&#1089;&#1087;&#1077;&#1096;&#1085;&#1086; - &#1101;&#1090;&#1086;
&#1079;&#1085;&#1072;&#1095;&#1080;&#1090;, &#1095;&#1090;&#1086;
&#1101;&#1090;&#1086;&#1090; &#1101;&#1083;&#1077;&#1084;&#1077;&#1085;&#1090;
&#1089;&#1087;&#1080;&#1089;&#1082;&#1072;
&#1089;&#1091;&#1097;&#1077;&#1089;&#1090;&#1074;&#1091;&#1077;&#1090;.
&#1054;&#1090;&#1082;&#1088;&#1099;&#1090;&#1099;&#1081;
&#1082;&#1083;&#1102;&#1095; &#1089;&#1083;&#1077;&#1076;&#1091;&#1077;&#1090;
&#1079;&#1072;&#1082;&#1088;&#1099;&#1090;&#1100;,
&#1080;&#1089;&#1087;&#1086;&#1083;&#1100;&#1079;&#1091;&#1103; NtClose.
<p><code><!--mstheme--></font>
<pre>        NTSTATUS NtClose(
                IN HANDLE Handle
        );</pre>
<!--mstheme--><font face="Arial, Arial, Helvetica"></code>
<p>&#1055;&#1088;&#1080; &#1082;&#1072;&#1078;&#1076;&#1086;&#1084;
&#1074;&#1099;&#1079;&#1086;&#1074;&#1077;
&#1092;&#1091;&#1085;&#1082;&#1094;&#1080;&#1080; NtEnumerateKey &#1084;&#1099;
&#1076;&#1086;&#1083;&#1078;&#1085;&#1099;
&#1074;&#1099;&#1095;&#1080;&#1089;&#1083;&#1103;&#1090;&#1100;
&#1089;&#1076;&#1074;&#1080;&#1075;, &#1082;&#1072;&#1082;
&#1082;&#1086;&#1083;&#1080;&#1095;&#1077;&#1089;&#1090;&#1074;&#1086;
&#1082;&#1083;&#1102;&#1095;&#1077;&#1081; &#1080;&#1079;
&#1085;&#1072;&#1096;&#1077;&#1075;&#1086;
&#1089;&#1087;&#1080;&#1089;&#1082;&#1072;,
&#1082;&#1086;&#1090;&#1086;&#1088;&#1099;&#1077;
&#1089;&#1091;&#1097;&#1077;&#1089;&#1090;&#1074;&#1091;&#1102;&#1090; &#1074;
&#1076;&#1072;&#1085;&#1085;&#1086;&#1081; &#1095;&#1072;&#1089;&#1090;&#1080;
&#1088;&#1077;&#1077;&#1089;&#1090;&#1088;&#1072;.
&#1047;&#1072;&#1090;&#1077;&#1084; &#1084;&#1099;
&#1076;&#1086;&#1083;&#1078;&#1085;&#1099;
&#1087;&#1088;&#1080;&#1073;&#1072;&#1074;&#1080;&#1090;&#1100;
&#1101;&#1090;&#1086;&#1090; &#1089;&#1076;&#1074;&#1080;&#1075; &#1082;
&#1072;&#1088;&#1075;&#1091;&#1084;&#1077;&#1085;&#1090;&#1091; Index &#1080;,
&#1085;&#1072;&#1082;&#1086;&#1085;&#1077;&#1094;,
&#1074;&#1099;&#1079;&#1074;&#1072;&#1090;&#1100;
&#1086;&#1088;&#1080;&#1075;&#1080;&#1085;&#1072;&#1083;&#1100;&#1085;&#1091;&#1102;
NtEnumerateKey.
<p>&#1044;&#1083;&#1103;
&#1087;&#1086;&#1083;&#1091;&#1095;&#1077;&#1085;&#1080;&#1103;
&#1080;&#1084;&#1077;&#1085;&#1080; &#1082;&#1083;&#1102;&#1095;&#1072;,
&#1091;&#1082;&#1072;&#1079;&#1072;&#1085;&#1085;&#1086;&#1075;&#1086;
&#1087;&#1072;&#1088;&#1072;&#1084;&#1077;&#1090;&#1088;&#1086;&#1084; Index,
&#1084;&#1099;
&#1080;&#1089;&#1087;&#1086;&#1083;&#1100;&#1079;&#1091;&#1077;&#1084;
KeyBasicInformation &#1074;
&#1082;&#1072;&#1095;&#1077;&#1089;&#1090;&#1074;&#1077;
&#1079;&#1085;&#1072;&#1095;&#1077;&#1085;&#1080;&#1103; &#1076;&#1083;&#1103;
KeyInformationClass.
<p><code><!--mstheme--></font>
<pre>        #define KeyBasicInformation 0</pre>
<!--mstheme--><font face="Arial, Arial, Helvetica"></code>
<p>NtEnumerateKey &#1074;&#1077;&#1088;&#1085;&#1077;&#1090; &#1074;
&#1073;&#1091;&#1092;&#1077;&#1088;&#1077; KeyInformation
&#1089;&#1090;&#1088;&#1091;&#1082;&#1090;&#1091;&#1088;&#1091;:
<p><code><!--mstheme--></font>
<pre>        typedef struct _KEY_BASIC_INFORMATION {
                LARGE_INTEGER LastWriteTime;
                ULONG TitleIndex;
                ULONG NameLength;
                WCHAR Name[1];            
        } KEY_BASIC_INFORMATION, *PKEY_BASIC_INFORMATION;</pre>
<!--mstheme--><font face="Arial, Arial, Helvetica"></code>
<p>&#1045;&#1076;&#1080;&#1085;&#1089;&#1090;&#1074;&#1077;&#1085;&#1085;&#1086;&#1077;
&#1095;&#1090;&#1086; &#1085;&#1072;&#1084; &#1085;&#1091;&#1078;&#1085;&#1086;
- &#1101;&#1090;&#1086; Name, &#1080; &#1077;&#1075;&#1086;
&#1076;&#1083;&#1080;&#1085;&#1072; - NameLength.
<p>&#1045;&#1089;&#1083;&#1080; &#1082;&#1083;&#1102;&#1095;&#1072;
&#1076;&#1083;&#1103;
&#1089;&#1076;&#1074;&#1080;&#1085;&#1091;&#1090;&#1086;&#1075;&#1086;
&#1087;&#1072;&#1088;&#1072;&#1084;&#1077;&#1090;&#1088;&#1072; Index
&#1085;&#1077;
&#1089;&#1091;&#1097;&#1077;&#1089;&#1090;&#1074;&#1091;&#1077;&#1090;,
&#1084;&#1099; &#1076;&#1086;&#1083;&#1078;&#1085;&#1099;
&#1074;&#1077;&#1088;&#1085;&#1091;&#1090;&#1100;
&#1086;&#1096;&#1080;&#1073;&#1082;&#1091; STATUS_EA_LIST_INCONSISTENT.
<p><code><!--mstheme--></font>
<pre>        #define STATUS_EA_LIST_INCONSISTENT 0x80000014</pre>
<!--mstheme--><font face="Arial, Arial, Helvetica"></code><a name="5_2"></a>
<p align="center">=====[ 5.2 NtEnumerateValueKey ]=====</p>
<p>&#1047;&#1085;&#1072;&#1095;&#1077;&#1085;&#1080;&#1103;
&#1088;&#1077;&#1077;&#1089;&#1090;&#1088;&#1072; &#1085;&#1077;
&#1086;&#1090;&#1089;&#1086;&#1088;&#1090;&#1080;&#1088;&#1086;&#1074;&#1072;&#1085;&#1099;.
&#1050; &#1089;&#1095;&#1072;&#1089;&#1090;&#1100;&#1102;, &#1080;&#1093;
&#1082;&#1086;&#1083;&#1080;&#1095;&#1077;&#1089;&#1090;&#1074;&#1086; &#1074;
&#1086;&#1076;&#1085;&#1086;&#1084; &#1082;&#1083;&#1102;&#1095;&#1077;
&#1076;&#1086;&#1089;&#1090;&#1072;&#1090;&#1086;&#1095;&#1085;&#1086;
&#1084;&#1072;&#1083;&#1086;, &#1087;&#1086;&#1101;&#1090;&#1086;&#1084;&#1091;
&#1084;&#1099; &#1084;&#1086;&#1078;&#1077;&#1084;
&#1087;&#1077;&#1088;&#1077;&#1074;&#1099;&#1079;&#1099;&#1074;&#1072;&#1090;&#1100;
&#1092;&#1091;&#1085;&#1082;&#1094;&#1080;&#1102;,
&#1095;&#1090;&#1086;&#1073;&#1099;
&#1087;&#1086;&#1083;&#1091;&#1095;&#1080;&#1090;&#1100;
&#1089;&#1076;&#1074;&#1080;&#1075;. API &#1076;&#1083;&#1103;
&#1087;&#1086;&#1083;&#1091;&#1095;&#1077;&#1085;&#1080;&#1103;
&#1080;&#1085;&#1092;&#1086;&#1088;&#1084;&#1072;&#1094;&#1080;&#1080;
&#1086;&#1073; &#1086;&#1076;&#1085;&#1086;&#1084;
&#1079;&#1085;&#1072;&#1095;&#1077;&#1085;&#1080;&#1080;
&#1088;&#1077;&#1077;&#1089;&#1090;&#1088;&#1072;
&#1085;&#1072;&#1079;&#1099;&#1074;&#1077;&#1090;&#1089;&#1103;
NtEnumarateValueKey.
<p><code><!--mstheme--></font>
<pre>        NTSTATUS NtEnumerateValueKey(
                IN HANDLE KeyHandle,
                IN ULONG Index,
                IN KEY_VALUE_INFORMATION_CLASS KeyValueInformationClass,
                OUT PVOID KeyValueInformation,
                IN ULONG KeyValueInformationLength,
                OUT PULONG ResultLength
        );</pre>
<!--mstheme--><font face="Arial, Arial, Helvetica"></code>
<p>KeyHandle - &#1101;&#1090;&#1086; &#1089;&#1085;&#1086;&#1074;&#1072;
&#1093;&#1101;&#1085;&#1076;&#1083;
&#1088;&#1086;&#1076;&#1080;&#1090;&#1077;&#1083;&#1100;&#1089;&#1082;&#1086;&#1075;&#1086;
&#1082;&#1083;&#1102;&#1095;&#1072;. Index - &#1101;&#1090;&#1086;
&#1080;&#1085;&#1076;&#1077;&#1082;&#1089; &#1074;
&#1089;&#1087;&#1080;&#1089;&#1082;&#1077;
&#1079;&#1085;&#1072;&#1095;&#1077;&#1085;&#1080;&#1081;
&#1076;&#1072;&#1085;&#1085;&#1086;&#1075;&#1086;
&#1082;&#1083;&#1102;&#1095;&#1072;. KeyValueInformationClass
&#1086;&#1087;&#1080;&#1089;&#1099;&#1074;&#1072;&#1077;&#1090;
&#1090;&#1080;&#1087;
&#1080;&#1085;&#1092;&#1086;&#1088;&#1084;&#1072;&#1094;&#1080;&#1080;,
&#1082;&#1086;&#1090;&#1086;&#1088;&#1072;&#1103;
&#1073;&#1091;&#1076;&#1077;&#1090;
&#1087;&#1086;&#1084;&#1077;&#1097;&#1077;&#1085;&#1072; &#1074;
&#1073;&#1091;&#1092;&#1077;&#1088; KeyValueInformation
&#1088;&#1072;&#1079;&#1084;&#1077;&#1088;&#1086;&#1084;
KeyValueInformationLength &#1073;&#1072;&#1081;&#1090;.
&#1050;&#1086;&#1083;&#1080;&#1095;&#1077;&#1089;&#1090;&#1074;&#1086;
&#1079;&#1072;&#1087;&#1080;&#1089;&#1072;&#1085;&#1085;&#1099;&#1093; &#1074;
&#1073;&#1091;&#1092;&#1077;&#1088; &#1073;&#1072;&#1081;&#1090;
&#1074;&#1086;&#1079;&#1074;&#1088;&#1072;&#1097;&#1072;&#1077;&#1090;&#1089;&#1103;
&#1074; ResultLength.
<p>&#1048; &#1089;&#1085;&#1086;&#1074;&#1072; &#1084;&#1099;
&#1076;&#1086;&#1083;&#1078;&#1085;&#1099;
&#1074;&#1099;&#1095;&#1080;&#1089;&#1083;&#1080;&#1090;&#1100;
&#1089;&#1076;&#1074;&#1080;&#1075;,
&#1087;&#1077;&#1088;&#1077;&#1074;&#1099;&#1079;&#1099;&#1074;&#1072;&#1103;
&#1092;&#1091;&#1085;&#1082;&#1094;&#1080;&#1102; &#1076;&#1083;&#1103;
&#1074;&#1089;&#1077;&#1093;
&#1080;&#1085;&#1076;&#1077;&#1082;&#1089;&#1086;&#1074; &#1086;&#1090; 0
&#1076;&#1086; Index. &#1048;&#1084;&#1103;
&#1079;&#1085;&#1072;&#1095;&#1077;&#1085;&#1080;&#1103;
&#1084;&#1086;&#1078;&#1077;&#1090; &#1073;&#1099;&#1090;&#1100;
&#1087;&#1086;&#1083;&#1091;&#1095;&#1077;&#1085;&#1086; &#1087;&#1088;&#1080;
&#1080;&#1089;&#1087;&#1086;&#1083;&#1100;&#1079;&#1086;&#1074;&#1072;&#1085;&#1080;&#1080;
KeyValueBasicInformation &#1074;
&#1082;&#1072;&#1095;&#1077;&#1089;&#1090;&#1074;&#1077;
&#1079;&#1085;&#1072;&#1095;&#1077;&#1085;&#1080;&#1103; &#1076;&#1083;&#1103;
KeyValueInformationClass.
<p><code><!--mstheme--></font>
<pre>        #define KeyValueBasicInformation 0</pre>
<!--mstheme--><font face="Arial, Arial, Helvetica"></code>
<p>&#1058;&#1086;&#1075;&#1076;&#1072; &#1074;
&#1073;&#1091;&#1092;&#1077;&#1088;&#1077; KeyValueInformation &#1084;&#1099;
&#1087;&#1086;&#1083;&#1091;&#1095;&#1080;&#1084;
&#1089;&#1083;&#1077;&#1076;&#1091;&#1102;&#1097;&#1091;&#1102;
&#1089;&#1090;&#1088;&#1091;&#1082;&#1090;&#1091;&#1088;&#1091;:
<p><code><!--mstheme--></font>
<pre>        typedef struct _KEY_VALUE_BASIC_INFORMATION {
                ULONG TitleIndex;
                ULONG Type;
                ULONG NameLength;
                WCHAR Name[1];
        } KEY_VALUE_BASIC_INFORMATION, *PKEY_VALUE_BASIC_INFORMATION;</pre>
<!--mstheme--><font face="Arial, Arial, Helvetica"></code>
<p>&#1053;&#1072;&#1089; &#1089;&#1085;&#1086;&#1074;&#1072;
&#1080;&#1085;&#1090;&#1077;&#1088;&#1077;&#1089;&#1091;&#1102;&#1090;
&#1090;&#1086;&#1083;&#1100;&#1082;&#1086; Name &#1080; NameLength.
<p>&#1045;&#1089;&#1083;&#1080; &#1076;&#1083;&#1103;
&#1089;&#1076;&#1074;&#1080;&#1085;&#1091;&#1090;&#1086;&#1075;&#1086;
&#1087;&#1072;&#1088;&#1072;&#1084;&#1077;&#1090;&#1088;&#1072; Index
&#1085;&#1077;
&#1089;&#1091;&#1097;&#1077;&#1089;&#1090;&#1074;&#1091;&#1077;&#1090;
&#1089;&#1086;&#1086;&#1090;&#1074;&#1077;&#1090;&#1089;&#1090;&#1074;&#1091;&#1102;&#1097;&#1077;&#1075;&#1086;
&#1079;&#1085;&#1072;&#1095;&#1077;&#1085;&#1080;&#1103;
&#1088;&#1077;&#1077;&#1089;&#1090;&#1088;&#1072;, &#1090;&#1086; &#1084;&#1099;
&#1076;&#1086;&#1083;&#1078;&#1085;&#1099;
&#1074;&#1077;&#1088;&#1085;&#1091;&#1090;&#1100; STATUS_NO_MORE_ENTRIES.
<p><code><!--mstheme--></font>
<pre>        #define STATUS_NO_MORE_ENTRIES 0x8000001A</pre>
<!--mstheme--><font face="Arial, Arial, Helvetica"></code><a name="6"></a>
<p align="center">=====[ 6. &#1057;&#1077;&#1088;&#1074;&#1080;&#1089;&#1099;
&#1080; &#1076;&#1088;&#1072;&#1081;&#1074;&#1077;&#1088;&#1099; ]=====</p>
<p>&#1057;&#1080;&#1089;&#1090;&#1077;&#1084;&#1085;&#1099;&#1077;
&#1089;&#1077;&#1088;&#1074;&#1080;&#1089;&#1099; &#1080;
&#1076;&#1088;&#1072;&#1081;&#1074;&#1077;&#1088;&#1099;
&#1086;&#1073;&#1088;&#1072;&#1073;&#1072;&#1090;&#1099;&#1074;&#1072;&#1102;&#1090;&#1089;&#1103;
&#1095;&#1077;&#1090;&#1099;&#1088;&#1100;&#1084;&#1103;
&#1085;&#1077;&#1079;&#1072;&#1074;&#1080;&#1089;&#1080;&#1084;&#1099;&#1084;&#1080;
API-&#1092;&#1091;&#1085;&#1082;&#1094;&#1080;&#1103;&#1084;&#1080;.
&#1048;&#1093; &#1089;&#1074;&#1103;&#1079;&#1080;
&#1088;&#1072;&#1079;&#1083;&#1080;&#1095;&#1085;&#1099; &#1074;
&#1082;&#1072;&#1078;&#1076;&#1086;&#1081;
&#1074;&#1077;&#1088;&#1089;&#1080;&#1080; Windows.
&#1055;&#1086;&#1101;&#1090;&#1086;&#1084;&#1091; &#1084;&#1099;
&#1074;&#1099;&#1085;&#1091;&#1078;&#1076;&#1077;&#1085;&#1099;
&#1087;&#1077;&#1088;&#1077;&#1093;&#1074;&#1072;&#1090;&#1099;&#1074;&#1072;&#1090;&#1100;
&#1074;&#1089;&#1077; &#1095;&#1077;&#1090;&#1099;&#1088;&#1077;
&#1092;&#1091;&#1085;&#1082;&#1094;&#1080;&#1080;.
<p><code><!--mstheme--></font>
<pre>        BOOL EnumServicesStatusA(
                SC_HANDLE hSCManager,
                DWORD dwServiceType,
                DWORD dwServiceState,
                LPENUM_SERVICE_STATUS lpServices,
                DWORD cbBufSize,
                LPDWORD pcbBytesNeeded,
                LPDWORD lpServicesReturned,
                LPDWORD lpResumeHandle
        );

        BOOL EnumServiceGroupW(
                SC_HANDLE hSCManager,
                DWORD dwServiceType,
                DWORD dwServiceState,
                LPBYTE lpServices,
                DWORD cbBufSize,
                LPDWORD pcbBytesNeeded,
                LPDWORD lpServicesReturned,
                LPDWORD lpResumeHandle,
                DWORD dwUnknown
        );

        BOOL EnumServicesStatusExA(
                SC_HANDLE hSCManager,
                SC_ENUM_TYPE InfoLevel,
                DWORD dwServiceType,
                DWORD dwServiceState,
                LPBYTE lpServices,
                DWORD cbBufSize,
                LPDWORD pcbBytesNeeded,
                LPDWORD lpServicesReturned,
                LPDWORD lpResumeHandle,
                LPCTSTR pszGroupName
        );

        BOOL EnumServicesStatusExW(
                SC_HANDLE hSCManager,
                SC_ENUM_TYPE InfoLevel,
                DWORD dwServiceType,
                DWORD dwServiceState,
                LPBYTE lpServices,
                DWORD cbBufSize,
                LPDWORD pcbBytesNeeded,
                LPDWORD lpServicesReturned,
                LPDWORD lpResumeHandle,
                LPCTSTR pszGroupName
        );</pre>
<!--mstheme--><font face="Arial, Arial, Helvetica"></code>
<p>&#1053;&#1072;&#1080;&#1073;&#1086;&#1083;&#1077;&#1077;
&#1074;&#1072;&#1078;&#1077;&#1085; &#1079;&#1076;&#1077;&#1089;&#1100;
&#1087;&#1072;&#1088;&#1072;&#1084;&#1077;&#1090;&#1088; lpServices,
&#1082;&#1086;&#1090;&#1086;&#1088;&#1086;&#1077;
&#1091;&#1082;&#1072;&#1079;&#1099;&#1074;&#1072;&#1077;&#1090; &#1085;&#1072;
&#1073;&#1091;&#1092;&#1077;&#1088;, &#1075;&#1076;&#1077;
&#1076;&#1086;&#1083;&#1078;&#1077;&#1085; &#1073;&#1099;&#1090;&#1100;
&#1088;&#1072;&#1079;&#1084;&#1077;&#1097;&#1077;&#1085;
&#1089;&#1087;&#1080;&#1089;&#1086;&#1082;
&#1089;&#1077;&#1088;&#1074;&#1080;&#1089;&#1086;&#1074;. lpServicesReturned,
&#1082;&#1086;&#1090;&#1086;&#1088;&#1086;&#1077;
&#1091;&#1082;&#1072;&#1079;&#1099;&#1074;&#1072;&#1077;&#1090; &#1085;&#1072;
&#1082;&#1086;&#1083;&#1080;&#1095;&#1077;&#1089;&#1090;&#1074;&#1086;
&#1079;&#1072;&#1087;&#1080;&#1089;&#1077;&#1081; &#1074;
&#1073;&#1091;&#1092;&#1077;&#1088;&#1077;, &#1090;&#1072;&#1082;&#1078;&#1077;
&#1074;&#1072;&#1078;&#1085;&#1086;.
&#1057;&#1090;&#1088;&#1091;&#1082;&#1090;&#1091;&#1088;&#1072;
&#1076;&#1072;&#1085;&#1085;&#1099;&#1093; &#1074;
&#1074;&#1099;&#1093;&#1086;&#1076;&#1085;&#1086;&#1084;
&#1073;&#1091;&#1092;&#1077;&#1088;&#1077;
&#1079;&#1072;&#1074;&#1080;&#1089;&#1080;&#1090; &#1086;&#1090;
&#1090;&#1080;&#1087;&#1072; &#1092;&#1091;&#1085;&#1082;&#1094;&#1080;&#1080;.
&#1044;&#1083;&#1103; &#1092;&#1091;&#1085;&#1082;&#1094;&#1080;&#1081;
EnumServicesStatusA &#1080; EnumServicesGroupW
&#1074;&#1086;&#1079;&#1074;&#1088;&#1072;&#1097;&#1072;&#1077;&#1090;&#1089;&#1103;
&#1089;&#1090;&#1088;&#1091;&#1082;&#1090;&#1091;&#1088;&#1072;:
<p><code><!--mstheme--></font>
<pre>        typedef struct _ENUM_SERVICE_STATUS {
                LPTSTR lpServiceName;
                LPTSTR lpDisplayName;
                SERVICE_STATUS ServiceStatus;
        } ENUM_SERVICE_STATUS, *LPENUM_SERVICE_STATUS;

        typedef struct _SERVICE_STATUS {
                DWORD dwServiceType;
                DWORD dwCurrentState;
                DWORD dwControlsAccepted;
                DWORD dwWin32ExitCode;
                DWORD dwServiceSpecificExitCode;
                DWORD dwCheckPoint;
                DWORD dwWaitHint;
        } SERVICE_STATUS, *LPSERVICE_STATUS;</pre>
<!--mstheme--><font face="Arial, Arial, Helvetica"></code>
<p>&#1072; &#1076;&#1083;&#1103; EnumServicesStatusExA &#1080;
EnumServicesStatusExW:
<p><code><!--mstheme--></font>
<pre>        typedef struct _ENUM_SERVICE_STATUS_PROCESS {
                LPTSTR lpServiceName;
                LPTSTR lpDisplayName;
                SERVICE_STATUS_PROCESS ServiceStatusProcess;
        } ENUM_SERVICE_STATUS_PROCESS, *LPENUM_SERVICE_STATUS_PROCESS;

        typedef struct _SERVICE_STATUS_PROCESS {
                DWORD dwServiceType;
                DWORD dwCurrentState;
                DWORD dwControlsAccepted;
                DWORD dwWin32ExitCode;
                DWORD dwServiceSpecificExitCode;
                DWORD dwCheckPoint;
                DWORD dwWaitHint;
                DWORD dwProcessId;
                DWORD dwServiceFlags;
        } SERVICE_STATUS_PROCESS, *LPSERVICE_STATUS_PROCESS;</pre>
<!--mstheme--><font face="Arial, Arial, Helvetica"></code>
<p>&#1053;&#1072;&#1089;
&#1080;&#1085;&#1090;&#1077;&#1088;&#1077;&#1089;&#1091;&#1077;&#1090;
&#1090;&#1086;&#1083;&#1100;&#1082;&#1086; &#1087;&#1086;&#1083;&#1077;
lpServiceName, &#1082;&#1086;&#1090;&#1086;&#1088;&#1086;&#1077;
&#1089;&#1086;&#1076;&#1077;&#1088;&#1078;&#1080;&#1090; &#1080;&#1084;&#1103;
&#1089;&#1077;&#1088;&#1074;&#1080;&#1089;&#1072;.
&#1047;&#1072;&#1087;&#1080;&#1089;&#1080; &#1080;&#1084;&#1077;&#1102;&#1090;
&#1092;&#1080;&#1082;&#1089;&#1080;&#1088;&#1086;&#1074;&#1072;&#1085;&#1085;&#1099;&#1081;
&#1088;&#1072;&#1079;&#1084;&#1077;&#1088;,
&#1087;&#1086;&#1101;&#1090;&#1086;&#1084;&#1091;, &#1077;&#1089;&#1083;&#1080;
&#1084;&#1099; &#1093;&#1086;&#1090;&#1080;&#1084;
&#1089;&#1082;&#1088;&#1099;&#1090;&#1100; &#1086;&#1076;&#1085;&#1091;,
&#1084;&#1099;
&#1087;&#1077;&#1088;&#1077;&#1076;&#1074;&#1080;&#1085;&#1077;&#1084;
&#1074;&#1089;&#1077;
&#1087;&#1086;&#1089;&#1083;&#1077;&#1076;&#1091;&#1102;&#1097;&#1080;&#1077;
&#1079;&#1072;&#1087;&#1080;&#1089;&#1080; &#1085;&#1072; &#1077;&#1077;
&#1088;&#1072;&#1079;&#1084;&#1077;&#1088;. &#1047;&#1076;&#1077;&#1089;&#1100;
&#1084;&#1099; &#1076;&#1086;&#1083;&#1078;&#1085;&#1099;
&#1087;&#1086;&#1084;&#1085;&#1080;&#1090;&#1100; &#1086;
&#1088;&#1072;&#1079;&#1083;&#1080;&#1095;&#1080;&#1080;
&#1088;&#1072;&#1079;&#1084;&#1077;&#1088;&#1086;&#1074; SERVICE_STATUS &#1080;
SERVICE_STATUS_PROCESS. <a name="7"></a>
<p align="center">=====[ 7.
&#1055;&#1077;&#1088;&#1077;&#1093;&#1074;&#1072;&#1090; &#1080;
&#1088;&#1072;&#1089;&#1087;&#1088;&#1086;&#1089;&#1090;&#1088;&#1072;&#1085;&#1077;&#1085;&#1080;&#1077;
]=====</p>
<p>&#1063;&#1090;&#1086;&#1073;&#1099;
&#1087;&#1086;&#1083;&#1091;&#1095;&#1080;&#1090;&#1100;
&#1078;&#1077;&#1083;&#1072;&#1077;&#1084;&#1099;&#1081;
&#1101;&#1092;&#1092;&#1077;&#1082;&#1090;, &#1084;&#1099;
&#1076;&#1086;&#1083;&#1078;&#1085;&#1099;
&#1079;&#1072;&#1088;&#1072;&#1079;&#1080;&#1090;&#1100; &#1074;&#1089;&#1077;
&#1079;&#1072;&#1087;&#1091;&#1097;&#1077;&#1085;&#1085;&#1099;&#1077;
&#1087;&#1088;&#1086;&#1094;&#1077;&#1089;&#1089;&#1099;, &#1072;
&#1090;&#1072;&#1082;&#1078;&#1077;
&#1087;&#1088;&#1086;&#1094;&#1077;&#1089;&#1089;&#1099;,
&#1082;&#1086;&#1090;&#1086;&#1088;&#1099;&#1077;
&#1073;&#1091;&#1076;&#1091;&#1090;
&#1079;&#1072;&#1087;&#1091;&#1097;&#1077;&#1085;&#1099;
&#1087;&#1086;&#1079;&#1078;&#1077;. &#1053;&#1086;&#1074;&#1099;&#1077;
&#1087;&#1088;&#1086;&#1094;&#1077;&#1089;&#1089;&#1099;
&#1076;&#1086;&#1083;&#1078;&#1085;&#1099; &#1073;&#1099;&#1090;&#1100;
&#1079;&#1072;&#1088;&#1072;&#1078;&#1077;&#1085;&#1099; &#1076;&#1086;
&#1074;&#1099;&#1087;&#1086;&#1083;&#1085;&#1077;&#1085;&#1080;&#1103;
&#1087;&#1077;&#1088;&#1074;&#1086;&#1081;
&#1080;&#1085;&#1089;&#1090;&#1088;&#1091;&#1082;&#1094;&#1080;&#1080;
&#1080;&#1093; &#1082;&#1086;&#1076;&#1072;, &#1080;&#1085;&#1072;&#1095;&#1077;
&#1086;&#1085;&#1080; &#1089;&#1084;&#1086;&#1075;&#1091;&#1090;
&#1091;&#1074;&#1080;&#1076;&#1077;&#1090;&#1100; &#1085;&#1072;&#1096;&#1080;
&#1089;&#1082;&#1088;&#1099;&#1090;&#1099;&#1077;
&#1086;&#1073;&#1098;&#1077;&#1082;&#1090;&#1099; &#1076;&#1086;
&#1090;&#1086;&#1075;&#1086;, &#1082;&#1072;&#1082;
&#1092;&#1091;&#1085;&#1082;&#1094;&#1080;&#1080;
&#1073;&#1091;&#1076;&#1091;&#1090;
&#1087;&#1077;&#1088;&#1077;&#1093;&#1074;&#1072;&#1095;&#1077;&#1085;&#1099;. <a name="7_1"></a>
<p align="center">=====[ 7.1
&#1055;&#1088;&#1080;&#1074;&#1077;&#1083;&#1077;&#1075;&#1080;&#1080; ]=====</p>
<p>&#1053;&#1072;&#1084; &#1085;&#1091;&#1078;&#1085;&#1099;
&#1082;&#1072;&#1082; &#1084;&#1080;&#1085;&#1080;&#1084;&#1091;&#1084;
&#1072;&#1076;&#1084;&#1080;&#1085;&#1080;&#1089;&#1090;&#1088;&#1072;&#1090;&#1086;&#1088;&#1089;&#1082;&#1080;&#1077;
&#1087;&#1088;&#1072;&#1074;&#1072;, &#1095;&#1090;&#1086;&#1073;&#1099;
&#1087;&#1086;&#1083;&#1091;&#1095;&#1080;&#1090;&#1100;
&#1076;&#1086;&#1089;&#1090;&#1091;&#1087; &#1082;&#1086;
&#1074;&#1089;&#1077;&#1084;
&#1079;&#1072;&#1087;&#1091;&#1097;&#1077;&#1085;&#1085;&#1099;&#1084;
&#1087;&#1088;&#1086;&#1094;&#1077;&#1089;&#1089;&#1072;&#1084;.
&#1051;&#1091;&#1095;&#1096;&#1072;&#1103;
&#1074;&#1086;&#1079;&#1084;&#1086;&#1078;&#1085;&#1086;&#1089;&#1090;&#1100; -
&#1101;&#1090;&#1086; &#1079;&#1072;&#1087;&#1091;&#1089;&#1082;
&#1085;&#1072;&#1096;&#1077;&#1075;&#1086;
&#1087;&#1088;&#1086;&#1094;&#1077;&#1089;&#1089;&#1072; &#1082;&#1072;&#1082;
&#1089;&#1080;&#1089;&#1090;&#1077;&#1084;&#1085;&#1086;&#1075;&#1086;
&#1089;&#1077;&#1088;&#1074;&#1080;&#1089;&#1072;,
&#1082;&#1086;&#1090;&#1086;&#1088;&#1099;&#1081;
&#1088;&#1072;&#1073;&#1086;&#1090;&#1072;&#1077;&#1090; &#1089;
&#1087;&#1088;&#1072;&#1074;&#1072;&#1084;&#1080;
&#1087;&#1086;&#1083;&#1100;&#1079;&#1086;&#1074;&#1072;&#1090;&#1077;&#1083;&#1103;
SYSTEM. &#1063;&#1090;&#1086;&#1073;&#1099;
&#1091;&#1089;&#1090;&#1072;&#1085;&#1086;&#1074;&#1080;&#1090;&#1100;
&#1089;&#1077;&#1088;&#1074;&#1080;&#1089; &#1085;&#1072;&#1084;
&#1090;&#1086;&#1078;&#1077; &#1085;&#1091;&#1078;&#1085;&#1099;
&#1089;&#1087;&#1077;&#1094;&#1080;&#1072;&#1083;&#1100;&#1085;&#1099;&#1077;
&#1087;&#1088;&#1080;&#1074;&#1077;&#1083;&#1077;&#1075;&#1080;&#1080;.
<p>&#1058;&#1072;&#1082;&#1078;&#1077; &#1086;&#1095;&#1077;&#1085;&#1100;
&#1087;&#1086;&#1083;&#1077;&#1079;&#1085;&#1086;
&#1087;&#1086;&#1083;&#1091;&#1095;&#1077;&#1085;&#1080;&#1077;
&#1087;&#1088;&#1080;&#1074;&#1077;&#1083;&#1077;&#1075;&#1080;&#1080;
SeDebugPrivilege. &#1069;&#1090;&#1086; &#1084;&#1086;&#1078;&#1077;&#1090;
&#1073;&#1099;&#1090;&#1100; &#1089;&#1076;&#1077;&#1083;&#1072;&#1085;&#1086;
&#1089; &#1087;&#1086;&#1084;&#1086;&#1097;&#1100;&#1102;
&#1092;&#1091;&#1085;&#1082;&#1094;&#1080;&#1081; OpenProcessToken,
LookupPrivilegeValue &#1080; AdjustTokenPrivileges.
<p><code><!--mstheme--></font>
<pre>        BOOL OpenProcessToken(
                HANDLE ProcessHandle,
                DWORD DesiredAccess,
                PHANDLE TokenHandle
        );

        BOOL LookupPrivilegeValue(
                LPCTSTR lpSystemName,
                LPCTSTR lpName,
                PLUID lpLuid
        );

        BOOL AdjustTokenPrivileges(
                HANDLE TokenHandle,
                BOOL DisableAllPrivileges,
                PTOKEN_PRIVILEGES NewState,
                DWORD BufferLength,
                PTOKEN_PRIVILEGES PreviousState,
                PDWORD ReturnLength
        );</pre>
<!--mstheme--><font face="Arial, Arial, Helvetica"></code>&#1048;&#1075;&#1085;&#1086;&#1088;&#1080;&#1088;&#1091;&#1103;
&#1074;&#1086;&#1079;&#1084;&#1086;&#1078;&#1085;&#1099;&#1077;
&#1086;&#1096;&#1080;&#1073;&#1082;&#1080;, &#1101;&#1090;&#1086;
&#1084;&#1086;&#1078;&#1077;&#1090; &#1073;&#1099;&#1090;&#1100;
&#1089;&#1076;&#1077;&#1083;&#1072;&#1085;&#1086; &#1090;&#1072;&#1082;:
<p><code><!--mstheme--></font>
<pre>        #define SE_PRIVILEGE_ENABLED    0x0002
        #define TOKEN_QUERY             0x0008
        #define TOKEN_ADJUST_PRIVILEGES 0x0020

        HANDLE hToken;
        LUID DebugNameValue;
        TOKEN_PRIVILEGES Privileges;
        DWORD dwRet;

        OpenProcessToken(GetCurrentProcess(),
                         TOKEN_ADJUST_PRIVILEGES | TOKEN_QUERY,hToken);
        LookupPrivilegeValue(NULL,&quot;SeDebugPrivilege&quot;,&amp;DebugNameValue);
        Privileges.PrivilegeCount=1;
        Privileges.Privileges[0].Luid=DebugNameValue;
        Privileges.Privileges[0].Attributes=SE_PRIVILEGE_ENABLED;
        AdjustTokenPrivileges(hToken,FALSE,&amp;Privileges,sizeof(Privileges),
                              NULL,&amp;dwRet);
        CloseHandle(hToken);</pre>
<!--mstheme--><font face="Arial, Arial, Helvetica"></code><a name="7_2"></a>
<p align="center">=====[ 7.2
&#1055;&#1077;&#1088;&#1077;&#1093;&#1074;&#1072;&#1090; ]=====</p>
<p>&#1055;&#1077;&#1088;&#1077;&#1095;&#1080;&#1089;&#1083;&#1077;&#1085;&#1080;&#1077;
&#1087;&#1088;&#1086;&#1094;&#1077;&#1089;&#1089;&#1086;&#1074;
&#1087;&#1088;&#1086;&#1080;&#1079;&#1074;&#1086;&#1076;&#1080;&#1090;&#1089;&#1103;
&#1091;&#1078;&#1077;
&#1091;&#1087;&#1086;&#1084;&#1103;&#1085;&#1091;&#1090;&#1086;&#1081; API-&#1092;&#1091;&#1085;&#1082;&#1094;&#1080;&#1077;&#1081;
NtQuerySystemInformation. &#1044;&#1083;&#1103;
&#1087;&#1077;&#1088;&#1077;&#1093;&#1074;&#1072;&#1090;&#1072;
&#1092;&#1091;&#1085;&#1082;&#1094;&#1080;&#1081;
&#1080;&#1089;&#1087;&#1086;&#1083;&#1100;&#1079;&#1091;&#1077;&#1090;&#1089;&#1103;
&#1084;&#1077;&#1090;&#1086;&#1076;
&#1087;&#1077;&#1088;&#1077;&#1079;&#1072;&#1087;&#1080;&#1089;&#1080;
&#1077;&#1077; &#1087;&#1077;&#1088;&#1074;&#1099;&#1093;
&#1080;&#1085;&#1089;&#1090;&#1088;&#1091;&#1082;&#1094;&#1080;&#1081;.
&#1069;&#1090;&#1086; &#1076;&#1077;&#1083;&#1072;&#1077;&#1090;&#1089;&#1103;
&#1076;&#1083;&#1103; &#1082;&#1072;&#1078;&#1076;&#1086;&#1075;&#1086;
&#1079;&#1072;&#1087;&#1091;&#1097;&#1077;&#1085;&#1086;&#1075;&#1086;
&#1087;&#1088;&#1086;&#1094;&#1077;&#1089;&#1089;&#1072;. &#1052;&#1099;
&#1074;&#1099;&#1076;&#1077;&#1083;&#1080;&#1084;
&#1087;&#1072;&#1084;&#1103;&#1090;&#1100; &#1074;
&#1085;&#1091;&#1078;&#1085;&#1086;&#1084;
&#1087;&#1088;&#1086;&#1094;&#1077;&#1089;&#1089;&#1077;, &#1075;&#1076;&#1077;
&#1079;&#1072;&#1087;&#1080;&#1096;&#1077;&#1084;
&#1085;&#1086;&#1074;&#1099;&#1081; &#1082;&#1086;&#1076; &#1076;&#1083;&#1103;
&#1092;&#1091;&#1085;&#1082;&#1094;&#1080;&#1081;,
&#1082;&#1086;&#1090;&#1086;&#1088;&#1099;&#1077;
&#1093;&#1086;&#1090;&#1080;&#1084;
&#1087;&#1077;&#1088;&#1077;&#1093;&#1074;&#1072;&#1090;&#1080;&#1090;&#1100;.
&#1047;&#1072;&#1090;&#1077;&#1084;
&#1079;&#1072;&#1084;&#1077;&#1085;&#1080;&#1084;
&#1087;&#1077;&#1088;&#1074;&#1099;&#1077; &#1087;&#1103;&#1090;&#1100;
&#1073;&#1072;&#1081;&#1090; &#1101;&#1090;&#1080;&#1093;
&#1092;&#1091;&#1085;&#1082;&#1094;&#1080;&#1081; &#1085;&#1072;
&#1080;&#1085;&#1089;&#1090;&#1088;&#1091;&#1082;&#1094;&#1080;&#1102; jmp.
&#1069;&#1090;&#1072;
&#1080;&#1085;&#1089;&#1090;&#1088;&#1091;&#1082;&#1094;&#1080;&#1103;
&#1073;&#1091;&#1076;&#1077;&#1090;
&#1087;&#1077;&#1088;&#1077;&#1085;&#1072;&#1087;&#1088;&#1072;&#1074;&#1083;&#1103;&#1090;&#1100;
&#1074;&#1099;&#1087;&#1086;&#1083;&#1085;&#1077;&#1085;&#1080;&#1077;
&#1085;&#1072; &#1085;&#1072;&#1096; &#1082;&#1086;&#1076;.
&#1058;&#1072;&#1082;,
&#1080;&#1085;&#1089;&#1090;&#1088;&#1091;&#1082;&#1094;&#1080;&#1103; jmp
&#1073;&#1091;&#1076;&#1077;&#1090;
&#1074;&#1099;&#1087;&#1086;&#1083;&#1085;&#1077;&#1085;&#1072;
&#1089;&#1088;&#1072;&#1079;&#1091;, &#1082;&#1072;&#1082;
&#1090;&#1086;&#1083;&#1100;&#1082;&#1086;
&#1092;&#1091;&#1085;&#1082;&#1094;&#1080;&#1103;
&#1073;&#1091;&#1076;&#1077;&#1090;
&#1074;&#1099;&#1079;&#1074;&#1072;&#1085;&#1072;. &#1052;&#1099;
&#1076;&#1086;&#1083;&#1078;&#1085;&#1099;
&#1089;&#1086;&#1093;&#1088;&#1072;&#1085;&#1080;&#1090;&#1100;
&#1087;&#1077;&#1088;&#1074;&#1099;&#1077;
&#1080;&#1085;&#1089;&#1090;&#1088;&#1091;&#1082;&#1094;&#1080;&#1080;
&#1082;&#1072;&#1078;&#1076;&#1086;&#1081;
&#1087;&#1077;&#1088;&#1077;&#1079;&#1072;&#1087;&#1080;&#1089;&#1072;&#1085;&#1085;&#1086;&#1081;
&#1092;&#1091;&#1085;&#1082;&#1094;&#1080;&#1080; - &#1086;&#1085;&#1080;
&#1085;&#1077;&#1086;&#1073;&#1093;&#1086;&#1076;&#1080;&#1084;&#1099;
&#1076;&#1083;&#1103; &#1074;&#1099;&#1079;&#1086;&#1074;&#1072;
&#1086;&#1088;&#1080;&#1075;&#1080;&#1085;&#1072;&#1083;&#1100;&#1085;&#1086;&#1075;&#1086;
&#1082;&#1086;&#1076;&#1072;
&#1087;&#1077;&#1088;&#1077;&#1093;&#1074;&#1072;&#1095;&#1077;&#1085;&#1085;&#1086;&#1081;
&#1092;&#1091;&#1085;&#1082;&#1094;&#1080;&#1080;.
&#1057;&#1086;&#1093;&#1088;&#1072;&#1085;&#1077;&#1085;&#1080;&#1077;
&#1080;&#1085;&#1089;&#1090;&#1088;&#1091;&#1082;&#1094;&#1080;&#1081;
&#1086;&#1087;&#1080;&#1089;&#1099;&#1074;&#1072;&#1077;&#1090;&#1089;&#1103;
&#1074; &#1088;&#1072;&#1079;&#1076;&#1077;&#1083;&#1077; 3.2.3
&#1089;&#1090;&#1072;&#1090;&#1100;&#1080; &quot;Hooking Windows API&quot;.
<p>&#1057;&#1085;&#1072;&#1095;&#1072;&#1083;&#1072; &#1084;&#1099;
&#1076;&#1086;&#1083;&#1078;&#1085;&#1099;
&#1086;&#1090;&#1082;&#1088;&#1099;&#1090;&#1100;
&#1085;&#1091;&#1078;&#1085;&#1099;&#1081;
&#1087;&#1088;&#1086;&#1094;&#1077;&#1089;&#1089; &#1089;
&#1087;&#1086;&#1084;&#1086;&#1097;&#1100;&#1102; NtOpenProcess &#1080;
&#1087;&#1086;&#1083;&#1091;&#1095;&#1080;&#1090;&#1100; &#1077;&#1075;&#1086;
&#1093;&#1101;&#1085;&#1076;&#1083;.
&#1055;&#1088;&#1086;&#1080;&#1079;&#1086;&#1081;&#1076;&#1077;&#1090;
&#1086;&#1096;&#1080;&#1073;&#1082;&#1072;, &#1077;&#1089;&#1083;&#1080; &#1091;
&#1085;&#1072;&#1089;
&#1085;&#1077;&#1076;&#1086;&#1089;&#1090;&#1072;&#1090;&#1086;&#1095;&#1085;&#1086;
&#1087;&#1088;&#1080;&#1074;&#1077;&#1083;&#1077;&#1075;&#1080;&#1081;.
<p><code><!--mstheme--></font>
<pre>        NTSTATUS NtOpenProcess(
                OUT PHANDLE ProcessHandle,
                IN ACCESS_MASK DesiredAccess,
                IN POBJECT_ATTRIBUTES ObjectAttributes,
                IN PCLIENT_ID ClientId OPTIONAL
        );</pre>
<!--mstheme--><font face="Arial, Arial, Helvetica"></code>
<p>ProcessHandle -
&#1091;&#1082;&#1072;&#1079;&#1072;&#1090;&#1077;&#1083;&#1100; &#1085;&#1072;
&#1093;&#1101;&#1085;&#1076;&#1083;, &#1075;&#1076;&#1077;
&#1073;&#1091;&#1076;&#1077;&#1090;
&#1089;&#1086;&#1093;&#1088;&#1072;&#1085;&#1077;&#1085;
&#1088;&#1077;&#1079;&#1091;&#1083;&#1100;&#1090;&#1072;&#1090;. DesiredAccess
&#1089;&#1083;&#1077;&#1076;&#1091;&#1077;&#1090;
&#1091;&#1089;&#1090;&#1072;&#1085;&#1086;&#1074;&#1080;&#1090;&#1100;
&#1088;&#1072;&#1074;&#1085;&#1099;&#1084; PROCESS_ALL_ACCESS. &#1052;&#1099;
&#1091;&#1089;&#1090;&#1072;&#1085;&#1086;&#1074;&#1080;&#1084;
&#1087;&#1086;&#1083;&#1077; UniqueProcess
&#1089;&#1090;&#1088;&#1091;&#1082;&#1090;&#1091;&#1088;&#1099; ClientId
&#1088;&#1072;&#1074;&#1085;&#1099;&#1084; PID
&#1085;&#1091;&#1078;&#1085;&#1086;&#1075;&#1086;
&#1087;&#1088;&#1086;&#1094;&#1077;&#1089;&#1089;&#1072;, UniqueThread
&#1076;&#1086;&#1083;&#1078;&#1085;&#1086; &#1073;&#1099;&#1090;&#1100;
&#1088;&#1072;&#1074;&#1085;&#1086; &#1085;&#1091;&#1083;&#1102;.
&#1054;&#1090;&#1082;&#1088;&#1099;&#1090;&#1099;&#1081;
&#1093;&#1101;&#1085;&#1076;&#1083; &#1076;&#1086;&#1083;&#1078;&#1077;&#1085;
&#1073;&#1099;&#1090;&#1100; &#1079;&#1072;&#1082;&#1088;&#1099;&#1090; &#1089;
&#1087;&#1086;&#1084;&#1086;&#1097;&#1100;&#1102; NtClose.
<p><code><!--mstheme--></font>
<pre>        #define PROCESS_ALL_ACCESS 0x001F0FFF</pre>
<!--mstheme--><font face="Arial, Arial, Helvetica"></code>
<p>&#1058;&#1077;&#1087;&#1077;&#1088;&#1100; &#1084;&#1099;
&#1074;&#1099;&#1076;&#1077;&#1083;&#1080;&#1084;
&#1087;&#1072;&#1084;&#1103;&#1090;&#1100; &#1076;&#1083;&#1103;
&#1085;&#1072;&#1096;&#1077;&#1075;&#1086; &#1082;&#1086;&#1076;&#1072;.
&#1069;&#1090;&#1086; &#1084;&#1086;&#1078;&#1077;&#1090;
&#1073;&#1099;&#1090;&#1100; &#1089;&#1076;&#1077;&#1083;&#1072;&#1085;&#1086;
&#1089; &#1087;&#1086;&#1084;&#1086;&#1097;&#1100;&#1102;
&#1092;&#1091;&#1085;&#1082;&#1094;&#1080;&#1080; NtAllocateVirtualMemory.
<p><code><!--mstheme--></font>
<pre>        NTSTATUS NtAllocateVirtualMemory(
                IN HANDLE ProcessHandle,
                IN OUT PVOID BaseAddress,
                IN ULONG ZeroBits,
                IN OUT PULONG AllocationSize,
                IN ULONG AllocationType,
                IN ULONG Protect
        );</pre>
<!--mstheme--><font face="Arial, Arial, Helvetica"></code>
<p>&#1048;&#1089;&#1087;&#1086;&#1083;&#1100;&#1079;&#1091;&#1077;&#1090;&#1089;&#1103;
&#1079;&#1085;&#1072;&#1095;&#1077;&#1085;&#1080;&#1077; ProcessHandle
&#1074;&#1086;&#1079;&#1074;&#1088;&#1072;&#1097;&#1077;&#1085;&#1085;&#1086;&#1077;
&#1092;&#1091;&#1085;&#1082;&#1094;&#1080;&#1077;&#1081; NtOpenProcess.
BaseAddress - &#1091;&#1082;&#1072;&#1079;&#1072;&#1090;&#1077;&#1083;&#1100;
&#1085;&#1072; &#1091;&#1082;&#1072;&#1079;&#1072;&#1090;&#1077;&#1083;&#1100;
&#1085;&#1072; &#1078;&#1077;&#1083;&#1072;&#1077;&#1084;&#1086;&#1077;
&#1085;&#1072;&#1095;&#1072;&#1083;&#1086; &#1073;&#1083;&#1086;&#1082;&#1072;
&#1074;&#1099;&#1076;&#1077;&#1083;&#1077;&#1085;&#1085;&#1086;&#1081;
&#1087;&#1072;&#1084;&#1103;&#1090;&#1080;. &#1047;&#1076;&#1077;&#1089;&#1100;
&#1073;&#1091;&#1076;&#1077;&#1090;
&#1089;&#1086;&#1093;&#1088;&#1072;&#1085;&#1077;&#1085;
&#1091;&#1082;&#1072;&#1079;&#1072;&#1090;&#1077;&#1083;&#1100; &#1085;&#1072;
&#1074;&#1099;&#1076;&#1077;&#1083;&#1077;&#1085;&#1085;&#1091;&#1102;
&#1087;&#1072;&#1084;&#1103;&#1090;&#1100;.
&#1042;&#1093;&#1086;&#1076;&#1085;&#1086;&#1077;
&#1079;&#1085;&#1072;&#1095;&#1077;&#1085;&#1080;&#1077;
&#1084;&#1086;&#1078;&#1077;&#1090; &#1073;&#1099;&#1090;&#1100;
&#1088;&#1072;&#1074;&#1085;&#1086; NULL. AllocationSize -
&#1091;&#1082;&#1072;&#1079;&#1072;&#1090;&#1077;&#1083;&#1100; &#1085;&#1072;
&#1087;&#1077;&#1088;&#1077;&#1084;&#1077;&#1085;&#1085;&#1091;&#1102;,
&#1089;&#1086;&#1076;&#1077;&#1088;&#1078;&#1072;&#1097;&#1091;&#1102;
&#1088;&#1072;&#1079;&#1084;&#1077;&#1088;
&#1073;&#1091;&#1092;&#1077;&#1088;&#1072;,
&#1082;&#1086;&#1090;&#1086;&#1088;&#1099;&#1081; &#1084;&#1099;
&#1093;&#1086;&#1090;&#1080;&#1084;
&#1074;&#1099;&#1076;&#1077;&#1083;&#1080;&#1090;&#1100;. &#1048;
&#1090;&#1072;&#1082;&#1078;&#1077; &#1079;&#1076;&#1077;&#1089;&#1100;
&#1073;&#1091;&#1076;&#1077;&#1090;
&#1089;&#1086;&#1093;&#1088;&#1072;&#1085;&#1077;&#1085;&#1086;
&#1082;&#1086;&#1083;&#1080;&#1095;&#1077;&#1089;&#1090;&#1074;&#1086;
&#1088;&#1077;&#1072;&#1083;&#1100;&#1085;&#1086;
&#1074;&#1099;&#1076;&#1077;&#1083;&#1077;&#1085;&#1085;&#1099;&#1093;
&#1073;&#1072;&#1081;&#1090;.
&#1056;&#1077;&#1082;&#1086;&#1084;&#1077;&#1085;&#1076;&#1091;&#1102;
&#1074;&#1082;&#1083;&#1102;&#1095;&#1080;&#1090;&#1100;
&#1079;&#1085;&#1072;&#1095;&#1077;&#1085;&#1080;&#1077; MEM_TOP_DOWN &#1074;
&#1087;&#1072;&#1088;&#1072;&#1084;&#1077;&#1090;&#1088; AllocationType &#1074;
&#1076;&#1086;&#1087;&#1086;&#1083;&#1085;&#1077;&#1085;&#1080;&#1077; &#1082;
MEM_COMMIT, &#1090;.&#1082;. &#1074; &#1101;&#1090;&#1086;&#1084;
&#1089;&#1083;&#1091;&#1095;&#1072;&#1077;
&#1087;&#1072;&#1084;&#1103;&#1090;&#1100; &#1073;&#1091;&#1076;&#1077;&#1090;
&#1074;&#1099;&#1076;&#1077;&#1083;&#1077;&#1085;&#1072; &#1082;&#1072;&#1082;
&#1084;&#1086;&#1078;&#1085;&#1086; &#1074;&#1099;&#1096;&#1077;
&#1088;&#1103;&#1076;&#1086;&#1084; &#1089; DLL.
<p><code><!--mstheme--></font>
<pre>        #define MEM_COMMIT      0x00001000
        #define MEM_TOP_DOWN    0x00100000      </pre>
<!--mstheme--><font face="Arial, Arial, Helvetica"></code>
<p>&#1058;&#1077;&#1087;&#1077;&#1088;&#1100; &#1084;&#1099;
&#1084;&#1086;&#1078;&#1077;&#1084;
&#1079;&#1072;&#1087;&#1080;&#1089;&#1072;&#1090;&#1100; &#1085;&#1072;&#1096;
&#1082;&#1086;&#1076;,
&#1080;&#1089;&#1087;&#1086;&#1083;&#1100;&#1079;&#1091;&#1103;
NtWriteVirtualMemory.
<p><code><!--mstheme--></font>
<pre>        NTSTATUS NtWriteVirtualMemory(
                IN HANDLE ProcessHandle,
                IN PVOID BaseAddress,
                IN PVOID Buffer,
                IN ULONG BufferLength,
                OUT PULONG ReturnLength OPTIONAL
        );</pre>
<!--mstheme--><font face="Arial, Arial, Helvetica"></code>
<p>&#1042; &#1087;&#1072;&#1088;&#1072;&#1084;&#1077;&#1090;&#1088;&#1077;
BaseAddress
&#1080;&#1089;&#1087;&#1086;&#1083;&#1100;&#1079;&#1091;&#1077;&#1084;
&#1079;&#1085;&#1072;&#1095;&#1077;&#1085;&#1080;&#1077;
&#1074;&#1086;&#1079;&#1074;&#1088;&#1072;&#1097;&#1077;&#1085;&#1085;&#1086;&#1077;
NtAllocateVirtual. Buffer
&#1091;&#1082;&#1072;&#1079;&#1099;&#1074;&#1072;&#1077;&#1090; &#1085;&#1072;
&#1073;&#1072;&#1081;&#1090;&#1099;,
&#1082;&#1086;&#1090;&#1086;&#1088;&#1099;&#1077; &#1084;&#1099;
&#1093;&#1086;&#1090;&#1080;&#1084;
&#1079;&#1072;&#1087;&#1080;&#1089;&#1072;&#1090;&#1100;, BufferLength -
&#1082;&#1086;&#1083;&#1080;&#1095;&#1077;&#1089;&#1090;&#1074;&#1086;
&#1101;&#1090;&#1080;&#1093; &#1073;&#1072;&#1081;&#1090;&#1086;&#1074;.
<p>&#1058;&#1077;&#1087;&#1077;&#1088;&#1100; &#1084;&#1099;
&#1087;&#1077;&#1088;&#1077;&#1093;&#1074;&#1072;&#1090;&#1080;&#1084;
&#1092;&#1091;&#1085;&#1082;&#1094;&#1080;&#1080;.
&#1045;&#1076;&#1080;&#1085;&#1089;&#1090;&#1074;&#1077;&#1085;&#1085;&#1072;&#1103;
DLL, &#1082;&#1086;&#1090;&#1086;&#1088;&#1072;&#1103;
&#1079;&#1072;&#1075;&#1088;&#1091;&#1078;&#1072;&#1077;&#1090;&#1089;&#1103;
&#1074; &#1082;&#1072;&#1078;&#1076;&#1099;&#1081;
&#1087;&#1088;&#1086;&#1094;&#1077;&#1089;&#1089; - ntdll.dll.
&#1058;&#1072;&#1082;, &#1084;&#1099; &#1076;&#1086;&#1083;&#1078;&#1085;&#1099;
&#1087;&#1088;&#1086;&#1074;&#1077;&#1088;&#1080;&#1090;&#1100;
&#1080;&#1084;&#1087;&#1086;&#1088;&#1090;&#1080;&#1088;&#1086;&#1074;&#1072;&#1085;&#1072;
&#1083;&#1080; &#1092;&#1091;&#1085;&#1082;&#1094;&#1080;&#1103;,
&#1082;&#1086;&#1090;&#1086;&#1088;&#1091;&#1102; &#1084;&#1099;
&#1093;&#1086;&#1090;&#1080;&#1084;
&#1087;&#1077;&#1088;&#1077;&#1093;&#1074;&#1072;&#1090;&#1080;&#1090;&#1100;,
&#1074; &#1087;&#1088;&#1086;&#1094;&#1077;&#1089;&#1089;,
&#1077;&#1089;&#1083;&#1080; &#1101;&#1090;&#1072;
&#1092;&#1091;&#1085;&#1082;&#1094;&#1080;&#1103; &#1085;&#1077; &#1080;&#1079;
ntdll.dll. &#1053;&#1086; &#1087;&#1072;&#1084;&#1103;&#1090;&#1100;,
&#1082;&#1086;&#1090;&#1086;&#1088;&#1091;&#1102; &#1101;&#1090;&#1072;
&#1092;&#1091;&#1085;&#1082;&#1094;&#1080;&#1103; (&#1080;&#1079;
&#1076;&#1088;&#1091;&#1075;&#1086;&#1081; DLL)
&#1084;&#1086;&#1075;&#1083;&#1072; &#1073;&#1099;
&#1079;&#1072;&#1085;&#1080;&#1084;&#1072;&#1090;&#1100;
&#1084;&#1086;&#1078;&#1077;&#1090; &#1073;&#1099;&#1090;&#1100;
&#1074;&#1099;&#1076;&#1077;&#1083;&#1077;&#1085;&#1072;, &#1080;
&#1087;&#1077;&#1088;&#1077;&#1079;&#1072;&#1087;&#1080;&#1089;&#1100;
&#1101;&#1090;&#1080;&#1093; &#1073;&#1072;&#1081;&#1090;
&#1087;&#1086;&#1074;&#1083;&#1077;&#1095;&#1077;&#1090; &#1079;&#1072;
&#1089;&#1086;&#1073;&#1086;&#1081; &#1089;&#1073;&#1086;&#1081; &#1074;
&#1087;&#1088;&#1086;&#1094;&#1077;&#1089;&#1089;&#1077;.
&#1055;&#1086;&#1101;&#1090;&#1086;&#1084;&#1091; &#1084;&#1099;
&#1076;&#1086;&#1083;&#1078;&#1085;&#1099;
&#1087;&#1088;&#1086;&#1074;&#1077;&#1088;&#1080;&#1090;&#1100;
&#1079;&#1072;&#1075;&#1088;&#1091;&#1078;&#1077;&#1085;&#1072; &#1083;&#1080;
&#1101;&#1090;&#1072;
&#1073;&#1080;&#1073;&#1083;&#1080;&#1086;&#1090;&#1077;&#1082;&#1072; (&#1074;
&#1082;&#1086;&#1090;&#1086;&#1088;&#1086;&#1081;
&#1085;&#1091;&#1078;&#1085;&#1072;&#1103; &#1085;&#1072;&#1084;
&#1092;&#1091;&#1085;&#1082;&#1094;&#1080;&#1103;) &#1074;
&#1087;&#1088;&#1086;&#1094;&#1077;&#1089;&#1089;.
<p>&#1052;&#1099; &#1076;&#1086;&#1083;&#1078;&#1085;&#1099;
&#1087;&#1086;&#1083;&#1091;&#1095;&#1080;&#1090;&#1100; PEB (Process
Environment Block) &#1085;&#1091;&#1078;&#1085;&#1086;&#1075;&#1086;
&#1087;&#1088;&#1086;&#1094;&#1077;&#1089;&#1089;&#1072;,
&#1080;&#1089;&#1087;&#1086;&#1083;&#1100;&#1079;&#1091;&#1103;
NtQueryInformationProcess.
<p><code><!--mstheme--></font>
<pre>        NTSTATUS NtQueryInformationProcess(
                IN HANDLE ProcessHandle,
                IN PROCESSINFOCLASS ProcessInformationClass,
                OUT PVOID ProcessInformation,
                IN ULONG ProcessInformationLength,
                OUT PULONG ReturnLength OPTIONAL
        );</pre>
<!--mstheme--><font face="Arial, Arial, Helvetica"></code>
<p>&#1055;&#1088;&#1080;&#1089;&#1074;&#1086;&#1080;&#1084;
&#1079;&#1085;&#1072;&#1095;&#1077;&#1085;&#1080;&#1077; ProcessBasicInformation
&#1087;&#1072;&#1088;&#1072;&#1084;&#1077;&#1090;&#1088;&#1091;
ProcessInformationClass. &#1058;&#1086;&#1075;&#1076;&#1072; &#1074;
&#1073;&#1091;&#1092;&#1077;&#1088; ProcessInformation,
&#1088;&#1072;&#1079;&#1084;&#1077;&#1088;
&#1082;&#1086;&#1090;&#1086;&#1088;&#1086;&#1075;&#1086;
&#1091;&#1082;&#1072;&#1079;&#1072;&#1085; &#1074;
&#1087;&#1072;&#1088;&#1072;&#1084;&#1077;&#1090;&#1088;&#1077;
ProcessInformationLength, &#1073;&#1091;&#1076;&#1077;&#1090;
&#1074;&#1086;&#1079;&#1074;&#1088;&#1072;&#1097;&#1077;&#1085;&#1072;
&#1089;&#1090;&#1088;&#1091;&#1082;&#1090;&#1091;&#1088;&#1072;
PROCESS_BASIC_INFORMATION.
<p><code><!--mstheme--></font>
<pre>        #define ProcessBasicInformation 0

        typedef struct _PROCESS_BASIC_INFORMATION {
                NTSTATUS ExitStatus;
                PPEB PebBaseAddress;
                KAFFINITY AffinityMask;
                KPRIORITY BasePriority;
                ULONG UniqueProcessId;
                ULONG InheritedFromUniqueProcessId;
        } PROCESS_BASIC_INFORMATION, *PPROCESS_BASIC_INFORMATION;</pre>
<!--mstheme--><font face="Arial, Arial, Helvetica"></code>
<p>PebBaseAddress - &#1090;&#1086;, &#1095;&#1090;&#1086; &#1084;&#1099;
&#1080;&#1097;&#1077;&#1084;. PebBaseAddress+0x0C - &#1101;&#1090;&#1086;
&#1072;&#1076;&#1088;&#1077;&#1089; PPEB_LDR_DATA. &#1054;&#1085;
&#1084;&#1086;&#1078;&#1077;&#1090; &#1073;&#1099;&#1090;&#1100;
&#1087;&#1086;&#1083;&#1091;&#1095;&#1077;&#1085;
&#1074;&#1099;&#1079;&#1086;&#1074;&#1086;&#1084; NtReadVirtualMemory.
<p><code><!--mstheme--></font>
<pre>        NTSTATUS NtReadVirtualMemory(
                IN HANDLE ProcessHandle,
                IN PVOID BaseAddress,
                OUT PVOID Buffer,
                IN ULONG BufferLength,
                OUT PULONG ReturnLength OPTIONAL
        );</pre>
<!--mstheme--><font face="Arial, Arial, Helvetica"></code>
<p>&#1055;&#1072;&#1088;&#1072;&#1084;&#1077;&#1090;&#1088;&#1099;
&#1090;&#1072;&#1082;&#1080;&#1077; &#1078;&#1077; &#1082;&#1072;&#1082; &#1080;
&#1091; NtWriteVirtualMemory.
<p>PPEB_LDR_DATA+0x1C - &#1072;&#1076;&#1088;&#1077;&#1089;
InInitializationOrderModuleList. &#1069;&#1090;&#1086;
&#1089;&#1087;&#1080;&#1089;&#1086;&#1082;
&#1073;&#1080;&#1073;&#1083;&#1080;&#1086;&#1090;&#1077;&#1082;,
&#1079;&#1072;&#1075;&#1088;&#1091;&#1078;&#1077;&#1085;&#1085;&#1099;&#1093;
&#1074; &#1087;&#1088;&#1086;&#1094;&#1077;&#1089;&#1089;. &#1053;&#1072;&#1089;
&#1080;&#1085;&#1090;&#1077;&#1088;&#1077;&#1089;&#1091;&#1077;&#1090;
&#1090;&#1086;&#1083;&#1100;&#1082;&#1086; &#1095;&#1072;&#1089;&#1090;&#1100;
&#1101;&#1090;&#1086;&#1081;
&#1089;&#1090;&#1088;&#1091;&#1082;&#1090;&#1091;&#1088;&#1099;.
<p><code><!--mstheme--></font>
<pre>        typedef struct _IN_INITIALIZATION_ORDER_MODULE_LIST {
                PVOID Next,
                PVOID Prev,
                DWORD ImageBase,
                DWORD ImageEntry,
                DWORD ImageSize,
                ...
        );</pre>
<!--mstheme--><font face="Arial, Arial, Helvetica"></code>
<p>Next - &#1091;&#1082;&#1072;&#1079;&#1072;&#1090;&#1077;&#1083;&#1100;
&#1085;&#1072; &#1089;&#1083;&#1077;&#1076;&#1091;&#1102;&#1097;&#1091;&#1102;
&#1079;&#1072;&#1087;&#1080;&#1089;&#1100;, Prev - &#1085;&#1072;
&#1087;&#1088;&#1077;&#1076;&#1099;&#1076;&#1091;&#1097;&#1091;&#1102;.
&#1055;&#1086;&#1089;&#1083;&#1077;&#1076;&#1085;&#1103;&#1103;
&#1079;&#1072;&#1087;&#1080;&#1089;&#1100;
&#1091;&#1082;&#1072;&#1079;&#1099;&#1074;&#1072;&#1077;&#1090; &#1085;&#1072;
&#1087;&#1077;&#1088;&#1074;&#1091;&#1102;. ImageBase -
&#1072;&#1076;&#1088;&#1077;&#1089; &#1084;&#1086;&#1076;&#1091;&#1083;&#1103;
&#1074; &#1087;&#1072;&#1084;&#1103;&#1090;&#1080;. ImageEntry -
&#1101;&#1090;&#1086; &#1090;&#1086;&#1095;&#1082;&#1072;
&#1074;&#1093;&#1086;&#1076;&#1072; &#1084;&#1086;&#1076;&#1091;&#1083;&#1103;,
ImageSize - &#1077;&#1075;&#1086; &#1088;&#1072;&#1079;&#1084;&#1077;&#1088;.
<p>&#1044;&#1083;&#1103; &#1082;&#1072;&#1078;&#1076;&#1086;&#1081;
&#1073;&#1080;&#1073;&#1083;&#1080;&#1086;&#1090;&#1077;&#1082;&#1080;,
&#1092;&#1091;&#1085;&#1082;&#1094;&#1080;&#1080;
&#1082;&#1086;&#1090;&#1086;&#1088;&#1086;&#1081; &#1084;&#1099;
&#1093;&#1086;&#1090;&#1080;&#1084;
&#1087;&#1077;&#1088;&#1077;&#1093;&#1074;&#1072;&#1090;&#1080;&#1090;&#1100;,
&#1084;&#1099; &#1087;&#1086;&#1083;&#1091;&#1095;&#1080;&#1084; ImageBase (&#1085;&#1072;&#1087;&#1088;&#1080;&#1084;&#1077;&#1088;,
&#1080;&#1089;&#1087;&#1086;&#1083;&#1100;&#1079;&#1091;&#1103; GetModuleHandle
&#1080;&#1083;&#1080; LoadLibrary). &#1069;&#1090;&#1091; ImageBase
&#1084;&#1099; &#1089;&#1088;&#1072;&#1074;&#1085;&#1080;&#1084; &#1089;
ImageBase &#1082;&#1072;&#1078;&#1076;&#1086;&#1075;&#1086;
&#1101;&#1083;&#1077;&#1084;&#1077;&#1085;&#1090;&#1072; &#1074;
InInitializationOrderModuleList.
<p>&#1058;&#1077;&#1087;&#1077;&#1088;&#1100; &#1084;&#1099;
&#1075;&#1086;&#1090;&#1086;&#1074;&#1099; &#1082;
&#1087;&#1077;&#1088;&#1077;&#1093;&#1074;&#1072;&#1090;&#1091;. &#1048;&#1079;-&#1079;&#1072;
&#1090;&#1086;&#1075;&#1086;, &#1095;&#1090;&#1086; &#1084;&#1099;
&#1087;&#1077;&#1088;&#1077;&#1093;&#1074;&#1072;&#1090;&#1099;&#1074;&#1072;&#1077;&#1084;
&#1092;&#1091;&#1085;&#1082;&#1094;&#1080;&#1080; &#1074;
&#1088;&#1072;&#1073;&#1086;&#1090;&#1072;&#1102;&#1097;&#1080;&#1093;
&#1087;&#1088;&#1086;&#1094;&#1077;&#1089;&#1089;&#1072;&#1093;,
&#1089;&#1091;&#1097;&#1077;&#1089;&#1090;&#1074;&#1091;&#1077;&#1090;
&#1074;&#1077;&#1088;&#1086;&#1103;&#1090;&#1085;&#1086;&#1089;&#1090;&#1100;,
&#1095;&#1090;&#1086; &#1082;&#1086;&#1076;,
&#1082;&#1086;&#1090;&#1086;&#1088;&#1099;&#1081; &#1084;&#1099;
&#1073;&#1091;&#1076;&#1077;&#1084;
&#1087;&#1077;&#1088;&#1077;&#1079;&#1072;&#1087;&#1080;&#1089;&#1099;&#1074;&#1072;&#1090;&#1100;
&#1074; &#1090;&#1086;&#1090; &#1084;&#1086;&#1084;&#1077;&#1085;&#1090;
&#1073;&#1091;&#1076;&#1077;&#1090;
&#1074;&#1099;&#1087;&#1086;&#1083;&#1085;&#1103;&#1090;&#1100;&#1089;&#1103;.
&#1069;&#1090;&#1086; &#1084;&#1086;&#1078;&#1077;&#1090;
&#1074;&#1099;&#1079;&#1074;&#1072;&#1090;&#1100;
&#1086;&#1096;&#1080;&#1073;&#1082;&#1091;,
&#1087;&#1086;&#1101;&#1090;&#1086;&#1084;&#1091;
&#1089;&#1085;&#1072;&#1095;&#1072;&#1083;&#1072; &#1084;&#1099;
&#1086;&#1089;&#1090;&#1072;&#1085;&#1086;&#1074;&#1080;&#1084;
&#1074;&#1089;&#1077; &#1087;&#1086;&#1090;&#1086;&#1082;&#1080;
&#1101;&#1090;&#1086;&#1075;&#1086;
&#1087;&#1088;&#1086;&#1094;&#1077;&#1089;&#1089;&#1072;.
&#1057;&#1087;&#1080;&#1089;&#1086;&#1082;
&#1087;&#1086;&#1090;&#1086;&#1082;&#1086;&#1074;
&#1084;&#1086;&#1078;&#1085;&#1086;
&#1087;&#1086;&#1083;&#1091;&#1095;&#1080;&#1090;&#1100;,
&#1080;&#1089;&#1087;&#1086;&#1083;&#1100;&#1079;&#1091;&#1103;
&#1092;&#1091;&#1085;&#1082;&#1094;&#1080;&#1102; NtQuerySystemInformation
&#1089; &#1082;&#1083;&#1072;&#1089;&#1089;&#1086;&#1084;
SystemProcessesAndThreadsInformation.
&#1056;&#1077;&#1079;&#1091;&#1083;&#1100;&#1090;&#1072;&#1090;
&#1088;&#1072;&#1073;&#1086;&#1090;&#1099; &#1101;&#1090;&#1086;&#1081;
&#1092;&#1091;&#1085;&#1082;&#1094;&#1080;&#1080;
&#1086;&#1087;&#1080;&#1089;&#1072;&#1085; &#1074;
&#1088;&#1072;&#1079;&#1076;&#1077;&#1083;&#1077; 4,
&#1085;&#1077;&#1086;&#1073;&#1093;&#1086;&#1076;&#1080;&#1084;&#1086;
&#1083;&#1080;&#1096;&#1100;
&#1076;&#1086;&#1073;&#1072;&#1074;&#1080;&#1090;&#1100;
&#1086;&#1087;&#1080;&#1089;&#1072;&#1085;&#1080;&#1077;
&#1089;&#1090;&#1088;&#1091;&#1082;&#1090;&#1091;&#1088;&#1099; SYSTEM_THREADS,
&#1082;&#1086;&#1090;&#1086;&#1088;&#1072;&#1103;
&#1089;&#1086;&#1076;&#1077;&#1088;&#1078;&#1080;&#1090;
&#1080;&#1085;&#1092;&#1086;&#1088;&#1084;&#1072;&#1094;&#1080;&#1102; &#1086;
&#1087;&#1086;&#1090;&#1086;&#1082;&#1077;.
<p><code><!--mstheme--></font>
<pre>        typedef struct _SYSTEM_THREADS {
                LARGE_INTEGER KernelTime;
                LARGE_INTEGER UserTime;
                LARGE_INTEGER CreateTime;
                ULONG WaitTime;
                PVOID StartAddress;
                CLIENT_ID ClientId;
                KPRIORITY Priority;
                KPRIORITY BasePriority;
                ULONG ContextSwitchCount;
                THREAD_STATE State;
                KWAIT_REASON WaitReason;
        } SYSTEM_THREADS, *PSYSTEM_THREADS; </pre>
<!--mstheme--><font face="Arial, Arial, Helvetica"></code>
<p>&#1044;&#1083;&#1103; &#1082;&#1072;&#1078;&#1076;&#1086;&#1075;&#1086;
&#1087;&#1086;&#1090;&#1086;&#1082;&#1072; &#1084;&#1099;
&#1076;&#1086;&#1083;&#1078;&#1085;&#1099;
&#1087;&#1086;&#1083;&#1091;&#1095;&#1080;&#1090;&#1100; &#1077;&#1075;&#1086;
&#1093;&#1101;&#1085;&#1076;&#1083;,
&#1080;&#1089;&#1087;&#1086;&#1083;&#1100;&#1079;&#1091;&#1103; NtOpenThread.
&#1052;&#1099;
&#1080;&#1089;&#1087;&#1086;&#1083;&#1100;&#1079;&#1091;&#1077;&#1084;
&#1076;&#1083;&#1103; &#1101;&#1090;&#1086;&#1075;&#1086; ClientId.
<p><code><!--mstheme--></font>
<pre>        NTSTATUS NtOpenThread(
                OUT PHANDLE ThreadHandle,
                IN ACCESS_MASK DesiredAccess,
                IN POBJECT_ATTRIBUTES ObjectAttributes,
                IN PCLIENT_ID ClientId
        );</pre>
<!--mstheme--><font face="Arial, Arial, Helvetica"></code>
<p>&#1061;&#1101;&#1085;&#1076;&#1083;,
&#1082;&#1086;&#1090;&#1086;&#1088;&#1099;&#1081; &#1085;&#1072;&#1084;
&#1085;&#1091;&#1078;&#1077;&#1085;, &#1073;&#1091;&#1076;&#1077;&#1090;
&#1089;&#1086;&#1093;&#1088;&#1072;&#1085;&#1077;&#1085; &#1074; ThreadHandle.
&#1055;&#1072;&#1088;&#1072;&#1084;&#1077;&#1090;&#1088; DesiredAccess
&#1076;&#1086;&#1083;&#1078;&#1077;&#1085; &#1073;&#1099;&#1090;&#1100;
&#1088;&#1072;&#1074;&#1077;&#1085; THREAD_SUSPEND_RESUME.
<p><code><!--mstheme--></font>
<pre>        #define THREAD_SUSPEND_RESUME 2</pre>
<!--mstheme--><font face="Arial, Arial, Helvetica"></code>
<p>ThreadHandle &#1073;&#1091;&#1076;&#1077;&#1090;
&#1080;&#1089;&#1087;&#1086;&#1083;&#1100;&#1079;&#1086;&#1074;&#1072;&#1085;
&#1087;&#1088;&#1080; &#1074;&#1099;&#1079;&#1086;&#1074;&#1077; NtSuspendThread.
<p><code><!--mstheme--></font>
<pre>        NTSTATUS NtSuspendThread(
                IN HANDLE ThreadHandle,
                OUT PULONG PreviousSuspendCount OPTIONAL
        );</pre>
<!--mstheme--><font face="Arial, Arial, Helvetica"></code>
<p>&#1055;&#1088;&#1080;&#1086;&#1089;&#1090;&#1072;&#1085;&#1086;&#1074;&#1083;&#1077;&#1085;&#1085;&#1099;&#1081;
&#1087;&#1088;&#1086;&#1094;&#1077;&#1089;&#1089;
&#1075;&#1086;&#1090;&#1086;&#1074; &#1082;
&#1087;&#1077;&#1088;&#1077;&#1079;&#1072;&#1087;&#1080;&#1089;&#1080;.
&#1052;&#1099; &#1087;&#1086;&#1089;&#1090;&#1091;&#1087;&#1080;&#1084;,
&#1082;&#1072;&#1082; &#1086;&#1087;&#1080;&#1089;&#1072;&#1085;&#1086; &#1074;
&#1088;&#1072;&#1079;&#1076;&#1077;&#1083;&#1077; 3.2.2
&#1089;&#1090;&#1072;&#1090;&#1100;&#1080; &quot;Hooking Windows API&quot;.
&#1045;&#1076;&#1080;&#1085;&#1089;&#1090;&#1074;&#1077;&#1085;&#1085;&#1072;&#1103;
&#1088;&#1072;&#1079;&#1085;&#1080;&#1094;&#1072; &#1074; &#1090;&#1086;&#1084;,
&#1095;&#1090;&#1086; &#1092;&#1091;&#1085;&#1082;&#1094;&#1080;&#1080;
&#1073;&#1091;&#1076;&#1091;&#1090;
&#1080;&#1089;&#1087;&#1086;&#1083;&#1100;&#1079;&#1086;&#1074;&#1072;&#1090;&#1100;&#1089;&#1103;
&#1076;&#1083;&#1103; &#1076;&#1088;&#1091;&#1075;&#1080;&#1093;
&#1087;&#1088;&#1086;&#1094;&#1077;&#1089;&#1089;&#1086;&#1074;.
<p>&#1055;&#1086;&#1089;&#1083;&#1077;
&#1087;&#1077;&#1088;&#1077;&#1093;&#1074;&#1072;&#1090;&#1072; &#1084;&#1099;
&#1074;&#1086;&#1079;&#1086;&#1073;&#1085;&#1086;&#1074;&#1080;&#1084;
&#1088;&#1072;&#1073;&#1086;&#1090;&#1091; &#1074;&#1089;&#1077;&#1093;
&#1087;&#1086;&#1090;&#1086;&#1082;&#1086;&#1074;
&#1087;&#1088;&#1086;&#1094;&#1077;&#1089;&#1089;&#1072;,
&#1080;&#1089;&#1087;&#1086;&#1083;&#1100;&#1079;&#1091;&#1103; NtResumeThread.
<p><code><!--mstheme--></font>
<pre>        NTSTATUS NtResumeThread(
                IN HANDLE ThreadHandle,
                OUT PULONG PreviousSuspendCount OPTIONAL
        );</pre>
<!--mstheme--><font face="Arial, Arial, Helvetica"></code><a name="7_3"></a>
<p align="center">=====[ 7.3 &#1053;&#1086;&#1074;&#1099;&#1077;
&#1087;&#1088;&#1086;&#1094;&#1077;&#1089;&#1089;&#1099; ]=====</p>
<p>&#1047;&#1072;&#1088;&#1072;&#1078;&#1077;&#1085;&#1080;&#1077;
&#1074;&#1089;&#1077;&#1093;
&#1079;&#1072;&#1087;&#1091;&#1097;&#1077;&#1085;&#1085;&#1099;&#1093;
&#1087;&#1088;&#1086;&#1094;&#1077;&#1089;&#1089;&#1086;&#1074; &#1085;&#1077;
&#1079;&#1072;&#1090;&#1088;&#1086;&#1085;&#1077;&#1090;
&#1087;&#1088;&#1086;&#1094;&#1077;&#1089;&#1089;&#1099;,
&#1082;&#1086;&#1090;&#1086;&#1088;&#1099;&#1077;
&#1073;&#1091;&#1076;&#1091;&#1090;
&#1079;&#1072;&#1087;&#1091;&#1097;&#1077;&#1085;&#1099;
&#1087;&#1086;&#1079;&#1078;&#1077;. &#1052;&#1099;
&#1076;&#1086;&#1083;&#1078;&#1085;&#1099;
&#1087;&#1086;&#1083;&#1091;&#1095;&#1080;&#1090;&#1100;
&#1089;&#1087;&#1080;&#1089;&#1086;&#1082;
&#1087;&#1088;&#1086;&#1094;&#1077;&#1089;&#1089;&#1086;&#1074;,
&#1095;&#1077;&#1088;&#1077;&#1079;
&#1085;&#1077;&#1082;&#1086;&#1090;&#1086;&#1088;&#1086;&#1077;
&#1074;&#1088;&#1077;&#1084;&#1103;
&#1087;&#1086;&#1083;&#1091;&#1095;&#1080;&#1090;&#1100;
&#1085;&#1086;&#1074;&#1099;&#1081;,
&#1089;&#1088;&#1072;&#1074;&#1085;&#1080;&#1090;&#1100; &#1080;&#1093;, &#1072;
&#1079;&#1072;&#1090;&#1077;&#1084;
&#1079;&#1072;&#1088;&#1072;&#1079;&#1080;&#1090;&#1100; &#1090;&#1077;
&#1087;&#1088;&#1086;&#1094;&#1077;&#1089;&#1089;&#1099;,
&#1082;&#1086;&#1090;&#1086;&#1088;&#1099;&#1077; &#1077;&#1089;&#1090;&#1100;
&#1074;&#1086; &#1074;&#1090;&#1086;&#1088;&#1086;&#1084;
&#1089;&#1087;&#1080;&#1089;&#1082;&#1077; &#1080;
&#1086;&#1090;&#1089;&#1091;&#1090;&#1089;&#1090;&#1074;&#1091;&#1102;&#1090;
&#1074; &#1087;&#1077;&#1088;&#1074;&#1086;&#1084;. &#1053;&#1086;
&#1101;&#1090;&#1086;&#1090; &#1084;&#1077;&#1090;&#1086;&#1076;
&#1086;&#1095;&#1077;&#1085;&#1100;
&#1085;&#1077;&#1085;&#1072;&#1076;&#1077;&#1078;&#1077;&#1085;.
<p>&#1053;&#1072;&#1084;&#1085;&#1086;&#1075;&#1086;
&#1083;&#1091;&#1095;&#1096;&#1077;
&#1087;&#1077;&#1088;&#1077;&#1093;&#1074;&#1072;&#1090;&#1080;&#1090;&#1100;
&#1092;&#1091;&#1085;&#1082;&#1094;&#1080;&#1102;,
&#1082;&#1086;&#1090;&#1086;&#1088;&#1072;&#1103;
&#1074;&#1099;&#1079;&#1099;&#1074;&#1072;&#1077;&#1090;&#1089;&#1103;,
&#1082;&#1086;&#1075;&#1076;&#1072;
&#1089;&#1090;&#1072;&#1088;&#1090;&#1091;&#1077;&#1090;
&#1085;&#1086;&#1074;&#1099;&#1081;
&#1087;&#1088;&#1086;&#1094;&#1077;&#1089;&#1089;. &#1058;&#1072;&#1082;
&#1082;&#1072;&#1082; &#1074;&#1089;&#1077;
&#1079;&#1072;&#1087;&#1091;&#1097;&#1077;&#1085;&#1085;&#1099;&#1077; &#1074;
&#1089;&#1080;&#1089;&#1090;&#1077;&#1084;&#1077;
&#1087;&#1088;&#1086;&#1094;&#1077;&#1089;&#1089;&#1099;
&#1079;&#1072;&#1088;&#1072;&#1078;&#1077;&#1085;&#1099;, &#1084;&#1099;
&#1085;&#1077; &#1089;&#1084;&#1086;&#1078;&#1077;&#1084;
&#1087;&#1088;&#1086;&#1087;&#1091;&#1089;&#1090;&#1080;&#1090;&#1100;
&#1085;&#1080; &#1086;&#1076;&#1080;&#1085; &#1085;&#1086;&#1074;&#1099;&#1081;
&#1087;&#1088;&#1086;&#1094;&#1077;&#1089;&#1089;,
&#1080;&#1089;&#1087;&#1086;&#1083;&#1100;&#1079;&#1091;&#1103;
&#1076;&#1072;&#1085;&#1085;&#1099;&#1081; &#1084;&#1077;&#1090;&#1086;&#1076;.
&#1052;&#1099; &#1084;&#1086;&#1078;&#1077;&#1084;
&#1087;&#1077;&#1088;&#1077;&#1093;&#1074;&#1072;&#1090;&#1080;&#1090;&#1100;
NtCreateThread, &#1085;&#1086; &#1101;&#1090;&#1086; &#1085;&#1077;
&#1089;&#1072;&#1084;&#1099;&#1081;
&#1087;&#1088;&#1086;&#1089;&#1090;&#1086;&#1081; &#1087;&#1091;&#1090;&#1100;.
&#1052;&#1099; &#1073;&#1091;&#1076;&#1077;&#1084;
&#1087;&#1077;&#1088;&#1077;&#1093;&#1074;&#1072;&#1090;&#1099;&#1074;&#1072;&#1090;&#1100;
&#1092;&#1091;&#1085;&#1082;&#1094;&#1080;&#1102; NtResumeThread,
&#1082;&#1086;&#1090;&#1086;&#1088;&#1072;&#1103;
&#1090;&#1072;&#1082;&#1078;&#1077; &#1074;&#1089;&#1077;&#1075;&#1076;&#1072;
&#1074;&#1099;&#1079;&#1099;&#1074;&#1072;&#1077;&#1090;&#1089;&#1103;
&#1087;&#1088;&#1080; &#1089;&#1090;&#1072;&#1088;&#1090;&#1077;
&#1085;&#1086;&#1074;&#1086;&#1075;&#1086;
&#1087;&#1088;&#1086;&#1094;&#1077;&#1089;&#1089;&#1072;. &#1054;&#1085;&#1072;
&#1074;&#1099;&#1079;&#1074;&#1072;&#1077;&#1090;&#1089;&#1103;
&#1087;&#1086;&#1089;&#1083;&#1077; NtCreateThread.
<p>&#1045;&#1076;&#1080;&#1085;&#1089;&#1090;&#1074;&#1077;&#1085;&#1085;&#1072;&#1103;
&#1087;&#1088;&#1086;&#1073;&#1083;&#1077;&#1084;&#1072; &#1089; NtResumeThread
&#1089;&#1086;&#1089;&#1090;&#1086;&#1080;&#1090; &#1074; &#1090;&#1086;&#1084;,
&#1095;&#1090;&#1086; &#1086;&#1085;&#1072;
&#1074;&#1099;&#1079;&#1099;&#1074;&#1072;&#1077;&#1090;&#1089;&#1103;
&#1085;&#1077; &#1090;&#1086;&#1083;&#1100;&#1082;&#1086; &#1087;&#1088;&#1080;
&#1079;&#1072;&#1087;&#1091;&#1089;&#1082;&#1077;
&#1085;&#1086;&#1074;&#1086;&#1075;&#1086;
&#1087;&#1088;&#1086;&#1094;&#1077;&#1089;&#1089;&#1072;. &#1053;&#1086;
&#1084;&#1099; &#1083;&#1077;&#1075;&#1082;&#1086;
&#1088;&#1077;&#1096;&#1080;&#1084; &#1101;&#1090;&#1091;
&#1087;&#1088;&#1086;&#1073;&#1083;&#1077;&#1084;&#1091;.
NtQueryInformationThread
&#1087;&#1088;&#1077;&#1076;&#1086;&#1089;&#1090;&#1072;&#1074;&#1080;&#1090;
&#1085;&#1072;&#1084;
&#1080;&#1085;&#1092;&#1086;&#1088;&#1084;&#1072;&#1094;&#1080;&#1102; &#1086;
&#1090;&#1086;&#1084;, &#1082;&#1072;&#1082;&#1086;&#1081;
&#1087;&#1088;&#1086;&#1094;&#1077;&#1089;&#1089;
&#1074;&#1083;&#1072;&#1076;&#1077;&#1077;&#1090;
&#1076;&#1072;&#1085;&#1085;&#1099;&#1084;
&#1087;&#1086;&#1090;&#1086;&#1082;&#1086;&#1084;. &#1052;&#1099;
&#1076;&#1086;&#1083;&#1078;&#1085;&#1099;
&#1087;&#1088;&#1086;&#1089;&#1090;&#1086;
&#1087;&#1088;&#1086;&#1074;&#1077;&#1088;&#1080;&#1090;&#1100;,
&#1079;&#1072;&#1088;&#1072;&#1078;&#1077;&#1085; &#1083;&#1080;
&#1101;&#1090;&#1086;&#1090; &#1087;&#1088;&#1086;&#1094;&#1077;&#1089;&#1089;.
&#1069;&#1090;&#1086; &#1084;&#1086;&#1078;&#1085;&#1086;
&#1086;&#1087;&#1088;&#1077;&#1076;&#1077;&#1083;&#1080;&#1090;&#1100;
&#1087;&#1088;&#1086;&#1095;&#1080;&#1090;&#1072;&#1074;
&#1087;&#1077;&#1088;&#1074;&#1099;&#1077; &#1073;&#1072;&#1081;&#1090;&#1099;
&#1083;&#1102;&#1073;&#1086;&#1081; &#1080;&#1079;
&#1092;&#1091;&#1085;&#1082;&#1094;&#1080;&#1081;,
&#1082;&#1086;&#1090;&#1086;&#1088;&#1099;&#1077; &#1084;&#1099;
&#1087;&#1077;&#1088;&#1077;&#1093;&#1074;&#1072;&#1090;&#1099;&#1074;&#1072;&#1077;&#1084;.
<p><code><!--mstheme--></font>
<pre>        NTSTATUS NtQueryInformationThread(
                IN HANDLE ThreadHandle,
                IN THREADINFOCLASS ThreadInformationClass,
                OUT PVOID ThreadInformation,
                IN ULONG ThreadInformationLength, 
                OUT PULONG ReturnLength OPTIONAL
        );</pre>
<!--mstheme--><font face="Arial, Arial, Helvetica"></code>
<p>&#1042; &#1085;&#1072;&#1096;&#1077;&#1084;
&#1089;&#1083;&#1091;&#1095;&#1072;&#1077;
&#1087;&#1072;&#1088;&#1072;&#1084;&#1077;&#1090;&#1088; ThreadInformationClass
&#1076;&#1086;&#1083;&#1078;&#1077;&#1085; &#1073;&#1099;&#1090;&#1100;
&#1088;&#1072;&#1074;&#1077;&#1085; ThreadBasicInformation. ThreadInformation -
&#1101;&#1090;&#1086; &#1073;&#1091;&#1092;&#1077;&#1088; &#1076;&#1083;&#1103;
&#1088;&#1077;&#1079;&#1091;&#1083;&#1100;&#1090;&#1072;&#1090;&#1072;,
&#1088;&#1072;&#1079;&#1084;&#1077;&#1088; &#1101;&#1090;&#1086;&#1075;&#1086;
&#1073;&#1091;&#1092;&#1077;&#1088;&#1072;
&#1091;&#1082;&#1072;&#1079;&#1072;&#1085; &#1074;
&#1087;&#1072;&#1088;&#1072;&#1084;&#1077;&#1090;&#1088;&#1077;
ThreadInformationLength.
<p><code><!--mstheme--></font>
<pre>        #define ThreadBasicInformation 0</pre>
<!--mstheme--><font face="Arial, Arial, Helvetica"></code>
<p>&#1044;&#1083;&#1103; &#1082;&#1083;&#1072;&#1089;&#1089;&#1072;
ThreadBasicInformation
&#1074;&#1086;&#1079;&#1074;&#1088;&#1072;&#1097;&#1072;&#1077;&#1090;&#1089;&#1103;
&#1090;&#1072;&#1082;&#1072;&#1103;
&#1089;&#1090;&#1088;&#1091;&#1082;&#1090;&#1091;&#1088;&#1072;:
<p><code><!--mstheme--></font>
<pre>        typedef struct _THREAD_BASIC_INFORMATION {
                NTSTATUS ExitStatus;
                PNT_TIB TebBaseAddress;
                CLIENT_ID ClientId;
                KAFFINITY AffinityMask;
                KPRIORITY Priority;
                KPRIORITY BasePriority;
        } THREAD_BASIC_INFORMATION, *PTHREAD_BASIC_INFORMATION;</pre>
<!--mstheme--><font face="Arial, Arial, Helvetica"></code>
<p>&#1042; &#1087;&#1072;&#1088;&#1072;&#1084;&#1077;&#1090;&#1088;&#1077;
ClientId &#1085;&#1072;&#1093;&#1086;&#1076;&#1080;&#1090;&#1089;&#1103; PID
&#1087;&#1088;&#1086;&#1094;&#1077;&#1089;&#1089;&#1072;,
&#1074;&#1083;&#1072;&#1076;&#1077;&#1102;&#1097;&#1077;&#1075;&#1086;
&#1101;&#1090;&#1080;&#1084; &#1087;&#1086;&#1090;&#1086;&#1082;&#1086;&#1084;.
<p>&#1058;&#1077;&#1087;&#1077;&#1088;&#1100; &#1084;&#1099;
&#1076;&#1086;&#1083;&#1078;&#1085;&#1099;
&#1079;&#1072;&#1088;&#1072;&#1079;&#1080;&#1090;&#1100;
&#1085;&#1086;&#1074;&#1099;&#1081;
&#1087;&#1088;&#1086;&#1094;&#1077;&#1089;&#1089;.
&#1055;&#1088;&#1086;&#1073;&#1083;&#1077;&#1084;&#1072; &#1074;
&#1090;&#1086;&#1084;, &#1095;&#1090;&#1086;
&#1087;&#1088;&#1086;&#1094;&#1077;&#1089;&#1089;
&#1080;&#1084;&#1077;&#1077;&#1090; &#1074; &#1089;&#1074;&#1086;&#1077;&#1081;
&#1087;&#1072;&#1084;&#1103;&#1090;&#1080;
&#1090;&#1086;&#1083;&#1100;&#1082;&#1086; ntdll.dll. &#1042;&#1089;&#1077;
&#1086;&#1089;&#1090;&#1072;&#1083;&#1100;&#1085;&#1099;&#1077;
&#1084;&#1086;&#1076;&#1091;&#1083;&#1080;
&#1079;&#1072;&#1075;&#1088;&#1091;&#1078;&#1072;&#1102;&#1090;&#1089;&#1103;
&#1089;&#1088;&#1072;&#1079;&#1091; &#1087;&#1086;&#1089;&#1083;&#1077;
&#1074;&#1099;&#1079;&#1086;&#1074;&#1072; NtResumeThread.
&#1057;&#1091;&#1097;&#1077;&#1089;&#1090;&#1074;&#1091;&#1077;&#1090;
&#1085;&#1077;&#1089;&#1082;&#1086;&#1083;&#1100;&#1082;&#1086;
&#1087;&#1091;&#1090;&#1077;&#1081;
&#1088;&#1077;&#1096;&#1077;&#1085;&#1080;&#1103; &#1101;&#1090;&#1086;&#1081;
&#1087;&#1088;&#1086;&#1073;&#1083;&#1077;&#1084;&#1099;.
&#1053;&#1072;&#1087;&#1088;&#1080;&#1084;&#1077;&#1088;,
&#1084;&#1086;&#1078;&#1085;&#1086;
&#1087;&#1077;&#1088;&#1077;&#1093;&#1074;&#1072;&#1090;&#1080;&#1090;&#1100;
&#1092;&#1091;&#1085;&#1082;&#1094;&#1080;&#1102; LdrInitializeThunk,
&#1082;&#1086;&#1090;&#1086;&#1088;&#1072;&#1103;
&#1074;&#1099;&#1079;&#1099;&#1074;&#1072;&#1077;&#1090;&#1089;&#1103;
&#1087;&#1088;&#1080;
&#1080;&#1085;&#1080;&#1094;&#1080;&#1072;&#1083;&#1080;&#1079;&#1072;&#1094;&#1080;&#1080;
&#1087;&#1088;&#1086;&#1094;&#1077;&#1089;&#1089;&#1072;.
<p><code><!--mstheme--></font>
<pre>        NTSTATUS LdrInitializeThunk(
                DWORD Unknown1,
                DWORD Unknown2,
                DWORD Unknown3
        );</pre>
<!--mstheme--><font face="Arial, Arial, Helvetica"></code>
<p>&#1057;&#1085;&#1072;&#1095;&#1072;&#1083;&#1072;
&#1085;&#1091;&#1078;&#1085;&#1086;
&#1074;&#1099;&#1087;&#1086;&#1083;&#1085;&#1080;&#1090;&#1100;
&#1086;&#1088;&#1080;&#1075;&#1080;&#1085;&#1072;&#1083;&#1100;&#1085;&#1099;&#1081;
&#1082;&#1086;&#1076;, &#1072; &#1079;&#1072;&#1084;&#1077;&#1090;
&#1087;&#1077;&#1088;&#1077;&#1093;&#1074;&#1072;&#1090;&#1080;&#1090;&#1100;
&#1074;&#1089;&#1077; &#1085;&#1091;&#1078;&#1085;&#1099;&#1077;
&#1092;&#1091;&#1085;&#1082;&#1094;&#1080;&#1080; &#1074;
&#1085;&#1086;&#1074;&#1086;&#1084;
&#1087;&#1088;&#1086;&#1094;&#1077;&#1089;&#1089;&#1077;.
&#1047;&#1072;&#1090;&#1077;&#1084; &#1083;&#1091;&#1095;&#1096;&#1077;
&#1089;&#1085;&#1103;&#1090;&#1100;
&#1087;&#1077;&#1088;&#1077;&#1093;&#1074;&#1072;&#1090; LdrInitializeThunk,
&#1090;&#1072;&#1082; &#1082;&#1072;&#1082; &#1086;&#1085;&#1072;
&#1073;&#1091;&#1076;&#1077;&#1090;
&#1074;&#1099;&#1079;&#1074;&#1072;&#1085;&#1072;
&#1087;&#1086;&#1079;&#1078;&#1077; &#1084;&#1085;&#1086;&#1075;&#1086;
&#1088;&#1072;&#1079;, &#1072; &#1084;&#1099; &#1085;&#1077;
&#1093;&#1074;&#1072;&#1090;&#1080;&#1084;
&#1079;&#1072;&#1085;&#1086;&#1074;&#1086;
&#1087;&#1077;&#1088;&#1077;&#1093;&#1074;&#1072;&#1090;&#1099;&#1074;&#1072;&#1090;&#1100;
&#1074;&#1089;&#1077; &#1092;&#1091;&#1085;&#1082;&#1094;&#1080;&#1080;.
&#1042;&#1089;&#1077; &#1101;&#1090;&#1086; &#1073;&#1091;&#1076;&#1077;&#1090;
&#1089;&#1076;&#1077;&#1083;&#1072;&#1085;&#1086; &#1076;&#1086;
&#1074;&#1099;&#1087;&#1086;&#1083;&#1085;&#1077;&#1085;&#1080;&#1103;
&#1087;&#1077;&#1088;&#1074;&#1099;&#1093;
&#1080;&#1085;&#1089;&#1090;&#1088;&#1091;&#1082;&#1094;&#1080;&#1081;
&#1087;&#1088;&#1086;&#1094;&#1077;&#1089;&#1089;&#1072;,
&#1087;&#1086;&#1101;&#1090;&#1086;&#1084;&#1091; &#1085;&#1077;&#1090;
&#1074;&#1077;&#1088;&#1086;&#1103;&#1090;&#1085;&#1086;&#1089;&#1090;&#1080;
&#1090;&#1086;&#1075;&#1086;, &#1095;&#1090;&#1086; &#1101;&#1090;&#1086;&#1090;
&#1087;&#1088;&#1086;&#1094;&#1077;&#1089;&#1089;
&#1074;&#1099;&#1079;&#1086;&#1074;&#1077;&#1090;
&#1082;&#1072;&#1082;&#1091;&#1102;-&#1085;&#1080;&#1073;&#1091;&#1076;&#1100;
&#1080;&#1079;
&#1087;&#1077;&#1088;&#1077;&#1093;&#1074;&#1072;&#1090;&#1099;&#1074;&#1072;&#1077;&#1084;&#1099;&#1093;
&#1092;&#1091;&#1085;&#1082;&#1094;&#1080;&#1081; &#1076;&#1086;
&#1090;&#1086;&#1075;&#1086;, &#1082;&#1072;&#1082; &#1084;&#1099;
&#1077;&#1077;
&#1087;&#1077;&#1088;&#1077;&#1093;&#1074;&#1072;&#1090;&#1080;&#1084;.
<p>&#1055;&#1077;&#1088;&#1077;&#1093;&#1074;&#1072;&#1090;
&#1092;&#1091;&#1085;&#1082;&#1094;&#1080;&#1081; &#1074;
&#1089;&#1074;&#1086;&#1077;&#1084;
&#1087;&#1088;&#1086;&#1094;&#1077;&#1089;&#1089;&#1077;
&#1090;&#1072;&#1082;&#1086;&#1081; &#1078;&#1077; &#1082;&#1072;&#1082; &#1080;
&#1087;&#1077;&#1088;&#1077;&#1093;&#1074;&#1072;&#1090; &#1074;
&#1079;&#1072;&#1087;&#1091;&#1097;&#1077;&#1085;&#1085;&#1086;&#1084;
&#1087;&#1088;&#1086;&#1094;&#1077;&#1089;&#1089;&#1077;, &#1085;&#1086;
&#1085;&#1072;&#1084; &#1085;&#1077; &#1085;&#1091;&#1078;&#1085;&#1086;
&#1073;&#1077;&#1089;&#1087;&#1086;&#1082;&#1086;&#1080;&#1090;&#1100;&#1089;&#1103;
&#1086; &#1087;&#1086;&#1090;&#1086;&#1082;&#1072;&#1093;. <a name="7_4"></a>
<p align="center">=====[ 7.4 DLL ]=====</p>
<p>&#1042; &#1082;&#1072;&#1078;&#1076;&#1086;&#1084;
&#1087;&#1088;&#1086;&#1094;&#1077;&#1089;&#1089;&#1077; &#1074;
&#1089;&#1080;&#1089;&#1090;&#1077;&#1084;&#1077; &#1077;&#1089;&#1090;&#1100;
&#1082;&#1086;&#1087;&#1080;&#1103; ntdll.dll. &#1069;&#1090;&#1086;
&#1079;&#1085;&#1072;&#1095;&#1080;&#1090;, &#1095;&#1090;&#1086; &#1084;&#1099;
&#1084;&#1086;&#1078;&#1077;&#1084;
&#1087;&#1077;&#1088;&#1077;&#1093;&#1074;&#1072;&#1090;&#1080;&#1090;&#1100;
&#1083;&#1102;&#1073;&#1091;&#1102;
&#1092;&#1091;&#1085;&#1082;&#1094;&#1080;&#1102;
&#1101;&#1090;&#1086;&#1075;&#1086; &#1084;&#1086;&#1076;&#1091;&#1083;&#1103;
&#1087;&#1088;&#1080;
&#1080;&#1085;&#1080;&#1094;&#1080;&#1072;&#1083;&#1080;&#1079;&#1072;&#1094;&#1080;&#1080;
&#1087;&#1088;&#1086;&#1094;&#1077;&#1089;&#1089;&#1072;. &#1053;&#1086;
&#1082;&#1072;&#1082; &#1073;&#1099;&#1090;&#1100; &#1089;
&#1092;&#1091;&#1085;&#1082;&#1094;&#1080;&#1103;&#1084;&#1080; &#1080;&#1079;
&#1076;&#1088;&#1091;&#1075;&#1080;&#1093;
&#1084;&#1086;&#1076;&#1091;&#1083;&#1077;&#1081;,
&#1085;&#1072;&#1087;&#1088;&#1080;&#1084;&#1077;&#1088;, kernel32.dll
&#1080;&#1083;&#1080; advapi32.dll? &#1045;&#1089;&#1090;&#1100;
&#1085;&#1077;&#1089;&#1082;&#1086;&#1083;&#1100;&#1082;&#1086;
&#1087;&#1088;&#1086;&#1094;&#1077;&#1089;&#1089;&#1086;&#1074;, &#1091;
&#1082;&#1086;&#1090;&#1086;&#1088;&#1099;&#1093; &#1077;&#1089;&#1090;&#1100;
&#1090;&#1086;&#1083;&#1100;&#1082;&#1086; ntdll.dll. &#1042;&#1089;&#1077;
&#1086;&#1089;&#1090;&#1072;&#1083;&#1100;&#1085;&#1099;&#1077;
&#1084;&#1086;&#1076;&#1091;&#1083;&#1080; &#1084;&#1086;&#1075;&#1091;&#1090;
&#1073;&#1099;&#1090;&#1100;
&#1079;&#1072;&#1075;&#1088;&#1091;&#1078;&#1077;&#1085;&#1099;
&#1076;&#1080;&#1085;&#1072;&#1084;&#1080;&#1095;&#1077;&#1089;&#1082;&#1080;
&#1074; &#1089;&#1077;&#1088;&#1077;&#1076;&#1080;&#1085;&#1077;
&#1082;&#1086;&#1076;&#1072; &#1087;&#1086;&#1089;&#1083;&#1077;
&#1087;&#1077;&#1088;&#1077;&#1093;&#1074;&#1072;&#1090;&#1072;
&#1087;&#1088;&#1086;&#1094;&#1077;&#1089;&#1089;&#1072;. &#1042;&#1086;&#1090;
&#1087;&#1086;&#1095;&#1077;&#1084;&#1091; &#1084;&#1099;
&#1076;&#1086;&#1083;&#1078;&#1085;&#1099;
&#1087;&#1077;&#1088;&#1077;&#1093;&#1074;&#1072;&#1090;&#1080;&#1090;&#1100;
LdrLoadDll, &#1082;&#1086;&#1090;&#1086;&#1088;&#1072;&#1103;
&#1079;&#1072;&#1075;&#1088;&#1091;&#1078;&#1072;&#1077;&#1090;
&#1085;&#1086;&#1074;&#1099;&#1077; &#1084;&#1086;&#1076;&#1091;&#1083;&#1080;.
<p><code><!--mstheme--></font>
<pre>        NTSTATUS LdrLoadDll( 
                PWSTR szcwPath,
                PDWORD pdwLdrErr,      
                PUNICODE_STRING pUniModuleName,
                PHINSTANCE pResultInstance
        );</pre>
<!--mstheme--><font face="Arial, Arial, Helvetica"></code>
<p>&#1053;&#1072;&#1080;&#1073;&#1086;&#1083;&#1077;&#1077;
&#1074;&#1072;&#1078;&#1085;&#1086; &#1076;&#1083;&#1103; &#1085;&#1072;&#1089;
pUniModuleName - &#1080;&#1084;&#1103;
&#1084;&#1086;&#1076;&#1091;&#1083;&#1103;. pResultInstance
&#1073;&#1091;&#1076;&#1077;&#1090;
&#1072;&#1076;&#1088;&#1077;&#1089;&#1086;&#1084;
&#1084;&#1086;&#1076;&#1091;&#1083;&#1103;, &#1077;&#1089;&#1083;&#1080;
&#1074;&#1099;&#1079;&#1086;&#1074; &#1073;&#1099;&#1083;
&#1091;&#1089;&#1087;&#1077;&#1096;&#1077;&#1085;.
<p>&#1052;&#1099; &#1074;&#1099;&#1079;&#1086;&#1074;&#1077;&#1084;
&#1086;&#1088;&#1080;&#1075;&#1080;&#1085;&#1072;&#1083;&#1100;&#1085;&#1091;&#1102;
LdrLoadDll &#1080; &#1079;&#1072;&#1090;&#1077;&#1084;
&#1087;&#1077;&#1088;&#1077;&#1093;&#1074;&#1072;&#1090;&#1080;&#1084;
&#1074;&#1089;&#1077; &#1092;&#1091;&#1085;&#1082;&#1094;&#1080;&#1080; &#1074;
&#1079;&#1072;&#1075;&#1088;&#1091;&#1078;&#1077;&#1085;&#1085;&#1086;&#1084;
&#1084;&#1086;&#1076;&#1091;&#1083;&#1077;. <a name="8"></a>
<p align="center">=====[ 8. &#1055;&#1072;&#1084;&#1103;&#1090;&#1100; ]=====</p>
<p>&#1050;&#1086;&#1075;&#1076;&#1072; &#1084;&#1099;
&#1087;&#1077;&#1088;&#1077;&#1093;&#1074;&#1072;&#1090;&#1099;&#1074;&#1072;&#1077;&#1084;
&#1092;&#1091;&#1085;&#1082;&#1094;&#1080;&#1102;, &#1084;&#1099;
&#1080;&#1079;&#1084;&#1077;&#1085;&#1103;&#1077;&#1084; &#1077;&#1077;
&#1087;&#1077;&#1088;&#1074;&#1099;&#1077; &#1073;&#1072;&#1081;&#1090;&#1099;.
&#1042;&#1099;&#1079;&#1074;&#1072;&#1074; NtReadVirtualMemory,
&#1082;&#1090;&#1086; &#1091;&#1075;&#1086;&#1076;&#1085;&#1086;
&#1089;&#1084;&#1086;&#1078;&#1077;&#1090;
&#1086;&#1087;&#1088;&#1077;&#1076;&#1077;&#1083;&#1080;&#1090;&#1100;,
&#1095;&#1090;&#1086; &#1092;&#1091;&#1085;&#1082;&#1094;&#1080;&#1103;
&#1087;&#1077;&#1088;&#1077;&#1093;&#1074;&#1072;&#1095;&#1077;&#1085;&#1072;.
&#1055;&#1086;&#1101;&#1090;&#1086;&#1084;&#1091; &#1084;&#1099;
&#1076;&#1086;&#1083;&#1078;&#1085;&#1099;
&#1087;&#1077;&#1088;&#1077;&#1093;&#1074;&#1072;&#1090;&#1080;&#1090;&#1100;
NtReadVirtualMemory, &#1095;&#1090;&#1086;&#1073;&#1099;
&#1080;&#1079;&#1073;&#1077;&#1078;&#1072;&#1090;&#1100;
&#1086;&#1073;&#1085;&#1072;&#1088;&#1091;&#1078;&#1077;&#1085;&#1080;&#1103;.
<p><code><!--mstheme--></font>
<pre>        NTSTATUS NtReadVirtualMemory(
                IN HANDLE ProcessHandle,
                IN PVOID BaseAddress,
                OUT PVOID Buffer,
                IN ULONG BufferLength,
                OUT PULONG ReturnLength OPTIONAL
        );</pre>
<!--mstheme--><font face="Arial, Arial, Helvetica"></code>
<p>&#1052;&#1099; &#1079;&#1072;&#1084;&#1077;&#1085;&#1080;&#1083;&#1080;
&#1073;&#1072;&#1081;&#1090;&#1099; &#1074;
&#1085;&#1072;&#1095;&#1072;&#1083;&#1077; &#1090;&#1077;&#1093;
&#1092;&#1091;&#1085;&#1082;&#1094;&#1080;&#1081;,
&#1082;&#1086;&#1090;&#1086;&#1088;&#1099;&#1077;
&#1087;&#1077;&#1088;&#1077;&#1093;&#1074;&#1072;&#1090;&#1080;&#1083;&#1080;,
&#1080; &#1077;&#1097;&#1077;
&#1074;&#1099;&#1076;&#1077;&#1083;&#1080;&#1083;&#1080;
&#1087;&#1072;&#1084;&#1103;&#1090;&#1100; &#1076;&#1083;&#1103;
&#1085;&#1086;&#1074;&#1086;&#1075;&#1086; &#1082;&#1086;&#1076;&#1072;.
&#1053;&#1077;&#1086;&#1073;&#1093;&#1086;&#1076;&#1080;&#1084;&#1086;
&#1087;&#1088;&#1086;&#1074;&#1077;&#1088;&#1080;&#1090;&#1100;
&#1095;&#1080;&#1090;&#1072;&#1077;&#1090; &#1083;&#1080;
&#1092;&#1091;&#1085;&#1082;&#1094;&#1080;&#1103;
&#1082;&#1072;&#1082;&#1080;&#1077;-&#1083;&#1080;&#1073;&#1086; &#1080;&#1079;
&#1101;&#1090;&#1080;&#1093; &#1073;&#1072;&#1081;&#1090;.
&#1045;&#1089;&#1083;&#1080; &#1085;&#1072;&#1096;&#1080;
&#1073;&#1072;&#1081;&#1090;&#1099;
&#1085;&#1072;&#1093;&#1086;&#1076;&#1103;&#1090;&#1089;&#1103; &#1074;
&#1076;&#1080;&#1072;&#1087;&#1072;&#1079;&#1086;&#1085;&#1077; &#1086;&#1090;
BaseAddress &#1076;&#1086; (BaseAddress + BufferLength), &#1084;&#1099;
&#1076;&#1086;&#1083;&#1078;&#1085;&#1099;
&#1079;&#1072;&#1084;&#1077;&#1085;&#1080;&#1090;&#1100;
&#1085;&#1077;&#1082;&#1086;&#1090;&#1086;&#1088;&#1099;&#1077;
&#1073;&#1072;&#1081;&#1090;&#1099; &#1074; Buffer.
<p>&#1045;&#1089;&#1083;&#1080; &#1082;&#1090;&#1086;-&#1083;&#1080;&#1073;&#1086;
&#1087;&#1099;&#1090;&#1072;&#1077;&#1090;&#1089;&#1103;
&#1087;&#1088;&#1086;&#1095;&#1080;&#1090;&#1072;&#1090;&#1100;
&#1073;&#1072;&#1081;&#1090;&#1099; &#1080;&#1079;
&#1085;&#1072;&#1096;&#1077;&#1081;
&#1074;&#1099;&#1076;&#1077;&#1083;&#1077;&#1085;&#1085;&#1086;&#1081;
&#1087;&#1072;&#1084;&#1103;&#1090;&#1080;,
&#1089;&#1083;&#1077;&#1076;&#1091;&#1077;&#1090;
&#1074;&#1077;&#1088;&#1085;&#1091;&#1090;&#1100;
&#1087;&#1091;&#1089;&#1090;&#1086;&#1081; Buffer &#1080;
&#1086;&#1096;&#1080;&#1073;&#1082;&#1091; STATUS_PARTIAL_COPY.
&#1069;&#1090;&#1086; &#1079;&#1085;&#1072;&#1095;&#1077;&#1085;&#1080;&#1077;
&#1075;&#1086;&#1074;&#1086;&#1088;&#1080;&#1090; &#1086; &#1090;&#1086;&#1084;,
&#1095;&#1090;&#1086; &#1085;&#1077; &#1074;&#1089;&#1077;
&#1079;&#1072;&#1087;&#1088;&#1086;&#1096;&#1077;&#1085;&#1085;&#1099;&#1077;
&#1073;&#1072;&#1081;&#1090;&#1099; &#1073;&#1099;&#1083;&#1080;
&#1089;&#1082;&#1086;&#1087;&#1080;&#1088;&#1086;&#1074;&#1072;&#1085;&#1099;
&#1074; &#1073;&#1091;&#1092;&#1077;&#1088; Buffer. &#1069;&#1090;&#1086;
&#1090;&#1072;&#1082;&#1078;&#1077;
&#1087;&#1088;&#1086;&#1080;&#1089;&#1093;&#1086;&#1076;&#1080;&#1090;
&#1087;&#1088;&#1080; &#1087;&#1086;&#1087;&#1099;&#1090;&#1082;&#1077;
&#1076;&#1086;&#1089;&#1090;&#1091;&#1087;&#1072; &#1082;
&#1085;&#1077;&#1074;&#1099;&#1076;&#1077;&#1083;&#1077;&#1085;&#1085;&#1086;&#1081;
&#1087;&#1072;&#1084;&#1103;&#1090;&#1080;. ReturnLength
&#1076;&#1086;&#1083;&#1078;&#1085;&#1086; &#1073;&#1099;&#1090;&#1100;
&#1091;&#1089;&#1090;&#1072;&#1085;&#1086;&#1074;&#1083;&#1077;&#1085;&#1086;
&#1074; &#1085;&#1091;&#1083;&#1100; &#1074;
&#1076;&#1072;&#1085;&#1085;&#1086;&#1084;
&#1089;&#1083;&#1091;&#1095;&#1072;&#1077;.
<p><code><!--mstheme--></font>
<pre>        #define STATUS_PARTIAL_COPY 0x8000000D</pre>
<!--mstheme--><font face="Arial, Arial, Helvetica"></code>
<p>&#1045;&#1089;&#1083;&#1080; &#1082;&#1090;&#1086;-&#1085;&#1080;&#1073;&#1091;&#1076;&#1100;
&#1079;&#1072;&#1087;&#1088;&#1072;&#1096;&#1080;&#1074;&#1072;&#1077;&#1090;
&#1087;&#1077;&#1088;&#1074;&#1099;&#1077; &#1073;&#1072;&#1081;&#1090;&#1099;
&#1087;&#1077;&#1088;&#1077;&#1093;&#1074;&#1072;&#1095;&#1077;&#1085;&#1085;&#1086;&#1081;
&#1085;&#1072;&#1084;&#1080; &#1092;&#1091;&#1085;&#1082;&#1094;&#1080;&#1080;,
&#1084;&#1099; &#1076;&#1086;&#1083;&#1078;&#1085;&#1099;
&#1074;&#1099;&#1079;&#1074;&#1072;&#1090;&#1100;
&#1086;&#1088;&#1080;&#1075;&#1080;&#1085;&#1072;&#1083;&#1100;&#1085;&#1099;&#1081;
&#1082;&#1086;&#1076;, &#1072; &#1079;&#1072;&#1090;&#1077;&#1084;
&#1089;&#1082;&#1086;&#1087;&#1080;&#1088;&#1086;&#1074;&#1072;&#1090;&#1100;
&#1086;&#1088;&#1080;&#1075;&#1080;&#1085;&#1072;&#1083;&#1100;&#1085;&#1099;&#1077;
&#1073;&#1072;&#1081;&#1090;&#1099; (&#1084;&#1099; &#1080;&#1093;
&#1089;&#1086;&#1093;&#1088;&#1072;&#1085;&#1080;&#1083;&#1080;) &#1074;
&#1073;&#1091;&#1092;&#1077;&#1088; Buffer.
<p>&#1058;&#1077;&#1087;&#1077;&#1088;&#1100;
&#1087;&#1088;&#1086;&#1094;&#1077;&#1089;&#1089; &#1085;&#1077;
&#1089;&#1084;&#1086;&#1078;&#1077;&#1090;
&#1086;&#1087;&#1088;&#1077;&#1076;&#1077;&#1083;&#1080;&#1090;&#1100;,
&#1095;&#1090;&#1086; &#1092;&#1091;&#1085;&#1082;&#1094;&#1080;&#1080;
&#1087;&#1077;&#1088;&#1077;&#1093;&#1074;&#1072;&#1095;&#1077;&#1085;&#1099;,
&#1095;&#1090;&#1077;&#1085;&#1080;&#1077;&#1084;
&#1087;&#1072;&#1084;&#1103;&#1090;&#1080;. &#1058;&#1072;&#1082;&#1078;&#1077;,
&#1077;&#1089;&#1083;&#1080; &#1074;&#1099;
&#1086;&#1090;&#1083;&#1072;&#1078;&#1080;&#1074;&#1072;&#1077;&#1090;&#1077;
&#1087;&#1077;&#1088;&#1077;&#1093;&#1074;&#1072;&#1090;&#1099;&#1074;&#1072;&#1095;&#1077;&#1085;&#1085;&#1099;&#1077;
&#1092;&#1091;&#1085;&#1082;&#1094;&#1080;&#1080;, &#1091;
&#1086;&#1090;&#1083;&#1072;&#1076;&#1095;&#1080;&#1082;&#1072;
&#1073;&#1091;&#1076;&#1091;&#1090;
&#1087;&#1088;&#1086;&#1073;&#1083;&#1077;&#1084;&#1099;. &#1054;&#1085;
&#1073;&#1091;&#1076;&#1077;&#1090;
&#1087;&#1086;&#1082;&#1072;&#1079;&#1099;&#1074;&#1072;&#1090;&#1100;
&#1086;&#1088;&#1080;&#1075;&#1080;&#1085;&#1072;&#1083;&#1100;&#1085;&#1099;&#1077;
&#1073;&#1072;&#1081;&#1090;&#1099;, &#1085;&#1086;
&#1074;&#1099;&#1087;&#1086;&#1083;&#1085;&#1103;&#1090;&#1100;
&#1085;&#1072;&#1096; &#1082;&#1086;&#1076;.
<p>&#1063;&#1090;&#1086;&#1073;&#1099;
&#1089;&#1076;&#1077;&#1083;&#1072;&#1090;&#1100;
&#1089;&#1082;&#1088;&#1099;&#1090;&#1080;&#1077;
&#1089;&#1086;&#1074;&#1077;&#1088;&#1096;&#1077;&#1085;&#1085;&#1099;&#1084;,
&#1084;&#1099; &#1077;&#1097;&#1077; &#1076;&#1086;&#1083;&#1078;&#1085;&#1099;
&#1087;&#1077;&#1088;&#1077;&#1093;&#1074;&#1072;&#1090;&#1080;&#1090;&#1100;
&#1092;&#1091;&#1085;&#1082;&#1094;&#1080;&#1102; NtQueryVirtualMemory,
&#1082;&#1086;&#1090;&#1086;&#1088;&#1072;&#1103;
&#1080;&#1089;&#1087;&#1086;&#1083;&#1100;&#1079;&#1091;&#1077;&#1090;&#1089;&#1103;
&#1076;&#1083;&#1103;
&#1087;&#1086;&#1083;&#1091;&#1095;&#1077;&#1085;&#1080;&#1103;
&#1080;&#1085;&#1092;&#1086;&#1088;&#1084;&#1072;&#1094;&#1080;&#1080; &#1086;
&#1074;&#1080;&#1088;&#1090;&#1091;&#1072;&#1083;&#1100;&#1085;&#1086;&#1081;
&#1087;&#1072;&#1084;&#1103;&#1090;&#1080;. &#1052;&#1099;
&#1084;&#1086;&#1078;&#1077;&#1084;
&#1087;&#1077;&#1088;&#1077;&#1093;&#1074;&#1072;&#1090;&#1080;&#1090;&#1100;
&#1077;&#1077;, &#1095;&#1090;&#1086;&#1073;&#1099;
&#1087;&#1088;&#1077;&#1076;&#1086;&#1090;&#1074;&#1088;&#1072;&#1090;&#1080;&#1090;&#1100;
&#1086;&#1073;&#1085;&#1072;&#1088;&#1091;&#1078;&#1077;&#1085;&#1080;&#1077;
&#1074;&#1099;&#1076;&#1077;&#1083;&#1077;&#1085;&#1085;&#1086;&#1081;
&#1085;&#1072;&#1084;&#1080; &#1087;&#1072;&#1084;&#1103;&#1090;&#1080;.
<p><code><!--mstheme--></font>
<pre>        NTSTATUS NtQueryVirtualMemory(
                IN HANDLE ProcessHandle,
                IN PVOID BaseAddress,
                IN MEMORY_INFORMATION_CLASS MemoryInformationClass,
                OUT PVOID MemoryInformation,
                IN ULONG MemoryInformationLength,
                OUT PULONG ReturnLength OPTIONAL
        );</pre>
<!--mstheme--><font face="Arial, Arial, Helvetica"></code>
<p>MemoryInformationClass
&#1086;&#1087;&#1088;&#1077;&#1076;&#1077;&#1083;&#1103;&#1077;&#1090;
&#1090;&#1080;&#1087;
&#1074;&#1086;&#1079;&#1074;&#1088;&#1072;&#1097;&#1072;&#1077;&#1084;&#1099;&#1093;
&#1076;&#1072;&#1085;&#1085;&#1099;&#1093;. &#1053;&#1072;&#1089;
&#1080;&#1085;&#1090;&#1077;&#1088;&#1077;&#1089;&#1091;&#1102;&#1090;
&#1087;&#1077;&#1088;&#1074;&#1099;&#1077; &#1076;&#1074;&#1072;
&#1090;&#1080;&#1087;&#1072;.
<p><code><!--mstheme--></font>
<pre>        #define MemoryBasicInformation 0
        #define MemoryWorkingSetList 1</pre>
<!--mstheme--><font face="Arial, Arial, Helvetica"></code>
<p>&#1044;&#1083;&#1103; MemoryBasicInformation
&#1074;&#1086;&#1079;&#1074;&#1088;&#1072;&#1097;&#1072;&#1077;&#1090;&#1089;&#1103;
&#1089;&#1090;&#1088;&#1091;&#1082;&#1090;&#1091;&#1088;&#1072;:
<p><code><!--mstheme--></font>
<pre>        typedef struct _MEMORY_BASIC_INFORMATION {
                PVOID BaseAddress;
                PVOID AllocationBase;
                ULONG AllocationProtect;
                ULONG RegionSize;
                ULONG State;
                ULONG Protect;
                ULONG Type;
        } MEMORY_BASIC_INFORMATION, *PMEMORY_BASIC_INFORMATION;</pre>
<!--mstheme--><font face="Arial, Arial, Helvetica"></code>
<p>&#1050;&#1072;&#1078;&#1076;&#1072;&#1103;
&#1089;&#1077;&#1082;&#1094;&#1080;&#1103;
&#1087;&#1072;&#1084;&#1103;&#1090;&#1080; &#1080;&#1084;&#1077;&#1077;&#1090;
&#1088;&#1072;&#1079;&#1084;&#1077;&#1088; - RegionSize &#1080;
&#1090;&#1080;&#1087; - Type.
&#1057;&#1074;&#1086;&#1073;&#1086;&#1076;&#1085;&#1072;&#1103;
&#1087;&#1072;&#1084;&#1103;&#1090;&#1100; &#1080;&#1084;&#1077;&#1077;&#1090;
&#1090;&#1080;&#1087; MEM_FREE.
<p><code><!--mstheme--></font>
<pre>        #define MEM_FREE 0x10000</pre>
<!--mstheme--><font face="Arial, Arial, Helvetica"></code>
<p>&#1045;&#1089;&#1083;&#1080; &#1089;&#1077;&#1082;&#1094;&#1080;&#1103;
&#1087;&#1077;&#1088;&#1077;&#1076; &#1085;&#1072;&#1096;&#1077;&#1081;
&#1080;&#1084;&#1077;&#1077;&#1090; &#1090;&#1080;&#1087; MEM_FREE,
&#1089;&#1083;&#1077;&#1076;&#1091;&#1077;&#1090;
&#1087;&#1088;&#1080;&#1073;&#1072;&#1074;&#1080;&#1090;&#1100;
&#1088;&#1072;&#1079;&#1084;&#1077;&#1088; &#1085;&#1072;&#1096;&#1077;&#1081;
&#1089;&#1077;&#1082;&#1094;&#1080;&#1080; &#1082; &#1077;&#1077; RegionSize.
&#1045;&#1089;&#1083;&#1080;
&#1089;&#1083;&#1077;&#1076;&#1091;&#1102;&#1097;&#1072;&#1103;
&#1089;&#1077;&#1082;&#1094;&#1080;&#1103; &#1090;&#1072;&#1082;&#1078;&#1077;
&#1080;&#1084;&#1077;&#1077;&#1090; &#1090;&#1080;&#1087; MEM_FREE,
&#1089;&#1083;&#1077;&#1076;&#1091;&#1077;&#1090;
&#1087;&#1088;&#1080;&#1073;&#1072;&#1074;&#1080;&#1090;&#1100;
&#1088;&#1072;&#1079;&#1084;&#1077;&#1088;
&#1089;&#1083;&#1077;&#1076;&#1091;&#1102;&#1097;&#1077;&#1081;
&#1089;&#1077;&#1082;&#1094;&#1080;&#1080; &#1082; RegionSize.
<p>&#1045;&#1089;&#1083;&#1080; &#1089;&#1077;&#1082;&#1094;&#1080;&#1103;
&#1087;&#1077;&#1088;&#1077;&#1076; &#1085;&#1072;&#1096;&#1077;&#1081;
&#1080;&#1084;&#1077;&#1077;&#1090; &#1076;&#1088;&#1091;&#1075;&#1086;&#1081;
&#1090;&#1080;&#1087;, &#1084;&#1099; &#1074;&#1077;&#1088;&#1085;&#1077;&#1084;
MEM_FREE &#1076;&#1083;&#1103; &#1085;&#1072;&#1096;&#1077;&#1081;
&#1089;&#1077;&#1082;&#1094;&#1080;&#1080;. &#1045;&#1077;
&#1088;&#1072;&#1079;&#1084;&#1077;&#1088;
&#1076;&#1086;&#1083;&#1078;&#1077;&#1085; &#1073;&#1099;&#1090;&#1100;
&#1074;&#1099;&#1095;&#1080;&#1089;&#1083;&#1077;&#1085;,
&#1091;&#1095;&#1080;&#1090;&#1099;&#1074;&#1072;&#1103;
&#1090;&#1072;&#1082;&#1078;&#1077;
&#1089;&#1083;&#1077;&#1076;&#1091;&#1102;&#1097;&#1091;&#1102;
&#1089;&#1077;&#1082;&#1094;&#1080;&#1102;.
<p>&#1044;&#1083;&#1103; MemoryWorkingSetList
&#1074;&#1086;&#1079;&#1074;&#1088;&#1072;&#1097;&#1072;&#1077;&#1090;&#1089;&#1103;
&#1089;&#1090;&#1088;&#1091;&#1082;&#1090;&#1091;&#1088;&#1072;:
<p><code><!--mstheme--></font>
<pre>        typedef struct _MEMORY_WORKING_SET_LIST { 
                ULONG NumberOfPages;
                ULONG WorkingSetList[1];
        } MEMORY_WORKING_SET_LIST, *PMEMORY_WORKING_SET_LIST;</pre>
<!--mstheme--><font face="Arial, Arial, Helvetica"></code>
<p>NumberOfPages -
&#1082;&#1086;&#1083;&#1080;&#1095;&#1077;&#1089;&#1090;&#1074;&#1086;
&#1101;&#1083;&#1077;&#1084;&#1077;&#1085;&#1090;&#1086;&#1074; &#1074;
WorkingSetList. &#1069;&#1090;&#1086; &#1095;&#1080;&#1089;&#1083;&#1086;
&#1076;&#1086;&#1083;&#1078;&#1085;&#1086; &#1073;&#1099;&#1090;&#1100;
&#1091;&#1084;&#1077;&#1085;&#1100;&#1096;&#1077;&#1085;&#1086;. &#1052;&#1099;
&#1076;&#1086;&#1083;&#1078;&#1085;&#1099; &#1085;&#1072;&#1081;&#1090;&#1080;
&#1085;&#1072;&#1096;&#1091; &#1089;&#1077;&#1082;&#1094;&#1080;&#1102; &#1074;
WorkingSetList &#1080;
&#1087;&#1077;&#1088;&#1077;&#1076;&#1074;&#1080;&#1085;&#1091;&#1090;&#1100;
&#1089;&#1083;&#1077;&#1076;&#1091;&#1102;&#1097;&#1080;&#1077;
&#1079;&#1072;&#1087;&#1080;&#1089;&#1080; &#1085;&#1072; &#1085;&#1077;&#1077;.
WorkingSetList - &#1084;&#1072;&#1089;&#1089;&#1080;&#1074; DWORD'&#1086;&#1074;,
&#1075;&#1076;&#1077; &#1089;&#1090;&#1072;&#1088;&#1096;&#1080;&#1077; 20
&#1073;&#1080;&#1090; - &#1101;&#1090;&#1086;
&#1089;&#1090;&#1072;&#1088;&#1096;&#1080;&#1077; 20 &#1073;&#1080;&#1090;
&#1072;&#1076;&#1088;&#1077;&#1089;&#1072;
&#1089;&#1077;&#1082;&#1094;&#1080;&#1080;, &#1072;
&#1084;&#1083;&#1072;&#1076;&#1096;&#1080;&#1077; 12 &#1073;&#1080;&#1090;
&#1089;&#1086;&#1076;&#1077;&#1088;&#1078;&#1072;&#1090;
&#1092;&#1083;&#1072;&#1075;&#1080;. <a name="9"></a>
<p align="center">=====[ 9. &#1061;&#1101;&#1085;&#1076;&#1083;&#1099; ]=====</p>
<p>&#1042;&#1099;&#1079;&#1086;&#1074; NtQuerySystemInformation &#1089;
&#1082;&#1083;&#1072;&#1089;&#1089;&#1086;&#1084; SystemHandleInformation
&#1076;&#1072;&#1077;&#1090; &#1085;&#1072;&#1084;
&#1084;&#1072;&#1089;&#1089;&#1080;&#1074; &#1074;&#1089;&#1077;&#1093;
&#1086;&#1090;&#1082;&#1088;&#1099;&#1090;&#1099;&#1093;
&#1093;&#1101;&#1085;&#1076;&#1083;&#1086;&#1074; &#1074;
&#1089;&#1090;&#1088;&#1091;&#1082;&#1090;&#1091;&#1088;&#1077;
_SYSTEM_HANDLE_INFORMATION_EX.
<p><code><!--mstheme--></font>
<pre>        #define SystemHandleInformation 0x10

        typedef struct _SYSTEM_HANDLE_INFORMATION {
                ULONG ProcessId;
                UCHAR ObjectTypeNumber;
                UCHAR Flags;
                USHORT Handle;
                PVOID Object;
                ACCESS_MASK GrantedAccess;
        } SYSTEM_HANDLE_INFORMATION, *PSYSTEM_HANDLE_INFORMATION;

        typedef struct _SYSTEM_HANDLE_INFORMATION_EX {
                ULONG NumberOfHandles;
                SYSTEM_HANDLE_INFORMATION Information[1];
        } SYSTEM_HANDLE_INFORMATION_EX, *PSYSTEM_HANDLE_INFORMATION_EX;</pre>
<!--mstheme--><font face="Arial, Arial, Helvetica"></code>
<p>ProcessId &#1091;&#1082;&#1072;&#1079;&#1099;&#1074;&#1072;&#1077;&#1090;
&#1087;&#1088;&#1086;&#1094;&#1077;&#1089;&#1089;,
&#1074;&#1083;&#1072;&#1076;&#1077;&#1102;&#1097;&#1080;&#1081;
&#1101;&#1090;&#1080;&#1084; &#1093;&#1101;&#1085;&#1076;&#1083;&#1086;&#1084;.
ObjectTypeNumber - &#1101;&#1090;&#1086; &#1090;&#1080;&#1087;
&#1093;&#1101;&#1085;&#1076;&#1083;&#1072;. NumberOfHandles -
&#1082;&#1086;&#1083;&#1080;&#1095;&#1077;&#1089;&#1090;&#1074;&#1086;
&#1079;&#1072;&#1087;&#1080;&#1089;&#1077;&#1081; &#1074;
&#1084;&#1072;&#1089;&#1089;&#1080;&#1074;&#1077; Information.
&#1057;&#1082;&#1088;&#1099;&#1090;&#1080;&#1077;
&#1086;&#1076;&#1085;&#1086;&#1075;&#1086;
&#1101;&#1083;&#1077;&#1084;&#1077;&#1085;&#1090;&#1072;
&#1090;&#1088;&#1080;&#1074;&#1080;&#1072;&#1083;&#1100;&#1085;&#1086;.
&#1053;&#1091;&#1078;&#1085;&#1086;
&#1089;&#1076;&#1074;&#1080;&#1085;&#1091;&#1090;&#1100;
&#1087;&#1086;&#1089;&#1083;&#1077;&#1076;&#1091;&#1102;&#1097;&#1080;&#1077;
&#1079;&#1072;&#1087;&#1080;&#1089;&#1080; &#1085;&#1072;
&#1086;&#1076;&#1085;&#1091; &#1080;
&#1091;&#1084;&#1077;&#1085;&#1100;&#1096;&#1080;&#1090;&#1100;
&#1079;&#1085;&#1072;&#1095;&#1077;&#1085;&#1080;&#1077; NumberOfHandles.
&#1057;&#1076;&#1074;&#1080;&#1075;
&#1087;&#1086;&#1089;&#1083;&#1077;&#1076;&#1091;&#1102;&#1097;&#1080;&#1093;
&#1079;&#1072;&#1087;&#1080;&#1089;&#1077;&#1081;
&#1090;&#1088;&#1077;&#1073;&#1091;&#1077;&#1090;&#1089;&#1103;,
&#1087;&#1086;&#1090;&#1086;&#1084;&#1091; &#1095;&#1090;&#1086;
&#1093;&#1101;&#1085;&#1076;&#1083;&#1099; &#1074;
&#1084;&#1072;&#1089;&#1089;&#1080;&#1074;&#1077;
&#1089;&#1075;&#1088;&#1091;&#1087;&#1087;&#1080;&#1088;&#1086;&#1074;&#1072;&#1085;&#1099;
&#1087;&#1086; ProcessId. &#1069;&#1090;&#1086;
&#1079;&#1085;&#1072;&#1095;&#1080;&#1090;, &#1095;&#1090;&#1086;
&#1074;&#1089;&#1077; &#1093;&#1101;&#1085;&#1076;&#1083;&#1099;
&#1086;&#1076;&#1085;&#1086;&#1075;&#1086;
&#1087;&#1088;&#1086;&#1094;&#1077;&#1089;&#1089;&#1072;
&#1088;&#1072;&#1089;&#1087;&#1086;&#1083;&#1086;&#1078;&#1077;&#1085;&#1099;
&#1087;&#1086;&#1089;&#1083;&#1077;&#1076;&#1086;&#1074;&#1072;&#1090;&#1077;&#1083;&#1100;&#1085;&#1086;.
&#1048; &#1076;&#1083;&#1103; &#1082;&#1072;&#1078;&#1076;&#1086;&#1075;&#1086;
&#1087;&#1088;&#1086;&#1094;&#1077;&#1089;&#1089;&#1072;
&#1079;&#1085;&#1072;&#1095;&#1077;&#1085;&#1080;&#1077;
&#1087;&#1086;&#1083;&#1103; Handle &#1088;&#1072;&#1089;&#1090;&#1077;&#1090;.
<p>&#1042;&#1089;&#1087;&#1086;&#1084;&#1085;&#1080;&#1090;&#1077;
&#1089;&#1090;&#1088;&#1091;&#1082;&#1090;&#1091;&#1088;&#1091;
_SYSTEM_PROCESSES, &#1082;&#1086;&#1090;&#1086;&#1088;&#1072;&#1103;
&#1074;&#1086;&#1079;&#1074;&#1088;&#1072;&#1097;&#1072;&#1077;&#1090;&#1089;&#1103;
&#1101;&#1090;&#1086;&#1081;
&#1092;&#1091;&#1085;&#1082;&#1094;&#1080;&#1077;&#1081; &#1089;
&#1082;&#1083;&#1072;&#1089;&#1089;&#1086;&#1084;
SystemProcessesAndThreadsInformation. &#1047;&#1076;&#1077;&#1089;&#1100;
&#1084;&#1099; &#1084;&#1086;&#1078;&#1077;&#1084;
&#1091;&#1074;&#1080;&#1076;&#1077;&#1090;&#1100;, &#1095;&#1090;&#1086;
&#1082;&#1072;&#1078;&#1076;&#1099;&#1081;
&#1087;&#1088;&#1086;&#1094;&#1077;&#1089;&#1089;
&#1080;&#1084;&#1077;&#1077;&#1090;
&#1080;&#1085;&#1092;&#1086;&#1088;&#1084;&#1072;&#1094;&#1080;&#1102; &#1086;
&#1082;&#1086;&#1083;&#1080;&#1095;&#1077;&#1089;&#1090;&#1074;&#1077;
&#1093;&#1101;&#1085;&#1076;&#1083;&#1086;&#1074; &#1074; HandleCount.
&#1045;&#1089;&#1083;&#1080; &#1084;&#1099; &#1093;&#1086;&#1090;&#1080;&#1084;
&#1089;&#1076;&#1077;&#1083;&#1072;&#1090;&#1100; &#1074;&#1089;&#1077;
&#1080;&#1076;&#1077;&#1072;&#1083;&#1100;&#1085;&#1086;, &#1085;&#1072;&#1084;
&#1089;&#1083;&#1077;&#1076;&#1091;&#1077;&#1090;
&#1080;&#1079;&#1084;&#1077;&#1085;&#1080;&#1090;&#1100;
&#1087;&#1086;&#1083;&#1077; HandleCount (&#1074;
&#1089;&#1086;&#1086;&#1090;&#1074;&#1077;&#1090;&#1089;&#1090;&#1074;&#1080;&#1080;
&#1089; &#1090;&#1077;&#1084;, &#1089;&#1082;&#1086;&#1083;&#1100;&#1082;&#1086;
&#1093;&#1101;&#1085;&#1076;&#1083;&#1086;&#1074; &#1084;&#1099;
&#1089;&#1082;&#1088;&#1099;&#1083;&#1080;), &#1082;&#1086;&#1075;&#1076;&#1072;
&#1092;&#1091;&#1085;&#1082;&#1094;&#1080;&#1103;
&#1073;&#1091;&#1076;&#1077;&#1090;
&#1074;&#1099;&#1079;&#1074;&#1072;&#1085;&#1072; &#1089;
&#1082;&#1083;&#1072;&#1089;&#1089;&#1086;&#1084;
SystemProcessesAndThreadsInformation. &#1053;&#1086; &#1101;&#1090;&#1072;
&#1087;&#1086;&#1087;&#1088;&#1072;&#1074;&#1082;&#1072;
&#1084;&#1086;&#1078;&#1077;&#1090;
&#1090;&#1088;&#1077;&#1073;&#1086;&#1074;&#1072;&#1090;&#1100;
&#1089;&#1083;&#1080;&#1096;&#1082;&#1086;&#1084;
&#1084;&#1085;&#1086;&#1075;&#1086;
&#1074;&#1088;&#1077;&#1084;&#1077;&#1085;&#1080;.
&#1052;&#1085;&#1086;&#1078;&#1077;&#1089;&#1090;&#1074;&#1086;
&#1093;&#1101;&#1085;&#1076;&#1083;&#1086;&#1074;
&#1086;&#1090;&#1082;&#1088;&#1099;&#1074;&#1072;&#1102;&#1090;&#1089;&#1103;
&#1080;
&#1079;&#1072;&#1082;&#1088;&#1099;&#1074;&#1072;&#1102;&#1090;&#1089;&#1103;
&#1074; &#1090;&#1077;&#1095;&#1077;&#1085;&#1080;&#1080;
&#1086;&#1095;&#1077;&#1085;&#1100;
&#1082;&#1086;&#1088;&#1086;&#1090;&#1082;&#1086;&#1075;&#1086;
&#1074;&#1088;&#1077;&#1084;&#1077;&#1085;&#1080; &#1087;&#1088;&#1080;
&#1085;&#1086;&#1088;&#1084;&#1072;&#1083;&#1100;&#1085;&#1086;&#1081;
&#1088;&#1072;&#1073;&#1086;&#1090;&#1077;
&#1089;&#1080;&#1089;&#1090;&#1077;&#1084;&#1099;.
&#1051;&#1077;&#1075;&#1082;&#1086; &#1084;&#1086;&#1078;&#1077;&#1090;
&#1089;&#1083;&#1091;&#1095;&#1080;&#1090;&#1100;&#1089;&#1103;,
&#1095;&#1090;&#1086;
&#1082;&#1086;&#1083;&#1080;&#1095;&#1077;&#1089;&#1090;&#1074;&#1086;
&#1093;&#1101;&#1085;&#1076;&#1083;&#1086;&#1074;
&#1080;&#1079;&#1084;&#1077;&#1085;&#1080;&#1083;&#1086;&#1089;&#1100;
&#1084;&#1077;&#1078;&#1076;&#1091; &#1076;&#1074;&#1091;&#1084;&#1103;
&#1074;&#1099;&#1079;&#1086;&#1074;&#1072;&#1084;&#1080;
&#1092;&#1091;&#1085;&#1082;&#1094;&#1080;&#1080;,
&#1087;&#1086;&#1101;&#1090;&#1086;&#1084;&#1091; &#1085;&#1072;&#1084;
&#1085;&#1077; &#1085;&#1091;&#1078;&#1085;&#1086;
&#1080;&#1079;&#1084;&#1077;&#1085;&#1103;&#1090;&#1100;
&#1079;&#1076;&#1077;&#1089;&#1100; &#1087;&#1086;&#1083;&#1077; HandleCount. <a name="9_1"></a>
<p align="center">=====[ 9.1
&#1048;&#1084;&#1077;&#1085;&#1086;&#1074;&#1072;&#1085;&#1080;&#1077;
&#1093;&#1101;&#1085;&#1076;&#1083;&#1086;&#1074; &#1080;
&#1087;&#1086;&#1083;&#1091;&#1095;&#1077;&#1085;&#1080;&#1077;
&#1090;&#1080;&#1087;&#1072; ]=====</p>
<p>&#1057;&#1082;&#1088;&#1099;&#1090;&#1080;&#1077;
&#1093;&#1101;&#1085;&#1076;&#1083;&#1086;&#1074;
&#1090;&#1088;&#1080;&#1074;&#1080;&#1072;&#1083;&#1100;&#1085;&#1086;,
&#1085;&#1086; &#1085;&#1077;&#1084;&#1085;&#1086;&#1075;&#1086;
&#1089;&#1083;&#1086;&#1078;&#1085;&#1077;&#1077;
&#1086;&#1087;&#1088;&#1077;&#1076;&#1077;&#1083;&#1080;&#1090;&#1100;
&#1082;&#1072;&#1082;&#1080;&#1077; &#1093;&#1101;&#1085;&#1076;&#1083;&#1099;
&#1084;&#1099; &#1076;&#1086;&#1083;&#1078;&#1085;&#1099;
&#1089;&#1082;&#1088;&#1099;&#1090;&#1100;. &#1045;&#1089;&#1083;&#1080; &#1091;
&#1085;&#1072;&#1089; &#1077;&#1089;&#1090;&#1100;,
&#1085;&#1072;&#1087;&#1088;&#1080;&#1084;&#1077;&#1088;,
&#1089;&#1082;&#1088;&#1099;&#1090;&#1099;&#1081;
&#1087;&#1088;&#1086;&#1094;&#1077;&#1089;&#1089;, &#1085;&#1072;&#1089;
&#1089;&#1083;&#1077;&#1076;&#1091;&#1077;&#1090;
&#1089;&#1082;&#1088;&#1099;&#1090;&#1100; &#1074;&#1089;&#1077;
&#1077;&#1075;&#1086; &#1093;&#1101;&#1085;&#1076;&#1083;&#1099; &#1080;
&#1074;&#1089;&#1077; &#1093;&#1101;&#1085;&#1076;&#1083;&#1099;
&#1089;&#1074;&#1103;&#1079;&#1072;&#1085;&#1085;&#1099;&#1077; &#1089;
&#1085;&#1080;&#1084;. &#1057;&#1082;&#1088;&#1099;&#1090;&#1080;&#1077;
&#1093;&#1101;&#1085;&#1076;&#1083;&#1086;&#1074;
&#1101;&#1090;&#1086;&#1075;&#1086;
&#1087;&#1088;&#1086;&#1094;&#1077;&#1089;&#1089;&#1072;
&#1090;&#1072;&#1082;&#1078;&#1077;
&#1090;&#1088;&#1080;&#1074;&#1080;&#1072;&#1083;&#1100;&#1085;&#1086;.
&#1052;&#1099; &#1087;&#1088;&#1086;&#1089;&#1090;&#1086;
&#1089;&#1088;&#1072;&#1074;&#1085;&#1080;&#1074;&#1072;&#1077;&#1084; ProcessId
&#1093;&#1101;&#1085;&#1076;&#1083;&#1072; &#1080; PID
&#1085;&#1072;&#1096;&#1077;&#1075;&#1086;
&#1087;&#1088;&#1086;&#1094;&#1077;&#1089;&#1089;&#1072;,
&#1077;&#1089;&#1083;&#1080; &#1086;&#1085;&#1080;
&#1088;&#1072;&#1074;&#1085;&#1099; &#1084;&#1099;
&#1087;&#1088;&#1103;&#1095;&#1077;&#1084; &#1093;&#1101;&#1085;&#1076;&#1083;.
&#1053;&#1086; &#1093;&#1101;&#1085;&#1076;&#1083;&#1099;
&#1076;&#1088;&#1091;&#1075;&#1080;&#1093;
&#1087;&#1088;&#1086;&#1094;&#1077;&#1089;&#1089;&#1086;&#1074;
&#1076;&#1086;&#1083;&#1078;&#1085;&#1099; &#1073;&#1099;&#1090;&#1100;
&#1087;&#1088;&#1086;&#1080;&#1084;&#1077;&#1085;&#1086;&#1074;&#1072;&#1085;&#1099;
&#1087;&#1088;&#1077;&#1078;&#1076;&#1077;, &#1095;&#1077;&#1084; &#1084;&#1099;
&#1089;&#1084;&#1086;&#1078;&#1077;&#1084;
&#1089;&#1088;&#1072;&#1074;&#1085;&#1080;&#1074;&#1072;&#1090;&#1100;
&#1080;&#1093; &#1089; &#1095;&#1077;&#1084;-&#1083;&#1080;&#1073;&#1086;.
&#1050;&#1086;&#1083;&#1080;&#1095;&#1077;&#1089;&#1090;&#1074;&#1086;
&#1093;&#1101;&#1085;&#1076;&#1083;&#1086;&#1074; &#1074;
&#1089;&#1080;&#1089;&#1090;&#1077;&#1084;&#1077;
&#1086;&#1073;&#1099;&#1095;&#1085;&#1086; &#1086;&#1095;&#1077;&#1085;&#1100;
&#1074;&#1077;&#1083;&#1080;&#1082;&#1086;,
&#1087;&#1086;&#1101;&#1090;&#1086;&#1084;&#1091;
&#1083;&#1091;&#1095;&#1096;&#1077;&#1077;, &#1095;&#1090;&#1086; &#1084;&#1099;
&#1084;&#1086;&#1078;&#1077;&#1084;
&#1089;&#1076;&#1077;&#1083;&#1072;&#1090;&#1100; - &#1101;&#1090;&#1086;
&#1089;&#1088;&#1072;&#1074;&#1085;&#1080;&#1090;&#1100; &#1090;&#1080;&#1087;
&#1093;&#1101;&#1085;&#1076;&#1083;&#1072;
&#1087;&#1088;&#1077;&#1078;&#1076;&#1077;, &#1095;&#1077;&#1084;
&#1087;&#1086;&#1087;&#1099;&#1090;&#1072;&#1090;&#1100;&#1089;&#1103;
&#1087;&#1088;&#1086;&#1080;&#1084;&#1077;&#1085;&#1086;&#1074;&#1072;&#1090;&#1100;
&#1077;&#1075;&#1086;.
&#1048;&#1084;&#1077;&#1085;&#1086;&#1074;&#1072;&#1085;&#1080;&#1077;
&#1090;&#1080;&#1087;&#1086;&#1074;
&#1089;&#1086;&#1093;&#1088;&#1072;&#1085;&#1080;&#1090;
&#1084;&#1085;&#1086;&#1075;&#1086;
&#1074;&#1088;&#1077;&#1084;&#1077;&#1085;&#1080; &#1076;&#1083;&#1103;
&#1093;&#1101;&#1085;&#1076;&#1083;&#1086;&#1074;,
&#1082;&#1086;&#1090;&#1086;&#1088;&#1099;&#1077; &#1085;&#1072;&#1089;
&#1085;&#1077;
&#1080;&#1085;&#1090;&#1077;&#1088;&#1077;&#1089;&#1091;&#1102;&#1090;.
<p>&#1048;&#1084;&#1077;&#1085;&#1086;&#1074;&#1072;&#1085;&#1080;&#1077;
&#1093;&#1101;&#1085;&#1076;&#1083;&#1072; &#1080; &#1090;&#1080;&#1087;&#1072;
&#1093;&#1101;&#1085;&#1076;&#1083;&#1072; &#1084;&#1086;&#1078;&#1077;&#1090;
&#1073;&#1099;&#1090;&#1100;
&#1074;&#1099;&#1087;&#1086;&#1083;&#1085;&#1077;&#1085;&#1086; &#1089;
&#1087;&#1086;&#1084;&#1086;&#1097;&#1100;&#1102;
&#1092;&#1091;&#1085;&#1082;&#1094;&#1080;&#1080; NtQueryObject.
<p><code><!--mstheme--></font>
<pre>        NTSTATUS ZwQueryObject(
                IN HANDLE ObjectHandle,
                IN OBJECT_INFORMATION_CLASS ObjectInformationClass,
                OUT PVOID ObjectInformation,
                IN ULONG ObjectInformationLength,
                OUT PULONG ReturnLength OPTIONAL
        );</pre>
<!--mstheme--><font face="Arial, Arial, Helvetica"></code>
<p>ObjectHandle - &#1093;&#1101;&#1085;&#1076;&#1083;,
&#1080;&#1085;&#1092;&#1086;&#1088;&#1084;&#1072;&#1094;&#1080;&#1102; &#1086;
&#1082;&#1086;&#1090;&#1086;&#1088;&#1086;&#1084; &#1084;&#1099;
&#1093;&#1086;&#1090;&#1080;&#1084;
&#1087;&#1086;&#1083;&#1091;&#1095;&#1080;&#1090;&#1100;, ObjectInformationClass
- &#1090;&#1080;&#1087;
&#1080;&#1085;&#1092;&#1086;&#1088;&#1084;&#1072;&#1094;&#1080;&#1080;,
&#1082;&#1086;&#1090;&#1086;&#1088;&#1072;&#1103;
&#1073;&#1091;&#1076;&#1077;&#1090;
&#1089;&#1086;&#1093;&#1088;&#1072;&#1085;&#1077;&#1085;&#1072; &#1074;
&#1073;&#1091;&#1092;&#1077;&#1088; ObjectInformation
&#1088;&#1072;&#1079;&#1084;&#1077;&#1088;&#1086;&#1084; ObjectInformationLength
&#1073;&#1072;&#1081;&#1090;.
<p>&#1052;&#1099; &#1073;&#1091;&#1076;&#1077;&#1084;
&#1080;&#1089;&#1087;&#1086;&#1083;&#1100;&#1079;&#1086;&#1074;&#1072;&#1090;&#1100;
&#1082;&#1083;&#1072;&#1089;&#1089;&#1099; ObjectNameInformation &#1080;
ObjectAllTypesInformation. &#1050;&#1083;&#1072;&#1089;&#1089;
ObjectNameInfromation &#1079;&#1072;&#1087;&#1086;&#1083;&#1085;&#1080;&#1090;
&#1073;&#1091;&#1092;&#1077;&#1088;
&#1089;&#1090;&#1088;&#1091;&#1082;&#1090;&#1091;&#1088;&#1086;&#1081;
OBJECT_NAME_INFORMATION, &#1072; &#1082;&#1083;&#1072;&#1089;&#1089;
ObjectAllTypesInformation
&#1089;&#1090;&#1088;&#1091;&#1082;&#1090;&#1091;&#1088;&#1086;&#1081;
OBJECT_ALL_TYPES_INFORMATION.
<p><code><!--mstheme--></font>
<pre>        #define ObjectNameInformation 1
        #define ObjectAllTypesInformation 3

        typedef struct _OBJECT_NAME_INFORMATION {
                UNICODE_STRING Name;
        } OBJECT_NAME_INFORMATION, *POBJECT_NAME_INFORMATION;</pre>
<!--mstheme--><font face="Arial, Arial, Helvetica"></code>
<p>&#1055;&#1086;&#1083;&#1077; Name
&#1086;&#1087;&#1088;&#1077;&#1076;&#1077;&#1083;&#1103;&#1077;&#1090;
&#1080;&#1084;&#1103; &#1093;&#1101;&#1085;&#1076;&#1083;&#1072;.
<p><code><!--mstheme--></font>
<pre>        typedef struct _OBJECT_TYPE_INFORMATION {
                UNICODE_STRING Name;
                ULONG ObjectCount;
                ULONG HandleCount;
                ULONG Reserved1[4];
                ULONG PeakObjectCount;
                ULONG PeakHandleCount;
                ULONG Reserved2[4];
                ULONG InvalidAttributes;
                GENERIC_MAPPING GenericMapping;
                ULONG ValidAccess;
                UCHAR Unknown;
                BOOLEAN MaintainHandleDatabase;
                POOL_TYPE PoolType;
                ULONG PagedPoolUsage;
                ULONG NonPagedPoolUsage;
        } OBJECT_TYPE_INFORMATION, *POBJECT_TYPE_INFORMATION;

        typedef struct _OBJECT_ALL_TYPES_INFORMATION {
                ULONG NumberOfTypes;
                OBJECT_TYPE_INFORMATION TypeInformation;
        } OBJECT_ALL_TYPES_INFORMATION, *POBJECT_ALL_TYPES_INFORMATION;</pre>
<!--mstheme--><font face="Arial, Arial, Helvetica"></code>
<p>&#1055;&#1086;&#1083;&#1077; Name
&#1086;&#1087;&#1088;&#1077;&#1076;&#1077;&#1083;&#1103;&#1077;&#1090;
&#1080;&#1084;&#1103; &#1090;&#1080;&#1087;&#1072;
&#1086;&#1073;&#1098;&#1077;&#1082;&#1090;&#1072;,
&#1082;&#1086;&#1090;&#1086;&#1088;&#1086;&#1077;
&#1089;&#1083;&#1077;&#1076;&#1091;&#1077;&#1090;
&#1089;&#1088;&#1072;&#1079;&#1091; &#1087;&#1086;&#1089;&#1083;&#1077;
&#1082;&#1072;&#1078;&#1076;&#1086;&#1081;
&#1089;&#1090;&#1088;&#1091;&#1082;&#1090;&#1091;&#1088;&#1099;
OBJECT_TYPE_INFORMATION.
&#1057;&#1083;&#1077;&#1076;&#1091;&#1102;&#1097;&#1072;&#1103;
&#1089;&#1090;&#1088;&#1091;&#1082;&#1090;&#1091;&#1088;&#1072;
OBJECT_TYPE_INFORMATION
&#1088;&#1072;&#1089;&#1087;&#1086;&#1083;&#1086;&#1078;&#1077;&#1085;&#1072;
&#1087;&#1086;&#1089;&#1083;&#1077; &#1101;&#1090;&#1086;&#1075;&#1086;
&#1080;&#1084;&#1077;&#1085;&#1080; &#1080;
&#1074;&#1099;&#1088;&#1086;&#1074;&#1085;&#1077;&#1085;&#1072; &#1085;&#1072;
&#1075;&#1088;&#1072;&#1085;&#1080;&#1094;&#1091;
&#1095;&#1077;&#1090;&#1099;&#1088;&#1077;&#1093; &#1073;&#1072;&#1081;&#1090;.
<p>ObjectTypeNumber &#1080;&#1079;
&#1089;&#1090;&#1088;&#1091;&#1082;&#1090;&#1091;&#1088;&#1099;
SYSTEM_HANDLE_INFORMATION - &#1101;&#1090;&#1086;
&#1080;&#1085;&#1076;&#1077;&#1082;&#1089; &#1074;
&#1084;&#1072;&#1089;&#1089;&#1080;&#1074;&#1077; TypeInformation.
<p>&#1057;&#1083;&#1086;&#1078;&#1085;&#1077;&#1077;
&#1087;&#1086;&#1083;&#1091;&#1095;&#1080;&#1090;&#1100; &#1080;&#1084;&#1103;
&#1093;&#1101;&#1085;&#1076;&#1083;&#1072; &#1080;&#1079;
&#1076;&#1088;&#1091;&#1075;&#1086;&#1075;&#1086;
&#1087;&#1088;&#1086;&#1094;&#1077;&#1089;&#1089;&#1072;.
&#1057;&#1091;&#1097;&#1077;&#1089;&#1090;&#1074;&#1091;&#1102;&#1090;
&#1076;&#1074;&#1072; &#1089;&#1087;&#1086;&#1089;&#1086;&#1073;&#1072;
&#1089;&#1076;&#1077;&#1083;&#1072;&#1090;&#1100; &#1101;&#1090;&#1086;.
&#1055;&#1077;&#1088;&#1074;&#1099;&#1081;
&#1089;&#1086;&#1089;&#1090;&#1086;&#1080;&#1090; &#1074; &#1090;&#1086;&#1084;,
&#1095;&#1090;&#1086;&#1073;&#1099;
&#1089;&#1082;&#1086;&#1087;&#1080;&#1088;&#1086;&#1074;&#1072;&#1090;&#1100;
&#1093;&#1101;&#1085;&#1076;&#1083;
&#1092;&#1091;&#1085;&#1082;&#1094;&#1080;&#1077;&#1081; NtDuplicateObject
&#1074; &#1085;&#1072;&#1096; &#1087;&#1088;&#1086;&#1094;&#1077;&#1089;&#1089;
&#1080; &#1079;&#1072;&#1090;&#1077;&#1084;
&#1087;&#1088;&#1086;&#1080;&#1084;&#1077;&#1085;&#1086;&#1074;&#1072;&#1090;&#1100;
&#1077;&#1075;&#1086;. &#1069;&#1090;&#1086;&#1090;
&#1084;&#1077;&#1090;&#1086;&#1076; &#1085;&#1077;
&#1089;&#1088;&#1072;&#1073;&#1086;&#1090;&#1072;&#1077;&#1090;
&#1076;&#1083;&#1103;
&#1085;&#1077;&#1082;&#1086;&#1090;&#1086;&#1088;&#1099;&#1093;
&#1089;&#1087;&#1077;&#1094;&#1080;&#1092;&#1080;&#1095;&#1077;&#1089;&#1082;&#1080;&#1093;
&#1090;&#1080;&#1087;&#1086;&#1074;
&#1093;&#1101;&#1085;&#1076;&#1083;&#1086;&#1074;. &#1053;&#1086; &#1086;&#1085;
&#1085;&#1077;
&#1089;&#1088;&#1072;&#1073;&#1072;&#1090;&#1099;&#1074;&#1072;&#1077;&#1090;
&#1076;&#1086;&#1074;&#1086;&#1083;&#1100;&#1085;&#1086;
&#1088;&#1077;&#1076;&#1082;&#1086;,
&#1087;&#1086;&#1101;&#1090;&#1086;&#1084;&#1091; &#1084;&#1099;
&#1084;&#1086;&#1078;&#1077;&#1084;
&#1086;&#1089;&#1090;&#1072;&#1074;&#1072;&#1090;&#1100;&#1089;&#1103;
&#1089;&#1087;&#1086;&#1082;&#1086;&#1081;&#1085;&#1099;&#1084;&#1080; &#1080;
&#1080;&#1089;&#1087;&#1086;&#1083;&#1100;&#1079;&#1086;&#1074;&#1072;&#1090;&#1100;
&#1077;&#1075;&#1086;.
<p><code><!--mstheme--></font>
<pre>        NtDuplicateObject(
                IN HANDLE SourceProcessHandle,
                IN HANDLE SourceHandle,
                IN HANDLE TargetProcessHandle,
                OUT PHANDLE TargetHandle OPTIONAL,
                IN ACCESS_MASK DesiredAccess,
                IN ULONG Attributes,
                IN ULONG Options
        );</pre>
<!--mstheme--><font face="Arial, Arial, Helvetica"></code>
<p>SourceProcessHandle - &#1093;&#1101;&#1085;&#1076;&#1083;
&#1087;&#1088;&#1086;&#1094;&#1077;&#1089;&#1089;&#1072;,
&#1082;&#1086;&#1090;&#1086;&#1088;&#1099;&#1081;
&#1074;&#1083;&#1072;&#1076;&#1077;&#1077;&#1090; SourceHandle, &#1090;&#1086;
&#1077;&#1089;&#1090;&#1100; &#1093;&#1101;&#1085;&#1076;&#1083;&#1086;&#1084;,
&#1082;&#1086;&#1090;&#1086;&#1088;&#1099;&#1081; &#1084;&#1099;
&#1093;&#1086;&#1090;&#1080;&#1084;
&#1089;&#1082;&#1086;&#1087;&#1080;&#1088;&#1086;&#1074;&#1072;&#1090;&#1100;.
TargetProcessHandle - &#1101;&#1090;&#1086; &#1093;&#1101;&#1085;&#1076;&#1083;
&#1087;&#1088;&#1086;&#1094;&#1077;&#1089;&#1089;&#1072;, &#1074;
&#1082;&#1086;&#1090;&#1086;&#1088;&#1099;&#1081; &#1084;&#1099;
&#1093;&#1086;&#1090;&#1080;&#1084;
&#1082;&#1086;&#1087;&#1080;&#1088;&#1086;&#1074;&#1072;&#1090;&#1100;.
&#1069;&#1090;&#1086; &#1093;&#1101;&#1085;&#1076;&#1083;
&#1085;&#1072;&#1096;&#1077;&#1075;&#1086;
&#1087;&#1088;&#1086;&#1094;&#1077;&#1089;&#1089;&#1072; &#1074;
&#1085;&#1072;&#1096;&#1077;&#1084; &#1089;&#1083;&#1091;&#1095;&#1072;&#1077;.
TargetHandle - &#1091;&#1082;&#1072;&#1079;&#1072;&#1090;&#1077;&#1083;&#1100;,
&#1082;&#1091;&#1076;&#1072; &#1073;&#1091;&#1076;&#1077;&#1090;
&#1089;&#1086;&#1093;&#1088;&#1072;&#1085;&#1077;&#1085;&#1072;
&#1082;&#1086;&#1087;&#1080;&#1103; &#1093;&#1101;&#1085;&#1076;&#1083;&#1072;.
&#1055;&#1072;&#1088;&#1072;&#1084;&#1077;&#1090;&#1088; DesiredAccess
&#1076;&#1086;&#1083;&#1078;&#1077;&#1085; &#1073;&#1099;&#1090;&#1100;
&#1088;&#1072;&#1074;&#1077;&#1085; PROCESS_QUERY_INFORMATION, &#1072;
Attribures &#1080; Options - &#1085;&#1091;&#1083;&#1102;.
<p>&#1042;&#1090;&#1086;&#1088;&#1086;&#1081;
&#1089;&#1087;&#1086;&#1089;&#1086;&#1073;
&#1080;&#1084;&#1077;&#1085;&#1086;&#1074;&#1072;&#1085;&#1080;&#1103;,
&#1088;&#1072;&#1073;&#1086;&#1090;&#1072;&#1102;&#1097;&#1080;&#1081;
&#1089;&#1086; &#1074;&#1089;&#1077;&#1084;&#1080;
&#1093;&#1101;&#1085;&#1076;&#1083;&#1072;&#1084;&#1080;,
&#1089;&#1086;&#1089;&#1090;&#1086;&#1080;&#1090; &#1074;
&#1080;&#1089;&#1087;&#1086;&#1083;&#1100;&#1079;&#1086;&#1074;&#1072;&#1085;&#1080;&#1080;
&#1089;&#1080;&#1089;&#1090;&#1077;&#1084;&#1085;&#1086;&#1075;&#1086;
&#1076;&#1088;&#1072;&#1081;&#1074;&#1077;&#1088;&#1072;.
&#1048;&#1089;&#1093;&#1086;&#1076;&#1085;&#1099;&#1081; &#1082;&#1086;&#1076;
&#1101;&#1090;&#1086;&#1075;&#1086; &#1084;&#1077;&#1090;&#1086;&#1076;&#1072;
&#1076;&#1086;&#1089;&#1090;&#1091;&#1087;&#1077;&#1085; &#1074;
&#1087;&#1088;&#1086;&#1077;&#1082;&#1090;&#1077; OpHandle &#1085;&#1072;
&#1084;&#1086;&#1077;&#1084; &#1089;&#1072;&#1081;&#1090;&#1077; <a href="http://rootkit.host.sk/">http://rootkit.host.sk/</a>.
<a name="10"></a>
<p align="center">=====[ 10. &#1055;&#1086;&#1088;&#1090;&#1099; ]=====</p>
<p>&#1057;&#1072;&#1084;&#1099;&#1081;
&#1087;&#1088;&#1086;&#1089;&#1090;&#1086;&#1081; &#1087;&#1091;&#1090;&#1100;
&#1076;&#1083;&#1103;
&#1087;&#1077;&#1088;&#1077;&#1095;&#1080;&#1089;&#1083;&#1077;&#1085;&#1080;&#1103;
&#1086;&#1090;&#1082;&#1088;&#1099;&#1090;&#1099;&#1093;
&#1087;&#1086;&#1088;&#1090;&#1086;&#1074; - &#1101;&#1090;&#1086;
&#1080;&#1089;&#1087;&#1086;&#1083;&#1100;&#1079;&#1086;&#1074;&#1072;&#1085;&#1080;&#1077;
&#1092;&#1091;&#1085;&#1082;&#1094;&#1080;&#1081;
AllocateAndGetTcpTableFromStack &#1080; AllocateAndGetUdpTableFromStack, &#1080;/&#1080;&#1083;&#1080;
AllocateAndGetTcpExTableFromStack &#1080; AllocateAndGetUdpExTableFromStack
&#1080;&#1079; iphlpapi.dll. Ex-&#1092;&#1091;&#1085;&#1082;&#1094;&#1080;&#1080;
&#1076;&#1086;&#1089;&#1090;&#1091;&#1087;&#1085;&#1099;
&#1085;&#1072;&#1095;&#1080;&#1085;&#1072;&#1103; &#1089; Windows XP.
<p><code><!--mstheme--></font>
<pre>        typedef struct _MIB_TCPROW {
                DWORD dwState;
                DWORD dwLocalAddr;
                DWORD dwLocalPort;
                DWORD dwRemoteAddr;
                DWORD dwRemotePort;
        } MIB_TCPROW, *PMIB_TCPROW;

        typedef struct _MIB_TCPTABLE {
                DWORD dwNumEntries;
                MIB_TCPROW table[ANY_SIZE];
        } MIB_TCPTABLE, *PMIB_TCPTABLE;

        typedef struct _MIB_UDPROW {
                DWORD dwLocalAddr;
                DWORD dwLocalPort;
        } MIB_UDPROW, *PMIB_UDPROW;

        typedef struct _MIB_UDPTABLE {
                DWORD dwNumEntries;
                MIB_UDPROW table[ANY_SIZE];
        } MIB_UDPTABLE, *PMIB_UDPTABLE;

        typedef struct _MIB_TCPROW_EX
        {
                DWORD dwState;
                DWORD dwLocalAddr;
                DWORD dwLocalPort;
                DWORD dwRemoteAddr;
                DWORD dwRemotePort;
                DWORD dwProcessId;
        } MIB_TCPROW_EX, *PMIB_TCPROW_EX;

        typedef struct _MIB_TCPTABLE_EX
        {
                DWORD dwNumEntries;
                MIB_TCPROW_EX table[ANY_SIZE];
        } MIB_TCPTABLE_EX, *PMIB_TCPTABLE_EX;

        typedef struct _MIB_UDPROW_EX
        {
                DWORD dwLocalAddr;
                DWORD dwLocalPort;
                DWORD dwProcessId;
        } MIB_UDPROW_EX, *PMIB_UDPROW_EX;

        typedef struct _MIB_UDPTABLE_EX
        {
                DWORD dwNumEntries;
                MIB_UDPROW_EX table[ANY_SIZE];
        } MIB_UDPTABLE_EX, *PMIB_UDPTABLE_EX;

        DWORD WINAPI AllocateAndGetTcpTableFromStack(
                OUT PMIB_TCPTABLE *pTcpTable,
                IN BOOL bOrder,
                IN HANDLE hAllocHeap,
                IN DWORD dwAllocFlags,
                IN DWORD dwProtocolVersion;
        );

        DWORD WINAPI AllocateAndGetUdpTableFromStack(
                OUT PMIB_UDPTABLE *pUdpTable,
                IN BOOL bOrder,
                IN HANDLE hAllocHeap,
                IN DWORD dwAllocFlags,
                IN DWORD dwProtocolVersion;
        );

        DWORD WINAPI AllocateAndGetTcpExTableFromStack(
                OUT PMIB_TCPTABLE_EX *pTcpTableEx,
                IN BOOL bOrder,
                IN HANDLE hAllocHeap,
                IN DWORD dwAllocFlags,
                IN DWORD dwProtocolVersion;
        );

        DWORD WINAPI AllocateAndGetUdpExTableFromStack(
                OUT PMIB_UDPTABLE_EX *pUdpTableEx,
                IN BOOL bOrder,
                IN HANDLE hAllocHeap,
                IN DWORD dwAllocFlags,
                IN DWORD dwProtocolVersion;
        );</pre>
<!--mstheme--><font face="Arial, Arial, Helvetica"></code>
<p>&#1045;&#1089;&#1090;&#1100; &#1080;
&#1076;&#1088;&#1091;&#1075;&#1086;&#1081;
&#1089;&#1087;&#1086;&#1089;&#1086;&#1073;. &#1050;&#1086;&#1075;&#1076;&#1072;
&#1087;&#1088;&#1086;&#1075;&#1088;&#1072;&#1084;&#1084;&#1072;
&#1089;&#1086;&#1079;&#1076;&#1072;&#1077;&#1090;
&#1089;&#1086;&#1082;&#1077;&#1090; &#1080;
&#1085;&#1072;&#1095;&#1080;&#1085;&#1072;&#1077;&#1090; &#1077;&#1075;&#1086;
&#1089;&#1083;&#1091;&#1096;&#1072;&#1090;&#1100;, &#1086;&#1085;&#1072;,
&#1082;&#1086;&#1085;&#1077;&#1095;&#1085;&#1086;,
&#1080;&#1084;&#1077;&#1077;&#1090;
&#1086;&#1090;&#1082;&#1088;&#1099;&#1090;&#1099;&#1081;
&#1093;&#1101;&#1085;&#1076;&#1083; &#1076;&#1083;&#1103;
&#1085;&#1077;&#1075;&#1086; &#1080; &#1076;&#1083;&#1103;
&#1086;&#1090;&#1082;&#1088;&#1099;&#1090;&#1086;&#1075;&#1086;
&#1087;&#1086;&#1088;&#1090;&#1072;. &#1052;&#1099;
&#1084;&#1086;&#1078;&#1077;&#1084;
&#1087;&#1077;&#1088;&#1077;&#1095;&#1080;&#1089;&#1083;&#1080;&#1090;&#1100;
&#1074;&#1089;&#1077; &#1086;&#1090;&#1082;&#1088;&#1099;&#1090;&#1099;&#1077;
&#1093;&#1101;&#1085;&#1076;&#1083;&#1099; &#1074;
&#1089;&#1080;&#1089;&#1090;&#1077;&#1084;&#1077; &#1080;
&#1087;&#1086;&#1089;&#1083;&#1072;&#1090;&#1100; &#1080;&#1084;
&#1089;&#1087;&#1077;&#1094;&#1080;&#1072;&#1083;&#1100;&#1085;&#1099;&#1081;
&#1073;&#1091;&#1092;&#1077;&#1088;,
&#1080;&#1089;&#1087;&#1086;&#1083;&#1100;&#1079;&#1091;&#1103;
&#1092;&#1091;&#1085;&#1082;&#1094;&#1080;&#1102; NtDeviceIoControlFile,
&#1095;&#1090;&#1086;&#1073;&#1099;
&#1086;&#1087;&#1088;&#1077;&#1076;&#1077;&#1083;&#1080;&#1090;&#1100;
&#1093;&#1101;&#1085;&#1076;&#1083;&#1099; &#1076;&#1083;&#1103;
&#1086;&#1090;&#1082;&#1088;&#1099;&#1090;&#1099;&#1093;
&#1087;&#1086;&#1088;&#1090;&#1086;&#1074;. &#1069;&#1090;&#1086;
&#1090;&#1072;&#1082;&#1078;&#1077; &#1076;&#1072;&#1089;&#1090;
&#1085;&#1072;&#1084;
&#1080;&#1085;&#1092;&#1086;&#1088;&#1084;&#1072;&#1094;&#1080;&#1102; &#1086;
&#1087;&#1086;&#1088;&#1090;&#1072;&#1093;. &#1058;&#1072;&#1082;
&#1082;&#1072;&#1082; &#1086;&#1090;&#1082;&#1088;&#1099;&#1090;&#1099;&#1093;
&#1093;&#1101;&#1085;&#1076;&#1083;&#1086;&#1074;
&#1086;&#1095;&#1077;&#1085;&#1100; &#1084;&#1085;&#1086;&#1075;&#1086;,
&#1084;&#1099; &#1073;&#1091;&#1076;&#1077;&#1084;
&#1090;&#1077;&#1089;&#1090;&#1080;&#1088;&#1086;&#1074;&#1072;&#1090;&#1100;
&#1090;&#1086;&#1083;&#1100;&#1082;&#1086;
&#1093;&#1101;&#1085;&#1076;&#1083;&#1099; &#1089;
&#1090;&#1080;&#1087;&#1086;&#1084; File &#1080;
&#1080;&#1084;&#1077;&#1085;&#1077;&#1084; \Device\Tcp &#1080;&#1083;&#1080;
\Device\Udp. &#1054;&#1090;&#1082;&#1088;&#1099;&#1090;&#1099;&#1077;
&#1087;&#1086;&#1088;&#1090;&#1099; &#1080;&#1084;&#1077;&#1102;&#1090;
&#1090;&#1086;&#1083;&#1100;&#1082;&#1086; &#1101;&#1090;&#1086;&#1090;
&#1090;&#1080;&#1087; &#1080; &#1080;&#1084;&#1103;.
<p>&#1050;&#1086;&#1075;&#1076;&#1072; &#1084;&#1099;
&#1089;&#1084;&#1086;&#1090;&#1088;&#1077;&#1083;&#1080; &#1082;&#1086;&#1076;
&#1087;&#1077;&#1088;&#1077;&#1095;&#1080;&#1089;&#1083;&#1077;&#1085;&#1085;&#1099;&#1093;
&#1092;&#1091;&#1085;&#1082;&#1094;&#1080;&#1081; &#1074; iphlpapi.dll,
&#1084;&#1099;
&#1086;&#1073;&#1085;&#1072;&#1088;&#1091;&#1078;&#1080;&#1083;&#1080;,
&#1095;&#1090;&#1086; &#1101;&#1090;&#1080;
&#1092;&#1091;&#1085;&#1082;&#1094;&#1080;&#1080;
&#1074;&#1099;&#1079;&#1099;&#1074;&#1072;&#1102;&#1090; NtDeviceIoControlFile
&#1080; &#1087;&#1086;&#1089;&#1099;&#1083;&#1072;&#1102;&#1090;
&#1089;&#1087;&#1077;&#1094;&#1080;&#1072;&#1083;&#1100;&#1085;&#1099;&#1081;
&#1073;&#1091;&#1092;&#1077;&#1088; &#1076;&#1083;&#1103;
&#1090;&#1086;&#1075;&#1086;, &#1095;&#1090;&#1086;&#1073;&#1099;
&#1087;&#1086;&#1083;&#1091;&#1095;&#1080;&#1090;&#1100;
&#1089;&#1087;&#1080;&#1089;&#1086;&#1082; &#1074;&#1089;&#1077;&#1093;
&#1086;&#1090;&#1082;&#1088;&#1099;&#1090;&#1099;&#1093;
&#1087;&#1086;&#1088;&#1090;&#1086;&#1074; &#1074;
&#1089;&#1080;&#1089;&#1090;&#1077;&#1084;&#1077;. &#1069;&#1090;&#1086;
&#1079;&#1085;&#1072;&#1095;&#1080;&#1090;, &#1095;&#1090;&#1086;
&#1077;&#1076;&#1080;&#1085;&#1089;&#1090;&#1074;&#1077;&#1085;&#1085;&#1072;&#1103;
&#1092;&#1091;&#1085;&#1082;&#1094;&#1080;&#1103;,
&#1082;&#1086;&#1090;&#1086;&#1088;&#1091;&#1102;
&#1085;&#1091;&#1078;&#1085;&#1086;
&#1087;&#1077;&#1088;&#1077;&#1093;&#1074;&#1072;&#1090;&#1080;&#1090;&#1100;
&#1076;&#1083;&#1103; &#1089;&#1082;&#1088;&#1099;&#1090;&#1080;&#1103;
&#1087;&#1086;&#1088;&#1090;&#1086;&#1074; - &#1101;&#1090;&#1086;
NtDeviceIoControlFile.
<p><code><!--mstheme--></font>
<pre>        NTSTATUS NtDeviceIoControlFile(
                IN HANDLE FileHandle
                IN HANDLE Event OPTIONAL,
                IN PIO_APC_ROUTINE ApcRoutine OPTIONAL,
                IN PVOID ApcContext OPTIONAL,
                OUT PIO_STATUS_BLOCK IoStatusBlock,
                IN ULONG IoControlCode,
                IN PVOID InputBuffer OPTIONAL,
                IN ULONG InputBufferLength,
                OUT PVOID OutputBuffer OPTIONAL,
                IN ULONG OutputBufferLength
        );      </pre>
<!--mstheme--><font face="Arial, Arial, Helvetica"></code>
<p>&#1048;&#1085;&#1090;&#1077;&#1088;&#1077;&#1089;&#1091;&#1102;&#1097;&#1080;&#1077;
&#1085;&#1072;&#1089;
&#1087;&#1072;&#1088;&#1072;&#1084;&#1077;&#1090;&#1088;&#1099; -
&#1101;&#1090;&#1086; FileHandle (&#1086;&#1087;&#1088;&#1077;&#1076;&#1077;&#1083;&#1103;&#1077;&#1090;
&#1093;&#1101;&#1085;&#1076;&#1083;
&#1091;&#1089;&#1090;&#1088;&#1086;&#1081;&#1089;&#1090;&#1074;&#1072;),
IoStatusBlock (&#1091;&#1082;&#1072;&#1079;&#1099;&#1074;&#1072;&#1077;&#1090;
&#1085;&#1072;
&#1087;&#1077;&#1088;&#1077;&#1084;&#1077;&#1085;&#1085;&#1091;&#1102;,
&#1082;&#1086;&#1090;&#1086;&#1088;&#1072;&#1103;
&#1087;&#1086;&#1083;&#1091;&#1095;&#1072;&#1077;&#1090;
&#1080;&#1085;&#1092;&#1086;&#1088;&#1084;&#1072;&#1094;&#1080;&#1102; &#1086;
&#1089;&#1090;&#1072;&#1090;&#1091;&#1089;&#1077;
&#1074;&#1099;&#1087;&#1086;&#1083;&#1085;&#1077;&#1085;&#1080;&#1103; &#1080;
&#1080;&#1085;&#1092;&#1086;&#1088;&#1084;&#1072;&#1094;&#1080;&#1102;
&#1086;&#1073; &#1086;&#1087;&#1077;&#1088;&#1072;&#1094;&#1080;&#1080;),
IoControlCode (&#1095;&#1080;&#1089;&#1083;&#1086;,
&#1086;&#1087;&#1088;&#1077;&#1076;&#1077;&#1083;&#1103;&#1102;&#1097;&#1077;&#1077;
&#1090;&#1080;&#1087;
&#1091;&#1089;&#1090;&#1088;&#1086;&#1081;&#1089;&#1090;&#1074;&#1072;,
&#1084;&#1077;&#1090;&#1086;&#1076;, &#1087;&#1088;&#1072;&#1074;&#1072;
&#1076;&#1086;&#1089;&#1090;&#1091;&#1087;&#1072; &#1080;
&#1092;&#1091;&#1085;&#1082;&#1094;&#1080;&#1102;). InputBiffer
&#1089;&#1086;&#1076;&#1077;&#1088;&#1078;&#1080;&#1090;
&#1076;&#1072;&#1085;&#1085;&#1099;&#1077;
&#1088;&#1072;&#1079;&#1084;&#1077;&#1088;&#1086;&#1084; InputBufferLength
&#1073;&#1072;&#1081;&#1090;. &#1048; &#1090;&#1086;&#1078;&#1077;
&#1089;&#1072;&#1084;&#1086;&#1077; &#1074; OutputBuffer &#1080;
OutputbufferLength. <a name="10_1"></a>
<p align="center">=====[ 10.1 Netstat, OpPorts &#1074; WinXP, FPort &#1074;
WinXP ]=====</p>
<p>&#1055;&#1086;&#1083;&#1091;&#1095;&#1077;&#1085;&#1080;&#1077;
&#1089;&#1087;&#1080;&#1089;&#1082;&#1072;
&#1086;&#1090;&#1082;&#1088;&#1099;&#1090;&#1099;&#1093;
&#1087;&#1086;&#1088;&#1090;&#1086;&#1074; &#1074;
&#1087;&#1077;&#1088;&#1074;&#1091;&#1102;
&#1086;&#1095;&#1077;&#1088;&#1077;&#1076;&#1100;
&#1080;&#1089;&#1087;&#1086;&#1083;&#1100;&#1079;&#1091;&#1090;&#1077;&#1089;&#1103;,
&#1085;&#1072;&#1087;&#1088;&#1080;&#1084;&#1077;&#1088;, &#1074; OpPorts
&#1080; FPort &#1074; Windows XP, &#1072; &#1090;&#1072;&#1082;&#1078;&#1077;
Netstat.
<p>&#1055;&#1088;&#1086;&#1075;&#1088;&#1072;&#1084;&#1084;&#1099;
&#1074;&#1099;&#1079;&#1099;&#1074;&#1072;&#1102;&#1090; NtDeviceIoControlFile
&#1076;&#1074;&#1072;&#1078;&#1076;&#1099; &#1089; IoControlCode
&#1088;&#1072;&#1074;&#1085;&#1099;&#1084; 0x000120003. OutputBuffer
&#1079;&#1072;&#1087;&#1086;&#1083;&#1085;&#1103;&#1077;&#1090;&#1089;&#1103;
&#1087;&#1086;&#1089;&#1083;&#1077;
&#1074;&#1090;&#1086;&#1088;&#1086;&#1075;&#1086;
&#1074;&#1099;&#1079;&#1086;&#1074;&#1072;. &#1048;&#1084;&#1103; FileHandle
&#1079;&#1076;&#1077;&#1089;&#1100; &#1074;&#1089;&#1077;&#1075;&#1076;&#1072;
\Device\Tcp. InputBuffer
&#1088;&#1072;&#1079;&#1083;&#1080;&#1095;&#1072;&#1077;&#1090;&#1089;&#1103;
&#1076;&#1083;&#1103; &#1088;&#1072;&#1079;&#1085;&#1099;&#1093;
&#1090;&#1080;&#1087;&#1086;&#1074; &#1074;&#1099;&#1079;&#1086;&#1074;&#1072;:
<p>1) &#1044;&#1083;&#1103;
&#1087;&#1086;&#1083;&#1091;&#1095;&#1077;&#1085;&#1080;&#1103;
&#1084;&#1072;&#1089;&#1089;&#1080;&#1074;&#1072; &#1080;&#1079; MIB_TCPROW
InputBuffer &#1076;&#1086;&#1083;&#1078;&#1077;&#1085;
&#1073;&#1099;&#1090;&#1100; &#1090;&#1072;&#1082;&#1080;&#1084;:
<p><code><!--mstheme--></font>
<pre>&#1087;&#1077;&#1088;&#1074;&#1099;&#1081; &#1074;&#1099;&#1079;&#1086;&#1074;:
0x00 0x04 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x02 0x00 0x00 0x00 0x01 0x00 0x00 
0x01 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 
0x00 0x00 0x00 0x00 

&#1074;&#1090;&#1086;&#1088;&#1086;&#1081; &#1074;&#1099;&#1079;&#1086;&#1074;:
0x00 0x04 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x02 0x00 0x00 0x00 0x01 0x00 0x00 
0x01 0x01 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 
0x00 0x00 0x00 0x00 </pre>
<!--mstheme--><font face="Arial, Arial, Helvetica"></code>
<p>2) &#1063;&#1090;&#1086;&#1073;&#1099;
&#1087;&#1086;&#1083;&#1091;&#1095;&#1080;&#1090;&#1100;
&#1084;&#1072;&#1089;&#1089;&#1080;&#1074; &#1080;&#1079; MIB_UDPROW:
<p><code><!--mstheme--></font>
<pre>&#1087;&#1077;&#1088;&#1074;&#1099;&#1081; &#1074;&#1099;&#1079;&#1086;&#1074;:
0x01 0x04 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x02 0x00 0x00 0x00 0x01 0x00 0x00 
0x01 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 
0x00 0x00 0x00 0x00 

&#1074;&#1090;&#1086;&#1088;&#1086;&#1081; &#1074;&#1099;&#1079;&#1086;&#1074;:
0x01 0x04 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x02 0x00 0x00 0x00 0x01 0x00 0x00 
0x01 0x01 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 
0x00 0x00 0x00 0x00 </pre>
<!--mstheme--><font face="Arial, Arial, Helvetica"></code>
<p>3) &#1063;&#1090;&#1086;&#1073;&#1099;
&#1087;&#1086;&#1083;&#1091;&#1095;&#1080;&#1090;&#1100;
&#1084;&#1072;&#1089;&#1089;&#1080;&#1074; &#1080;&#1079; MIB_TCPROW_EX:
<p><code><!--mstheme--></font>
<pre>&#1087;&#1077;&#1088;&#1074;&#1099;&#1081; &#1074;&#1099;&#1079;&#1086;&#1074;:
0x00 0x04 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x02 0x00 0x00 0x00 0x01 0x00 0x00 
0x01 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 
0x00 0x00 0x00 0x00 

&#1074;&#1090;&#1086;&#1088;&#1086;&#1081; &#1074;&#1099;&#1079;&#1086;&#1074;:
0x00 0x04 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x02 0x00 0x00 0x00 0x01 0x00 0x00 
0x02 0x01 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 
0x00 0x00 0x00 0x00 </pre>
<!--mstheme--><font face="Arial, Arial, Helvetica"></code>
<p>4) &#1063;&#1090;&#1086;&#1073;&#1099;
&#1087;&#1086;&#1083;&#1091;&#1095;&#1080;&#1090;&#1100;
&#1084;&#1072;&#1089;&#1089;&#1080;&#1074; &#1080;&#1079; MIB_UDPROW_EX:
<p><code><!--mstheme--></font>
<pre>&#1055;&#1077;&#1088;&#1074;&#1099;&#1081; &#1074;&#1099;&#1079;&#1086;&#1074;:
0x01 0x04 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x02 0x00 0x00 0x00 0x01 0x00 0x00 
0x01 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 
0x00 0x00 0x00 0x00 

&#1042;&#1090;&#1086;&#1088;&#1086;&#1081; &#1074;&#1099;&#1079;&#1086;&#1074;:
0x01 0x04 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x02 0x00 0x00 0x00 0x01 0x00 0x00 
0x02 0x01 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 
0x00 0x00 0x00 0x00 </pre>
<!--mstheme--><font face="Arial, Arial, Helvetica"></code>
<p>&#1042;&#1099; &#1084;&#1086;&#1078;&#1077;&#1090;&#1077;
&#1079;&#1072;&#1084;&#1077;&#1090;&#1080;&#1090;&#1100;, &#1095;&#1090;&#1086;
&#1073;&#1091;&#1092;&#1077;&#1088;&#1099;
&#1088;&#1072;&#1079;&#1083;&#1080;&#1095;&#1072;&#1102;&#1090;&#1089;&#1103;
&#1090;&#1086;&#1083;&#1100;&#1082;&#1086; &#1074;
&#1085;&#1077;&#1089;&#1082;&#1086;&#1083;&#1100;&#1082;&#1080;&#1093;
&#1073;&#1072;&#1081;&#1090;&#1072;&#1093;. &#1052;&#1099;
&#1084;&#1086;&#1078;&#1077;&#1084;
&#1086;&#1073;&#1098;&#1103;&#1089;&#1085;&#1080;&#1090;&#1100;
&#1101;&#1090;&#1086;.
<p>&#1048;&#1085;&#1090;&#1077;&#1088;&#1077;&#1089;&#1091;&#1102;&#1097;&#1080;&#1077;
&#1085;&#1072;&#1089; &#1074;&#1099;&#1079;&#1086;&#1074;&#1099;
&#1080;&#1084;&#1077;&#1102;&#1090; &#1074; InputBuffer[1] 0x04 &#1080;, &#1074;
&#1086;&#1089;&#1085;&#1086;&#1074;&#1085;&#1086;&#1084;, InputBuffer[17]
&#1089;&#1086;&#1076;&#1077;&#1088;&#1078;&#1080;&#1090; 0x01.
&#1058;&#1086;&#1083;&#1100;&#1082;&#1086; &#1087;&#1088;&#1080;
&#1090;&#1072;&#1082;&#1080;&#1093;
&#1074;&#1093;&#1086;&#1076;&#1085;&#1099;&#1093;
&#1076;&#1072;&#1085;&#1085;&#1099;&#1093; &#1084;&#1099;
&#1087;&#1086;&#1083;&#1091;&#1095;&#1080;&#1084; &#1074; OutputBuffer
&#1085;&#1091;&#1078;&#1085;&#1099;&#1077;
&#1090;&#1072;&#1073;&#1083;&#1080;&#1094;&#1099;. &#1045;&#1089;&#1083;&#1080;
&#1084;&#1099; &#1093;&#1086;&#1090;&#1080;&#1084;
&#1087;&#1086;&#1083;&#1091;&#1095;&#1080;&#1090;&#1100;
&#1080;&#1085;&#1092;&#1086;&#1088;&#1084;&#1072;&#1094;&#1080;&#1102; &#1086;
TCP-&#1087;&#1086;&#1088;&#1090;&#1072;&#1093;,
&#1085;&#1091;&#1078;&#1085;&#1086;
&#1091;&#1089;&#1090;&#1072;&#1085;&#1086;&#1074;&#1080;&#1090;&#1100; &#1074;
InputBuffer[0] &#1079;&#1085;&#1072;&#1095;&#1077;&#1085;&#1080;&#1077; 0x00,
&#1080;&#1083;&#1080; 0x01 &#1076;&#1083;&#1103;
&#1087;&#1086;&#1083;&#1091;&#1095;&#1077;&#1085;&#1080;&#1103;
&#1080;&#1085;&#1092;&#1086;&#1088;&#1084;&#1072;&#1094;&#1080;&#1080; &#1086;
UDP-&#1087;&#1086;&#1088;&#1090;&#1072;&#1093;. &#1045;&#1089;&#1083;&#1080;
&#1085;&#1072;&#1084; &#1085;&#1091;&#1078;&#1085;&#1099; Ex-&#1090;&#1072;&#1073;&#1083;&#1080;&#1094;&#1099;
(MIB_TCPROW_EX &#1080;&#1083;&#1080; MIB_UDPROW_EX),
&#1085;&#1091;&#1078;&#1085;&#1086; &#1074;&#1086;
&#1074;&#1090;&#1086;&#1088;&#1086;&#1084;
&#1074;&#1099;&#1079;&#1086;&#1074;&#1077;
&#1091;&#1089;&#1090;&#1072;&#1085;&#1086;&#1074;&#1080;&#1090;&#1100; &#1074;
Inputbuffer[16] 0x02.
<p>&#1045;&#1089;&#1083;&#1080; &#1084;&#1099;
&#1087;&#1077;&#1088;&#1077;&#1093;&#1074;&#1072;&#1090;&#1080;&#1083;&#1080;
&#1074;&#1099;&#1079;&#1086;&#1074; &#1089; &#1101;&#1090;&#1080;&#1084;&#1080;
&#1087;&#1072;&#1088;&#1072;&#1084;&#1077;&#1090;&#1088;&#1072;&#1084;&#1080;,
&#1085;&#1091;&#1078;&#1085;&#1086; &#1087;&#1088;&#1086;&#1089;&#1090;&#1086;
&#1080;&#1079;&#1084;&#1077;&#1085;&#1080;&#1090;&#1100;
&#1074;&#1099;&#1093;&#1086;&#1076;&#1085;&#1086;&#1081;
&#1073;&#1091;&#1092;&#1077;&#1088;. &#1063;&#1090;&#1086;&#1073;&#1099;
&#1087;&#1086;&#1083;&#1091;&#1095;&#1080;&#1090;&#1100;
&#1082;&#1086;&#1083;&#1080;&#1095;&#1077;&#1089;&#1090;&#1074;&#1086;
&#1089;&#1090;&#1088;&#1086;&#1082; &#1074;
&#1074;&#1099;&#1093;&#1086;&#1076;&#1085;&#1086;&#1084;
&#1073;&#1091;&#1092;&#1077;&#1088;&#1077;,
&#1087;&#1088;&#1086;&#1089;&#1090;&#1086;
&#1088;&#1072;&#1079;&#1076;&#1077;&#1083;&#1080;&#1090;&#1077; Information
&#1080;&#1079; IoStatusBlock &#1085;&#1072;
&#1088;&#1072;&#1079;&#1084;&#1077;&#1088;
&#1089;&#1090;&#1088;&#1086;&#1082;&#1080;.
&#1057;&#1082;&#1088;&#1099;&#1090;&#1100; &#1086;&#1076;&#1085;&#1091;
&#1089;&#1090;&#1088;&#1086;&#1082;&#1091; &#1086;&#1095;&#1077;&#1085;&#1100;
&#1087;&#1088;&#1086;&#1089;&#1090;&#1086;.
&#1055;&#1088;&#1086;&#1089;&#1090;&#1086;
&#1087;&#1077;&#1088;&#1077;&#1079;&#1072;&#1087;&#1080;&#1096;&#1080;&#1090;&#1077;
&#1077;&#1077;
&#1087;&#1086;&#1089;&#1083;&#1077;&#1076;&#1091;&#1102;&#1097;&#1080;&#1084;&#1080;
&#1089;&#1090;&#1088;&#1086;&#1082;&#1072;&#1084;&#1080; &#1080;
&#1091;&#1076;&#1072;&#1083;&#1080;&#1090;&#1100;
&#1087;&#1086;&#1089;&#1083;&#1077;&#1076;&#1085;&#1102;&#1102;
&#1089;&#1090;&#1088;&#1086;&#1082;&#1091;. &#1053;&#1077;
&#1079;&#1072;&#1073;&#1091;&#1076;&#1100;&#1090;&#1077;
&#1080;&#1079;&#1084;&#1077;&#1085;&#1080;&#1090;&#1100; OutputBufferLength
&#1080; IoStatusBlock. <a name="10_2"></a>
<p align="center">=====[ 10.2 OpPorts &#1074; Win2k &#1080; NT4, FPort &#1074;
Win2k ]=====</p>
<p>&#1052;&#1099;
&#1080;&#1089;&#1087;&#1086;&#1083;&#1100;&#1079;&#1091;&#1077;&#1084;
NtDeviceIoControlFile &#1089; IoControlCode
&#1088;&#1072;&#1074;&#1085;&#1099;&#1084; 0x00210012,
&#1095;&#1090;&#1086;&#1073;&#1099;
&#1086;&#1087;&#1088;&#1077;&#1076;&#1077;&#1083;&#1080;&#1090;&#1100;,
&#1095;&#1090;&#1086; &#1093;&#1101;&#1085;&#1076;&#1083; &#1089;
&#1090;&#1080;&#1087;&#1086;&#1084; File &#1080;
&#1080;&#1084;&#1077;&#1085;&#1077;&#1084; \Device\Tcp &#1080;&#1083;&#1080;
\Device\Udp - &#1101;&#1090;&#1086; &#1093;&#1101;&#1085;&#1076;&#1083;
&#1086;&#1090;&#1082;&#1088;&#1099;&#1090;&#1086;&#1075;&#1086;
&#1087;&#1086;&#1088;&#1090;&#1072;.
<p>&#1042;&#1086;-&#1087;&#1077;&#1088;&#1074;&#1099;&#1093;, &#1084;&#1099;
&#1089;&#1088;&#1072;&#1074;&#1085;&#1080;&#1084; IoControlCode, &#1072;
&#1079;&#1072;&#1090;&#1077;&#1084; &#1090;&#1080;&#1087; &#1080;
&#1080;&#1084;&#1103; &#1093;&#1101;&#1085;&#1076;&#1083;&#1072;.
&#1045;&#1089;&#1083;&#1080; &#1086;&#1085; &#1085;&#1072;&#1089;
&#1074;&#1089;&#1077; &#1077;&#1097;&#1077;
&#1080;&#1085;&#1090;&#1077;&#1088;&#1077;&#1089;&#1091;&#1077;&#1090;,
&#1084;&#1099; &#1087;&#1088;&#1086;&#1074;&#1077;&#1088;&#1080;&#1084;
&#1076;&#1083;&#1080;&#1085;&#1091;
&#1074;&#1093;&#1086;&#1076;&#1085;&#1086;&#1075;&#1086;
&#1073;&#1091;&#1092;&#1077;&#1088;&#1072;,
&#1082;&#1086;&#1090;&#1086;&#1088;&#1099;&#1081;
&#1076;&#1086;&#1083;&#1078;&#1077;&#1085; &#1073;&#1099;&#1090;&#1100;
&#1088;&#1072;&#1074;&#1085;&#1099;&#1084; &#1076;&#1083;&#1080;&#1085;&#1077;
&#1089;&#1090;&#1088;&#1091;&#1082;&#1090;&#1091;&#1088;&#1099;
TDI_CONNECTION_IN. &#1045;&#1077; &#1076;&#1083;&#1080;&#1085;&#1072; 0x18.
&#1042;&#1099;&#1093;&#1086;&#1076;&#1085;&#1086;&#1081;
&#1073;&#1091;&#1092;&#1077;&#1088; - TDI_CONNETION_OUT.
<p><code><!--mstheme--></font>
<pre>        typedef struct _TDI_CONNETION_IN
        {
                ULONG UserDataLength,
                PVOID UserData,
                ULONG OptionsLength,
                PVOID Options,
                ULONG RemoteAddressLength,
                PVOID RemoteAddress
        } TDI_CONNETION_IN, *PTDI_CONNETION_IN;

        typedef struct _TDI_CONNETION_OUT
        {
                ULONG State,
                ULONG Event,
                ULONG TransmittedTsdus,
                ULONG ReceivedTsdus,
                ULONG TransmissionErrors,
                ULONG ReceiveErrors,
                LARGE_INTEGER Throughput
                LARGE_INTEGER Delay,
                ULONG SendBufferSize,
                ULONG ReceiveBufferSize,
                ULONG Unreliable,
                ULONG Unknown1[5],
                USHORT Unknown2
        } TDI_CONNETION_OUT, *PTDI_CONNETION_OUT;</pre>
<!--mstheme--><font face="Arial, Arial, Helvetica"></code>
<p>&#1050;&#1086;&#1085;&#1082;&#1088;&#1077;&#1090;&#1085;&#1072;&#1103;
&#1088;&#1077;&#1072;&#1083;&#1080;&#1079;&#1072;&#1094;&#1080;&#1103;,
&#1090;&#1086;&#1075;&#1086; &#1082;&#1072;&#1082;
&#1086;&#1087;&#1088;&#1077;&#1076;&#1077;&#1083;&#1080;&#1090;&#1100;
&#1090;&#1086;, &#1095;&#1090;&#1086; &#1093;&#1101;&#1085;&#1076;&#1083; -
&#1101;&#1090;&#1086; &#1093;&#1101;&#1085;&#1076;&#1083;
&#1086;&#1090;&#1082;&#1088;&#1099;&#1090;&#1086;&#1075;&#1086;
&#1087;&#1086;&#1088;&#1090;&#1072;,
&#1076;&#1086;&#1089;&#1090;&#1091;&#1087;&#1085;&#1072; &#1074;
&#1080;&#1089;&#1093;&#1086;&#1076;&#1085;&#1086;&#1084;
&#1082;&#1086;&#1076;&#1077; OpPorts &#1085;&#1072; &#1084;&#1086;&#1077;&#1084;
&#1089;&#1072;&#1081;&#1090;&#1077; <a href="http://rootkit.host.sk/">http://rootkit.host.sk/</a>.
&#1057;&#1077;&#1081;&#1095;&#1072;&#1089; &#1085;&#1072;&#1084;
&#1085;&#1077;&#1086;&#1073;&#1093;&#1086;&#1076;&#1080;&#1084;&#1086;
&#1089;&#1082;&#1088;&#1099;&#1090;&#1100;
&#1086;&#1087;&#1088;&#1077;&#1076;&#1077;&#1083;&#1077;&#1085;&#1085;&#1099;&#1077;
&#1087;&#1086;&#1088;&#1090;&#1099;. &#1052;&#1099; &#1091;&#1078;&#1077;
&#1087;&#1088;&#1086;&#1074;&#1077;&#1088;&#1080;&#1083;&#1080;
InputBufferLength &#1080; IoControlCode.
&#1058;&#1077;&#1087;&#1077;&#1088;&#1100; &#1084;&#1099;
&#1076;&#1086;&#1083;&#1078;&#1085;&#1099;
&#1087;&#1088;&#1086;&#1074;&#1077;&#1088;&#1080;&#1090;&#1100;
RemoteAddressLength - &#1076;&#1083;&#1103;
&#1086;&#1090;&#1082;&#1088;&#1099;&#1090;&#1086;&#1075;&#1086;
&#1087;&#1086;&#1088;&#1090;&#1072; &#1074;&#1089;&#1077;&#1075;&#1076;&#1072; 3
&#1080;&#1083;&#1080; 4. &#1053;&#1072;&#1082;&#1086;&#1085;&#1077;&#1094;,
&#1084;&#1099; &#1076;&#1086;&#1083;&#1078;&#1085;&#1099;
&#1089;&#1088;&#1072;&#1074;&#1085;&#1080;&#1090;&#1100;
&#1087;&#1086;&#1083;&#1077; ReceivedTsdus &#1080;&#1079; OutputBuffer,
&#1082;&#1086;&#1090;&#1086;&#1088;&#1086;&#1077;
&#1089;&#1086;&#1076;&#1077;&#1088;&#1078;&#1080;&#1090;
&#1087;&#1086;&#1088;&#1090; &#1074;
&#1089;&#1077;&#1090;&#1077;&#1074;&#1086;&#1081;
&#1092;&#1086;&#1088;&#1084;&#1077;, &#1089;&#1086;
&#1089;&#1087;&#1080;&#1089;&#1082;&#1086;&#1084;
&#1087;&#1086;&#1088;&#1090;&#1086;&#1074;,
&#1082;&#1086;&#1090;&#1086;&#1088;&#1099;&#1077; &#1084;&#1099;
&#1093;&#1086;&#1090;&#1080;&#1084; &#1089;&#1082;&#1088;&#1099;&#1090;&#1100;.
&#1052;&#1099; &#1084;&#1086;&#1078;&#1077;&#1084;
&#1088;&#1072;&#1079;&#1083;&#1080;&#1095;&#1072;&#1090;&#1100; TCP &#1080; UDP
&#1074;
&#1089;&#1086;&#1086;&#1090;&#1074;&#1077;&#1090;&#1089;&#1090;&#1074;&#1080;&#1080;
&#1089; &#1080;&#1084;&#1077;&#1085;&#1077;&#1084;
&#1093;&#1101;&#1085;&#1076;&#1083;&#1072;.
&#1059;&#1076;&#1072;&#1083;&#1080;&#1074; OutputBuffer,
&#1080;&#1079;&#1084;&#1077;&#1085;&#1080;&#1074; IoStatusBlock &#1080;
&#1074;&#1077;&#1088;&#1085;&#1091;&#1074;
&#1079;&#1085;&#1072;&#1095;&#1077;&#1085;&#1080;&#1077; STATUS_INVALID_ADDRESS,
&#1084;&#1099; &#1089;&#1082;&#1088;&#1086;&#1077;&#1084;
&#1087;&#1086;&#1088;&#1090;. <a name="11"></a>
<p align="center">=====[ 11.
&#1054;&#1082;&#1086;&#1085;&#1095;&#1072;&#1085;&#1080;&#1077; ]=====</p>
<p>&#1050;&#1086;&#1085;&#1082;&#1088;&#1077;&#1090;&#1085;&#1072;&#1103;
&#1088;&#1077;&#1072;&#1083;&#1080;&#1079;&#1072;&#1094;&#1080;&#1103;
&#1086;&#1087;&#1080;&#1089;&#1072;&#1085;&#1085;&#1099;&#1093;
&#1090;&#1077;&#1093;&#1085;&#1080;&#1082;
&#1076;&#1086;&#1089;&#1090;&#1091;&#1087;&#1085;&#1072; &#1074;
&#1080;&#1089;&#1093;&#1086;&#1076;&#1085;&#1086;&#1084;
&#1082;&#1086;&#1076;&#1077; Hacker Defender Rootkit
&#1074;&#1077;&#1088;&#1089;&#1080;&#1080; 1.0.0 &#1085;&#1072;
&#1089;&#1072;&#1081;&#1090;&#1077; <a href="http://rootkit.host.sk/">http://rootkit.host.sk/</a>
&#1080; &#1085;&#1072; <a href="http://www.rootkit.com/">http://www.rootkit.com/</a>.
<p>&#1042;&#1086;&#1079;&#1084;&#1086;&#1078;&#1085;&#1086;, &#1103;
&#1076;&#1086;&#1073;&#1072;&#1074;&#1083;&#1102;
&#1080;&#1085;&#1092;&#1086;&#1088;&#1084;&#1072;&#1094;&#1080;&#1102; &#1086;
&#1085;&#1077;&#1074;&#1080;&#1076;&#1080;&#1084;&#1086;&#1089;&#1090;&#1080;
&#1074; Windows NT &#1074; &#1073;&#1091;&#1076;&#1091;&#1097;&#1077;&#1084;.
&#1053;&#1086;&#1074;&#1099;&#1077; &#1074;&#1077;&#1088;&#1089;&#1080;&#1080;
&#1076;&#1086;&#1082;&#1091;&#1084;&#1077;&#1085;&#1090;&#1072;
&#1090;&#1072;&#1082;&#1078;&#1077; &#1073;&#1091;&#1076;&#1091;&#1090;
&#1089;&#1086;&#1076;&#1077;&#1088;&#1078;&#1072;&#1090;&#1100;
&#1091;&#1083;&#1091;&#1095;&#1096;&#1077;&#1085;&#1080;&#1103;
&#1086;&#1087;&#1080;&#1089;&#1072;&#1085;&#1099;&#1093;
&#1084;&#1077;&#1090;&#1086;&#1076;&#1086;&#1074; &#1080;
&#1085;&#1086;&#1074;&#1099;&#1077;
&#1082;&#1086;&#1084;&#1084;&#1077;&#1085;&#1090;&#1072;&#1088;&#1080;&#1080;.
<p>&#1054;&#1090;&#1076;&#1077;&#1083;&#1100;&#1085;&#1086;&#1077;
&#1089;&#1087;&#1072;&#1089;&#1080;&#1073;&#1086; Ratter'&#1091;,
&#1082;&#1086;&#1090;&#1086;&#1088;&#1099;&#1081; &#1076;&#1072;&#1083;
&#1084;&#1085;&#1077; &#1084;&#1085;&#1086;&#1075;&#1086; &#1085;&#1086;&#1091;-&#1093;&#1072;&#1091;,
&#1082;&#1086;&#1090;&#1086;&#1088;&#1099;&#1077; &#1073;&#1099;&#1083;&#1080;
&#1085;&#1077;&#1086;&#1073;&#1093;&#1086;&#1076;&#1080;&#1084;&#1099;
&#1076;&#1083;&#1103;
&#1085;&#1072;&#1087;&#1080;&#1089;&#1072;&#1085;&#1080;&#1103;
&#1101;&#1090;&#1086;&#1081; &#1089;&#1090;&#1072;&#1090;&#1100;&#1080; &#1080;
&#1082;&#1086;&#1076;&#1072; &#1087;&#1088;&#1086;&#1077;&#1082;&#1090;&#1072;
Hacker Defender. &#1042;&#1089;&#1077;
&#1082;&#1086;&#1084;&#1084;&#1077;&#1085;&#1090;&#1072;&#1088;&#1080;&#1080;
&#1087;&#1088;&#1080;&#1089;&#1099;&#1083;&#1072;&#1077;&#1090;&#1077;
&#1085;&#1072; <a href="mailto:holy_father@phreader.net">mailto:holy_father@phreader.net</a>
&#1080;&#1083;&#1080; &#1085;&#1072; &#1076;&#1086;&#1089;&#1082;&#1091;
&#1085;&#1072; &#1089;&#1072;&#1081;&#1090;&#1077; <a href="http://rootkit.host.sk/">http://rootkit.host.sk/</a>.
<p>&nbsp; [C] Holy_Father, &#1087;&#1077;&#1088;. Kerk</p>
<!--mstheme--></font>

</body>

</html>
