<html>

<head>
<meta http-equiv="Content-Type" content="text/html; charset=windows-1252">
<meta name="GENERATOR" content="Microsoft FrontPage 4.0">
<meta name="ProgId" content="FrontPage.Editor.Document">
<title>New Page 1</title>
<meta name="Microsoft Theme" content="zero 011">
</head>

<body background="zertxtr.gif" bgcolor="#000000" text="#FFFFFF" link="#6699CC" vlink="#669966" alink="#999999">

<!--mstheme--><font face="Arial, Arial, Helvetica"><!--mstheme--></font>
<h3 align="center"><!--mstheme--><font face="Arial, Arial, Helvetica" color="#CCCCCC"><b><font size="5" color="#00FF00">&#1044;&#1088;&#1072;&#1081;&#1074;&#1077;&#1088;&#1099;
&#1088;&#1077;&#1078;&#1080;&#1084;&#1072; &#1103;&#1076;&#1088;&#1072;:
&#1063;&#1072;&#1089;&#1090;&#1100; 13:
&#1041;&#1072;&#1079;&#1086;&#1074;&#1072;&#1103;
&#1090;&#1077;&#1093;&#1085;&#1080;&#1082;&#1072;.
&#1057;&#1080;&#1085;&#1093;&#1088;&#1086;&#1085;&#1080;&#1079;&#1072;&#1094;&#1080;&#1103;:
&#1042;&#1079;&#1072;&#1080;&#1084;&#1086;&#1080;&#1089;&#1082;&#1083;&#1102;&#1095;&#1072;&#1102;&#1097;&#1080;&#1081;
&#1076;&#1086;&#1089;&#1090;&#1091;&#1087;</font></b><!--mstheme--></font></h3>
<!--mstheme--><font face="Arial, Arial, Helvetica"><br>
<p>&#1042; &#1087;&#1088;&#1086;&#1096;&#1083;&#1086;&#1081;
&#1089;&#1090;&#1072;&#1090;&#1100;&#1077; &#1084;&#1099;
&#1080;&#1089;&#1087;&#1086;&#1083;&#1100;&#1079;&#1086;&#1074;&#1072;&#1083;&#1080;
&#1089;&#1080;&#1085;&#1093;&#1088;&#1086;&#1085;&#1080;&#1079;&#1072;&#1094;&#1080;&#1102;
&#1076;&#1083;&#1103; &#1086;&#1078;&#1080;&#1076;&#1072;&#1085;&#1080;&#1103;
&#1089;&#1088;&#1072;&#1073;&#1072;&#1090;&#1099;&#1074;&#1072;&#1085;&#1080;&#1103;
&#1090;&#1072;&#1081;&#1084;&#1077;&#1088;&#1072; &#1080;
&#1086;&#1078;&#1080;&#1076;&#1072;&#1085;&#1080;&#1103;
&#1086;&#1082;&#1086;&#1085;&#1095;&#1072;&#1085;&#1080;&#1103;
&#1088;&#1072;&#1073;&#1086;&#1090;&#1099;
&#1087;&#1086;&#1090;&#1086;&#1082;&#1072;.
&#1044;&#1088;&#1091;&#1075;&#1086;&#1081; &#1095;&#1072;&#1089;&#1090;&#1086;
&#1074;&#1089;&#1090;&#1088;&#1077;&#1095;&#1072;&#1102;&#1097;&#1077;&#1081;&#1089;&#1103;
&#1079;&#1072;&#1076;&#1072;&#1095;&#1077;&#1081;,
&#1082;&#1086;&#1090;&#1086;&#1088;&#1091;&#1102;
&#1088;&#1077;&#1096;&#1072;&#1077;&#1090;
&#1089;&#1080;&#1085;&#1093;&#1088;&#1086;&#1085;&#1080;&#1079;&#1072;&#1094;&#1080;&#1103;,
&#1103;&#1074;&#1083;&#1103;&#1077;&#1090;&#1089;&#1103;
&#1079;&#1072;&#1076;&#1072;&#1095;&#1072;
&#1084;&#1086;&#1085;&#1086;&#1087;&#1086;&#1083;&#1100;&#1085;&#1086;&#1075;&#1086;
&#1076;&#1086;&#1089;&#1090;&#1091;&#1087;&#1072; &#1082;
&#1076;&#1072;&#1085;&#1085;&#1099;&#1084;.</p>
<p>&#1042; &#1087;&#1088;&#1080;&#1084;&#1077;&#1088;&#1077;,
&#1082;&#1086;&#1090;&#1086;&#1088;&#1099;&#1081; &#1084;&#1099;
&#1088;&#1072;&#1089;&#1089;&#1084;&#1086;&#1090;&#1088;&#1080;&#1084; &#1074;
&#1101;&#1090;&#1086;&#1090; &#1088;&#1072;&#1079;,
&#1089;&#1086;&#1079;&#1076;&#1072;&#1077;&#1090;&#1089;&#1103;
&#1091;&#1078;&#1077; &#1085;&#1077; &#1086;&#1076;&#1080;&#1085;, &#1072;
&#1085;&#1077;&#1089;&#1082;&#1086;&#1083;&#1100;&#1082;&#1086;
&#1087;&#1086;&#1090;&#1086;&#1082;&#1086;&#1074;. &#1042;&#1089;&#1077;
&#1087;&#1086;&#1090;&#1086;&#1082;&#1080;
&#1088;&#1072;&#1073;&#1086;&#1090;&#1072;&#1102;&#1090; &#1089;
&#1086;&#1076;&#1085;&#1080;&#1084; &#1080; &#1090;&#1077;&#1084; &#1078;&#1077;
&#1088;&#1077;&#1089;&#1091;&#1088;&#1089;&#1086;&#1084;,
&#1082;&#1086;&#1090;&#1086;&#1088;&#1099;&#1084;
&#1103;&#1074;&#1083;&#1103;&#1077;&#1090;&#1089;&#1103;
&#1087;&#1077;&#1088;&#1077;&#1084;&#1077;&#1085;&#1085;&#1072;&#1103;
&#1088;&#1072;&#1079;&#1084;&#1077;&#1088;&#1086;&#1084; DWORD. &#1042;
&#1079;&#1072;&#1076;&#1072;&#1095;&#1091;
&#1082;&#1072;&#1078;&#1076;&#1086;&#1075;&#1086;
&#1087;&#1086;&#1090;&#1086;&#1082;&#1072;
&#1074;&#1093;&#1086;&#1076;&#1080;&#1090;
&#1085;&#1077;&#1089;&#1082;&#1086;&#1083;&#1100;&#1082;&#1086;
&#1088;&#1072;&#1079;
&#1091;&#1074;&#1077;&#1083;&#1080;&#1095;&#1080;&#1090;&#1100;
&#1079;&#1085;&#1072;&#1095;&#1077;&#1085;&#1080;&#1077;
&#1101;&#1090;&#1086;&#1081;
&#1087;&#1077;&#1088;&#1077;&#1084;&#1077;&#1085;&#1085;&#1086;&#1081;
&#1085;&#1072; &#1077;&#1076;&#1080;&#1085;&#1080;&#1094;&#1091;. &#1055;&#1086;
&#1086;&#1082;&#1086;&#1085;&#1095;&#1072;&#1085;&#1080;&#1080;
&#1088;&#1072;&#1073;&#1086;&#1090;
&#1079;&#1085;&#1072;&#1095;&#1077;&#1085;&#1080;&#1077;
&#1087;&#1077;&#1088;&#1077;&#1084;&#1077;&#1085;&#1086;&#1081;
&#1076;&#1086;&#1083;&#1078;&#1085;&#1086; &#1073;&#1099;&#1090;&#1100;
&#1088;&#1072;&#1074;&#1085;&#1086;
&#1087;&#1088;&#1086;&#1080;&#1079;&#1074;&#1077;&#1076;&#1077;&#1085;&#1080;&#1102;
&#1082;&#1086;&#1083;&#1080;&#1095;&#1077;&#1089;&#1090;&#1074;&#1072;
&#1087;&#1086;&#1090;&#1086;&#1082;&#1086;&#1074; &#1085;&#1072;
&#1082;&#1086;&#1083;&#1080;&#1095;&#1077;&#1089;&#1090;&#1074;&#1086;
&#1087;&#1088;&#1086;&#1093;&#1086;&#1076;&#1086;&#1074;.</p>
<p>&#1055;&#1077;&#1088;&#1077;&#1084;&#1077;&#1085;&#1085;&#1072;&#1103;,
&#1079;&#1085;&#1072;&#1095;&#1077;&#1085;&#1080;&#1077;
&#1082;&#1086;&#1090;&#1086;&#1088;&#1086;&#1081;
&#1091;&#1074;&#1077;&#1083;&#1080;&#1095;&#1080;&#1074;&#1072;&#1102;&#1090;
&#1087;&#1086;&#1090;&#1086;&#1082;&#1080;,
&#1103;&#1074;&#1083;&#1103;&#1077;&#1090;&#1089;&#1103;
&#1087;&#1088;&#1086;&#1090;&#1086;&#1090;&#1080;&#1087;&#1086;&#1084;
&#1082;&#1072;&#1082;&#1080;&#1093;-&#1083;&#1080;&#1073;&#1086;
&#1076;&#1072;&#1085;&#1085;&#1099;&#1093;,
&#1085;&#1072;&#1087;&#1088;&#1080;&#1084;&#1077;&#1088;,
&#1089;&#1090;&#1072;&#1090;&#1080;&#1089;&#1090;&#1080;&#1095;&#1077;&#1089;&#1082;&#1080;&#1093;
&#1076;&#1072;&#1085;&#1085;&#1099;&#1093; &#1086; &#1082;&#1086;&#1083;-&#1074;&#1077;
&#1087;&#1077;&#1088;&#1077;&#1093;&#1074;&#1072;&#1090;&#1086;&#1074;
&#1086;&#1076;&#1085;&#1086;&#1075;&#1086; &#1080;&#1079;
&#1089;&#1080;&#1089;&#1090;&#1077;&#1084;&#1085;&#1099;&#1093;
&#1089;&#1077;&#1088;&#1074;&#1080;&#1089;&#1086;&#1074; (&#1101;&#1090;&#1080;&#1084;
&#1084;&#1099; &#1079;&#1072;&#1081;&#1084;&#1077;&#1084;&#1089;&#1103; &#1074;
&#1086;&#1076;&#1085;&#1086;&#1081; &#1080;&#1079;
&#1089;&#1083;&#1077;&#1076;&#1091;&#1102;&#1097;&#1080;&#1093;
&#1089;&#1090;&#1072;&#1090;&#1077;&#1081;). &#1045;&#1089;&#1083;&#1080;
&#1088;&#1072;&#1073;&#1086;&#1090;&#1091;
&#1087;&#1086;&#1090;&#1086;&#1082;&#1086;&#1074; &#1085;&#1077;
&#1089;&#1080;&#1085;&#1093;&#1088;&#1086;&#1085;&#1080;&#1079;&#1080;&#1088;&#1086;&#1074;&#1072;&#1090;&#1100;,
&#1090;&#1086; &#1086;&#1085;&#1080; &#1073;&#1091;&#1076;&#1091;&#1090;
&#1086;&#1073;&#1088;&#1072;&#1097;&#1072;&#1090;&#1100;&#1089;&#1103; &#1082;
&#1088;&#1072;&#1079;&#1076;&#1077;&#1083;&#1103;&#1077;&#1084;&#1099;&#1084;
&#1076;&#1072;&#1085;&#1085;&#1099;&#1084; &#1074;
&#1085;&#1077;&#1087;&#1088;&#1077;&#1076;&#1089;&#1082;&#1072;&#1079;&#1091;&#1077;&#1084;&#1086;&#1084;
&#1087;&#1086;&#1088;&#1103;&#1076;&#1082;&#1077;, &#1095;&#1090;&#1086;
&#1085;&#1077;&#1080;&#1079;&#1073;&#1077;&#1078;&#1085;&#1086;
&#1087;&#1088;&#1080;&#1074;&#1077;&#1076;&#1077;&#1090; &#1082;
&#1090;&#1086;&#1084;&#1091;, &#1095;&#1090;&#1086;
&#1074;&#1084;&#1077;&#1089;&#1090;&#1086;
&#1089;&#1090;&#1072;&#1090;&#1080;&#1089;&#1090;&#1080;&#1095;&#1077;&#1089;&#1082;&#1080;&#1093;
&#1076;&#1072;&#1085;&#1085;&#1099;&#1093; &#1084;&#1099;, &#1074;
&#1083;&#1091;&#1095;&#1096;&#1077;&#1084;
&#1089;&#1083;&#1091;&#1095;&#1072;&#1077;,
&#1087;&#1086;&#1083;&#1091;&#1095;&#1080;&#1084;
&#1084;&#1091;&#1089;&#1086;&#1088;, &#1072; &#1074;
&#1093;&#1091;&#1076;&#1096;&#1077;&#1084;
&#1076;&#1088;&#1072;&#1081;&#1074;&#1077;&#1088;
&#1089;&#1090;&#1072;&#1085;&#1077;&#1090;
&#1087;&#1088;&#1080;&#1095;&#1080;&#1085;&#1086;&#1081;
&#1082;&#1088;&#1072;&#1093;&#1072;
&#1089;&#1080;&#1089;&#1090;&#1077;&#1084;&#1099;.</p>
<p>&#1042; &#1076;&#1072;&#1085;&#1085;&#1086;&#1084;
&#1089;&#1083;&#1091;&#1095;&#1072;&#1077; &#1076;&#1083;&#1103;
&#1089;&#1080;&#1085;&#1093;&#1088;&#1086;&#1085;&#1080;&#1079;&#1072;&#1094;&#1080;&#1080;
&#1087;&#1086;&#1090;&#1086;&#1082;&#1086;&#1074; &#1082;&#1072;&#1082;
&#1085;&#1077;&#1083;&#1100;&#1079;&#1103; &#1083;&#1091;&#1095;&#1096;&#1077;
&#1087;&#1086;&#1076;&#1093;&#1086;&#1076;&#1080;&#1090;
&#1086;&#1073;&#1098;&#1077;&#1082;&#1090;
&#1089;&#1080;&#1085;&#1093;&#1088;&#1086;&#1085;&#1080;&#1079;&#1072;&#1094;&#1080;&#1080;
<font color="#636363"><b><i>&#1084;&#1100;&#1102;&#1090;&#1077;&#1082;&#1089;</i></b></font>
(mutex). &#1042; &#1103;&#1076;&#1088;&#1077; &#1086;&#1085;
&#1090;&#1072;&#1082;&#1078;&#1077; &#1085;&#1086;&#1089;&#1080;&#1090;
&#1085;&#1072;&#1079;&#1074;&#1072;&#1085;&#1080;&#1077; <font color="#636363"><b><i>&#1084;&#1091;&#1090;&#1072;&#1085;&#1090;</i></b></font>
(mutant). &#1058;&#1077;&#1088;&#1084;&#1080;&#1085; mutex
&#1087;&#1088;&#1086;&#1080;&#1089;&#1093;&#1086;&#1076;&#1080;&#1090;
&#1086;&#1090; &#1089;&#1083;&#1086;&#1074; &quot;mutual exclusion&quot;,
&#1095;&#1090;&#1086; &#1086;&#1079;&#1085;&#1072;&#1095;&#1072;&#1077;&#1090;
&quot;&#1074;&#1079;&#1072;&#1080;&#1084;&#1086;&#1080;&#1089;&#1082;&#1083;&#1102;&#1095;&#1072;&#1102;&#1097;&#1080;&#1081;
&#1076;&#1086;&#1089;&#1090;&#1091;&#1087;&quot;.</p>
<p>&#1055;&#1077;&#1088;&#1077;&#1076; &#1090;&#1077;&#1084;
&#1082;&#1072;&#1082; &#1085;&#1072;&#1095;&#1072;&#1090;&#1100;
&#1088;&#1072;&#1073;&#1086;&#1090;&#1091; &#1089;
&#1088;&#1072;&#1079;&#1076;&#1077;&#1083;&#1103;&#1077;&#1084;&#1099;&#1084;
&#1088;&#1077;&#1089;&#1091;&#1088;&#1089;&#1086;&#1084;
&#1087;&#1086;&#1090;&#1086;&#1082; &#1076;&#1086;&#1083;&#1078;&#1077;&#1085;
&#1079;&#1072;&#1093;&#1074;&#1072;&#1090;&#1080;&#1090;&#1100;
&#1084;&#1100;&#1102;&#1090;&#1077;&#1082;&#1089;.
&#1045;&#1076;&#1080;&#1085;&#1086;&#1074;&#1088;&#1077;&#1084;&#1077;&#1085;&#1085;&#1086;
&#1074;&#1083;&#1072;&#1076;&#1077;&#1090;&#1100;
&#1084;&#1100;&#1102;&#1090;&#1077;&#1082;&#1089;&#1086;&#1084;
&#1084;&#1086;&#1078;&#1077;&#1090; &#1090;&#1086;&#1083;&#1100;&#1082;&#1086;
&#1086;&#1076;&#1080;&#1085; &#1087;&#1086;&#1090;&#1086;&#1082;.
&#1055;&#1086;&#1101;&#1090;&#1086;&#1084;&#1091;, &#1077;&#1089;&#1083;&#1080;
&#1087;&#1086;&#1090;&#1086;&#1082;&#1091;
&#1091;&#1076;&#1072;&#1077;&#1090;&#1089;&#1103;
&#1079;&#1072;&#1093;&#1074;&#1072;&#1090;&#1080;&#1090;&#1100;
&#1084;&#1100;&#1102;&#1090;&#1077;&#1082;&#1089;, &#1101;&#1090;&#1086;
&#1086;&#1079;&#1085;&#1072;&#1095;&#1072;&#1077;&#1090;, &#1095;&#1090;&#1086;
&#1084;&#1100;&#1102;&#1090;&#1077;&#1082;&#1089; &#1073;&#1099;&#1083;
&#1089;&#1074;&#1086;&#1073;&#1086;&#1076;&#1077;&#1085;.
&#1045;&#1089;&#1083;&#1080; &#1084;&#1100;&#1102;&#1090;&#1077;&#1082;&#1089;
&#1079;&#1072;&#1085;&#1103;&#1090;,
&#1089;&#1080;&#1089;&#1090;&#1077;&#1084;&#1072;
&#1087;&#1077;&#1088;&#1077;&#1074;&#1086;&#1076;&#1080;&#1090;
&#1087;&#1086;&#1090;&#1086;&#1082; &#1074; &#1088;&#1077;&#1078;&#1080;&#1084;
&#1086;&#1078;&#1080;&#1076;&#1072;&#1085;&#1080;&#1103; &#1076;&#1086;
&#1090;&#1077;&#1093; &#1087;&#1086;&#1088;, &#1087;&#1086;&#1082;&#1072;
&#1084;&#1100;&#1102;&#1090;&#1077;&#1082;&#1089; &#1085;&#1077;
&#1086;&#1089;&#1074;&#1086;&#1073;&#1086;&#1076;&#1080;&#1090;&#1089;&#1103;.
&#1047;&#1072;&#1093;&#1074;&#1072;&#1090;&#1080;&#1074;
&#1084;&#1100;&#1102;&#1090;&#1077;&#1082;&#1089;,
&#1087;&#1086;&#1090;&#1086;&#1082;
&#1085;&#1072;&#1095;&#1080;&#1085;&#1072;&#1077;&#1090;
&#1088;&#1072;&#1073;&#1086;&#1090;&#1072;&#1090;&#1100; &#1089;
&#1088;&#1077;&#1089;&#1091;&#1088;&#1089;&#1086;&#1084;,
&#1080;&#1084;&#1077;&#1103;
&#1075;&#1072;&#1088;&#1072;&#1085;&#1090;&#1080;&#1102; &#1085;&#1072;
&#1090;&#1086;, &#1095;&#1090;&#1086;,
&#1089;&#1082;&#1086;&#1083;&#1100;&#1082;&#1086; &#1073;&#1099;
&#1087;&#1086;&#1090;&#1086;&#1082;&#1086;&#1074; &#1085;&#1077;
&#1087;&#1099;&#1090;&#1072;&#1083;&#1086;&#1089;&#1100;
&#1079;&#1072;&#1093;&#1074;&#1072;&#1090;&#1080;&#1090;&#1100;
&#1090;&#1086;&#1090; &#1078;&#1077; &#1089;&#1072;&#1084;&#1099;&#1081;
&#1084;&#1100;&#1102;&#1090;&#1077;&#1082;&#1089;, &#1074;&#1089;&#1077;
&#1086;&#1085;&#1080; &#1073;&#1091;&#1076;&#1091;&#1090;
&#1078;&#1076;&#1072;&#1090;&#1100; &#1077;&#1075;&#1086;
&#1086;&#1089;&#1074;&#1086;&#1073;&#1086;&#1078;&#1076;&#1077;&#1085;&#1080;&#1103;.
&#1047;&#1072;&#1082;&#1086;&#1085;&#1095;&#1080;&#1074;
&#1088;&#1072;&#1073;&#1086;&#1090;&#1091; &#1089;
&#1088;&#1077;&#1089;&#1091;&#1088;&#1089;&#1086;&#1084;,
&#1087;&#1086;&#1090;&#1086;&#1082;
&#1086;&#1089;&#1074;&#1086;&#1073;&#1086;&#1078;&#1076;&#1072;&#1077;&#1090;
&#1084;&#1100;&#1102;&#1090;&#1077;&#1082;&#1089;. &#1044;&#1072;&#1078;&#1077;
&#1077;&#1089;&#1083;&#1080; &#1074; &#1101;&#1090;&#1086;&#1090;
&#1084;&#1086;&#1084;&#1077;&#1085;&#1090;
&#1084;&#1100;&#1102;&#1090;&#1077;&#1082;&#1089;
&#1086;&#1078;&#1080;&#1076;&#1072;&#1077;&#1090;
&#1085;&#1077;&#1089;&#1082;&#1086;&#1083;&#1100;&#1082;&#1086;
&#1087;&#1086;&#1090;&#1086;&#1082;&#1086;&#1074;,
&#1079;&#1072;&#1093;&#1074;&#1072;&#1090;&#1080;&#1090;&#1100;
&#1077;&#1075;&#1086; &#1089;&#1084;&#1086;&#1078;&#1077;&#1090;
&#1090;&#1086;&#1083;&#1100;&#1082;&#1086; &#1086;&#1076;&#1080;&#1085;
&#1087;&#1086;&#1090;&#1086;&#1082; (&#1082;&#1072;&#1082;&#1086;&#1081;
&#1080;&#1084;&#1077;&#1085;&#1085;&#1086; -
&#1088;&#1077;&#1096;&#1072;&#1077;&#1090;
&#1087;&#1083;&#1072;&#1085;&#1080;&#1088;&#1086;&#1074;&#1097;&#1080;&#1082;).
&#1058;&#1072;&#1082;&#1080;&#1084;
&#1086;&#1073;&#1088;&#1072;&#1079;&#1086;&#1084;,
&#1084;&#1100;&#1102;&#1090;&#1077;&#1082;&#1089;
&#1075;&#1072;&#1088;&#1072;&#1085;&#1090;&#1080;&#1088;&#1091;&#1077;&#1090;,
&#1095;&#1090;&#1086; &#1090;&#1086;&#1083;&#1100;&#1082;&#1086;
&#1086;&#1076;&#1080;&#1085; &#1087;&#1086;&#1090;&#1086;&#1082;
&#1087;&#1086;&#1083;&#1091;&#1095;&#1072;&#1077;&#1090;
&#1084;&#1086;&#1085;&#1086;&#1087;&#1086;&#1083;&#1100;&#1085;&#1099;&#1081;
&#1076;&#1086;&#1089;&#1090;&#1091;&#1087; &#1082;
&#1088;&#1077;&#1089;&#1091;&#1088;&#1089;&#1091;.</p>
<br>
<br>
<p>&nbsp;<!--mstheme--></font>
<h2><!--mstheme--><font face="Arial, Arial, Helvetica" color="#CCCCCC">13.1
&#1048;&#1089;&#1093;&#1086;&#1076;&#1085;&#1099;&#1081;
&#1090;&#1077;&#1082;&#1089;&#1090;
&#1076;&#1088;&#1072;&#1081;&#1074;&#1077;&#1088;&#1072; MutualExclusion<!--mstheme--></font></h2>
<!--mstheme--><font face="Arial, Arial, Helvetica">
<p>&nbsp;</p>
<code><!--mstheme--></font>
<pre><font size="2"><b> ;@echo off
 ;goto make

 ;:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
 ;
 ;  MutualExclusion - &#1042;&#1079;&#1072;&#1080;&#1084;&#1086;&#1080;&#1089;&#1082;&#1083;&#1102;&#1095;&#1072;&#1102;&#1097;&#1080;&#1081; &#1076;&#1086;&#1089;&#1090;&#1091;&#1087; &#1082; &#1088;&#1072;&#1079;&#1076;&#1077;&#1083;&#1103;&#1077;&#1084;&#1086;&#1084;&#1091; &#1088;&#1077;&#1089;&#1091;&#1088;&#1089;&#1091;
 ;
 ;:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::

 .386
 .model flat, stdcall
 option casemap:none

 ;:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
 ;                               &#1042; &#1050; &#1051; &#1070; &#1063; &#1040; &#1045; &#1052; &#1067; &#1045;    &#1060; &#1040; &#1049; &#1051; &#1067;
 ;:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::

 include \masm32\include\w2k\ntstatus.inc
 include \masm32\include\w2k\ntddk.inc
 include \masm32\include\w2k\ntoskrnl.inc

 includelib \masm32\lib\w2k\ntoskrnl.lib

 include \masm32\Macros\Strings.mac

 NUM_THREADS equ 5       ; &#1085;&#1077; &#1076;&#1086;&#1083;&#1078;&#1085;&#1086; &#1073;&#1099;&#1090;&#1100; &#1073;&#1086;&#1083;&#1100;&#1096;&#1077; &#1095;&#1077;&#1084; MAXIMUM_WAIT_OBJECTS (64)
 NUM_WORKS   equ 10

 ;:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
 ;                                       &#1052; &#1040; &#1050; &#1056; &#1054; &#1057; &#1067;                                               
 ;:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::

 include Mutex.mac

 ;:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
 ;                             &#1053; &#1045; &#1048; &#1047; &#1052; &#1045; &#1053; &#1071; &#1045; &#1052; &#1067; &#1045;    &#1044; &#1040; &#1053; &#1053; &#1067; &#1045;                                
 ;:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::

 .const

 CCOUNTED_UNICODE_STRING &quot;\\Device\\MutualExclusion&quot;, g_usDeviceName, 4
 CCOUNTED_UNICODE_STRING &quot;\\DosDevices\\MutualExclusion&quot;, g_usSymbolicLinkName, 4

 ;:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
 ;                     &#1053; &#1045; &#1048; &#1053; &#1048; &#1062; &#1048; &#1040; &#1051; &#1048; &#1047; &#1048; &#1056; &#1054; &#1042; &#1040; &#1053; &#1053; &#1067; &#1045;    &#1044; &#1040; &#1053; &#1053; &#1067; &#1045;                                
 ;:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::

 .data?

 g_pkWaitBlock       PKWAIT_BLOCK    ?
 g_apkThreads        DWORD NUM_THREADS dup(?)    ; &#1052;&#1072;&#1089;&#1089;&#1080;&#1074; &#1091;&#1082;&#1072;&#1079;&#1072;&#1090;&#1077;&#1083;&#1077;&#1081; &#1085;&#1072; KTHREAD
 g_dwCountThreads    DWORD   ?
 g_kMutex            KMUTEX  &lt;&gt;
 g_dwWorkElement     DWORD   ?

 ;:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
 ;                                           &#1050; &#1054; &#1044;                                                   
 ;:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::

 .code

 ;:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
 ;                                        ThreadProc                                                 
 ;:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::

 ThreadProc proc uses ebx Param:DWORD

 local liDelayTime:LARGE_INTEGER
 local pkThread:DWORD     ; PKTHREAD
 local dwWorkElement:DWORD

     invoke PsGetCurrentThread
     mov pkThread, eax
     invoke DbgPrint, $CTA0(&quot;MutualExclusion: Thread %08X is entering ThreadProc\n&quot;), pkThread

     xor ebx, ebx
     .while ebx &lt; NUM_WORKS

         invoke DbgPrint, $CTA0(&quot;MutualExclusion: Thread %08X is working on #%d\n&quot;), pkThread, ebx
        
         MUTEX_WAIT addr g_kMutex

         ; &#1057;&#1095;&#1080;&#1090;&#1099;&#1074;&#1072;&#1077;&#1084; &#1079;&#1085;&#1072;&#1095;&#1077;&#1085;&#1080;&#1077; &#1088;&#1072;&#1079;&#1076;&#1077;&#1083;&#1103;&#1077;&#1084;&#1086;&#1075;&#1086; &#1088;&#1077;&#1089;&#1091;&#1088;&#1089;&#1072;

         push g_dwWorkElement
         pop dwWorkElement

         ; &#1048;&#1084;&#1080;&#1090;&#1080;&#1088;&#1091;&#1077;&#1084; &#1088;&#1072;&#1073;&#1086;&#1090;&#1091; &#1089; &#1088;&#1072;&#1079;&#1076;&#1077;&#1083;&#1103;&#1077;&#1084;&#1099;&#1084; &#1088;&#1077;&#1089;&#1091;&#1088;&#1089;&#1086;&#1084;

         invoke rand             ; &#1042;&#1099;&#1076;&#1072;&#1077;&#1090; &#1087;&#1089;&#1077;&#1074;&#1076;&#1086;&#1089;&#1083;&#1091;&#1095;&#1072;&#1081;&#1085;&#1086;&#1077; &#1095;&#1080;&#1089;&#1083;&#1086; &#1074; &#1076;&#1080;&#1072;&#1087;&#1072;&#1079;&#1086;&#1085;&#1077; 0 - 07FFFh
         shl eax, 4              ; * 16
         neg eax                 ; &#1079;&#1072;&#1076;&#1077;&#1088;&#1078;&#1082;&#1072; = 0 - ~50 &#1084;&#1089;
         or liDelayTime.HighPart, -1
         mov liDelayTime.LowPart, eax
         invoke KeDelayExecutionThread, KernelMode, FALSE, addr liDelayTime

         ; &#1048;&#1079;&#1084;&#1077;&#1085;&#1103;&#1077;&#1084; &#1088;&#1072;&#1079;&#1076;&#1077;&#1083;&#1103;&#1077;&#1084;&#1099;&#1081; &#1088;&#1077;&#1089;&#1091;&#1088;&#1089; &#1080; &#1079;&#1072;&#1087;&#1080;&#1089;&#1099;&#1074;&#1072;&#1077;&#1084; &#1077;&#1075;&#1086; &#1085;&#1072;&#1079;&#1072;&#1076;

         inc dwWorkElement

         push dwWorkElement
         pop g_dwWorkElement

         MUTEX_RELEASE addr g_kMutex

         mov eax, liDelayTime.LowPart
         neg eax
         mov edx, 3518437209     ; &#1052;&#1072;&#1075;&#1080;&#1095;&#1077;&#1089;&#1082;&#1086;&#1077; &#1095;&#1080;&#1089;&#1083;&#1086;
         mul edx                 ; &#1044;&#1077;&#1083;&#1077;&#1085;&#1080;&#1077; &#1085;&#1072; 10000 &#1095;&#1077;&#1088;&#1077;&#1079; &#1091;&#1084;&#1085;&#1086;&#1078;&#1077;&#1085;&#1080;&#1077;. &#1055;&#1086;&#1083;&#1091;&#1095;&#1080;&#1084; &#1084;&#1080;&#1083;&#1083;&#1080;&#1089;&#1077;&#1082;&#1091;&#1085;&#1076;&#1099;.
         shr edx, 13
         invoke DbgPrint, $CTA0(&quot;MutualExclusion: Thread %08X work #%d is done (%02dms)\n&quot;), \
                            pkThread, ebx, edx

         inc ebx

     .endw

     invoke DbgPrint, $CTA0(&quot;MutualExclusion: Thread %08X is about to terminate\n&quot;), pkThread

     invoke PsTerminateSystemThread, STATUS_SUCCESS

     ret

 ThreadProc endp

 ;:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
 ;                                          CleanUp                                                  
 ;:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::

 CleanUp proc pDriverObject:PDRIVER_OBJECT

     invoke IoDeleteSymbolicLink, addr g_usSymbolicLinkName

     mov eax, pDriverObject
     invoke IoDeleteDevice, (DRIVER_OBJECT PTR [eax]).DeviceObject

     .if g_pkWaitBlock != NULL
         invoke ExFreePool, g_pkWaitBlock
         and g_pkWaitBlock, NULL
     .endif

     ret

 CleanUp endp

 ;:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
 ;                                       DriverUnload                                                
 ;:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::

 DriverUnload proc pDriverObject:PDRIVER_OBJECT

     invoke DbgPrint, $CTA0(&quot;MutualExclusion: Entering DriverUnload\n&quot;)
     invoke DbgPrint, $CTA0(&quot;MutualExclusion: Wait for threads exit...\n&quot;)

     ; &#1046;&#1076;&#1077;&#1084; &#1086;&#1082;&#1086;&#1085;&#1095;&#1072;&#1085;&#1080;&#1103; &#1088;&#1072;&#1073;&#1086;&#1090;&#1099; &#1074;&#1089;&#1077;&#1093; &#1087;&#1086;&#1090;&#1086;&#1082;&#1086;&#1074;

     .if g_dwCountThreads &gt; 0

         invoke KeWaitForMultipleObjects, g_dwCountThreads, addr g_apkThreads, WaitAll, \
                     Executive, KernelMode, FALSE, NULL, g_pkWaitBlock

         .while g_dwCountThreads
             dec g_dwCountThreads
             mov eax, g_dwCountThreads   ; zero-based
             fastcall ObfDereferenceObject, g_apkThreads[eax * type g_apkThreads]
         .endw

     .endif

     invoke CleanUp, pDriverObject

     ; &#1042;&#1099;&#1076;&#1072;&#1077;&#1084; &#1088;&#1077;&#1079;&#1091;&#1083;&#1100;&#1090;&#1072;&#1090;&#1099; &#1088;&#1072;&#1073;&#1086;&#1090;&#1099;. &#1047;&#1085;&#1072;&#1095;&#1077;&#1085;&#1080;&#1077; g_dwWorkElement &#1076;&#1086;&#1083;&#1078;&#1085;&#1086; &#1073;&#1099;&#1090;&#1100; &#1088;&#1072;&#1074;&#1085;&#1086; NUM_THREADS * NUM_WORKS

     invoke DbgPrint, $CTA0(&quot;MutualExclusion: WorkElement = %d\n&quot;), g_dwWorkElement
 
     invoke DbgPrint, $CTA0(&quot;MutualExclusion: Leaving DriverUnload\n&quot;)

     ret

 DriverUnload endp

 ; &#1053;&#1072; &#1074;&#1089;&#1103;&#1082;&#1080;&#1081; &#1089;&#1083;&#1091;&#1095;&#1072;&#1081; &#1087;&#1088;&#1086;&#1074;&#1077;&#1088;&#1080;&#1084;, &#1077;&#1097;&#1105; &#1085;&#1072; &#1101;&#1090;&#1072;&#1087;&#1077; &#1082;&#1086;&#1084;&#1087;&#1080;&#1083;&#1103;&#1094;&#1080;&#1080;, &#1085;&#1077; &#1087;&#1088;&#1077;&#1074;&#1099;&#1096;&#1072;&#1077;&#1090; &#1083;&#1080; &#1079;&#1085;&#1072;&#1095;&#1077;&#1085;&#1080;&#1077; NUM_THREADS
 ; &#1084;&#1072;&#1082;&#1089;&#1080;&#1084;&#1072;&#1083;&#1100;&#1085;&#1086; &#1076;&#1086;&#1087;&#1091;&#1089;&#1090;&#1080;&#1084;&#1086;&#1075;&#1086; MAXIMUM_WAIT_OBJECTS.

 ; &#1045;&#1089;&#1083;&#1080; &#1084;&#1099; &#1079;&#1072;&#1089;&#1090;&#1072;&#1074;&#1080;&#1084; &#1089;&#1080;&#1089;&#1090;&#1077;&#1084;&#1091; &#1078;&#1076;&#1072;&#1090;&#1100; &#1073;&#1086;&#1083;&#1077;&#1077; &#1095;&#1077;&#1084; MAXIMUM_WAIT_OBJECTS &#1086;&#1073;&#1098;&#1077;&#1082;&#1090;&#1086;&#1074;,
 ; &#1090;&#1086; &#1087;&#1086;&#1083;&#1091;&#1095;&#1080;&#1084; BSOD &#1089; &#1082;&#1086;&#1076;&#1086;&#1084; 0xC (MAXIMUM_WAIT_OBJECTS_EXCEEDED).

 IF NUM_THREADS GT MAXIMUM_WAIT_OBJECTS
     .ERR Maximum number of wait objects exceeded!
 ENDIF

 ;:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
 ;                                       StartThread                                                 
 ;:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::

 StartThreads proc uses ebx

 local hThread:HANDLE
 local i:DWORD
    
     and i, 0
     xor ebx, ebx
     .while i &lt; NUM_THREADS
    
         invoke PsCreateSystemThread, addr hThread, THREAD_ALL_ACCESS, NULL, NULL, NULL, ThreadProc, 0
         .if eax == STATUS_SUCCESS

             invoke ObReferenceObjectByHandle, hThread, THREAD_ALL_ACCESS, NULL, KernelMode, \
                                     addr g_apkThreads[ebx * type g_apkThreads], NULL

             invoke ZwClose, hThread
             invoke DbgPrint, $CTA0(&quot;MutualExclusion: System thread created. Thread Object: %08X\n&quot;), \
                                     g_apkThreads[ebx * type g_apkThreads]
             inc ebx
         .else
             invoke DbgPrint, $CTA0(&quot;MutualExclusion: Can't create system thread. Status: %08X\n&quot;), eax
         .endif
         inc i
     .endw

     mov g_dwCountThreads, ebx
     .if ebx != 0
         mov eax, STATUS_SUCCESS
     .else
         mov eax, STATUS_UNSUCCESSFUL
     .endif

     ret

 StartThreads endp

 ;:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
 ;                                       DriverEntry                                                 
 ;:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::

 DriverEntry proc pDriverObject:PDRIVER_OBJECT, pusRegistryPath:PUNICODE_STRING

 local status:NTSTATUS
 local pDeviceObject:PDEVICE_OBJECT
 local liTickCount:LARGE_INTEGER

     mov status, STATUS_DEVICE_CONFIGURATION_ERROR

     invoke IoCreateDevice, pDriverObject, 0, addr g_usDeviceName, \
                                FILE_DEVICE_UNKNOWN, 0, FALSE, addr pDeviceObject
     .if eax == STATUS_SUCCESS
         invoke IoCreateSymbolicLink, addr g_usSymbolicLinkName, addr g_usDeviceName
         .if eax == STATUS_SUCCESS

             mov eax, NUM_THREADS
             mov ecx, sizeof KWAIT_BLOCK
             xor edx, edx
             mul ecx

             and g_pkWaitBlock, NULL
             invoke ExAllocatePool, NonPagedPool, eax
             .if eax != NULL
                 mov g_pkWaitBlock, eax

                 MUTEX_INIT addr g_kMutex

                 invoke KeQueryTickCount, addr liTickCount

                 invoke srand, liTickCount.LowPart

                 and g_dwWorkElement, 0

                 invoke StartThreads
                 .if eax == STATUS_SUCCESS
                     mov eax, pDriverObject
                     mov (DRIVER_OBJECT PTR [eax]).DriverUnload, offset DriverUnload
                     mov status, STATUS_SUCCESS
                 .else
                     invoke CleanUp, pDriverObject
                 .endif
             .else
                 invoke CleanUp, pDriverObject
                 invoke DbgPrint, $CTA0(&quot;MutualExclusion: Couldn't allocate memory for Wait Block\n&quot;)
             .endif
         .else
             invoke IoDeleteDevice, pDeviceObject
         .endif
     .endif

     mov eax, status
     ret

 DriverEntry endp

 ;:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
 ;                                                                                                   
 ;:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::

 end DriverEntry

 :make

 set drv=MutualExclusion

 \masm32\bin\ml /nologo /c /coff %drv%.bat
 \masm32\bin\link /nologo /driver /base:0x10000 /align:32 /out:%drv%.sys /subsystem:native /ignore:4078 %drv%.obj

 del %drv%.obj

 echo.
 pause

</b></font></pre>
<!--mstheme--><font face="Arial, Arial, Helvetica"></code><br>
<br>
<p>&nbsp;<!--mstheme--></font>
<h2><!--mstheme--><font face="Arial, Arial, Helvetica" color="#CCCCCC">13.2
&#1055;&#1088;&#1086;&#1094;&#1077;&#1076;&#1091;&#1088;&#1072; DriverEntry<!--mstheme--></font></h2>
<!--mstheme--><font face="Arial, Arial, Helvetica">
<p>&nbsp;</p>
<code><!--mstheme--></font>
<pre>             mov eax, NUM_THREADS
             mov ecx, sizeof KWAIT_BLOCK
             xor edx, edx
             mul ecx

             and g_pkWaitBlock, NULL
             invoke ExAllocatePool, NonPagedPool, eax
             .if eax != NULL
                 mov g_pkWaitBlock, eax

</pre>
<!--mstheme--><font face="Arial, Arial, Helvetica"></code>
<p>&#1042;&#1099;&#1076;&#1077;&#1083;&#1103;&#1077;&#1084;
&#1073;&#1083;&#1086;&#1082; &#1087;&#1072;&#1084;&#1103;&#1090;&#1080;
&#1088;&#1072;&#1079;&#1084;&#1077;&#1088;&#1086;&#1084; NUM_THREADS * sizeof
KWAIT_BLOCK. &#1050;&#1086;&#1085;&#1089;&#1090;&#1072;&#1085;&#1090;&#1072;
NUM_THREADS
&#1086;&#1087;&#1088;&#1077;&#1076;&#1077;&#1083;&#1103;&#1077;&#1090;,
&#1089;&#1082;&#1086;&#1083;&#1100;&#1082;&#1086;
&#1087;&#1086;&#1090;&#1086;&#1082;&#1086;&#1074; &#1084;&#1099;
&#1079;&#1072;&#1087;&#1091;&#1089;&#1090;&#1080;&#1084;.
&#1057;&#1086;&#1093;&#1088;&#1072;&#1085;&#1103;&#1077;&#1084;
&#1091;&#1082;&#1072;&#1079;&#1072;&#1090;&#1077;&#1083;&#1100; &#1085;&#1072;
&#1074;&#1099;&#1076;&#1077;&#1083;&#1077;&#1085;&#1085;&#1099;&#1081;
&#1073;&#1083;&#1086;&#1082; &#1087;&#1072;&#1084;&#1103;&#1090;&#1080; &#1074;
&#1087;&#1077;&#1088;&#1077;&#1084;&#1077;&#1085;&#1085;&#1086;&#1081;
g_pkWaitBlock. &#1069;&#1090;&#1072; &#1087;&#1072;&#1084;&#1103;&#1090;&#1100;
&#1087;&#1086;&#1085;&#1072;&#1076;&#1086;&#1073;&#1080;&#1090;&#1089;&#1103;
&#1085;&#1072;&#1084; &#1087;&#1088;&#1080;
&#1074;&#1099;&#1075;&#1088;&#1091;&#1079;&#1082;&#1077;
&#1076;&#1088;&#1072;&#1081;&#1074;&#1077;&#1088;&#1072;.
&#1047;&#1072;&#1095;&#1077;&#1084; &#1086;&#1085;&#1072;
&#1085;&#1091;&#1078;&#1085;&#1072; &#1080;
&#1087;&#1086;&#1095;&#1077;&#1084;&#1091; &#1084;&#1099;
&#1074;&#1099;&#1076;&#1077;&#1083;&#1103;&#1077;&#1084; &#1077;&#1105;
&#1087;&#1088;&#1080;
&#1080;&#1085;&#1080;&#1094;&#1080;&#1072;&#1083;&#1080;&#1079;&#1072;&#1094;&#1080;&#1080;
&#1076;&#1088;&#1072;&#1081;&#1074;&#1077;&#1088;&#1072;, &#1103;
&#1086;&#1073;&#1098;&#1103;&#1089;&#1085;&#1102;
&#1087;&#1086;&#1079;&#1078;&#1077;. &#1055;&#1086;&#1082;&#1072; &#1084;&#1099;
&#1077;&#1105; &#1085;&#1077;
&#1080;&#1089;&#1087;&#1086;&#1083;&#1100;&#1079;&#1091;&#1077;&#1084;.</p>
<code><!--mstheme--></font>
<pre>                 MUTEX_INIT g_kMutex

</pre>
<!--mstheme--><font face="Arial, Arial, Helvetica"></code>
<p>&#1050;&#1072;&#1082; &#1103; &#1091;&#1078;&#1077;
&#1089;&#1082;&#1072;&#1079;&#1072;&#1083;, &#1084;&#1099;
&#1073;&#1091;&#1076;&#1077;&#1084;
&#1080;&#1089;&#1087;&#1086;&#1083;&#1100;&#1079;&#1086;&#1074;&#1072;&#1090;&#1100;
&#1076;&#1083;&#1103;
&#1089;&#1080;&#1085;&#1093;&#1088;&#1086;&#1085;&#1080;&#1079;&#1072;&#1094;&#1080;&#1080;
&#1084;&#1100;&#1102;&#1090;&#1077;&#1082;&#1089;.
&#1055;&#1077;&#1088;&#1077;&#1076;
&#1080;&#1089;&#1087;&#1086;&#1083;&#1100;&#1079;&#1086;&#1074;&#1072;&#1085;&#1080;&#1077;&#1084;
&#1077;&#1075;&#1086; &#1085;&#1072;&#1076;&#1086;
&#1080;&#1085;&#1080;&#1094;&#1080;&#1072;&#1083;&#1080;&#1079;&#1080;&#1088;&#1086;&#1074;&#1072;&#1090;&#1100;,
&#1074;&#1099;&#1079;&#1086;&#1074;&#1086;&#1084;
&#1092;&#1091;&#1085;&#1082;&#1094;&#1080;&#1080; <font color="#636363"><b>KeInitializeMutex</b></font>.
&#1071; &#1080;&#1089;&#1087;&#1086;&#1083;&#1100;&#1079;&#1091;&#1102;
&#1084;&#1072;&#1082;&#1088;&#1086;&#1089; MUTEX_INIT. &#1042;
&#1091;&#1087;&#1088;&#1086;&#1097;&#1077;&#1085;&#1085;&#1086;&#1084;
&#1074;&#1080;&#1076;&#1077; &#1086;&#1085;
&#1074;&#1099;&#1075;&#1083;&#1103;&#1076;&#1080;&#1090; &#1090;&#1072;&#1082; (&#1087;&#1086;&#1083;&#1085;&#1072;&#1103;
&#1074;&#1077;&#1088;&#1089;&#1080;&#1103;
&#1084;&#1072;&#1082;&#1088;&#1086;&#1089;&#1072;
&#1073;&#1086;&#1083;&#1077;&#1077;
&#1091;&#1085;&#1080;&#1074;&#1077;&#1088;&#1089;&#1072;&#1083;&#1100;&#1085;&#1072;
- &#1089;&#1084;. Mutex.mac):</p>
<code><!--mstheme--></font>
<pre> MUTEX_INIT MACRO mtx:REQ
     invoke KeInitializeMutex, mtx, 0
 ENDM

</pre>
<!--mstheme--><font face="Arial, Arial, Helvetica"></code>
<p>&#1060;&#1091;&#1085;&#1082;&#1094;&#1080;&#1103; <font color="#636363"><b>KeInitializeMutex</b></font>
&#1087;&#1088;&#1086;&#1089;&#1090;&#1086;
&#1079;&#1072;&#1087;&#1086;&#1083;&#1085;&#1103;&#1077;&#1090;
&#1089;&#1090;&#1088;&#1091;&#1082;&#1090;&#1091;&#1088;&#1091; KMUTANT,
&#1086;&#1087;&#1080;&#1089;&#1099;&#1074;&#1072;&#1102;&#1097;&#1091;&#1102;
&#1086;&#1073;&#1098;&#1077;&#1082;&#1090;
&#1084;&#1100;&#1102;&#1090;&#1077;&#1082;&#1089;, &#1087;&#1088;&#1080;
&#1101;&#1090;&#1086;&#1084; &#1084;&#1100;&#1102;&#1090;&#1077;&#1082;&#1089;
&#1091;&#1089;&#1090;&#1072;&#1085;&#1072;&#1074;&#1083;&#1080;&#1074;&#1072;&#1077;&#1090;&#1089;&#1103;
&#1074; &#1089;&#1074;&#1086;&#1073;&#1086;&#1076;&#1085;&#1086;&#1077;
&#1089;&#1086;&#1089;&#1090;&#1086;&#1103;&#1085;&#1080;&#1077;.</p>
<code><!--mstheme--></font>
<pre> KMUTANT STRUCT                           ; sizeof = 020h
     Header          DISPATCHER_HEADER &lt;&gt; ; 0000h
     MutantListEntry LIST_ENTRY        &lt;&gt; ; 0010h
     OwnerThread     PVOID             ?  ; 0018h  PTR KTHREAD
     Abandoned       BYTE              ?  ; 001Ch  BOOLEAN
     ApcDisable      BYTE              ?  ; 001Dh
                     WORD              ?  ; 001Eh  padding
 KMUTANT ENDS

</pre>
<!--mstheme--><font face="Arial, Arial, Helvetica"></code>
<p>&#1048;&#1090;&#1072;&#1082;,
&#1084;&#1100;&#1102;&#1090;&#1077;&#1082;&#1089;
&#1075;&#1086;&#1090;&#1086;&#1074; &#1082;
&#1080;&#1089;&#1087;&#1086;&#1083;&#1100;&#1079;&#1086;&#1074;&#1072;&#1085;&#1080;&#1102;.</p>
<code><!--mstheme--></font>
<pre>                 invoke KeQueryTickCount, addr liTickCount

                 invoke srand, liTickCount.LowPart

</pre>
<!--mstheme--><font face="Arial, Arial, Helvetica"></code>
<p>&#1044;&#1083;&#1103;
&#1084;&#1072;&#1082;&#1089;&#1080;&#1084;&#1072;&#1083;&#1100;&#1085;&#1086;&#1075;&#1086;
&#1087;&#1088;&#1080;&#1073;&#1083;&#1080;&#1078;&#1077;&#1085;&#1080;&#1103;
&#1082; &#1073;&#1086;&#1077;&#1074;&#1099;&#1084;
&#1091;&#1089;&#1083;&#1086;&#1074;&#1080;&#1103;&#1084; &#1085;&#1072;&#1084;
&#1085;&#1091;&#1078;&#1085;&#1086;
&#1079;&#1072;&#1089;&#1090;&#1072;&#1074;&#1080;&#1090;&#1100;
&#1087;&#1086;&#1090;&#1086;&#1082;&#1080;
&#1086;&#1073;&#1088;&#1072;&#1097;&#1072;&#1090;&#1100;&#1089;&#1103; &#1082;
&#1088;&#1072;&#1079;&#1076;&#1077;&#1083;&#1103;&#1077;&#1084;&#1086;&#1084;&#1091;
&#1088;&#1077;&#1089;&#1091;&#1088;&#1089;&#1091;
&#1093;&#1072;&#1086;&#1090;&#1080;&#1095;&#1085;&#1086;. &#1044;&#1083;&#1103;
&#1101;&#1090;&#1086;&#1075;&#1086; &#1084;&#1099;
&#1073;&#1091;&#1076;&#1077;&#1084;
&#1075;&#1077;&#1085;&#1077;&#1088;&#1080;&#1088;&#1086;&#1074;&#1072;&#1090;&#1100;
&#1085;&#1077;&#1082;&#1086;&#1077;
&#1087;&#1089;&#1077;&#1074;&#1076;&#1086;&#1089;&#1083;&#1091;&#1095;&#1072;&#1081;&#1085;&#1086;&#1077;
&#1095;&#1080;&#1089;&#1083;&#1086;, &#1080;
&#1080;&#1089;&#1087;&#1086;&#1083;&#1100;&#1079;&#1086;&#1074;&#1072;&#1090;&#1100;
&#1077;&#1075;&#1086; &#1082;&#1072;&#1082;
&#1074;&#1088;&#1077;&#1084;&#1077;&#1085;&#1085;&#1086;&#1081;
&#1080;&#1085;&#1090;&#1077;&#1088;&#1074;&#1072;&#1083; &#1076;&#1083;&#1103;
&#1079;&#1072;&#1076;&#1077;&#1088;&#1078;&#1082;&#1080;
&#1087;&#1086;&#1090;&#1086;&#1082;&#1072;. Ntoskrnl.exe
&#1101;&#1082;&#1089;&#1087;&#1086;&#1088;&#1090;&#1080;&#1088;&#1091;&#1077;&#1090;
&#1089;&#1090;&#1072;&#1085;&#1076;&#1072;&#1088;&#1090;&#1085;&#1091;&#1102;
&#1073;&#1080;&#1073;&#1083;&#1080;&#1086;&#1090;&#1077;&#1095;&#1085;&#1091;&#1102;
&#1092;&#1091;&#1085;&#1082;&#1094;&#1080;&#1102; <font color="#636363"><b>rand</b></font>.
&#1069;&#1090;&#1072; &#1092;&#1091;&#1085;&#1082;&#1094;&#1080;&#1103;
&#1074;&#1086;&#1079;&#1074;&#1088;&#1072;&#1097;&#1072;&#1077;&#1090;
&#1087;&#1089;&#1077;&#1074;&#1076;&#1086;&#1089;&#1083;&#1091;&#1095;&#1072;&#1081;&#1085;&#1086;&#1077;
&#1095;&#1080;&#1089;&#1083;&#1086; &#1074;
&#1076;&#1080;&#1072;&#1087;&#1072;&#1079;&#1086;&#1085;&#1077; 0 - 07FFFh.
&#1044;&#1083;&#1103;
&#1075;&#1077;&#1085;&#1077;&#1088;&#1072;&#1094;&#1080;&#1080;
&#1080;&#1089;&#1087;&#1086;&#1083;&#1100;&#1079;&#1091;&#1077;&#1090;&#1089;&#1103;
&#1090;&#1072;&#1082;
&#1085;&#1072;&#1079;&#1099;&#1074;&#1072;&#1077;&#1084;&#1086;&#1077;
&#1085;&#1072;&#1095;&#1072;&#1083;&#1100;&#1085;&#1086;&#1077;
&#1095;&#1080;&#1089;&#1083;&#1086; &#1080;&#1083;&#1080; &quot;&#1079;&#1072;&#1090;&#1088;&#1072;&#1074;&#1082;&#1072;&quot;
(seed), &#1082;&#1086;&#1090;&#1086;&#1088;&#1086;&#1077;
&#1093;&#1088;&#1072;&#1085;&#1080;&#1090;&#1089;&#1103; &#1074;
&#1075;&#1083;&#1086;&#1073;&#1072;&#1083;&#1100;&#1085;&#1086;&#1081;
&#1085;&#1077;&#1101;&#1082;&#1089;&#1087;&#1086;&#1088;&#1090;&#1080;&#1088;&#1091;&#1077;&#1084;&#1086;&#1081;
&#1087;&#1077;&#1088;&#1077;&#1084;&#1077;&#1085;&#1085;&#1086;&#1081;
&#1103;&#1076;&#1088;&#1072;.
&#1048;&#1079;&#1085;&#1072;&#1095;&#1072;&#1083;&#1100;&#1085;&#1086; &quot;&#1079;&#1072;&#1090;&#1088;&#1072;&#1074;&#1082;&#1072;&quot;
&#1080;&#1085;&#1080;&#1094;&#1080;&#1072;&#1083;&#1080;&#1079;&#1080;&#1088;&#1086;&#1074;&#1072;&#1085;&#1072;
&#1077;&#1076;&#1080;&#1085;&#1080;&#1094;&#1077;&#1081;, &#1090;.&#1077;.
&#1085;&#1072;&#1095;&#1072;&#1083;&#1100;&#1085;&#1086;&#1077;
&#1095;&#1080;&#1089;&#1083;&#1086; &#1076;&#1083;&#1103;
&#1075;&#1077;&#1085;&#1077;&#1088;&#1072;&#1090;&#1086;&#1088;&#1072;
&#1087;&#1089;&#1077;&#1074;&#1076;&#1086;&#1089;&#1083;&#1091;&#1095;&#1072;&#1081;&#1085;&#1099;&#1093;
&#1095;&#1080;&#1089;&#1077;&#1083; &#1091;&#1078;&#1077;
&#1089;&#1091;&#1097;&#1077;&#1089;&#1090;&#1074;&#1091;&#1077;&#1090;.
&#1053;&#1086; &#1084;&#1099; &#1074;&#1089;&#1105; &#1078;&#1077;
&#1089;&#1076;&#1077;&#1083;&#1072;&#1077;&#1084; &#1074;&#1089;&#1105;
&#1087;&#1086; &#1087;&#1088;&#1072;&#1074;&#1080;&#1083;&#1072;&#1084;:
&#1074;&#1099;&#1079;&#1086;&#1074;&#1077;&#1084;
&#1092;&#1091;&#1085;&#1082;&#1094;&#1080;&#1102; <font color="#636363"><b>srand</b></font>
&#1080;
&#1087;&#1088;&#1086;&#1080;&#1085;&#1080;&#1094;&#1080;&#1072;&#1083;&#1080;&#1079;&#1080;&#1088;&#1091;&#1077;&#1084;
&quot;&#1079;&#1072;&#1090;&#1088;&#1072;&#1074;&#1082;&#1091;&quot;
&#1090;&#1072;&#1082;&#1078;&#1077;
&#1087;&#1089;&#1077;&#1074;&#1076;&#1086;&#1089;&#1083;&#1091;&#1095;&#1072;&#1081;&#1085;&#1099;&#1084;
&#1095;&#1080;&#1089;&#1083;&#1086;&#1084;, &#1074;
&#1082;&#1072;&#1095;&#1077;&#1089;&#1090;&#1074;&#1077;
&#1082;&#1086;&#1090;&#1086;&#1088;&#1086;&#1075;&#1086;
&#1080;&#1089;&#1087;&#1086;&#1083;&#1100;&#1079;&#1091;&#1077;&#1084;
&#1084;&#1083;&#1072;&#1076;&#1096;&#1091;&#1102;
&#1095;&#1072;&#1089;&#1090;&#1100; 64-&#1073;&#1080;&#1090;&#1085;&#1086;&#1075;&#1086;
&#1095;&#1080;&#1083;&#1072;,
&#1074;&#1086;&#1079;&#1074;&#1088;&#1072;&#1097;&#1072;&#1077;&#1084;&#1086;&#1075;&#1086;
&#1092;&#1091;&#1085;&#1082;&#1094;&#1080;&#1077;&#1081; <font color="#636363"><b>KeQueryTickCount</b></font>.
<font color="#636363"><b>KeQueryTickCount</b></font>
&#1074;&#1086;&#1079;&#1074;&#1088;&#1072;&#1097;&#1072;&#1077;&#1090;
&#1082;&#1086;&#1083;&#1080;&#1095;&#1077;&#1089;&#1090;&#1074;&#1086;
&#1090;&#1072;&#1082;&#1090;&#1086;&#1074;,
&#1087;&#1088;&#1086;&#1096;&#1077;&#1076;&#1096;&#1080;&#1093; &#1089;
&#1084;&#1086;&#1084;&#1077;&#1085;&#1090;&#1072;
&#1087;&#1086;&#1076;&#1072;&#1095;&#1080;
&#1087;&#1080;&#1090;&#1072;&#1085;&#1080;&#1103; &#1085;&#1072;
&#1087;&#1088;&#1086;&#1094;&#1077;&#1089;&#1089;&#1086;&#1088;.</p>
<code><!--mstheme--></font>
<pre>                 and g_dwWorkElement, 0

</pre>
<!--mstheme--><font face="Arial, Arial, Helvetica"></code>
<p>g_dwWorkElement - &#1101;&#1090;&#1086; &#1085;&#1072;&#1096;
&#1088;&#1072;&#1079;&#1076;&#1077;&#1083;&#1103;&#1077;&#1084;&#1099;&#1081;
&#1088;&#1077;&#1089;&#1091;&#1088;&#1089;.</p>
<br>
<br>
<p>&nbsp;<!--mstheme--></font>
<h2><!--mstheme--><font face="Arial, Arial, Helvetica" color="#CCCCCC">13.3
&#1057;&#1086;&#1079;&#1076;&#1072;&#1077;&#1084;
&#1089;&#1080;&#1089;&#1090;&#1077;&#1084;&#1085;&#1099;&#1077;
&#1087;&#1086;&#1090;&#1086;&#1082;&#1080;<!--mstheme--></font></h2>
<!--mstheme--><font face="Arial, Arial, Helvetica">
<p>&nbsp;</p>
<code><!--mstheme--></font>
<pre>     and i, 0
     xor ebx, ebx
     .while i &lt; NUM_THREADS
    
         invoke PsCreateSystemThread, addr hThread, THREAD_ALL_ACCESS, NULL, NULL, NULL, ThreadProc, 0
         .if eax == STATUS_SUCCESS

             invoke ObReferenceObjectByHandle, hThread, THREAD_ALL_ACCESS, NULL, KernelMode, \
                                     addr g_apkThreads[ebx * type g_apkThreads], NULL

             invoke ZwClose, hThread

             inc ebx

         .endif
         inc i
     .endw

     mov g_dwCountThreads, ebx

</pre>
<!--mstheme--><font face="Arial, Arial, Helvetica"></code>
<p>&#1047;&#1076;&#1077;&#1089;&#1100; &#1085;&#1077;&#1090;
&#1085;&#1080;&#1082;&#1072;&#1082;&#1080;&#1093;
&#1087;&#1088;&#1080;&#1085;&#1094;&#1080;&#1087;&#1080;&#1072;&#1083;&#1100;&#1085;&#1099;&#1093;
&#1086;&#1090;&#1083;&#1080;&#1095;&#1080;&#1081; &#1086;&#1090;
&#1090;&#1086;&#1075;&#1086;, &#1095;&#1090;&#1086; &#1084;&#1099;
&#1076;&#1077;&#1083;&#1072;&#1083;&#1080; &#1074;
&#1087;&#1088;&#1086;&#1096;&#1083;&#1099;&#1081; &#1088;&#1072;&#1079; &#1074;
&#1076;&#1088;&#1072;&#1081;&#1074;&#1077;&#1088;&#1077; TimerWorks.
&#1045;&#1076;&#1080;&#1085;&#1089;&#1090;&#1074;&#1077;&#1085;&#1085;&#1072;&#1103;
&#1088;&#1072;&#1079;&#1085;&#1080;&#1094;&#1072; &#1074; &#1090;&#1086;&#1084;,
&#1095;&#1090;&#1086; &#1084;&#1099;
&#1079;&#1072;&#1087;&#1091;&#1089;&#1082;&#1072;&#1077;&#1084; &#1085;&#1077;
&#1086;&#1076;&#1080;&#1085;, &#1072; NUM_THREADS
&#1087;&#1086;&#1090;&#1086;&#1082;&#1086;&#1074;,
&#1089;&#1086;&#1093;&#1088;&#1072;&#1085;&#1103;&#1077;&#1084;
&#1091;&#1082;&#1072;&#1079;&#1072;&#1090;&#1077;&#1083;&#1080; &#1085;&#1072;
&#1085;&#1080;&#1093; &#1074; &#1084;&#1072;&#1089;&#1089;&#1080;&#1074;&#1077;
g_apkThreads, &#1072;
&#1082;&#1086;&#1083;&#1080;&#1095;&#1077;&#1089;&#1090;&#1074;&#1086;
&#1092;&#1072;&#1082;&#1090;&#1080;&#1095;&#1077;&#1089;&#1082;&#1080;
&#1089;&#1086;&#1079;&#1076;&#1072;&#1085;&#1085;&#1099;&#1093;
&#1087;&#1086;&#1090;&#1086;&#1082;&#1086;&#1074; - &#1074;
&#1087;&#1077;&#1088;&#1077;&#1084;&#1077;&#1085;&#1085;&#1086;&#1081;
g_dwCountThreads.
&#1057;&#1090;&#1072;&#1088;&#1090;&#1086;&#1074;&#1072;&#1103;
&#1092;&#1091;&#1085;&#1082;&#1094;&#1080;&#1103; &#1074;&#1089;&#1077;&#1093;
&#1087;&#1086;&#1090;&#1086;&#1082;&#1086;&#1074; &#1086;&#1076;&#1085;&#1072;
&#1080; &#1090;&#1072; &#1078;&#1077; - <font color="#636363"><b>ThreadProc</b></font>.</p>
<p>&#1048; &#1077;&#1097;&#1105; &#1086;&#1076;&#1080;&#1085;
&#1084;&#1086;&#1084;&#1077;&#1085;&#1090;.</p>
<code><!--mstheme--></font>
<pre> IF NUM_THREADS GT MAXIMUM_WAIT_OBJECTS
     .ERR Maximum number of wait objects exceeded!
 ENDIF

</pre>
<!--mstheme--><font face="Arial, Arial, Helvetica"></code>
<p>&#1069;&#1090;&#1080; &#1090;&#1088;&#1080;
&#1089;&#1090;&#1088;&#1086;&#1095;&#1082;&#1080; &#1085;&#1077;
&#1087;&#1086;&#1079;&#1074;&#1086;&#1083;&#1103;&#1090; &#1074;&#1072;&#1084;
&#1089;&#1082;&#1086;&#1084;&#1087;&#1080;&#1083;&#1080;&#1088;&#1086;&#1074;&#1072;&#1090;&#1100;
&#1076;&#1088;&#1072;&#1081;&#1074;&#1077;&#1088;, &#1077;&#1089;&#1083;&#1080;
&#1087;&#1086; &#1086;&#1096;&#1080;&#1073;&#1082;&#1077; &#1074;&#1099;
&#1080;&#1079;&#1084;&#1077;&#1085;&#1080;&#1090;&#1077; NUM_THREADS
&#1085;&#1072; &#1079;&#1085;&#1072;&#1095;&#1077;&#1085;&#1080;&#1077;
&#1073;&#1086;&#1083;&#1100;&#1096;&#1077;&#1077;, &#1095;&#1077;&#1084;
MAXIMUM_WAIT_OBJECTS. MAXIMUM_WAIT_OBJECTS - &#1101;&#1090;&#1086;
&#1084;&#1072;&#1082;&#1089;&#1080;&#1084;&#1072;&#1083;&#1100;&#1085;&#1086;&#1077;
&#1082;&#1086;&#1083;&#1080;&#1095;&#1077;&#1089;&#1090;&#1074;&#1086;
&#1086;&#1073;&#1098;&#1077;&#1082;&#1090;&#1086;&#1074;
&#1086;&#1078;&#1080;&#1076;&#1072;&#1085;&#1080;&#1103;,
&#1086;&#1078;&#1080;&#1076;&#1072;&#1090;&#1100;
&#1082;&#1086;&#1090;&#1086;&#1088;&#1099;&#1077;
&#1084;&#1086;&#1078;&#1085;&#1086;
&#1086;&#1076;&#1085;&#1086;&#1074;&#1088;&#1077;&#1084;&#1077;&#1085;&#1085;&#1086;,
&#1080; &#1088;&#1072;&#1074;&#1085;&#1086; &#1086;&#1085;&#1086; 64.
&#1058;&#1086;&#1095;&#1085;&#1086; &#1090;&#1072;&#1082;&#1078;&#1077;
&#1082;&#1072;&#1082; &#1080; &#1074;
&#1076;&#1088;&#1072;&#1081;&#1074;&#1077;&#1088;&#1077; TimerWorks &#1074;
&#1087;&#1088;&#1086;&#1094;&#1077;&#1076;&#1091;&#1088;&#1077; <font color="#636363"><b>DriverUnload</b></font>
&#1084;&#1099; &#1073;&#1091;&#1076;&#1077;&#1084;
&#1078;&#1076;&#1072;&#1090;&#1100; &#1074;&#1089;&#1077;
&#1088;&#1072;&#1073;&#1086;&#1090;&#1072;&#1102;&#1097;&#1080;&#1077;
&#1087;&#1086;&#1090;&#1086;&#1082;&#1080; &#1080; &#1080;&#1093;
&#1082;&#1086;&#1083;&#1080;&#1095;&#1077;&#1089;&#1090;&#1074;&#1086;
&#1085;&#1077; &#1076;&#1086;&#1083;&#1078;&#1085;&#1086;
&#1073;&#1099;&#1090;&#1100; &#1073;&#1086;&#1083;&#1100;&#1096;&#1077;
MAXIMUM_WAIT_OBJECTS.</p>
<br>
<br>
<p>&nbsp;<!--mstheme--></font>
<h2><!--mstheme--><font face="Arial, Arial, Helvetica" color="#CCCCCC">13.4
&#1055;&#1088;&#1086;&#1094;&#1077;&#1076;&#1091;&#1088;&#1072;
&#1087;&#1086;&#1090;&#1086;&#1082;&#1086;&#1074;<!--mstheme--></font></h2>
<!--mstheme--><font face="Arial, Arial, Helvetica">
<p>&nbsp;</p>
<p>&#1048;&#1090;&#1072;&#1082;, &#1084;&#1099;
&#1089;&#1086;&#1079;&#1076;&#1072;&#1083;&#1080; NUM_THREADS
&#1087;&#1086;&#1090;&#1086;&#1082;&#1086;&#1074;. &#1042;&#1089;&#1077;
&#1086;&#1085;&#1080; &#1088;&#1072;&#1085;&#1086; &#1080;&#1083;&#1080;
&#1087;&#1086;&#1079;&#1076;&#1085;&#1086; &#1087;&#1086;
&#1088;&#1077;&#1096;&#1077;&#1085;&#1080;&#1102;
&#1087;&#1083;&#1072;&#1085;&#1080;&#1088;&#1086;&#1074;&#1097;&#1080;&#1082;&#1072;
&#1085;&#1072;&#1095;&#1085;&#1091;&#1090;
&#1074;&#1099;&#1087;&#1086;&#1083;&#1085;&#1103;&#1090;&#1100;
&#1087;&#1088;&#1086;&#1094;&#1077;&#1076;&#1091;&#1088;&#1091; <font color="#636363"><b>ThreadProc</b></font>.
&#1055;&#1088;&#1080;&#1095;&#1077;&#1084; &#1074;
&#1084;&#1085;&#1086;&#1075;&#1086;&#1087;&#1088;&#1086;&#1094;&#1077;&#1089;&#1089;&#1086;&#1088;&#1085;&#1086;&#1081;
&#1089;&#1080;&#1089;&#1090;&#1077;&#1084;&#1077; &#1101;&#1090;&#1086;,
&#1074;&#1086;&#1079;&#1084;&#1086;&#1078;&#1085;&#1086;,
&#1073;&#1091;&#1076;&#1077;&#1090;
&#1087;&#1088;&#1086;&#1080;&#1089;&#1093;&#1086;&#1076;&#1080;&#1090;&#1100;
&#1074; &#1073;&#1091;&#1082;&#1074;&#1072;&#1083;&#1100;&#1085;&#1086;&#1084;
&#1089;&#1084;&#1099;&#1089;&#1083;&#1077;
&#1086;&#1076;&#1085;&#1086;&#1074;&#1088;&#1077;&#1084;&#1077;&#1085;&#1085;&#1086;.</p>
<code><!--mstheme--></font>
<pre>     invoke PsGetCurrentThread
     mov pkThread, eax
     invoke DbgPrint, $CTA0(&quot;MutualExclusion: Thread %08X is entering ThreadProc\n&quot;), pkThread

</pre>
<!--mstheme--><font face="Arial, Arial, Helvetica"></code>
<p>&#1060;&#1091;&#1085;&#1082;&#1094;&#1080;&#1077;&#1081; <font color="#636363"><b>PsGetCurrentThread</b></font>
&#1087;&#1086;&#1083;&#1091;&#1095;&#1072;&#1077;&#1084;
&#1091;&#1082;&#1072;&#1079;&#1072;&#1090;&#1077;&#1083;&#1100; &#1085;&#1072;
&#1089;&#1090;&#1088;&#1091;&#1082;&#1090;&#1091;&#1088;&#1091;
&#1090;&#1077;&#1082;&#1091;&#1097;&#1077;&#1075;&#1086;
&#1087;&#1086;&#1090;&#1086;&#1082;&#1072; &#1080;
&#1074;&#1099;&#1074;&#1086;&#1076;&#1080;&#1084; &#1077;&#1105;
&#1072;&#1076;&#1088;&#1077;&#1089; &#1074;
&#1086;&#1090;&#1083;&#1072;&#1076;&#1086;&#1095;&#1085;&#1086;&#1084;
&#1089;&#1086;&#1086;&#1073;&#1097;&#1077;&#1085;&#1080;&#1080;.</p>
<code><!--mstheme--></font>
<pre>     xor ebx, ebx
     .while ebx &lt; NUM_WORKS

</pre>
<!--mstheme--><font face="Arial, Arial, Helvetica"></code>
<p>&#1054;&#1088;&#1075;&#1072;&#1085;&#1080;&#1079;&#1091;&#1077;&#1084;
&#1094;&#1080;&#1082;&#1083;,
&#1087;&#1086;&#1074;&#1090;&#1086;&#1088;&#1103;&#1102;&#1097;&#1080;&#1081;&#1089;&#1103;
NUM_WORKS &#1088;&#1072;&#1079;. &#1042; &#1094;&#1080;&#1082;&#1083;&#1077;
&#1080;&#1084;&#1080;&#1090;&#1080;&#1088;&#1091;&#1077;&#1084;
&#1089;&#1083;&#1091;&#1095;&#1072;&#1081;&#1085;&#1091;&#1102;
&#1088;&#1072;&#1073;&#1086;&#1090;&#1091;
&#1087;&#1086;&#1090;&#1086;&#1082;&#1086;&#1074; &#1089;
&#1088;&#1072;&#1079;&#1076;&#1077;&#1083;&#1103;&#1077;&#1084;&#1099;&#1084;
&#1088;&#1077;&#1089;&#1091;&#1088;&#1089;&#1086;&#1084;.
&#1050;&#1072;&#1078;&#1076;&#1099;&#1081; &#1087;&#1086;&#1090;&#1086;&#1082;
&#1076;&#1086;&#1083;&#1078;&#1077;&#1085; &#1073;&#1091;&#1076;&#1077;&#1090;
&#1091;&#1074;&#1077;&#1083;&#1080;&#1095;&#1080;&#1090;&#1100; &#1085;&#1072;
&#1077;&#1076;&#1080;&#1085;&#1080;&#1094;&#1091;
&#1079;&#1085;&#1072;&#1095;&#1077;&#1085;&#1080;&#1077;
&#1077;&#1076;&#1080;&#1085;&#1089;&#1090;&#1074;&#1077;&#1085;&#1085;&#1086;&#1081;
&#1075;&#1083;&#1086;&#1073;&#1072;&#1083;&#1100;&#1085;&#1086;&#1081;
&#1087;&#1077;&#1088;&#1077;&#1084;&#1077;&#1085;&#1085;&#1086;&#1081;
g_dwWorkElement &#1080;
&#1087;&#1088;&#1086;&#1076;&#1077;&#1083;&#1072;&#1090;&#1100;
&#1101;&#1090;&#1091; &#1086;&#1087;&#1077;&#1088;&#1072;&#1094;&#1080;&#1102;
NUM_WORKS &#1088;&#1072;&#1079;.</p>
<code><!--mstheme--></font>
<pre>         MUTEX_WAIT g_kMutex

</pre>
<!--mstheme--><font face="Arial, Arial, Helvetica"></code>
<p>&#1045;&#1089;&#1083;&#1080; &#1087;&#1086;&#1090;&#1086;&#1082;
&#1086;&#1082;&#1072;&#1079;&#1099;&#1074;&#1072;&#1077;&#1090;&#1089;&#1103;
&#1074; &#1101;&#1090;&#1086;&#1081; &#1090;&#1086;&#1095;&#1082;&#1077;,
&#1079;&#1085;&#1072;&#1095;&#1080;&#1090;, &#1086;&#1085;
&#1091;&#1089;&#1087;&#1077;&#1096;&#1085;&#1086;
&#1079;&#1072;&#1093;&#1074;&#1072;&#1090;&#1080;&#1083;
&#1084;&#1100;&#1102;&#1090;&#1077;&#1082;&#1089; &#1080;
&#1087;&#1086;&#1090;&#1086;&#1082;&#1091;
&#1075;&#1072;&#1088;&#1072;&#1085;&#1090;&#1080;&#1088;&#1086;&#1074;&#1072;&#1085;&#1086;,
&#1095;&#1090;&#1086; &#1076;&#1086; &#1090;&#1077;&#1093; &#1087;&#1086;&#1088;,
&#1087;&#1086;&#1082;&#1072; &#1086;&#1085; &#1085;&#1077;
&#1086;&#1089;&#1074;&#1086;&#1073;&#1086;&#1076;&#1080;&#1090;
&#1084;&#1100;&#1102;&#1090;&#1077;&#1082;&#1089;,
&#1085;&#1080;&#1082;&#1090;&#1086; &#1073;&#1086;&#1083;&#1100;&#1096;&#1077;
&#1085;&#1077; &#1089;&#1084;&#1086;&#1078;&#1077;&#1090; &#1077;&#1075;&#1086;
(&#1084;&#1100;&#1102;&#1090;&#1077;&#1082;&#1089;)
&#1079;&#1072;&#1093;&#1074;&#1072;&#1090;&#1080;&#1090;&#1100;.
&#1047;&#1085;&#1072;&#1095;&#1080;&#1090;, &#1087;&#1086;&#1090;&#1086;&#1082;
&#1084;&#1086;&#1078;&#1077;&#1090;
&#1084;&#1086;&#1085;&#1086;&#1087;&#1086;&#1083;&#1100;&#1085;&#1086;
&#1088;&#1072;&#1073;&#1086;&#1090;&#1072;&#1090;&#1100; &#1089;
&#1088;&#1077;&#1089;&#1091;&#1088;&#1089;&#1086;&#1084;, &#1090;.&#1082;.
&#1074;&#1089;&#1077;
&#1086;&#1089;&#1090;&#1072;&#1083;&#1100;&#1085;&#1099;&#1077; NUM_THREADS - 1
&#1087;&#1086;&#1090;&#1086;&#1082;&#1086;&#1074; &#1076;&#1083;&#1103;
&#1074;&#1093;&#1086;&#1076;&#1072; &#1074; &#1101;&#1090;&#1086;&#1090;
&#1091;&#1095;&#1072;&#1089;&#1090;&#1086;&#1082; &#1082;&#1086;&#1076;&#1072;
&#1090;&#1072;&#1082;&#1078;&#1077; &#1076;&#1086;&#1083;&#1078;&#1085;&#1099;
&#1079;&#1072;&#1093;&#1074;&#1072;&#1090;&#1080;&#1090;&#1100;
&#1090;&#1086;&#1090; &#1078;&#1077; &#1089;&#1072;&#1084;&#1099;&#1081;
&#1084;&#1100;&#1102;&#1090;&#1077;&#1082;&#1089;.</p>
<p>&#1047;&#1076;&#1077;&#1089;&#1100; &#1103; &#1090;&#1086;&#1078;&#1077;
&#1080;&#1089;&#1087;&#1086;&#1083;&#1100;&#1079;&#1091;&#1102;
&#1084;&#1072;&#1082;&#1088;&#1086;&#1089;. &#1042;
&#1091;&#1087;&#1088;&#1086;&#1097;&#1077;&#1085;&#1085;&#1086;&#1084;
&#1074;&#1080;&#1076;&#1077; &#1086;&#1085;
&#1074;&#1099;&#1075;&#1083;&#1103;&#1076;&#1080;&#1090; &#1090;&#1072;&#1082; (&#1087;&#1086;&#1083;&#1085;&#1072;&#1103;
&#1074;&#1077;&#1088;&#1089;&#1080;&#1103;
&#1084;&#1072;&#1082;&#1088;&#1086;&#1089;&#1072;
&#1090;&#1072;&#1082;&#1078;&#1077; &#1073;&#1086;&#1083;&#1077;&#1077;
&#1091;&#1085;&#1080;&#1074;&#1077;&#1088;&#1089;&#1072;&#1083;&#1100;&#1085;&#1072;):</p>
<code><!--mstheme--></font>
<pre> MUTEX_WAIT MACRO mtx:REQ
     invoke KeWaitForMutexObject, mtx, Executive, KernelMode, FALSE, NULL
 ENDM

</pre>
<!--mstheme--><font face="Arial, Arial, Helvetica"></code>
<p>&#1055;&#1072;&#1088;&#1072;&#1084;&#1077;&#1090;&#1088;&#1099;
&#1092;&#1091;&#1085;&#1082;&#1094;&#1080;&#1080; <font color="#636363"><b>KeWaitForMutexObject</b></font>
&#1087;&#1086;&#1083;&#1085;&#1086;&#1089;&#1090;&#1100;&#1102;
&#1080;&#1076;&#1077;&#1085;&#1090;&#1080;&#1095;&#1085;&#1099;
&#1087;&#1072;&#1088;&#1072;&#1084;&#1077;&#1090;&#1088;&#1072;&#1084;
&#1092;&#1091;&#1085;&#1082;&#1094;&#1080;&#1080; <font color="#636363"><b>KeWaitForSingleObject</b></font>
&#1080; &#1074;&#1089;&#1105;
&#1089;&#1082;&#1072;&#1079;&#1072;&#1085;&#1085;&#1086;&#1077; &#1074;
&#1087;&#1088;&#1086;&#1096;&#1083;&#1099;&#1081; &#1088;&#1072;&#1079;
&#1086;&#1090;&#1085;&#1086;&#1089;&#1080;&#1090;&#1077;&#1083;&#1100;&#1085;&#1086;
&#1092;&#1091;&#1085;&#1082;&#1094;&#1080;&#1080; <font color="#636363"><b>KeWaitForSingleObject</b></font>
&#1090;&#1072;&#1082;&#1078;&#1077;
&#1087;&#1088;&#1080;&#1084;&#1077;&#1085;&#1080;&#1084;&#1086; &#1082; <font color="#636363"><b>KeWaitForMutexObject</b></font>.
&#1041;&#1086;&#1083;&#1077;&#1077; &#1090;&#1086;&#1075;&#1086;, &#1074;
&#1079;&#1072;&#1075;&#1086;&#1083;&#1086;&#1074;&#1086;&#1095;&#1085;&#1099;&#1093;
&#1092;&#1072;&#1081;&#1083;&#1072;&#1093; <font color="#636363"><b>KeWaitForMutexObject</b></font>
&#1086;&#1087;&#1088;&#1077;&#1076;&#1077;&#1083;&#1077;&#1085;&#1072;
&#1090;&#1072;&#1082;:</p>
<code><!--mstheme--></font>
<pre> #define KeWaitForMutexObject KeWaitForSingleObject

</pre>
<!--mstheme--><font face="Arial, Arial, Helvetica"></code>
<p>&#1048; &#1077;&#1089;&#1083;&#1080; &#1091;&#1078;
&#1089;&#1086;&#1074;&#1089;&#1077;&#1084; &#1085;&#1072;
&#1095;&#1080;&#1089;&#1090;&#1086;&#1090;&#1091;, &#1090;&#1086;
&#1101;&#1090;&#1080; &#1076;&#1074;&#1077;
&#1092;&#1091;&#1085;&#1082;&#1094;&#1080;&#1080;
&#1080;&#1084;&#1077;&#1102;&#1090;
&#1086;&#1076;&#1080;&#1085;&#1072;&#1082;&#1086;&#1074;&#1091;&#1102;
&#1090;&#1086;&#1095;&#1082;&#1091; &#1074;&#1093;&#1086;&#1076;&#1072;. &#1058;.&#1077;.
<font color="#636363"><b>KeWaitForMutexObject</b></font> &#1080; <font color="#636363"><b>KeWaitForSingleObject</b></font>
- &#1101;&#1090;&#1086; &#1087;&#1088;&#1086;&#1089;&#1090;&#1086;
&#1080;&#1084;&#1077;&#1085;&#1072;-&#1089;&#1080;&#1085;&#1086;&#1085;&#1080;&#1084;&#1099;
&#1086;&#1076;&#1085;&#1086;&#1081; &#1080; &#1090;&#1086;&#1081; &#1078;&#1077;
&#1092;&#1091;&#1085;&#1082;&#1094;&#1080;&#1080;.</p>
<p>&#1042; &#1103;&#1076;&#1088;&#1077;
&#1089;&#1091;&#1097;&#1077;&#1089;&#1090;&#1074;&#1091;&#1077;&#1090;
&#1077;&#1097;&#1105; &#1086;&#1076;&#1080;&#1085;
&#1084;&#1100;&#1102;&#1090;&#1077;&#1082;&#1089; - <font color="#636363"><b><i>&#1073;&#1099;&#1089;&#1090;&#1088;&#1099;&#1081;
&#1084;&#1100;&#1102;&#1090;&#1077;&#1082;&#1089;</i></b></font> (fast mutex).
&#1041;&#1099;&#1089;&#1090;&#1088;&#1099;&#1084; &#1086;&#1085;
&#1085;&#1072;&#1079;&#1099;&#1074;&#1072;&#1077;&#1090;&#1089;&#1103;
&#1087;&#1086;&#1090;&#1086;&#1084;&#1091;, &#1095;&#1090;&#1086;
&#1077;&#1075;&#1086; &#1079;&#1072;&#1093;&#1074;&#1072;&#1090;/&#1086;&#1089;&#1074;&#1086;&#1073;&#1086;&#1078;&#1076;&#1077;&#1085;&#1080;&#1077;
&#1087;&#1088;&#1086;&#1093;&#1086;&#1076;&#1103;&#1090;
&#1073;&#1099;&#1089;&#1090;&#1088;&#1077;&#1077;. &#1054;&#1085;
&#1079;&#1085;&#1072;&#1095;&#1080;&#1090;&#1077;&#1083;&#1100;&#1085;&#1086;
&#1086;&#1090;&#1083;&#1080;&#1095;&#1072;&#1077;&#1090;&#1089;&#1103;
&#1086;&#1090; &#1086;&#1073;&#1099;&#1095;&#1085;&#1086;&#1075;&#1086;
&#1084;&#1100;&#1102;&#1090;&#1077;&#1082;&#1089;&#1072; &#1080;
&#1084;&#1077;&#1085;&#1077;&#1077;
&#1091;&#1085;&#1080;&#1074;&#1077;&#1088;&#1089;&#1072;&#1083;&#1077;&#1085;.</p>
<code><!--mstheme--></font>
<pre>         push g_dwWorkElement
         pop dwWorkElement

</pre>
<!--mstheme--><font face="Arial, Arial, Helvetica"></code>
<p>&#1057;&#1095;&#1080;&#1090;&#1099;&#1074;&#1072;&#1077;&#1084;
&#1079;&#1085;&#1072;&#1095;&#1077;&#1085;&#1080;&#1077;
&#1088;&#1072;&#1079;&#1076;&#1077;&#1083;&#1103;&#1077;&#1084;&#1086;&#1075;&#1086;
&#1088;&#1077;&#1089;&#1091;&#1088;&#1089;&#1072; &#1074;
&#1083;&#1086;&#1082;&#1072;&#1083;&#1100;&#1085;&#1091;&#1102;
&#1087;&#1072;&#1084;&#1103;&#1090;&#1100;
&#1087;&#1086;&#1090;&#1086;&#1082;&#1072; (&#1072;
&#1080;&#1084;&#1077;&#1085;&#1085;&#1086; &#1074; &#1089;&#1090;&#1077;&#1082;)
&#1080; &#1085;&#1072;&#1095;&#1080;&#1085;&#1072;&#1077;&#1084; &#1089;
&#1085;&#1080;&#1084; &#1088;&#1072;&#1073;&#1086;&#1090;&#1072;&#1090;&#1100;.</p>
<p>&#1044;&#1083;&#1103;
&#1080;&#1084;&#1080;&#1090;&#1072;&#1094;&#1080;&#1080;
&#1088;&#1072;&#1073;&#1086;&#1090;&#1099;
&#1087;&#1086;&#1090;&#1086;&#1082;&#1072; &#1089;
&#1088;&#1077;&#1089;&#1091;&#1088;&#1089;&#1086;&#1084; &#1084;&#1099;
&#1087;&#1088;&#1086;&#1089;&#1090;&#1086;
&#1087;&#1088;&#1080;&#1086;&#1089;&#1090;&#1072;&#1085;&#1086;&#1074;&#1080;&#1084;
&#1077;&#1075;&#1086;
&#1074;&#1099;&#1087;&#1086;&#1083;&#1085;&#1077;&#1085;&#1080;&#1077;
&#1085;&#1072; &#1089;&#1083;&#1091;&#1095;&#1072;&#1081;&#1085;&#1099;&#1081;
&#1080;&#1085;&#1090;&#1077;&#1088;&#1074;&#1072;&#1083; &#1080;&#1079;
&#1076;&#1080;&#1072;&#1087;&#1072;&#1079;&#1086;&#1085;&#1072; 0-50
&#1084;&#1080;&#1083;&#1083;&#1080;&#1089;&#1077;&#1082;&#1091;&#1085;&#1076;.
&#1058;.&#1077;.
&#1087;&#1088;&#1077;&#1076;&#1087;&#1086;&#1083;&#1072;&#1075;&#1072;&#1077;&#1090;&#1089;&#1103;,
&#1095;&#1090;&#1086; &#1074;&#1089;&#1105; &#1101;&#1090;&#1086;
&#1074;&#1088;&#1077;&#1084;&#1103; &#1087;&#1086;&#1090;&#1086;&#1082;
&#1087;&#1088;&#1086;&#1080;&#1079;&#1074;&#1086;&#1076;&#1080;&#1090; &#1089;
&#1088;&#1077;&#1089;&#1091;&#1088;&#1089;&#1086;&#1084;
&#1082;&#1072;&#1082;&#1080;&#1077;-&#1090;&#1086;
&#1084;&#1072;&#1085;&#1080;&#1087;&#1091;&#1083;&#1103;&#1094;&#1080;&#1080;.</p>
<code><!--mstheme--></font>
<pre>         invoke rand
         shl eax, 4              ; * 16
         neg eax                 ; &#1079;&#1072;&#1076;&#1077;&#1088;&#1078;&#1082;&#1072; = 0 - ~50 &#1084;&#1089;
         or liDelayTime.HighPart, -1
         mov liDelayTime.LowPart, eax
         invoke KeDelayExecutionThread, KernelMode, FALSE, addr liDelayTime

</pre>
<!--mstheme--><font face="Arial, Arial, Helvetica"></code>
<p>&#1050;&#1072;&#1082; &#1103; &#1091;&#1078;&#1077;
&#1089;&#1082;&#1072;&#1079;&#1072;&#1083;,
&#1092;&#1091;&#1085;&#1082;&#1094;&#1080;&#1103; <font color="#636363"><b>rand</b></font>
&#1074;&#1099;&#1076;&#1072;&#1077;&#1090;
&#1087;&#1089;&#1077;&#1074;&#1076;&#1086;&#1089;&#1083;&#1091;&#1095;&#1072;&#1081;&#1085;&#1086;&#1077;
&#1095;&#1080;&#1089;&#1083;&#1086; &#1074;
&#1076;&#1080;&#1072;&#1087;&#1072;&#1079;&#1086;&#1085;&#1077; 0 - 07FFFh.
&#1059;&#1084;&#1085;&#1086;&#1078;&#1080;&#1074; &#1077;&#1075;&#1086;
&#1085;&#1072; 16, &#1084;&#1099;
&#1087;&#1086;&#1083;&#1091;&#1095;&#1080;&#1084;
&#1085;&#1077;&#1086;&#1073;&#1093;&#1086;&#1076;&#1080;&#1084;&#1086;&#1077;
&#1085;&#1072;&#1084; &#1074;&#1088;&#1077;&#1084;&#1103;
&#1079;&#1072;&#1076;&#1077;&#1088;&#1078;&#1082;&#1080;. &#1042;&#1089;&#1105;
&#1095;&#1090;&#1086; &#1103; &#1075;&#1086;&#1074;&#1086;&#1088;&#1080;&#1083;
&#1074; &#1087;&#1088;&#1086;&#1096;&#1083;&#1099;&#1081; &#1088;&#1072;&#1079;
&#1087;&#1088;&#1086; &#1087;&#1072;&#1088;&#1072;&#1084;&#1077;&#1090;&#1088;
DueTime &#1092;&#1091;&#1085;&#1082;&#1094;&#1080;&#1080; <font color="#636363"><b>KeSetTimerEx</b></font>
&#1087;&#1086;&#1083;&#1085;&#1086;&#1089;&#1090;&#1100;&#1102;
&#1087;&#1088;&#1080;&#1084;&#1077;&#1085;&#1080;&#1084;&#1086; &#1082;
&#1087;&#1072;&#1088;&#1072;&#1084;&#1077;&#1090;&#1088;&#1091; DelayTime
&#1092;&#1091;&#1085;&#1082;&#1094;&#1080;&#1080; <font color="#636363"><b>KeDelayExecutionThread</b></font>.
&#1045;&#1076;&#1080;&#1085;&#1089;&#1090;&#1074;&#1077;&#1085;&#1085;&#1086;&#1077;
&#1086;&#1090;&#1083;&#1080;&#1095;&#1080;&#1077; &#1074; &#1090;&#1086;&#1084;,
&#1095;&#1090;&#1086; &#1074; &#1092;&#1091;&#1085;&#1082;&#1094;&#1080;&#1102; <font color="#636363"><b>KeDelayExecutionThread</b></font>
&#1087;&#1077;&#1088;&#1077;&#1076;&#1072;&#1077;&#1090;&#1089;&#1103;
&#1085;&#1077; &#1089;&#1072;&#1084;&#1086; 64-&#1073;&#1080;&#1090;&#1085;&#1086;&#1077;
&#1079;&#1085;&#1072;&#1095;&#1077;&#1085;&#1080;&#1077;, &#1072;
&#1091;&#1082;&#1072;&#1079;&#1072;&#1090;&#1077;&#1083;&#1100; &#1085;&#1072;
&#1085;&#1077;&#1075;&#1086;. &#1050;&#1072;&#1082;
&#1089;&#1083;&#1077;&#1076;&#1091;&#1077;&#1090; &#1080;&#1079;
&#1080;&#1084;&#1077;&#1085;&#1080;
&#1092;&#1091;&#1085;&#1082;&#1094;&#1080;&#1080; <font color="#636363"><b>KeDelayExecutionThread</b></font>,
&#1086;&#1085;&#1072;
&#1087;&#1088;&#1080;&#1086;&#1089;&#1090;&#1072;&#1085;&#1072;&#1074;&#1083;&#1080;&#1074;&#1072;&#1077;&#1090;
&#1088;&#1072;&#1073;&#1086;&#1090;&#1091;
&#1087;&#1086;&#1090;&#1086;&#1082;&#1072; &#1085;&#1072;
&#1085;&#1077;&#1082;&#1086;&#1090;&#1086;&#1088;&#1086;&#1077;
&#1074;&#1088;&#1077;&#1084;&#1103;. &#1069;&#1090;&#1072;
&#1092;&#1091;&#1085;&#1082;&#1094;&#1080;&#1103;
&#1076;&#1086;&#1083;&#1078;&#1085;&#1072;
&#1074;&#1099;&#1079;&#1099;&#1074;&#1072;&#1090;&#1100;&#1089;&#1103;
&#1090;&#1086;&#1083;&#1100;&#1082;&#1086; &#1087;&#1088;&#1080; IRQL =
PASSIVE_LEVEL. &#1042;&#1085;&#1091;&#1090;&#1088;&#1077;&#1085;&#1085;&#1077;
&#1086;&#1085;&#1072;
&#1080;&#1089;&#1087;&#1086;&#1083;&#1100;&#1079;&#1091;&#1077;&#1090;
&#1076;&#1083;&#1103; &#1086;&#1078;&#1080;&#1076;&#1072;&#1085;&#1080;&#1103;
&#1090;&#1072;&#1081;&#1084;&#1077;&#1088;.</p>
<p>&#1055;&#1088;&#1086; &#1092;&#1091;&#1085;&#1082;&#1094;&#1080;&#1102; <font color="#636363"><b>rand</b></font>
&#1089;&#1083;&#1077;&#1076;&#1091;&#1077;&#1090;
&#1089;&#1082;&#1072;&#1079;&#1072;&#1090;&#1100; &#1077;&#1097;&#1105;
&#1087;&#1072;&#1088;&#1091; &#1089;&#1083;&#1086;&#1074;. &#1050;&#1072;&#1082;
&#1103; &#1091;&#1078;&#1077; &#1089;&#1082;&#1072;&#1079;&#1072;&#1083;,
&#1101;&#1090;&#1072; &#1092;&#1091;&#1085;&#1082;&#1094;&#1080;&#1103;
&#1075;&#1077;&#1085;&#1077;&#1088;&#1080;&#1088;&#1091;&#1077;&#1090;
&#1087;&#1089;&#1077;&#1074;&#1076;&#1086;&#1089;&#1083;&#1091;&#1095;&#1072;&#1081;&#1085;&#1086;&#1077;
&#1095;&#1080;&#1089;&#1083;&#1086; &#1085;&#1072;
&#1086;&#1089;&#1085;&#1086;&#1074;&#1072;&#1085;&#1080;&#1080;
&#1085;&#1072;&#1095;&#1072;&#1083;&#1100;&#1085;&#1086;&#1075;&#1086;
&#1079;&#1085;&#1072;&#1095;&#1077;&#1085;&#1080;&#1103;,
&#1082;&#1086;&#1090;&#1086;&#1088;&#1086;&#1077; &#1084;&#1099;
&#1087;&#1088;&#1086;&#1080;&#1085;&#1080;&#1094;&#1080;&#1072;&#1083;&#1080;&#1079;&#1080;&#1088;&#1086;&#1074;&#1072;&#1083;&#1080;
&#1074;&#1099;&#1079;&#1086;&#1074;&#1086;&#1084;
&#1092;&#1091;&#1085;&#1082;&#1094;&#1080;&#1080; <font color="#636363"><b>srand</b></font>
&#1087;&#1088;&#1080; &#1079;&#1072;&#1087;&#1091;&#1089;&#1082;&#1077;
&#1076;&#1088;&#1072;&#1081;&#1074;&#1077;&#1088;&#1072;.
&#1050;&#1072;&#1078;&#1076;&#1099;&#1081; &#1074;&#1099;&#1079;&#1086;&#1074; <font color="#636363"><b>rand</b></font>
&#1084;&#1077;&#1085;&#1103;&#1077;&#1090; &#1101;&#1090;&#1086;
&#1085;&#1072;&#1095;&#1072;&#1083;&#1100;&#1085;&#1086;&#1077;
&#1095;&#1080;&#1089;&#1083;&#1086;, &#1072;
&#1087;&#1086;&#1089;&#1082;&#1086;&#1083;&#1100;&#1082;&#1091;
&#1101;&#1090;&#1086;
&#1075;&#1083;&#1086;&#1073;&#1072;&#1083;&#1100;&#1085;&#1072;&#1103;
&#1087;&#1077;&#1088;&#1077;&#1084;&#1077;&#1085;&#1085;&#1072;&#1103;
&#1103;&#1076;&#1088;&#1072;, &#1090;&#1086; &#1084;&#1099;
&#1086;&#1082;&#1072;&#1079;&#1099;&#1074;&#1072;&#1077;&#1084;
&#1085;&#1077;&#1082;&#1086;&#1090;&#1086;&#1088;&#1086;&#1077;
&#1074;&#1083;&#1080;&#1103;&#1085;&#1080;&#1077; &#1085;&#1072;
&#1088;&#1077;&#1079;&#1091;&#1083;&#1100;&#1090;&#1072;&#1090;
&#1074;&#1086;&#1079;&#1084;&#1086;&#1078;&#1085;&#1086;&#1075;&#1086;
&#1074;&#1099;&#1079;&#1086;&#1074;&#1072; &#1101;&#1090;&#1086;&#1081;
&#1092;&#1091;&#1085;&#1082;&#1094;&#1080;&#1080;
&#1082;&#1072;&#1082;&#1080;&#1084;-&#1090;&#1086;
&#1076;&#1088;&#1091;&#1075;&#1080;&#1084; &#1082;&#1086;&#1076;&#1086;&#1084;.
&#1053;&#1086; &#1087;&#1086;&#1089;&#1082;&#1086;&#1083;&#1100;&#1082;&#1091;
&#1088;&#1077;&#1079;&#1091;&#1083;&#1100;&#1090;&#1072;&#1090;&#1086;&#1084;
&#1103;&#1074;&#1083;&#1103;&#1077;&#1090;&#1089;&#1103;
&#1089;&#1083;&#1091;&#1095;&#1072;&#1081;&#1085;&#1086;&#1077;
&#1095;&#1080;&#1089;&#1083;&#1086;, &#1090;&#1086; &#1085;&#1080;
&#1084;&#1077;&#1085;&#1077;&#1077;, &#1085;&#1080;
&#1073;&#1086;&#1083;&#1077;&#1077;
&#1089;&#1083;&#1091;&#1095;&#1072;&#1081;&#1085;&#1099;&#1084;
&#1086;&#1085;&#1086; &#1085;&#1077; &#1089;&#1090;&#1072;&#1085;&#1077;&#1090;.
&#1058;&#1072;&#1082; &#1095;&#1090;&#1086;
&#1087;&#1086;&#1083;&#1100;&#1079;&#1086;&#1074;&#1072;&#1090;&#1100;&#1089;&#1103;
&#1092;&#1091;&#1085;&#1082;&#1094;&#1080;&#1077;&#1081; <font color="#636363"><b>rand</b></font>
&#1084;&#1086;&#1078;&#1085;&#1086; &#1073;&#1077;&#1079;
&#1086;&#1089;&#1086;&#1073;&#1099;&#1093;
&#1087;&#1088;&#1086;&#1073;&#1083;&#1077;&#1084;. &#1071;,
&#1082;&#1089;&#1090;&#1072;&#1090;&#1080;, &#1085;&#1077;
&#1086;&#1073;&#1085;&#1072;&#1088;&#1091;&#1078;&#1080;&#1083;
&#1080;&#1089;&#1087;&#1086;&#1083;&#1100;&#1079;&#1086;&#1074;&#1072;&#1085;&#1080;&#1103;
&#1101;&#1090;&#1086;&#1081; &#1092;&#1091;&#1085;&#1082;&#1094;&#1080;&#1080;
&#1089;&#1072;&#1084;&#1080;&#1084; &#1103;&#1076;&#1088;&#1086;&#1084;.</p>
<code><!--mstheme--></font>
<pre>         inc dwWorkElement

         push dwWorkElement
         pop g_dwWorkElement

</pre>
<!--mstheme--><font face="Arial, Arial, Helvetica"></code>
<p>&#1048;&#1079;&#1084;&#1077;&#1085;&#1103;&#1077;&#1084;
&#1088;&#1072;&#1079;&#1076;&#1077;&#1083;&#1103;&#1077;&#1084;&#1099;&#1081;
&#1088;&#1077;&#1089;&#1091;&#1088;&#1089; &#1080;
&#1079;&#1072;&#1087;&#1080;&#1089;&#1099;&#1074;&#1072;&#1077;&#1084;
&#1077;&#1075;&#1086; &#1085;&#1072;&#1079;&#1072;&#1076;.</p>
<code><!--mstheme--></font>
<pre>         MUTEX_RELEASE g_kMutex

</pre>
<!--mstheme--><font face="Arial, Arial, Helvetica"></code>
<p>&#1056;&#1072;&#1073;&#1086;&#1090;&#1072;
&#1089;&#1076;&#1077;&#1083;&#1072;&#1085;&#1072;, &#1080;
&#1084;&#1100;&#1102;&#1090;&#1077;&#1082;&#1089; &#1085;&#1072;&#1076;&#1086;
&#1086;&#1089;&#1074;&#1086;&#1073;&#1086;&#1076;&#1080;&#1090;&#1100;,
&#1076;&#1083;&#1103; &#1090;&#1086;&#1075;&#1086;
&#1095;&#1090;&#1086;&#1073;&#1099; &#1076;&#1088;&#1091;&#1075;&#1080;&#1077;
&#1087;&#1086;&#1090;&#1086;&#1082;&#1080;,
&#1082;&#1086;&#1090;&#1086;&#1088;&#1099;&#1077; &#1091;&#1078;&#1077;,
&#1085;&#1072;&#1074;&#1077;&#1088;&#1085;&#1086;&#1077;,
&#1078;&#1076;&#1091;&#1090; &#1077;&#1075;&#1086;
&#1086;&#1089;&#1074;&#1086;&#1073;&#1086;&#1078;&#1076;&#1077;&#1085;&#1080;&#1103;,
&#1090;&#1086;&#1078;&#1077; &#1084;&#1086;&#1075;&#1083;&#1080;
&#1087;&#1088;&#1086;&#1076;&#1077;&#1083;&#1072;&#1090;&#1100;
&#1089;&#1074;&#1086;&#1102; &#1095;&#1072;&#1089;&#1090;&#1100;
&#1088;&#1072;&#1073;&#1086;&#1090;&#1099;.</p>
<p>&#1048; &#1086;&#1087;&#1103;&#1090;&#1100;
&#1084;&#1072;&#1082;&#1088;&#1086;&#1089;,
&#1091;&#1087;&#1088;&#1086;&#1097;&#1077;&#1085;&#1085;&#1072;&#1103;
&#1092;&#1086;&#1088;&#1084;&#1072;
&#1082;&#1086;&#1090;&#1086;&#1088;&#1086;&#1075;&#1086;
&#1074;&#1099;&#1075;&#1083;&#1103;&#1076;&#1080;&#1090; &#1090;&#1072;&#1082;:</p>
<code><!--mstheme--></font>
<pre> MUTEX_RELEASE MACRO mtx:REQ
     invoke KeReleaseMutex, mtx, FALSE
 ENDM

</pre>
<!--mstheme--><font face="Arial, Arial, Helvetica"></code>
<p>&#1055;&#1086;&#1089;&#1083;&#1077;&#1076;&#1085;&#1080;&#1081;
&#1087;&#1072;&#1088;&#1072;&#1084;&#1077;&#1090;&#1088;
&#1092;&#1091;&#1085;&#1082;&#1094;&#1080;&#1080; <font color="#636363"><b>KeReleaseMutex</b></font>
&#1085;&#1091;&#1078;&#1077;&#1085; &#1076;&#1083;&#1103;
&#1091;&#1074;&#1077;&#1083;&#1080;&#1095;&#1077;&#1085;&#1080;&#1103;
&#1086;&#1073;&#1097;&#1077;&#1081;
&#1087;&#1088;&#1086;&#1080;&#1079;&#1074;&#1086;&#1076;&#1080;&#1090;&#1077;&#1083;&#1100;&#1085;&#1086;&#1089;&#1090;&#1080;.
&#1045;&#1089;&#1083;&#1080; &#1089;&#1088;&#1072;&#1079;&#1091;
&#1087;&#1086;&#1089;&#1083;&#1077;
&#1086;&#1089;&#1074;&#1086;&#1073;&#1086;&#1078;&#1076;&#1077;&#1085;&#1080;&#1103;
&#1084;&#1100;&#1102;&#1090;&#1077;&#1082;&#1089;&#1072; &#1074;&#1099;
&#1089;&#1086;&#1073;&#1080;&#1088;&#1072;&#1077;&#1090;&#1077;&#1089;&#1100;
&#1089;&#1085;&#1086;&#1074;&#1072; &#1078;&#1076;&#1072;&#1090;&#1100;,
&#1074;&#1086;&#1079;&#1084;&#1086;&#1078;&#1085;&#1086;,
&#1082;&#1072;&#1082;&#1086;&#1081;-&#1090;&#1086;
&#1076;&#1088;&#1091;&#1075;&#1086;&#1081;
&#1086;&#1073;&#1098;&#1077;&#1082;&#1090;, &#1090;&#1086;
&#1087;&#1086;&#1089;&#1083;&#1077;&#1076;&#1085;&#1080;&#1081;
&#1087;&#1072;&#1088;&#1072;&#1084;&#1077;&#1090;&#1088;
&#1084;&#1086;&#1078;&#1085;&#1086;
&#1091;&#1089;&#1090;&#1072;&#1085;&#1086;&#1074;&#1080;&#1090;&#1100; &#1074;
TRUE. &#1058;&#1086;&#1075;&#1076;&#1072; <font color="#636363"><b>KeReleaseMutex</b></font>
&#1085;&#1077; &#1073;&#1091;&#1076;&#1077;&#1090;
&#1089;&#1085;&#1080;&#1084;&#1072;&#1090;&#1100;
&#1073;&#1083;&#1086;&#1082;&#1080;&#1088;&#1086;&#1074;&#1082;&#1091; &#1089;
&#1073;&#1072;&#1079;&#1099; &#1076;&#1072;&#1085;&#1085;&#1099;&#1093;
&#1076;&#1080;&#1089;&#1087;&#1077;&#1090;&#1095;&#1077;&#1088;&#1072;, &#1072;
&#1089;&#1083;&#1077;&#1076;&#1091;&#1102;&#1097;&#1072;&#1103;
&#1092;&#1091;&#1085;&#1082;&#1094;&#1080;&#1103; <font color="#636363"><b>KeWaitXxx</b></font>
&#1089;&#1086;&#1086;&#1090;&#1074;&#1077;&#1090;&#1089;&#1090;&#1074;&#1077;&#1085;&#1085;&#1086;
&#1085;&#1077; &#1073;&#1091;&#1076;&#1077;&#1090; &#1077;&#1105;
&#1091;&#1089;&#1090;&#1072;&#1085;&#1072;&#1074;&#1083;&#1080;&#1074;&#1072;&#1090;&#1100;
&#1080; &#1074;&#1099;&#1079;&#1086;&#1074;&#1099; <font color="#636363"><b>KeReleaseMutex</b></font>-<font color="#636363"><b>KeWaitXxx</b></font>
&#1087;&#1088;&#1086;&#1081;&#1076;&#1091;&#1090; &#1082;&#1072;&#1082;
&#1077;&#1076;&#1080;&#1085;&#1072;&#1103;
&#1072;&#1090;&#1086;&#1084;&#1072;&#1088;&#1085;&#1072;&#1103;
&#1086;&#1087;&#1077;&#1088;&#1072;&#1094;&#1080;&#1103;:
&#1073;&#1083;&#1086;&#1082;&#1080;&#1088;&#1086;&#1074;&#1082;&#1072;
&#1073;&#1072;&#1079;&#1099; &#1076;&#1072;&#1085;&#1085;&#1099;&#1093;
&#1076;&#1080;&#1089;&#1087;&#1077;&#1090;&#1095;&#1077;&#1088;&#1072;
&#1073;&#1091;&#1076;&#1077;&#1090;
&#1091;&#1089;&#1090;&#1072;&#1085;&#1086;&#1074;&#1083;&#1077;&#1085;&#1072;
&#1087;&#1088;&#1080; &#1074;&#1093;&#1086;&#1076;&#1077; &#1074; <font color="#636363"><b>KeReleaseMutex</b></font>,
&#1072; &#1089;&#1085;&#1103;&#1090;&#1072;
&#1074;&#1085;&#1091;&#1090;&#1088;&#1080; <font color="#636363"><b>KeWaitXxx</b></font>.
&#1071; &#1080;&#1089;&#1087;&#1086;&#1083;&#1100;&#1079;&#1091;&#1102;
&#1079;&#1085;&#1072;&#1095;&#1077;&#1085;&#1080;&#1077; FALSE, &#1090;.&#1082;.
&#1084;&#1072;&#1082;&#1088;&#1086;&#1089;&#1099; MUTEX_INIT, MUTEX_WAIT &#1080;
MUTEX_RELEASE - &#1101;&#1090;&#1086; &#1086;&#1073;&#1097;&#1077;&#1077;
&#1088;&#1077;&#1096;&#1077;&#1085;&#1080;&#1077; &#1085;&#1072;
&#1074;&#1089;&#1077; &#1089;&#1083;&#1091;&#1095;&#1072;&#1080;
&#1078;&#1080;&#1079;&#1085;&#1080;. &#1045;&#1089;&#1083;&#1080;
&#1074;&#1088;&#1077;&#1084;&#1103; &#1076;&#1083;&#1103; &#1074;&#1072;&#1089;
&#1082;&#1088;&#1080;&#1090;&#1080;&#1095;&#1085;&#1086;, &#1090;&#1086;
&#1090;&#1086;&#1075;&#1076;&#1072; &#1084;&#1086;&#1078;&#1085;&#1086;
&#1087;&#1088;&#1080;&#1073;&#1077;&#1075;&#1085;&#1091;&#1090;&#1100; &#1082;
&#1086;&#1087;&#1090;&#1080;&#1084;&#1080;&#1079;&#1072;&#1094;&#1080;&#1080;.
&#1071; &#1087;&#1088;&#1080;&#1074;&#1086;&#1078;&#1091;
&#1091;&#1087;&#1088;&#1086;&#1097;&#1077;&#1085;&#1085;&#1099;&#1077;
&#1074;&#1077;&#1088;&#1089;&#1080;&#1080;
&#1084;&#1072;&#1082;&#1088;&#1086;&#1089;&#1086;&#1074; &#1076;&#1083;&#1103;
&#1090;&#1086;&#1075;&#1086;, &#1095;&#1090;&#1086;&#1073;&#1099; &#1074;
&#1089;&#1083;&#1091;&#1095;&#1072;&#1077; &#1077;&#1089;&#1083;&#1080;
&#1074;&#1099; &#1089; &#1085;&#1080;&#1084;&#1080; &#1085;&#1077;
&#1076;&#1088;&#1091;&#1078;&#1080;&#1090;&#1077;, &#1074;&#1072;&#1084;
&#1073;&#1099;&#1083;&#1086; &#1087;&#1086;&#1085;&#1103;&#1090;&#1085;&#1086;
&#1082;&#1072;&#1082;&#1080;&#1077;
&#1092;&#1091;&#1085;&#1082;&#1094;&#1080;&#1080; &#1080; &#1082;&#1072;&#1082;
&#1089;&#1083;&#1077;&#1076;&#1091;&#1077;&#1090;
&#1080;&#1089;&#1087;&#1086;&#1083;&#1100;&#1079;&#1086;&#1074;&#1072;&#1090;&#1100;.</p>
<p>&#1060;&#1091;&#1085;&#1082;&#1094;&#1080;&#1103; <font color="#636363"><b>KeReleaseMutex</b></font>,
&#1082;&#1089;&#1090;&#1072;&#1090;&#1080;,
&#1103;&#1074;&#1083;&#1103;&#1077;&#1090;&#1089;&#1103;
&#1086;&#1073;&#1086;&#1083;&#1086;&#1095;&#1082;&#1086;&#1081;
&#1074;&#1086;&#1082;&#1088;&#1091;&#1075; &#1073;&#1086;&#1083;&#1077;&#1077;
&#1075;&#1080;&#1073;&#1082;&#1086;&#1081;
&#1092;&#1091;&#1085;&#1082;&#1094;&#1080;&#1080; KeReleaseMutant.</p>
<p>&#1045;&#1097;&#1105;
&#1085;&#1077;&#1089;&#1082;&#1086;&#1083;&#1100;&#1082;&#1086;
&#1084;&#1086;&#1084;&#1077;&#1085;&#1090;&#1086;&#1074; &#1087;&#1086;
&#1087;&#1086;&#1074;&#1086;&#1076;&#1091;
&#1086;&#1073;&#1099;&#1095;&#1085;&#1086;&#1075;&#1086; (&#1085;&#1077;
&#1073;&#1099;&#1089;&#1090;&#1088;&#1086;&#1075;&#1086;)
&#1084;&#1100;&#1102;&#1090;&#1077;&#1082;&#1089;&#1072;. &#1047;&#1072;
&#1082;&#1072;&#1078;&#1076;&#1099;&#1084;
&#1079;&#1072;&#1093;&#1074;&#1072;&#1090;&#1086;&#1084;
&#1084;&#1100;&#1102;&#1090;&#1077;&#1082;&#1089;&#1072;
&#1076;&#1086;&#1083;&#1078;&#1085;&#1086;
&#1089;&#1083;&#1077;&#1076;&#1086;&#1074;&#1072;&#1090;&#1100;
&#1077;&#1075;&#1086;
&#1086;&#1089;&#1074;&#1086;&#1073;&#1086;&#1078;&#1076;&#1077;&#1085;&#1080;&#1077;.
&#1055;&#1088;&#1080;&#1095;&#1077;&#1084;
&#1084;&#1100;&#1102;&#1090;&#1077;&#1082;&#1089;
&#1084;&#1086;&#1078;&#1085;&#1086;
&#1079;&#1072;&#1093;&#1074;&#1072;&#1090;&#1099;&#1074;&#1072;&#1090;&#1100;
&#1088;&#1077;&#1082;&#1091;&#1088;&#1089;&#1080;&#1074;&#1085;&#1086;, &#1090;.&#1077;.
&#1085;&#1077;&#1089;&#1082;&#1086;&#1083;&#1100;&#1082;&#1086;
&#1088;&#1072;&#1079; &#1087;&#1086;&#1076;&#1088;&#1103;&#1076;, &#1085;&#1086;
&#1090;&#1086;&#1083;&#1100;&#1082;&#1086; &#1086;&#1076;&#1085;&#1080;&#1084;
&#1087;&#1086;&#1090;&#1086;&#1082;&#1086;&#1084;. &#1045;&#1089;&#1083;&#1080;
&#1087;&#1086;&#1090;&#1086;&#1082;
&#1085;&#1077;&#1089;&#1082;&#1086;&#1083;&#1100;&#1082;&#1086;
&#1088;&#1072;&#1079; &#1079;&#1072;&#1093;&#1074;&#1072;&#1090;&#1080;&#1083;
&#1084;&#1100;&#1102;&#1090;&#1077;&#1082;&#1089;, &#1090;&#1086;
&#1088;&#1086;&#1074;&#1085;&#1086;
&#1089;&#1090;&#1086;&#1083;&#1100;&#1082;&#1086; &#1078;&#1077;
&#1088;&#1072;&#1079; &#1076;&#1086;&#1083;&#1078;&#1077;&#1085;
&#1077;&#1075;&#1086;
&#1086;&#1089;&#1074;&#1086;&#1073;&#1086;&#1076;&#1080;&#1090;&#1100;.
&#1050;&#1086;&#1083;&#1080;&#1095;&#1077;&#1089;&#1090;&#1074;&#1086;
&#1088;&#1077;&#1082;&#1091;&#1088;&#1089;&#1080;&#1074;&#1085;&#1099;&#1093;
&#1079;&#1072;&#1093;&#1074;&#1072;&#1090;&#1086;&#1074;
&#1084;&#1100;&#1102;&#1090;&#1077;&#1082;&#1089;&#1072;
&#1086;&#1075;&#1088;&#1072;&#1085;&#1080;&#1095;&#1077;&#1085;&#1086;
&#1082;&#1086;&#1085;&#1089;&#1090;&#1072;&#1085;&#1090;&#1086;&#1081; MINLONG,
&#1088;&#1072;&#1074;&#1085;&#1086;&#1081; 80000000h.
&#1045;&#1089;&#1083;&#1080; &#1074;&#1099;
&#1087;&#1088;&#1077;&#1074;&#1099;&#1089;&#1080;&#1090;&#1077;
&#1101;&#1090;&#1086;
&#1085;&#1077;&#1089;&#1091;&#1088;&#1072;&#1079;&#1085;&#1086;
&#1073;&#1086;&#1083;&#1100;&#1096;&#1086;&#1077;
&#1079;&#1085;&#1072;&#1095;&#1077;&#1085;&#1080;&#1077;, &#1090;&#1086;
&#1087;&#1086;&#1083;&#1091;&#1095;&#1080;&#1090;&#1077; BSOD &#1089;
&#1082;&#1086;&#1076;&#1086;&#1084; STATUS_MUTANT_LIMIT_EXCEEDED.
&#1045;&#1089;&#1083;&#1080;
&#1087;&#1086;&#1087;&#1099;&#1090;&#1072;&#1077;&#1090;&#1077;&#1089;&#1100;
&#1086;&#1089;&#1074;&#1086;&#1073;&#1086;&#1076;&#1080;&#1090;&#1100;
&#1085;&#1077; &#1074;&#1072;&#1084;&#1080;
&#1079;&#1072;&#1085;&#1103;&#1090;&#1099;&#1081;
&#1084;&#1100;&#1102;&#1090;&#1077;&#1082;&#1089;, &#1090;&#1086; -
STATUS_MUTANT_NOT_OWNED.</p>
<code><!--mstheme--></font>
<pre>         mov eax, liDelayTime.LowPart
         neg eax
         mov edx, 3518437209     ; &#1052;&#1072;&#1075;&#1080;&#1095;&#1077;&#1089;&#1082;&#1086;&#1077; &#1095;&#1080;&#1089;&#1083;&#1086;
         mul edx
         shr edx, 13
         invoke DbgPrint, $CTA0(&quot;MutualExclusion: Thread %08X work #%d is done (%02dms)\n&quot;), \
                            pkThread, ebx, edx

</pre>
<!--mstheme--><font face="Arial, Arial, Helvetica"></code>
<p>&#1044;&#1083;&#1103;
&#1082;&#1086;&#1085;&#1090;&#1088;&#1086;&#1083;&#1103;
&#1074;&#1099;&#1074;&#1086;&#1076;&#1080;&#1084;
&#1089;&#1086;&#1086;&#1073;&#1097;&#1077;&#1085;&#1080;&#1077;, &#1074;
&#1082;&#1086;&#1090;&#1086;&#1088;&#1086;&#1084;
&#1087;&#1086;&#1090;&#1086;&#1082;
&#1091;&#1074;&#1077;&#1076;&#1086;&#1084;&#1083;&#1103;&#1077;&#1090; &#1086;
&#1090;&#1086;&#1084;, &#1082;&#1072;&#1082;&#1091;&#1102; &#1087;&#1086;
&#1089;&#1095;&#1077;&#1090;&#1091; &#1088;&#1072;&#1073;&#1086;&#1090;&#1091;
&#1086;&#1085; &#1089;&#1076;&#1077;&#1083;&#1072;&#1083;, &#1080;
&#1089;&#1082;&#1086;&#1083;&#1100;&#1082;&#1086; &#1101;&#1090;&#1086;
&#1079;&#1072;&#1085;&#1103;&#1083;&#1086;
&#1074;&#1088;&#1077;&#1084;&#1077;&#1085;&#1080;.
&#1047;&#1076;&#1077;&#1089;&#1100; &#1103;
&#1080;&#1089;&#1087;&#1086;&#1083;&#1100;&#1079;&#1091;&#1102; &quot;&#1084;&#1072;&#1075;&#1080;&#1095;&#1077;&#1089;&#1082;&#1086;&#1077;
&#1076;&#1077;&#1083;&#1077;&#1085;&#1080;&#1077;&quot; - &#1101;&#1090;&#1086;
&#1076;&#1077;&#1083;&#1077;&#1085;&#1080;&#1077;
&#1095;&#1077;&#1088;&#1077;&#1079;
&#1091;&#1084;&#1085;&#1086;&#1078;&#1077;&#1085;&#1080;&#1077;,
&#1095;&#1090;&#1086; &#1075;&#1086;&#1088;&#1072;&#1079;&#1076;&#1086;
&#1073;&#1099;&#1089;&#1090;&#1088;&#1077;&#1077; (&#1093;&#1086;&#1090;&#1103;,
&#1074; &#1076;&#1072;&#1085;&#1085;&#1086;&#1084;
&#1089;&#1083;&#1091;&#1095;&#1072;&#1077;, &#1074;&#1088;&#1077;&#1084;&#1103;
&#1072;&#1073;&#1089;&#1086;&#1083;&#1102;&#1090;&#1085;&#1086; &#1085;&#1077;
&#1082;&#1088;&#1080;&#1090;&#1080;&#1095;&#1085;&#1086;).
&#1055;&#1086;&#1089;&#1082;&#1086;&#1083;&#1100;&#1082;&#1091;
&#1079;&#1072;&#1076;&#1077;&#1088;&#1078;&#1082;&#1072;
&#1080;&#1079;&#1084;&#1077;&#1088;&#1103;&#1077;&#1090;&#1089;&#1103; &#1074;
100-&#1085;&#1072;&#1085;&#1086;&#1089;&#1077;&#1082;&#1091;&#1085;&#1076;&#1085;&#1099;&#1093;
&#1080;&#1085;&#1090;&#1077;&#1088;&#1074;&#1072;&#1083;&#1072;&#1093;,
&#1085;&#1072;&#1076;&#1086;
&#1091;&#1084;&#1085;&#1086;&#1078;&#1080;&#1090;&#1100; &#1101;&#1090;&#1086;
&#1095;&#1080;&#1089;&#1083;&#1086; &#1085;&#1072; 10000, &#1076;&#1083;&#1103;
&#1090;&#1086;&#1075;&#1086; &#1095;&#1090;&#1086;&#1073;&#1099;
&#1087;&#1077;&#1088;&#1077;&#1081;&#1090;&#1080; &#1082;
&#1084;&#1080;&#1083;&#1083;&#1080;&#1089;&#1077;&#1082;&#1091;&#1085;&#1076;&#1072;&#1084;.
&#1044;&#1083;&#1103;
&#1074;&#1099;&#1095;&#1080;&#1089;&#1083;&#1077;&#1085;&#1080;&#1103; &quot;&#1084;&#1072;&#1075;&#1080;&#1095;&#1077;&#1089;&#1082;&#1080;&#1093;
&#1095;&#1080;&#1089;&#1077;&#1083;&quot; &#1080;&#1097;&#1080;&#1090;&#1077;
&#1085;&#1072; <a href="http://www.wasm.ru/">http://www.wasm.ru/</a> &#1074;
&#1088;&#1072;&#1079;&#1076;&#1077;&#1083;&#1077; &quot;&#1054;&#1073;&#1088;&#1072;&#1079;&#1086;&#1074;&#1072;&#1090;&#1077;&#1083;&#1100;&#1085;&#1099;&#1077;
&#1087;&#1088;&#1086;&#1075;&#1088;&#1072;&#1084;&#1084;&#1099;&quot;
&#1091;&#1090;&#1080;&#1083;&#1080;&#1090;&#1091; <font color="#636363"><b><i>Magic
Divider by The Svin</i></b></font>.</p>
<code><!--mstheme--></font>
<pre>         inc ebx

     .endw

</pre>
<!--mstheme--><font face="Arial, Arial, Helvetica"></code>
<p>&#1055;&#1077;&#1088;&#1077;&#1093;&#1086;&#1076;&#1080;&#1084; &#1082;
&#1089;&#1083;&#1077;&#1076;&#1091;&#1102;&#1097;&#1077;&#1081;
&#1088;&#1072;&#1073;&#1086;&#1090;&#1077;.</p>
<code><!--mstheme--></font>
<pre>     invoke PsTerminateSystemThread, STATUS_SUCCESS

</pre>
<!--mstheme--><font face="Arial, Arial, Helvetica"></code>
<p>&#1045;&#1089;&#1083;&#1080; &#1074;&#1089;&#1077;
&#1088;&#1072;&#1073;&#1086;&#1090;&#1099;
&#1089;&#1076;&#1077;&#1083;&#1072;&#1085;&#1099;,
&#1088;&#1072;&#1079;&#1088;&#1091;&#1096;&#1072;&#1077;&#1084;
&#1087;&#1086;&#1090;&#1086;&#1082;.</p>
<br>
<br>
<p>&nbsp;<!--mstheme--></font>
<h2><!--mstheme--><font face="Arial, Arial, Helvetica" color="#CCCCCC">13.5
&#1055;&#1088;&#1086;&#1094;&#1077;&#1076;&#1091;&#1088;&#1072; DriverUnload<!--mstheme--></font></h2>
<!--mstheme--><font face="Arial, Arial, Helvetica">
<p>&nbsp;</p>
<p>&#1058;&#1086;&#1095;&#1085;&#1086; &#1090;&#1072;&#1082; &#1078;&#1077;
&#1082;&#1072;&#1082; &#1080; &#1074;
&#1076;&#1088;&#1072;&#1081;&#1074;&#1077;&#1088;&#1077; TimerWorks,
&#1087;&#1088;&#1077;&#1078;&#1076;&#1077; &#1095;&#1077;&#1084;
&#1087;&#1086;&#1079;&#1074;&#1086;&#1083;&#1080;&#1090;&#1100;
&#1074;&#1099;&#1075;&#1088;&#1091;&#1079;&#1080;&#1090;&#1100;
&#1076;&#1088;&#1072;&#1081;&#1074;&#1077;&#1088; &#1085;&#1072;&#1076;&#1086;
&#1091;&#1073;&#1077;&#1076;&#1080;&#1090;&#1100;&#1089;&#1103;,
&#1095;&#1090;&#1086; &#1074;&#1089;&#1077;
&#1087;&#1086;&#1090;&#1086;&#1082;&#1080;
&#1079;&#1072;&#1074;&#1077;&#1088;&#1096;&#1080;&#1083;&#1080;
&#1088;&#1072;&#1073;&#1086;&#1090;&#1091;, &#1090;.&#1082;.
&#1087;&#1086;&#1090;&#1086;&#1082;&#1086;&#1074;&#1072;&#1103;
&#1087;&#1088;&#1086;&#1094;&#1077;&#1076;&#1091;&#1088;&#1072;
&#1085;&#1072;&#1093;&#1086;&#1076;&#1080;&#1090;&#1089;&#1103; &#1074;
&#1090;&#1077;&#1083;&#1077;
&#1076;&#1088;&#1072;&#1081;&#1074;&#1077;&#1088;&#1072; &#1080;
&#1077;&#1075;&#1086;
&#1087;&#1088;&#1077;&#1078;&#1076;&#1077;&#1074;&#1088;&#1077;&#1084;&#1077;&#1085;&#1085;&#1072;&#1103;
&#1074;&#1099;&#1075;&#1088;&#1091;&#1079;&#1082;&#1072;
&#1087;&#1088;&#1080;&#1074;&#1077;&#1076;&#1077;&#1090; &#1082;
&#1082;&#1088;&#1072;&#1093;&#1091;
&#1089;&#1080;&#1089;&#1090;&#1077;&#1084;&#1099;. &#1052;&#1099;
&#1088;&#1077;&#1096;&#1080;&#1084; &#1101;&#1090;&#1091;
&#1087;&#1088;&#1086;&#1073;&#1083;&#1077;&#1084;&#1091;
&#1090;&#1086;&#1095;&#1085;&#1086; &#1090;&#1072;&#1082;&#1078;&#1077;
&#1082;&#1072;&#1082; &#1080; &#1074;
&#1087;&#1088;&#1086;&#1096;&#1083;&#1099;&#1081; &#1088;&#1072;&#1079; -
&#1073;&#1091;&#1076;&#1077;&#1084; &#1078;&#1076;&#1072;&#1090;&#1100;,
&#1085;&#1086; &#1090;&#1077;&#1087;&#1077;&#1088;&#1100; &#1091;&#1078;&#1077;
&#1085;&#1077;&#1089;&#1082;&#1086;&#1083;&#1100;&#1082;&#1086;
&#1087;&#1086;&#1090;&#1086;&#1082;&#1086;&#1074;.</p>
<code><!--mstheme--></font>
<pre>     .if g_dwCountThreads &gt; 0

         invoke KeWaitForMultipleObjects, g_dwCountThreads, addr g_apkThreads, WaitAll, \
                     Executive, KernelMode, FALSE, NULL, g_pkWaitBlock

</pre>
<!--mstheme--><font face="Arial, Arial, Helvetica"></code>
<p>&#1045;&#1089;&#1083;&#1080; &#1077;&#1089;&#1090;&#1100;
&#1082;&#1086;&#1075;&#1086; &#1078;&#1076;&#1072;&#1090;&#1100;, &#1090;&#1086;
&#1074;&#1099;&#1079;&#1099;&#1074;&#1072;&#1077;&#1084;
&#1092;&#1091;&#1085;&#1082;&#1094;&#1080;&#1102; <font color="#636363"><b>KeWaitForMultipleObjects</b></font>.
&#1055;&#1072;&#1088;&#1072;&#1084;&#1077;&#1090;&#1088;&#1099;
&#1101;&#1090;&#1086;&#1081; &#1092;&#1091;&#1085;&#1082;&#1094;&#1080;&#1080;
&#1074; &#1086;&#1089;&#1085;&#1086;&#1074;&#1085;&#1086;&#1084;
&#1089;&#1086;&#1074;&#1087;&#1072;&#1076;&#1072;&#1102;&#1090; &#1089;
&#1087;&#1072;&#1088;&#1072;&#1084;&#1077;&#1090;&#1088;&#1072;&#1084;&#1080;
&#1092;&#1091;&#1085;&#1082;&#1094;&#1080;&#1080; <font color="#636363"><b>KeWaitForSingleObject</b></font>,
&#1085;&#1086; &#1101;&#1090;&#1072;
&#1092;&#1091;&#1085;&#1082;&#1094;&#1080;&#1103;
&#1086;&#1078;&#1080;&#1076;&#1072;&#1077;&#1090; &#1085;&#1077;
&#1086;&#1076;&#1080;&#1085;, &#1072; &#1089;&#1088;&#1072;&#1079;&#1091;
&#1085;&#1077;&#1089;&#1082;&#1086;&#1083;&#1100;&#1082;&#1086;
&#1086;&#1073;&#1098;&#1077;&#1082;&#1090;&#1086;&#1074;.
&#1055;&#1088;&#1080;&#1095;&#1077;&#1084;
&#1086;&#1073;&#1098;&#1077;&#1082;&#1090;&#1099;
&#1084;&#1086;&#1075;&#1091;&#1090; &#1073;&#1099;&#1090;&#1100;
&#1088;&#1072;&#1079;&#1085;&#1099;&#1077;,
&#1075;&#1083;&#1072;&#1074;&#1085;&#1086;&#1077;
&#1095;&#1090;&#1086;&#1073;&#1099; &#1086;&#1085;&#1080;
&#1073;&#1099;&#1083;&#1080;
&#1086;&#1078;&#1080;&#1076;&#1072;&#1077;&#1084;&#1099;&#1084;&#1080;.</p>
<p>&#1055;&#1077;&#1088;&#1074;&#1099;&#1081;
&#1087;&#1072;&#1088;&#1072;&#1084;&#1077;&#1090;&#1088;
&#1086;&#1087;&#1088;&#1077;&#1076;&#1077;&#1083;&#1103;&#1077;&#1090;
&#1082;&#1086;&#1083;&#1080;&#1095;&#1077;&#1089;&#1090;&#1074;&#1086;
&#1086;&#1073;&#1098;&#1077;&#1082;&#1090;&#1086;&#1074; &#1074;
&#1084;&#1072;&#1089;&#1089;&#1080;&#1074;&#1077;
&#1091;&#1082;&#1072;&#1079;&#1072;&#1090;&#1077;&#1083;&#1077;&#1081;
&#1085;&#1072; &#1086;&#1073;&#1098;&#1077;&#1082;&#1090;&#1099;,
&#1072;&#1076;&#1088;&#1077;&#1089;
&#1082;&#1086;&#1090;&#1086;&#1088;&#1086;&#1075;&#1086;
&#1087;&#1077;&#1088;&#1077;&#1076;&#1072;&#1077;&#1090;&#1089;&#1103;
&#1074;&#1086; &#1074;&#1090;&#1086;&#1088;&#1086;&#1084;
&#1087;&#1072;&#1088;&#1072;&#1084;&#1077;&#1090;&#1088;&#1077;.
&#1058;&#1088;&#1077;&#1090;&#1080;&#1081;
&#1087;&#1072;&#1088;&#1072;&#1084;&#1077;&#1090;&#1088;
&#1086;&#1087;&#1088;&#1077;&#1076;&#1077;&#1083;&#1103;&#1077;&#1090;,
&#1093;&#1086;&#1090;&#1080;&#1084; &#1083;&#1080; &#1084;&#1099;
&#1078;&#1076;&#1072;&#1090;&#1100; &#1074;&#1089;&#1077;
&#1086;&#1073;&#1098;&#1077;&#1082;&#1090;&#1099; &#1080;&#1083;&#1080;
&#1087;&#1077;&#1088;&#1074;&#1099;&#1081;
&#1086;&#1089;&#1074;&#1086;&#1073;&#1086;&#1076;&#1080;&#1074;&#1096;&#1080;&#1081;&#1089;&#1103;.
&#1045;&#1089;&#1083;&#1080; &#1074;&#1099;
&#1079;&#1072;&#1093;&#1086;&#1090;&#1080;&#1090;&#1077;
&#1078;&#1076;&#1072;&#1090;&#1100; &#1087;&#1077;&#1088;&#1074;&#1099;&#1081;
&#1086;&#1089;&#1074;&#1086;&#1073;&#1086;&#1076;&#1080;&#1074;&#1096;&#1080;&#1081;&#1089;&#1103;
&#1086;&#1073;&#1098;&#1077;&#1082;&#1090;, &#1090;&#1086;
&#1086;&#1087;&#1088;&#1077;&#1076;&#1077;&#1083;&#1080;&#1090;&#1100;,
&#1082;&#1072;&#1082;&#1086;&#1081; &#1080;&#1084;&#1077;&#1085;&#1085;&#1086;
&#1086;&#1073;&#1098;&#1077;&#1082;&#1090;
&#1087;&#1077;&#1088;&#1077;&#1096;&#1077;&#1083; &#1074;
&#1089;&#1074;&#1086;&#1073;&#1086;&#1076;&#1085;&#1086;&#1077;
&#1089;&#1086;&#1089;&#1090;&#1086;&#1103;&#1085;&#1080;&#1077;
&#1084;&#1086;&#1078;&#1085;&#1086; &#1073;&#1091;&#1076;&#1077;&#1090;
&#1087;&#1086;
&#1074;&#1086;&#1079;&#1074;&#1088;&#1072;&#1097;&#1077;&#1085;&#1085;&#1086;&#1084;&#1091;
<b><font color="#00FFFF">KeWaitForMultipleObjects</font></b>
&#1079;&#1085;&#1072;&#1095;&#1077;&#1085;&#1080;&#1102;.
&#1045;&#1089;&#1083;&#1080; &#1086;&#1085;&#1086;
&#1073;&#1091;&#1076;&#1077;&#1090; &#1088;&#1072;&#1074;&#1085;&#1086;
STATUS_WAIT_0, &#1090;&#1086; &#1079;&#1085;&#1072;&#1095;&#1080;&#1090;,
&#1074;&#1099; &#1076;&#1086;&#1078;&#1076;&#1072;&#1083;&#1080;&#1089;&#1100;
&#1087;&#1077;&#1088;&#1074;&#1099;&#1081;
&#1086;&#1073;&#1098;&#1077;&#1082;&#1090; &#1074;
&#1084;&#1072;&#1089;&#1089;&#1080;&#1074;&#1077;, &#1077;&#1089;&#1083;&#1080;
STATUS_WAIT_1 - &#1074;&#1090;&#1086;&#1088;&#1086;&#1081;, &#1080; &#1090;.&#1076;.
&#1055;&#1086;&#1089;&#1083;&#1077;&#1076;&#1085;&#1080;&#1081;
&#1087;&#1072;&#1088;&#1072;&#1084;&#1077;&#1090;&#1088; - &#1101;&#1090;&#1086;
&#1091;&#1082;&#1072;&#1079;&#1072;&#1090;&#1077;&#1083;&#1100; &#1085;&#1072;
&#1073;&#1083;&#1086;&#1082; &#1087;&#1072;&#1084;&#1103;&#1090;&#1080;,
&#1082;&#1086;&#1090;&#1086;&#1088;&#1099;&#1081;
&#1092;&#1091;&#1085;&#1082;&#1094;&#1080;&#1103; <b><font color="#00FFFF">KeWaitForMultipleObjects</font></b>
&#1080;&#1089;&#1087;&#1086;&#1083;&#1100;&#1079;&#1091;&#1077;&#1090;
&#1076;&#1083;&#1103;
&#1086;&#1088;&#1075;&#1072;&#1085;&#1080;&#1079;&#1072;&#1094;&#1080;&#1080;
&#1086;&#1078;&#1080;&#1076;&#1072;&#1085;&#1080;&#1103;.
&#1056;&#1072;&#1079;&#1084;&#1077;&#1088; &#1101;&#1090;&#1086;&#1075;&#1086;
&#1073;&#1083;&#1086;&#1082;&#1072; &#1076;&#1086;&#1083;&#1078;&#1077;&#1085;
&#1073;&#1099;&#1090;&#1100; &#1088;&#1072;&#1074;&#1077;&#1085;
&#1087;&#1088;&#1086;&#1080;&#1079;&#1074;&#1077;&#1076;&#1077;&#1085;&#1080;&#1102;
&#1088;&#1072;&#1079;&#1084;&#1077;&#1088;&#1072;
&#1089;&#1090;&#1088;&#1091;&#1082;&#1090;&#1091;&#1088;&#1099; KWAIT_BLOCK
&#1085;&#1072;
&#1082;&#1086;&#1083;&#1080;&#1095;&#1077;&#1089;&#1090;&#1074;&#1086;
&#1086;&#1073;&#1098;&#1077;&#1082;&#1090;&#1086;&#1074;. &#1042;<font color="#00FFFF">
<b>DriverEntry</b> </font>&#1084;&#1099; &#1091;&#1078;&#1077;
&#1074;&#1099;&#1076;&#1077;&#1083;&#1080;&#1083;&#1080;
&#1085;&#1077;&#1086;&#1073;&#1093;&#1086;&#1076;&#1080;&#1084;&#1091;&#1102;
&#1087;&#1072;&#1084;&#1103;&#1090;&#1100;. &#1052;&#1099;
&#1089;&#1076;&#1077;&#1083;&#1072;&#1083;&#1080; &#1101;&#1090;&#1086;
&#1079;&#1072;&#1088;&#1072;&#1085;&#1077;&#1077;, &#1090;.&#1082;.
&#1077;&#1089;&#1083;&#1080; &#1074;&#1076;&#1088;&#1091;&#1075; (&#1095;&#1090;&#1086;
&#1084;&#1072;&#1083;&#1086;
&#1074;&#1077;&#1088;&#1086;&#1103;&#1090;&#1085;&#1086;, &#1085;&#1086;
&#1074;&#1089;&#1077; &#1078;&#1077;) &#1084;&#1099; &#1085;&#1077;
&#1089;&#1084;&#1086;&#1078;&#1077;&#1084;
&#1074;&#1099;&#1076;&#1077;&#1083;&#1080;&#1090;&#1100; &#1101;&#1090;&#1091;
&#1087;&#1072;&#1084;&#1103;&#1090;&#1100;
&#1089;&#1077;&#1081;&#1095;&#1072;&#1089; - &#1087;&#1088;&#1080;
&#1074;&#1099;&#1075;&#1088;&#1091;&#1079;&#1082;&#1077;
&#1076;&#1088;&#1072;&#1081;&#1074;&#1077;&#1088;&#1072;, &#1090;&#1086;,
&#1082;&#1072;&#1082; &#1078;&#1077; &#1084;&#1099;
&#1073;&#1091;&#1076;&#1077;&#1084; &#1078;&#1076;&#1072;&#1090;&#1100;
&#1079;&#1072;&#1074;&#1077;&#1088;&#1096;&#1077;&#1085;&#1080;&#1103;
&#1088;&#1072;&#1073;&#1086;&#1090;&#1099; &#1085;&#1072;&#1096;&#1080;&#1093;
&#1087;&#1086;&#1090;&#1086;&#1082;&#1086;&#1074;?</p>
<code><!--mstheme--></font>
<pre> KTHREAD STRUCT
 . . .
     WaitBlock KWAIT_BLOCK 4 dup(&lt;&gt;)
 . . .
 KTHREAD ENDS

</pre>
<!--mstheme--><font face="Arial, Arial, Helvetica"></code>
<p>&#1045;&#1089;&#1083;&#1080;
&#1082;&#1086;&#1083;&#1080;&#1095;&#1077;&#1089;&#1090;&#1074;&#1086;
&#1086;&#1073;&#1098;&#1077;&#1082;&#1090;&#1086;&#1074; &#1085;&#1077;
&#1073;&#1086;&#1083;&#1077;&#1077; THREAD_WAIT_OBJECTS (3),
&#1084;&#1086;&#1078;&#1085;&#1086; &#1085;&#1077;
&#1074;&#1099;&#1076;&#1077;&#1083;&#1103;&#1090;&#1100; WaitBlock, &#1090;.&#1082;.
&#1074; &#1101;&#1090;&#1086;&#1084; &#1089;&#1083;&#1091;&#1095;&#1072;&#1077;
&#1089;&#1080;&#1089;&#1090;&#1077;&#1084;&#1072;
&#1073;&#1091;&#1076;&#1077;&#1090;
&#1080;&#1089;&#1087;&#1086;&#1083;&#1100;&#1079;&#1086;&#1074;&#1072;&#1090;&#1100;
&#1087;&#1072;&#1084;&#1103;&#1090;&#1100;,
&#1079;&#1072;&#1088;&#1077;&#1079;&#1077;&#1088;&#1074;&#1080;&#1088;&#1086;&#1074;&#1072;&#1085;&#1085;&#1091;&#1102;
&#1087;&#1088;&#1103;&#1084;&#1086; &#1074;
&#1086;&#1073;&#1098;&#1077;&#1082;&#1090;&#1077; &quot;&#1087;&#1086;&#1090;&#1086;&#1082;&quot;:</p>
<code><!--mstheme--></font>
<pre>         .while g_dwCountThreads
             dec g_dwCountThreads
             mov eax, g_dwCountThreads
             fastcall ObfDereferenceObject, g_apkThreads[eax * type g_apkThreads]
         .endw

</pre>
<!--mstheme--><font face="Arial, Arial, Helvetica"></code>
<p>&#1044;&#1086;&#1078;&#1076;&#1072;&#1074;&#1096;&#1080;&#1089;&#1100;
&#1086;&#1082;&#1086;&#1085;&#1095;&#1072;&#1085;&#1080;&#1103;
&#1088;&#1072;&#1073;&#1086;&#1090;&#1099; &#1074;&#1089;&#1077;&#1093;
&#1087;&#1086;&#1090;&#1086;&#1082;&#1086;&#1074;,
&#1091;&#1084;&#1077;&#1085;&#1100;&#1096;&#1072;&#1077;&#1084;
&#1082;&#1086;&#1083;&#1080;&#1095;&#1077;&#1089;&#1090;&#1074;&#1086;
&#1089;&#1089;&#1099;&#1083;&#1086;&#1082; &#1085;&#1072; &#1080;&#1093;
&#1086;&#1073;&#1098;&#1077;&#1082;&#1090;&#1099;,
&#1082;&#1086;&#1090;&#1086;&#1088;&#1086;&#1077; &#1084;&#1099;
&#1091;&#1074;&#1077;&#1083;&#1080;&#1095;&#1080;&#1083;&#1080;
&#1087;&#1088;&#1080; &#1089;&#1086;&#1079;&#1076;&#1072;&#1085;&#1080;&#1080;
&#1087;&#1086;&#1090;&#1086;&#1082;&#1086;&#1074;.</p>
<code><!--mstheme--></font>
<pre>     invoke DbgPrint, $CTA0(&quot;MutualExclusion: WorkElement = %d\n&quot;), g_dwWorkElement

</pre>
<!--mstheme--><font face="Arial, Arial, Helvetica"></code>
<p>&#1042;&#1099;&#1076;&#1072;&#1077;&#1084;
&#1088;&#1077;&#1079;&#1091;&#1083;&#1100;&#1090;&#1072;&#1090;&#1099;
&#1088;&#1072;&#1073;&#1086;&#1090;&#1099;.
&#1047;&#1085;&#1072;&#1095;&#1077;&#1085;&#1080;&#1077; g_dwWorkElement
&#1076;&#1086;&#1083;&#1078;&#1085;&#1086; &#1073;&#1099;&#1090;&#1100;
&#1088;&#1072;&#1074;&#1085;&#1086; NUM_THREADS * NUM_WORKS.
&#1047;&#1072;&#1082;&#1086;&#1084;&#1084;&#1077;&#1085;&#1090;&#1072;&#1088;&#1080;&#1074;
&#1084;&#1072;&#1082;&#1088;&#1086;&#1089;&#1099; MUTEX_WAIT &#1080;
MUTEX_RELEASE, &#1074;&#1099; &#1085;&#1080; &#1079;&#1072;
&#1095;&#1090;&#1086; &#1085;&#1077;
&#1087;&#1086;&#1083;&#1091;&#1095;&#1080;&#1090;&#1077;
&#1074;&#1077;&#1088;&#1085;&#1086;&#1075;&#1086;
&#1088;&#1077;&#1079;&#1091;&#1083;&#1100;&#1090;&#1072;&#1090;&#1072;, &#1090;.&#1082;.
&#1087;&#1086;&#1090;&#1086;&#1082;&#1080; &#1073;&#1091;&#1076;&#1091;&#1090;
&#1073;&#1077;&#1089;&#1082;&#1086;&#1085;&#1090;&#1088;&#1086;&#1083;&#1100;&#1085;&#1086;
&#1080;&#1079;&#1084;&#1077;&#1085;&#1103;&#1090;&#1100;
&#1088;&#1072;&#1079;&#1076;&#1077;&#1083;&#1103;&#1077;&#1084;&#1099;&#1081;
&#1088;&#1077;&#1089;&#1091;&#1088;&#1089;.</p>
<p>&#1048;&#1089;&#1093;&#1086;&#1076;&#1085;&#1099;&#1081;
&#1082;&#1086;&#1076; &#1076;&#1088;&#1072;&#1081;&#1074;&#1077;&#1088;&#1072;
&#1074; <a href="http://wasm.ru/pub/21/files/kmd13.zip"><u>&#1072;&#1088;&#1093;&#1080;&#1074;&#1077;</u></a>.</p>
<!--mstheme--></font>

</body>

</html>
