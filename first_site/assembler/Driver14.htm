<html>

<head>
<meta http-equiv="Content-Type" content="text/html; charset=windows-1252">
<meta name="GENERATOR" content="Microsoft FrontPage 4.0">
<meta name="ProgId" content="FrontPage.Editor.Document">
<title>New Page 1</title>
<meta name="Microsoft Theme" content="zero 011">
</head>

<body background="zertxtr.gif" bgcolor="#000000" text="#FFFFFF" link="#6699CC" vlink="#669966" alink="#999999">

<!--mstheme--><font face="Arial, Arial, Helvetica"><!--mstheme--></font>
<h3 align="center"><!--mstheme--><font face="Arial, Arial, Helvetica" color="#CCCCCC"><font color="#00FF00" size="4">&#1044;&#1088;&#1072;&#1081;&#1074;&#1077;&#1088;&#1099;
&#1088;&#1077;&#1078;&#1080;&#1084;&#1072; &#1103;&#1076;&#1088;&#1072;:
&#1063;&#1072;&#1089;&#1090;&#1100; 14:
&#1041;&#1072;&#1079;&#1086;&#1074;&#1072;&#1103;
&#1090;&#1077;&#1093;&#1085;&#1080;&#1082;&#1072;.
&#1057;&#1080;&#1085;&#1093;&#1088;&#1086;&#1085;&#1080;&#1079;&#1072;&#1094;&#1080;&#1103;:
&#1048;&#1089;&#1087;&#1086;&#1083;&#1100;&#1079;&#1086;&#1074;&#1072;&#1085;&#1080;&#1077;
&#1086;&#1073;&#1098;&#1077;&#1082;&#1090;&#1072; &quot;&#1089;&#1086;&#1073;&#1099;&#1090;&#1080;&#1077;&quot;
&#1076;&#1083;&#1103;
&#1074;&#1079;&#1072;&#1080;&#1084;&#1086;&#1076;&#1077;&#1081;&#1089;&#1090;&#1074;&#1080;&#1103;
&#1076;&#1088;&#1072;&#1081;&#1074;&#1077;&#1088;&#1072; &#1089;
&#1087;&#1088;&#1086;&#1075;&#1088;&#1072;&#1084;&#1084;&#1086;&#1081;
&#1091;&#1087;&#1088;&#1072;&#1074;&#1083;&#1077;&#1085;&#1080;&#1103;.</font><!--mstheme--></font></h3>
<!--mstheme--><font face="Arial, Arial, Helvetica"><font color="#00FF00" size="4"><br>
</font>
<br>
<p>&#1055;&#1088;&#1077;&#1076;&#1087;&#1086;&#1083;&#1086;&#1078;&#1080;&#1084;,
&#1095;&#1090;&#1086; &#1091; &#1085;&#1072;&#1089; &#1077;&#1089;&#1090;&#1100;
&#1076;&#1088;&#1072;&#1081;&#1074;&#1077;&#1088;,
&#1089;&#1086;&#1073;&#1080;&#1088;&#1072;&#1102;&#1097;&#1080;&#1081;
&#1082;&#1072;&#1082;&#1091;&#1102;-&#1090;&#1086;
&#1089;&#1090;&#1072;&#1090;&#1080;&#1089;&#1090;&#1080;&#1095;&#1077;&#1089;&#1082;&#1091;&#1102;
&#1080;&#1085;&#1092;&#1086;&#1088;&#1084;&#1072;&#1094;&#1080;&#1102; &#1080;
&#1087;&#1088;&#1086;&#1075;&#1088;&#1072;&#1084;&#1084;&#1072;
&#1091;&#1087;&#1088;&#1072;&#1074;&#1083;&#1077;&#1085;&#1080;&#1103;,
&#1087;&#1086;&#1083;&#1091;&#1095;&#1072;&#1102;&#1097;&#1072;&#1103; &#1080;
&#1086;&#1073;&#1088;&#1072;&#1073;&#1072;&#1090;&#1099;&#1074;&#1072;&#1102;&#1097;&#1072;&#1103;
&#1101;&#1090;&#1091;
&#1080;&#1085;&#1092;&#1086;&#1088;&#1084;&#1072;&#1094;&#1080;&#1102;.
&#1050;&#1072;&#1082;
&#1086;&#1088;&#1075;&#1072;&#1085;&#1080;&#1079;&#1086;&#1074;&#1072;&#1090;&#1100;
&#1080;&#1093;
&#1074;&#1079;&#1072;&#1080;&#1084;&#1086;&#1076;&#1077;&#1081;&#1089;&#1090;&#1074;&#1080;&#1077;?
&#1042; &#1089;&#1072;&#1084;&#1086;&#1084;
&#1087;&#1088;&#1086;&#1089;&#1090;&#1077;&#1081;&#1096;&#1077;&#1084;
&#1089;&#1083;&#1091;&#1095;&#1072;&#1077; &#1085;&#1072;&#1076;&#1086;
&#1089;&#1086;&#1079;&#1076;&#1072;&#1090;&#1100; &#1074;
&#1087;&#1088;&#1086;&#1075;&#1088;&#1072;&#1084;&#1084;&#1077;
&#1091;&#1087;&#1088;&#1072;&#1074;&#1083;&#1077;&#1085;&#1080;&#1103;
&#1090;&#1072;&#1081;&#1084;&#1077;&#1088; &#1080; &#1089;
&#1085;&#1077;&#1082;&#1086;&#1081;
&#1087;&#1077;&#1088;&#1080;&#1086;&#1076;&#1080;&#1095;&#1085;&#1086;&#1089;&#1090;&#1100;&#1102;
(&#1089;&#1082;&#1072;&#1078;&#1077;&#1084;, &#1088;&#1072;&#1079; &#1074;
&#1089;&#1077;&#1082;&#1091;&#1085;&#1076;&#1091;)
&#1079;&#1072;&#1073;&#1080;&#1088;&#1072;&#1090;&#1100; &#1091;
&#1076;&#1088;&#1072;&#1081;&#1074;&#1077;&#1088;&#1072;
&#1089;&#1090;&#1072;&#1090;&#1080;&#1089;&#1090;&#1080;&#1082;&#1091;
&#1095;&#1077;&#1088;&#1077;&#1079; DeviceIoControl. &#1047;&#1072;
&#1087;&#1088;&#1080;&#1084;&#1077;&#1088;&#1072;&#1084;&#1080;
&#1076;&#1072;&#1083;&#1077;&#1082;&#1086;
&#1093;&#1086;&#1076;&#1080;&#1090;&#1100; &#1085;&#1077;
&#1085;&#1072;&#1076;&#1086;: RegMon, FileMon &#1080; &#1090;.&#1076;.
&#1053;&#1086; &#1095;&#1090;&#1086; &#1077;&#1089;&#1083;&#1080;
&#1089;&#1086;&#1073;&#1099;&#1090;&#1080;&#1103;,
&#1082;&#1086;&#1090;&#1086;&#1088;&#1099;&#1077;
&#1086;&#1090;&#1089;&#1083;&#1077;&#1078;&#1080;&#1074;&#1072;&#1077;&#1090;
&#1076;&#1088;&#1072;&#1081;&#1074;&#1077;&#1088; (&#1085;&#1072;&#1087;&#1088;&#1080;&#1084;&#1077;&#1088;,
&#1089;&#1086;&#1079;&#1076;&#1072;&#1085;&#1080;&#1077;
&#1087;&#1088;&#1086;&#1094;&#1077;&#1089;&#1089;&#1072;)
&#1087;&#1088;&#1086;&#1080;&#1089;&#1093;&#1086;&#1076;&#1103;&#1090;
&#1086;&#1090;&#1085;&#1086;&#1089;&#1080;&#1090;&#1077;&#1083;&#1100;&#1085;&#1086;
&#1088;&#1077;&#1076;&#1082;&#1086;?
&#1041;&#1086;&#1083;&#1100;&#1096;&#1091;&#1102;
&#1095;&#1072;&#1089;&#1090;&#1100;
&#1074;&#1088;&#1077;&#1084;&#1077;&#1085;&#1080; &#1084;&#1099;
&#1073;&#1091;&#1076;&#1077;&#1084; &#1075;&#1086;&#1085;&#1103;&#1090;&#1100;
DeviceIoControl &#1074;&#1087;&#1091;&#1089;&#1090;&#1091;&#1102;.
&#1059;&#1074;&#1077;&#1083;&#1080;&#1095;&#1077;&#1085;&#1080;&#1077;
&#1080;&#1085;&#1090;&#1077;&#1088;&#1074;&#1072;&#1083;&#1072;
&#1089;&#1088;&#1072;&#1073;&#1072;&#1090;&#1099;&#1074;&#1072;&#1085;&#1080;&#1103;
&#1090;&#1072;&#1081;&#1084;&#1077;&#1088;&#1072; (&#1089;&#1082;&#1072;&#1078;&#1077;&#1084;,
&#1076;&#1086; 10 &#1089;&#1077;&#1082;&#1091;&#1085;&#1076;),
&#1087;&#1088;&#1080;&#1074;&#1077;&#1076;&#1077;&#1090; &#1082;
&#1088;&#1072;&#1079;&#1076;&#1088;&#1072;&#1078;&#1072;&#1102;&#1097;&#1080;&#1084;
&#1079;&#1072;&#1076;&#1077;&#1088;&#1078;&#1082;&#1072;&#1084; &#1074;
&#1088;&#1072;&#1073;&#1086;&#1090;&#1077;
&#1087;&#1088;&#1086;&#1075;&#1088;&#1072;&#1084;&#1084;&#1099;
&#1091;&#1087;&#1088;&#1072;&#1074;&#1083;&#1077;&#1085;&#1080;&#1103;.
&#1054;&#1095;&#1077;&#1074;&#1080;&#1076;&#1085;&#1086;, &#1095;&#1090;&#1086;
&#1074; &#1076;&#1072;&#1085;&#1085;&#1086;&#1084;
&#1089;&#1094;&#1077;&#1085;&#1072;&#1088;&#1080;&#1080;
&#1080;&#1085;&#1080;&#1094;&#1080;&#1072;&#1090;&#1086;&#1088;&#1086;&#1084;
&#1087;&#1077;&#1088;&#1077;&#1076;&#1072;&#1095;&#1080;
&#1086;&#1095;&#1077;&#1088;&#1077;&#1076;&#1085;&#1086;&#1081;
&#1087;&#1086;&#1088;&#1094;&#1080;&#1080;
&#1080;&#1085;&#1092;&#1086;&#1088;&#1084;&#1072;&#1094;&#1080;&#1080;
&#1076;&#1086;&#1083;&#1078;&#1077;&#1085; &#1073;&#1099;&#1090;&#1100;
&#1076;&#1088;&#1072;&#1081;&#1074;&#1077;&#1088;, &#1090;.&#1082;. &#1086;
&#1090;&#1086;&#1084;, &#1095;&#1090;&#1086;
&#1086;&#1090;&#1089;&#1083;&#1077;&#1078;&#1080;&#1074;&#1072;&#1077;&#1084;&#1086;&#1077;
&#1089;&#1086;&#1073;&#1099;&#1090;&#1080;&#1077; (&#1089;&#1086;&#1073;&#1099;&#1090;&#1080;&#1103;)
&#1087;&#1088;&#1086;&#1080;&#1079;&#1086;&#1096;&#1083;&#1086;,
&#1091;&#1079;&#1085;&#1072;&#1077;&#1090;
&#1080;&#1084;&#1077;&#1085;&#1085;&#1086; &#1086;&#1085;.
&#1047;&#1085;&#1072;&#1095;&#1080;&#1090;, &#1086;&#1085;
&#1076;&#1086;&#1083;&#1078;&#1077;&#1085; &#1082;&#1072;&#1082;&#1080;&#1084;-&#1090;&#1086;
&#1086;&#1073;&#1088;&#1072;&#1079;&#1086;&#1084;
&#1080;&#1079;&#1074;&#1077;&#1097;&#1072;&#1090;&#1100;
&#1089;&#1074;&#1086;&#1102;
&#1087;&#1088;&#1086;&#1075;&#1088;&#1072;&#1084;&#1084;&#1091;
&#1091;&#1087;&#1088;&#1072;&#1074;&#1083;&#1077;&#1085;&#1080;&#1103; &#1086;
&#1090;&#1086;&#1084;, &#1095;&#1090;&#1086;
&#1080;&#1084;&#1077;&#1102;&#1090;&#1089;&#1103;
&#1089;&#1074;&#1077;&#1078;&#1080;&#1077;
&#1076;&#1072;&#1085;&#1085;&#1099;&#1077;.</p>
<p>&#1045;&#1089;&#1090;&#1100; &#1076;&#1074;&#1072;
&#1073;&#1072;&#1079;&#1086;&#1074;&#1099;&#1093; &#1080;
&#1086;&#1090;&#1085;&#1086;&#1089;&#1080;&#1090;&#1077;&#1083;&#1100;&#1085;&#1086;
&#1093;&#1086;&#1088;&#1086;&#1096;&#1086;
&#1076;&#1086;&#1082;&#1091;&#1084;&#1077;&#1085;&#1090;&#1080;&#1088;&#1086;&#1074;&#1072;&#1085;&#1085;&#1099;&#1093;
&#1089;&#1087;&#1086;&#1089;&#1086;&#1073;&#1072;. &#1054;&#1076;&#1080;&#1085;
&#1079;&#1072;&#1082;&#1083;&#1102;&#1095;&#1072;&#1077;&#1090;&#1089;&#1103;
&#1074;
&#1072;&#1089;&#1080;&#1085;&#1093;&#1088;&#1086;&#1085;&#1085;&#1086;&#1084;
&#1074;&#1099;&#1079;&#1086;&#1074;&#1077; DeviceIoControl.
&#1055;&#1086;&#1083;&#1100;&#1079;&#1086;&#1074;&#1072;&#1090;&#1077;&#1083;&#1100;&#1089;&#1082;&#1080;&#1081;
&#1087;&#1086;&#1090;&#1086;&#1082;
&#1089;&#1086;&#1079;&#1076;&#1072;&#1077;&#1090;
&#1086;&#1073;&#1098;&#1077;&#1082;&#1090; &quot;&#1089;&#1086;&#1073;&#1099;&#1090;&#1080;&#1077;&quot;
&#1080;
&#1089;&#1086;&#1086;&#1090;&#1074;&#1077;&#1090;&#1089;&#1090;&#1074;&#1091;&#1102;&#1097;&#1080;&#1084;
&#1086;&#1073;&#1088;&#1072;&#1079;&#1086;&#1084;
&#1079;&#1072;&#1087;&#1086;&#1083;&#1085;&#1103;&#1077;&#1090;
&#1089;&#1090;&#1088;&#1091;&#1082;&#1090;&#1091;&#1088;&#1091; OVERLAPPED,
&#1091;&#1082;&#1072;&#1079;&#1072;&#1090;&#1077;&#1083;&#1100; &#1085;&#1072;
&#1082;&#1086;&#1090;&#1086;&#1088;&#1091;&#1102;
&#1087;&#1077;&#1088;&#1077;&#1076;&#1072;&#1077;&#1090;&#1089;&#1103; &#1074;
&#1087;&#1086;&#1089;&#1083;&#1077;&#1076;&#1085;&#1077;&#1084;
&#1087;&#1072;&#1088;&#1072;&#1084;&#1077;&#1090;&#1088;&#1077;.
&#1054;&#1087;&#1080;&#1089;&#1072;&#1090;&#1077;&#1083;&#1100;
&#1091;&#1089;&#1090;&#1088;&#1086;&#1081;&#1089;&#1090;&#1074;&#1072;
&#1076;&#1086;&#1083;&#1078;&#1077;&#1085; &#1073;&#1099;&#1090;&#1100;
&#1086;&#1090;&#1082;&#1088;&#1099;&#1090; &#1089;
&#1092;&#1083;&#1072;&#1075;&#1086;&#1084; FILE_FLAG_OVERLAPPED.
&#1055;&#1086;&#1083;&#1091;&#1095;&#1080;&#1074;
&#1090;&#1072;&#1082;&#1086;&#1081; &#1079;&#1072;&#1087;&#1088;&#1086;&#1089;,
&#1076;&#1088;&#1072;&#1081;&#1074;&#1077;&#1088;
&#1086;&#1090;&#1082;&#1083;&#1072;&#1076;&#1099;&#1074;&#1072;&#1077;&#1090;
&#1077;&#1075;&#1086;
&#1079;&#1072;&#1074;&#1077;&#1088;&#1096;&#1077;&#1085;&#1080;&#1077;
&#1076;&#1086; &#1090;&#1077;&#1093; &#1087;&#1086;&#1088;,
&#1087;&#1086;&#1082;&#1072; &#1085;&#1077;
&#1087;&#1088;&#1086;&#1080;&#1079;&#1086;&#1081;&#1076;&#1077;&#1090;
&#1086;&#1078;&#1080;&#1076;&#1072;&#1077;&#1084;&#1086;&#1077;
&#1089;&#1086;&#1073;&#1099;&#1090;&#1080;&#1077; &#1080;
&#1074;&#1086;&#1079;&#1074;&#1088;&#1072;&#1097;&#1072;&#1077;&#1090;
STATUS_PENDING. &#1053;&#1072; &#1089;&#1090;&#1086;&#1088;&#1086;&#1085;&#1077;
&#1088;&#1077;&#1078;&#1080;&#1084;&#1072;
&#1087;&#1086;&#1083;&#1100;&#1079;&#1086;&#1074;&#1072;&#1090;&#1077;&#1083;&#1103;
&#1074;&#1099;&#1079;&#1086;&#1074; DeviceIoControl
&#1074;&#1086;&#1079;&#1074;&#1088;&#1072;&#1097;&#1072;&#1077;&#1090;
&#1086;&#1096;&#1080;&#1073;&#1082;&#1091; ERROR_IO_PENDING &#1080;
&#1087;&#1086;&#1090;&#1086;&#1082; &#1076;&#1086;&#1083;&#1078;&#1077;&#1085;
&#1078;&#1076;&#1072;&#1090;&#1100; &#1085;&#1072;
&#1086;&#1073;&#1098;&#1077;&#1082;&#1090;&#1077; &quot;&#1089;&#1086;&#1073;&#1099;&#1090;&#1080;&#1077;&quot;.
&#1050;&#1086;&#1075;&#1076;&#1072;
&#1087;&#1088;&#1086;&#1080;&#1089;&#1093;&#1086;&#1076;&#1080;&#1090;
&#1086;&#1078;&#1080;&#1076;&#1072;&#1077;&#1084;&#1086;&#1077;
&#1089;&#1086;&#1073;&#1099;&#1090;&#1080;&#1077;,
&#1076;&#1088;&#1072;&#1081;&#1074;&#1077;&#1088;
&#1079;&#1072;&#1074;&#1077;&#1088;&#1096;&#1072;&#1077;&#1090; IRP &#1080;
&#1089;&#1080;&#1075;&#1085;&#1072;&#1083;&#1080;&#1079;&#1080;&#1088;&#1091;&#1077;&#1090;
&#1086;&#1073; &#1101;&#1090;&#1086;&#1084;
&#1087;&#1086;&#1083;&#1100;&#1079;&#1086;&#1074;&#1072;&#1090;&#1077;&#1083;&#1100;&#1089;&#1082;&#1086;&#1084;&#1091;
&#1087;&#1086;&#1090;&#1086;&#1082;&#1091;,
&#1086;&#1089;&#1074;&#1086;&#1073;&#1086;&#1078;&#1076;&#1072;&#1103;
&#1086;&#1073;&#1098;&#1077;&#1082;&#1090; &quot;&#1089;&#1086;&#1073;&#1099;&#1090;&#1080;&#1077;&quot;.
&#1055;&#1088;&#1080; &#1101;&#1090;&#1086;&#1084;
&#1076;&#1088;&#1072;&#1081;&#1074;&#1077;&#1088;
&#1076;&#1086;&#1083;&#1078;&#1077;&#1085; &#1073;&#1099;&#1090;&#1100;
&#1075;&#1086;&#1090;&#1086;&#1074; &#1082; &#1090;&#1086;&#1084;&#1091;,
&#1095;&#1090;&#1086; &#1077;&#1084;&#1091;
&#1087;&#1088;&#1080;&#1076;&#1077;&#1090;&#1089;&#1103;
&#1086;&#1073;&#1088;&#1072;&#1073;&#1072;&#1090;&#1099;&#1074;&#1072;&#1090;&#1100;
&#1085;&#1077;&#1089;&#1082;&#1086;&#1083;&#1100;&#1082;&#1086;
&#1090;&#1072;&#1082;&#1080;&#1093; IRP. &#1058;.&#1077;. &#1086;&#1085;
&#1076;&#1086;&#1083;&#1078;&#1077;&#1085;
&#1086;&#1088;&#1075;&#1072;&#1085;&#1080;&#1079;&#1086;&#1074;&#1072;&#1090;&#1100;
&#1086;&#1095;&#1077;&#1088;&#1077;&#1076;&#1100;
&#1079;&#1072;&#1087;&#1088;&#1086;&#1089;&#1086;&#1074;
&#1074;&#1074;&#1086;&#1076;&#1072;-&#1074;&#1099;&#1074;&#1086;&#1076;&#1072;
&#1086;&#1078;&#1080;&#1076;&#1072;&#1102;&#1097;&#1080;&#1093;
&#1079;&#1072;&#1074;&#1077;&#1088;&#1096;&#1077;&#1085;&#1080;&#1103;.
&#1055;&#1086;&#1076;&#1088;&#1086;&#1073;&#1085;&#1086;
&#1088;&#1072;&#1079;&#1073;&#1080;&#1088;&#1072;&#1090;&#1100;
&#1101;&#1090;&#1086;&#1090; &#1089;&#1087;&#1086;&#1089;&#1086;&#1073;
&#1084;&#1099; &#1085;&#1077; &#1073;&#1091;&#1076;&#1077;&#1084; (&#1089;&#1084;.
DDK &#1080; MSDN). &#1042;&#1090;&#1086;&#1088;&#1086;&#1081;
&#1089;&#1087;&#1086;&#1089;&#1086;&#1073;
&#1085;&#1077;&#1089;&#1082;&#1086;&#1083;&#1100;&#1082;&#1086;
&#1087;&#1088;&#1086;&#1097;&#1077; &#1080;
&#1079;&#1072;&#1082;&#1083;&#1102;&#1095;&#1072;&#1077;&#1090;&#1089;&#1103;
&#1074; &#1090;&#1086;&#1084;, &#1095;&#1090;&#1086;
&#1076;&#1088;&#1072;&#1081;&#1074;&#1077;&#1088; &#1080; &#1077;&#1075;&#1086;
&#1082;&#1083;&#1080;&#1077;&#1085;&#1090;
&#1088;&#1077;&#1078;&#1080;&#1084;&#1072;
&#1087;&#1086;&#1083;&#1100;&#1079;&#1086;&#1074;&#1072;&#1090;&#1077;&#1083;&#1103;
&#1089;&#1086;&#1074;&#1084;&#1077;&#1089;&#1090;&#1085;&#1086;
&#1080;&#1089;&#1087;&#1086;&#1083;&#1100;&#1079;&#1091;&#1102;&#1090;
&#1086;&#1073;&#1098;&#1077;&#1082;&#1090; &quot;&#1089;&#1086;&#1073;&#1099;&#1090;&#1080;&#1077;&quot;.
&#1050;&#1083;&#1080;&#1077;&#1085;&#1090; &#1078;&#1076;&#1077;&#1090;
&#1085;&#1072; &#1086;&#1073;&#1098;&#1077;&#1082;&#1090;&#1077; &#1080;
&#1077;&#1089;&#1083;&#1080; &#1086;&#1085;&#1086;
&#1087;&#1077;&#1088;&#1077;&#1093;&#1086;&#1076;&#1080;&#1090; &#1074;
&#1089;&#1080;&#1075;&#1085;&#1072;&#1083;&#1100;&#1085;&#1086;&#1077;
&#1089;&#1086;&#1089;&#1090;&#1086;&#1103;&#1085;&#1080;&#1077; (&#1087;&#1086;
&#1091;&#1082;&#1072;&#1079;&#1072;&#1085;&#1080;&#1102;
&#1076;&#1088;&#1072;&#1081;&#1074;&#1077;&#1088;&#1072;)
&#1089;&#1080;&#1085;&#1093;&#1088;&#1086;&#1085;&#1085;&#1086;
&#1074;&#1099;&#1079;&#1099;&#1074;&#1072;&#1077;&#1090; DeviceIoControl,
&#1087;&#1086;&#1083;&#1091;&#1095;&#1072;&#1103; &#1086;&#1090;
&#1076;&#1088;&#1072;&#1081;&#1074;&#1077;&#1088;&#1072;
&#1085;&#1077;&#1086;&#1073;&#1093;&#1086;&#1076;&#1080;&#1084;&#1091;&#1102;
&#1080;&#1085;&#1092;&#1086;&#1088;&#1084;&#1072;&#1094;&#1080;&#1102;.</p>
<p>&#1048;&#1090;&#1072;&#1082;, &#1084;&#1099;
&#1076;&#1086;&#1083;&#1078;&#1085;&#1099;
&#1089;&#1086;&#1074;&#1084;&#1077;&#1089;&#1090;&#1085;&#1086;
&#1080;&#1089;&#1087;&#1086;&#1083;&#1100;&#1079;&#1086;&#1074;&#1072;&#1090;&#1100;
&#1086;&#1073;&#1098;&#1077;&#1082;&#1090; &quot;&#1089;&#1086;&#1073;&#1099;&#1090;&#1080;&#1077;&quot;.
&#1058;&#1091;&#1090; &#1077;&#1089;&#1090;&#1100;
&#1085;&#1077;&#1089;&#1082;&#1086;&#1083;&#1100;&#1082;&#1086;
&#1074;&#1072;&#1088;&#1080;&#1072;&#1085;&#1090;&#1086;&#1074;.
&#1052;&#1086;&#1078;&#1085;&#1086;
&#1080;&#1089;&#1087;&#1086;&#1083;&#1100;&#1079;&#1086;&#1074;&#1072;&#1090;&#1100;
&#1080;&#1084;&#1077;&#1085;&#1086;&#1074;&#1072;&#1085;&#1085;&#1099;&#1081;
&#1086;&#1073;&#1098;&#1077;&#1082;&#1090; &#1080;
&#1086;&#1073;&#1088;&#1072;&#1097;&#1072;&#1090;&#1100;&#1089;&#1103; &#1082;
&#1085;&#1077;&#1084;&#1091; &#1087;&#1086; &#1080;&#1084;&#1077;&#1085;&#1080;.
&#1042;&#1089;&#1087;&#1086;&#1084;&#1085;&#1080;&#1090;&#1077;,
&#1082;&#1072;&#1082; &#1084;&#1099;
&#1080;&#1089;&#1087;&#1086;&#1083;&#1100;&#1079;&#1086;&#1074;&#1072;&#1083;&#1080;
&#1080;&#1084;&#1077;&#1085;&#1086;&#1074;&#1072;&#1085;&#1085;&#1099;&#1081;
&#1086;&#1073;&#1098;&#1077;&#1082;&#1090; &quot;&#1088;&#1072;&#1079;&#1076;&#1077;&#1083;&quot;
&#1074; &#1063;&#1072;&#1089;&#1090;&#1080; 8 &quot;&#1041;&#1072;&#1079;&#1086;&#1074;&#1072;&#1103;
&#1090;&#1077;&#1093;&#1085;&#1080;&#1082;&#1072;:
&#1056;&#1072;&#1073;&#1086;&#1090;&#1072; &#1089;
&#1087;&#1072;&#1084;&#1103;&#1090;&#1100;&#1102;.
&#1057;&#1086;&#1074;&#1084;&#1077;&#1089;&#1090;&#1085;&#1086;
&#1080;&#1089;&#1087;&#1086;&#1083;&#1100;&#1079;&#1091;&#1077;&#1084;&#1099;&#1081;
&#1088;&#1072;&#1079;&#1076;&#1077;&#1083;&quot;.
&#1054;&#1095;&#1077;&#1074;&#1080;&#1076;&#1085;&#1099;&#1081;
&#1085;&#1077;&#1076;&#1086;&#1089;&#1090;&#1072;&#1090;&#1086;&#1082; -
&#1101;&#1090;&#1086;&#1090; &#1086;&#1073;&#1098;&#1077;&#1082;&#1090;
&#1073;&#1091;&#1076;&#1077;&#1090; &#1074;&#1080;&#1076;&#1077;&#1085;
&#1074;&#1089;&#1077;&#1084;. &#1055;&#1086;&#1101;&#1090;&#1086;&#1084;&#1091;
&#1083;&#1091;&#1095;&#1096;&#1077;
&#1080;&#1089;&#1087;&#1086;&#1083;&#1100;&#1079;&#1086;&#1074;&#1072;&#1090;&#1100;
&#1073;&#1077;&#1079;&#1099;&#1084;&#1103;&#1085;&#1085;&#1099;&#1081;
&#1086;&#1073;&#1098;&#1077;&#1082;&#1090;.
&#1054;&#1073;&#1099;&#1095;&#1085;&#1086;&#1081; &#1080;
&#1086;&#1092;&#1080;&#1094;&#1080;&#1072;&#1083;&#1100;&#1085;&#1086;
&#1076;&#1086;&#1082;&#1091;&#1084;&#1077;&#1085;&#1090;&#1080;&#1088;&#1086;&#1074;&#1072;&#1085;&#1085;&#1086;&#1081;
&#1087;&#1088;&#1072;&#1082;&#1090;&#1080;&#1082;&#1086;&#1081;
&#1079;&#1076;&#1077;&#1089;&#1100;
&#1103;&#1074;&#1083;&#1103;&#1077;&#1090;&#1089;&#1103;
&#1089;&#1086;&#1079;&#1076;&#1072;&#1085;&#1080;&#1077;
&#1086;&#1073;&#1098;&#1077;&#1082;&#1090;&#1072; &quot;&#1089;&#1086;&#1073;&#1099;&#1090;&#1080;&#1077;&quot;
&#1082;&#1083;&#1080;&#1077;&#1085;&#1090;&#1086;&#1084; &#1074;
&#1088;&#1077;&#1078;&#1080;&#1084;&#1077;
&#1087;&#1086;&#1083;&#1100;&#1079;&#1086;&#1074;&#1072;&#1090;&#1077;&#1083;&#1103;
&#1080; &#1087;&#1077;&#1088;&#1077;&#1076;&#1072;&#1095;&#1072;
&#1077;&#1075;&#1086;
&#1086;&#1087;&#1080;&#1089;&#1072;&#1090;&#1077;&#1083;&#1103;
&#1076;&#1088;&#1072;&#1081;&#1074;&#1077;&#1088;&#1091;
&#1095;&#1077;&#1088;&#1077;&#1079; DeviceIoControl.
&#1069;&#1090;&#1080;&#1084; &#1084;&#1077;&#1090;&#1086;&#1076;&#1086;&#1084;
&#1084;&#1099; &#1080;
&#1074;&#1086;&#1089;&#1087;&#1086;&#1083;&#1100;&#1079;&#1091;&#1077;&#1084;&#1089;&#1103;.
&#1042; &#1101;&#1090;&#1086;&#1084;
&#1087;&#1088;&#1080;&#1084;&#1077;&#1088;&#1077; &#1084;&#1099;
&#1073;&#1091;&#1076;&#1077;&#1084;
&#1086;&#1090;&#1089;&#1083;&#1077;&#1078;&#1080;&#1074;&#1072;&#1090;&#1100;
&#1089;&#1086;&#1079;&#1076;&#1072;&#1085;&#1080;&#1077;/&#1091;&#1076;&#1072;&#1083;&#1077;&#1085;&#1080;&#1077;
&#1087;&#1088;&#1086;&#1094;&#1077;&#1089;&#1089;&#1086;&#1074;.</p>
<p>&#1044;&#1086;&#1087;&#1086;&#1083;&#1085;&#1080;&#1090;&#1077;&#1083;&#1100;&#1085;&#1091;&#1102;
&#1080;&#1085;&#1092;&#1086;&#1088;&#1084;&#1072;&#1094;&#1080;&#1102;
&#1087;&#1086; &#1090;&#1077;&#1084;&#1077; &#1084;&#1086;&#1078;&#1085;&#1086;
&#1087;&#1086;&#1095;&#1077;&#1088;&#1087;&#1085;&#1091;&#1090;&#1100;
&#1080;&#1079; &#1089;&#1083;&#1077;&#1076;&#1091;&#1102;&#1097;&#1080;&#1093;
&#1080;&#1089;&#1090;&#1086;&#1095;&#1085;&#1080;&#1082;&#1086;&#1074;:</p>
<!--mstheme--></font>
<!--msthemelist--><table border="0" cellpadding="0" cellspacing="0" width="100%">
  <!--msthemelist--><tr>
    <!--msthemelist--><td valign="baseline" width="42"><img src="zerbul1a.gif" width="15" height="15" hspace="13"></td>
    <td valign="top" width="100%"><!--mstheme--><font face="Arial, Arial, Helvetica">MSDN
      Q228785 &quot;OpenEvent Fails in a Non-Administrator Account&quot;<!--mstheme--></font><!--msthemelist--></td>
  </tr>
  <!--msthemelist--><tr>
    <!--msthemelist--><td valign="baseline" width="42"><img src="zerbul1a.gif" width="15" height="15" hspace="13"></td>
    <td valign="top" width="100%"><!--mstheme--><font face="Arial, Arial, Helvetica">MSDN
      Q176415 &quot;Event.exe Shows How to Share and Signal an Event Object&quot;<!--mstheme--></font><!--msthemelist--></td>
  </tr>
  <!--msthemelist--><tr>
    <!--msthemelist--><td valign="baseline" width="42"><img src="zerbul1a.gif" width="15" height="15" hspace="13"></td>
    <td valign="top" width="100%"><!--mstheme--><font face="Arial, Arial, Helvetica">&#1055;&#1088;&#1080;&#1084;&#1077;&#1088;
      &#1074; DDK \src\general\event\<!--mstheme--></font><!--msthemelist--></td>
  </tr>
  <!--msthemelist--><tr>
    <!--msthemelist--><td valign="baseline" width="42"><img src="zerbul1a.gif" width="15" height="15" hspace="13"></td>
    <td valign="top" width="100%"><!--mstheme--><font face="Arial, Arial, Helvetica">&#1046;&#1091;&#1088;&#1085;&#1072;&#1083;
      &quot;The NT Insider&quot; &#1079;&#1072; 2002 &#1075;&#1086;&#1076;,
      &quot;Sharing is Caring - Sharing Events Between Kernel and User Mode&quot;<!--mstheme--></font><!--msthemelist--></td>
  </tr>
<!--msthemelist--></table>
<!--mstheme--><font face="Arial, Arial, Helvetica"><br>
<br>
<p>&nbsp;<!--mstheme--></font>
<h2><!--mstheme--><font face="Arial, Arial, Helvetica" color="#CCCCCC">14.1
&#1054;&#1073;&#1097;&#1080;&#1077; &#1076;&#1072;&#1085;&#1085;&#1099;&#1077;<!--mstheme--></font></h2>
<!--mstheme--><font face="Arial, Arial, Helvetica">
<p>&nbsp;</p>
<p>&#1053;&#1072;&#1095;&#1085;&#1077;&#1084; &#1089;
&#1088;&#1072;&#1079;&#1073;&#1086;&#1088;&#1072;
&#1089;&#1086;&#1076;&#1077;&#1088;&#1078;&#1080;&#1084;&#1086;&#1075;&#1086;
&#1092;&#1072;&#1081;&#1083;&#1072; common.inc.</p>
<code><!--mstheme--></font>
<pre> IOCTL_SET_NOTIFY        equ CTL_CODE(FILE_DEVICE_UNKNOWN, 800h, METHOD_BUFFERED, FILE_WRITE_ACCESS)
 IOCTL_REMOVE_NOTIFY     equ CTL_CODE(FILE_DEVICE_UNKNOWN, 801h, 0, 0)
 IOCTL_GET_PROCESS_DATA  equ CTL_CODE(FILE_DEVICE_UNKNOWN, 802h, METHOD_BUFFERED, FILE_READ_ACCESS)

 IMAGE_FILE_PATH_LEN equ 512

 PROCESS_DATA STRUCT
     bCreate             BOOL        ?
 
     dwProcessId         DWORD       ?
     szProcessPath       CHAR    IMAGE_FILE_PATH_LEN dup(?)

 PROCESS_DATA ENDS

</pre>
<!--mstheme--><font face="Arial, Arial, Helvetica"></code>
<p>&#1048;&#1084;&#1077;&#1077;&#1084; &#1090;&#1088;&#1080;
&#1091;&#1087;&#1088;&#1072;&#1074;&#1083;&#1103;&#1102;&#1097;&#1080;&#1093;
&#1082;&#1086;&#1076;&#1072;: IOCTL_SET_NOTIFY
&#1079;&#1072;&#1089;&#1090;&#1072;&#1074;&#1083;&#1103;&#1077;&#1090;
&#1076;&#1088;&#1072;&#1081;&#1074;&#1077;&#1088;
&#1085;&#1072;&#1095;&#1072;&#1090;&#1100;
&#1089;&#1083;&#1077;&#1078;&#1077;&#1085;&#1080;&#1077; &#1079;&#1072;
&#1089;&#1086;&#1079;&#1076;&#1072;&#1085;&#1080;&#1077;&#1084;/&#1091;&#1076;&#1072;&#1083;&#1077;&#1085;&#1080;&#1077;&#1084;
&#1087;&#1088;&#1086;&#1094;&#1077;&#1089;&#1089;&#1086;&#1074;;
IOCTL_REMOVE_NOTIFY,
&#1089;&#1086;&#1086;&#1090;&#1074;&#1077;&#1090;&#1089;&#1090;&#1074;&#1077;&#1085;&#1085;&#1086;,
&#1076;&#1077;&#1083;&#1072;&#1077;&#1090;
&#1086;&#1073;&#1088;&#1072;&#1090;&#1085;&#1086;&#1077;; IOCTL_GET_PROCESS_DATA
&#1074;&#1086;&#1079;&#1074;&#1088;&#1072;&#1097;&#1072;&#1077;&#1090; &#1074;
&#1089;&#1090;&#1088;&#1091;&#1082;&#1090;&#1091;&#1088;&#1077; PROCESS_DATA
&#1080;&#1085;&#1092;&#1086;&#1088;&#1084;&#1072;&#1094;&#1080;&#1102; &#1086;
&#1087;&#1088;&#1086;&#1094;&#1077;&#1089;&#1089;&#1077;. &#1069;&#1090;&#1072;
&#1080;&#1085;&#1092;&#1086;&#1088;&#1084;&#1072;&#1094;&#1080;&#1103;
&#1089;&#1086;&#1089;&#1090;&#1086;&#1080;&#1090; &#1080;&#1079;
&#1080;&#1076;&#1077;&#1085;&#1090;&#1080;&#1092;&#1080;&#1082;&#1072;&#1090;&#1086;&#1088;&#1072;
&#1087;&#1088;&#1086;&#1094;&#1077;&#1089;&#1089;&#1072;,
&#1092;&#1083;&#1072;&#1075;&#1072;,
&#1086;&#1087;&#1088;&#1077;&#1076;&#1077;&#1083;&#1103;&#1102;&#1097;&#1077;&#1075;&#1086;,
&#1073;&#1099;&#1083; &#1083;&#1080;
&#1087;&#1088;&#1086;&#1094;&#1077;&#1089;&#1089;
&#1089;&#1086;&#1079;&#1076;&#1072;&#1085; &#1080;&#1083;&#1080;
&#1091;&#1076;&#1072;&#1083;&#1077;&#1085;, &#1080;
&#1087;&#1086;&#1083;&#1085;&#1086;&#1075;&#1086; &#1087;&#1091;&#1090;&#1080;
&#1082; &#1086;&#1073;&#1088;&#1072;&#1079;&#1091;,
&#1089;&#1086;&#1079;&#1076;&#1072;&#1074;&#1096;&#1077;&#1084;&#1091;
&#1087;&#1088;&#1086;&#1094;&#1077;&#1089;&#1089;.</p>
<br>
<br>
<p>&nbsp;<!--mstheme--></font>
<h2><!--mstheme--><font face="Arial, Arial, Helvetica" color="#CCCCCC">14.2
&#1048;&#1089;&#1093;&#1086;&#1076;&#1085;&#1099;&#1081;
&#1090;&#1077;&#1082;&#1089;&#1090;
&#1087;&#1088;&#1086;&#1075;&#1088;&#1072;&#1084;&#1084;&#1099;
&#1091;&#1087;&#1088;&#1072;&#1074;&#1083;&#1077;&#1085;&#1080;&#1103;
&#1076;&#1088;&#1072;&#1081;&#1074;&#1077;&#1088;&#1086;&#1084; ProcessMon<!--mstheme--></font></h2>
<!--mstheme--><font face="Arial, Arial, Helvetica">
<p>&nbsp;</p>
<code><!--mstheme--></font>
<pre><font size="2"><b> ;@echo off
 ;goto make

 ;:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
 ;
 ;  &#1055;&#1088;&#1086;&#1075;&#1088;&#1072;&#1084;&#1084;&#1072; &#1091;&#1087;&#1088;&#1072;&#1074;&#1083;&#1077;&#1085;&#1080;&#1103; &#1076;&#1088;&#1072;&#1081;&#1074;&#1077;&#1088;&#1086;&#1084; ProcessMon
 ;
 ;:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::

 .386
 .model flat, stdcall
 option casemap:none

 ;:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
 ;                               &#1042; &#1050; &#1051; &#1070; &#1063; &#1040; &#1045; &#1052; &#1067; &#1045;    &#1060; &#1040; &#1049; &#1051; &#1067;
 ;:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::

 include \masm32\include\windows.inc

 include \masm32\include\kernel32.inc
 include \masm32\include\user32.inc
 include \masm32\include\advapi32.inc
 include \masm32\include\comctl32.inc

 includelib \masm32\lib\kernel32.lib
 includelib \masm32\lib\user32.lib
 includelib \masm32\lib\advapi32.lib
 includelib \masm32\lib\comctl32.lib

 include \masm32\include\winioctl.inc

 include cocomac\ListView.mac
 include \masm32\Macros\Strings.mac

 include ..\common.inc

 ;:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
 ;                                      &#1050; &#1054; &#1053; &#1057; &#1058; &#1040; &#1053; &#1058; &#1067;                                           
 ;:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::

 IDD_MAIN        equ 1000
 IDC_LISTVIEW    equ 1001
 IDI_ICON        equ 1002

 ;:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
 ;                     &#1053; &#1045; &#1048; &#1053; &#1048; &#1062; &#1048; &#1040; &#1051; &#1048; &#1047; &#1048; &#1056; &#1054; &#1042; &#1040; &#1053; &#1053; &#1067; &#1045;    &#1044; &#1040; &#1053; &#1053; &#1067; &#1045;                        
 ;:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::

 .data?

 g_hInstance     HINSTANCE   ?
 g_hwndDlg       HWND        ?
 g_hwndListView  HWND        ?

 g_hSCManager    HANDLE      ?
 g_hService      HANDLE      ?
 g_hEvent        HANDLE      ?

 g_hDevice       HANDLE      ?

 g_fbExitNow     BOOL        ?

 ;:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
 ;                                           &#1050; &#1054; &#1044;                                                   
 ;:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::

 .code
 
 ;:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
 ;                             MyUnhandledExceptionFilter                                            
 ;:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
 
 MyUnhandledExceptionFilter proc lpExceptionInfo:PTR EXCEPTION_POINTERS
 
 local dwBytesReturned:DWORD
 local _ss:SERVICE_STATUS

     invoke DeviceIoControl, g_hDevice, IOCTL_REMOVE_NOTIFY, \
                     NULL, 0, NULL, 0, addr dwBytesReturned, NULL
 
     mov g_fbExitNow, TRUE
     invoke SetEvent, g_hEvent

     invoke Sleep, 100
 
     invoke CloseHandle, g_hEvent
     invoke CloseHandle, g_hDevice
 
     invoke ControlService, g_hService, SERVICE_CONTROL_STOP, addr _ss
     invoke DeleteService, g_hService
 
     invoke CloseServiceHandle, g_hService
     invoke CloseServiceHandle, g_hSCManager
 
     mov eax, EXCEPTION_EXECUTE_HANDLER
     ret
 
 MyUnhandledExceptionFilter endp
 
 ;:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
 ;                                     ListViewInsertColumn                                          
 ;:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
 
 ListViewInsertColumn proc
 
 local lvc:LV_COLUMN
 
     mov lvc.imask, LVCF_TEXT + LVCF_WIDTH 
     mov lvc.pszText, $CTA0(&quot;Process&quot;)
     mov lvc.lx, 354
     ListView_InsertColumn g_hwndListView, 0, addr lvc
 
     mov lvc.pszText, $CTA0(&quot;PID&quot;)
     or lvc.imask, LVCF_FMT
     mov lvc.fmt, LVCFMT_RIGHT
     mov lvc.lx, 40
     ListView_InsertColumn g_hwndListView, 1, addr lvc
 
     mov lvc.fmt, LVCFMT_LEFT
     mov lvc.lx, 80
     mov lvc.pszText, $CTA0(&quot;State&quot;)
     ListView_InsertColumn g_hwndListView, 2, addr lvc
 
     ret
 
 ListViewInsertColumn endp
 
 ;:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
 ;                                        FillProcessInfo                                            
 ;:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
 
 FillProcessInfo proc uses esi pProcessData:PTR PROCESS_DATA
 
 local lvi:LV_ITEM
 local buffer[1024]:CHAR
 
     mov esi, pProcessData
     assume esi:ptr PROCESS_DATA
 
     mov lvi.imask, LVIF_TEXT
 
     ListView_GetItemCount g_hwndListView
     mov lvi.iItem, eax
 
     invoke GetLongPathName, addr [esi].szProcessName, addr buffer, sizeof buffer
     .if ( eax == 0 ) || ( eax &gt;= sizeof buffer )
         lea ecx, [esi].szProcessName
     .else
         lea ecx, buffer
     .endif

     and lvi.iSubItem, 0
     mov lvi.pszText, ecx
     ListView_InsertItem g_hwndListView, addr lvi
 
     inc lvi.iSubItem
     invoke wsprintf, addr buffer, $CTA0(&quot;%X&quot;), [esi].dwProcessId
     lea eax, buffer
     mov lvi.pszText, eax
     ListView_SetItem g_hwndListView, addr lvi
 
     inc lvi.iSubItem
     .if [esi].bCreate
         mov lvi.pszText, $CTA0(&quot;Created&quot;)
     .else
         mov lvi.pszText, $CTA0(&quot;Destroyed&quot;)
     .endif
     ListView_SetItem g_hwndListView, addr lvi
 
     assume esi:nothing
 
     ret
 
 FillProcessInfo endp
 
 ;:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
 ;                                     WaitForProcessData                                            
 ;:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
 
 WaitForProcessData proc hEvent:HANDLE
 
 local ProcessData:PROCESS_DATA
 local dwBytesReturned:DWORD
 
     invoke GetCurrentThread
     invoke SetThreadPriority, eax, THREAD_PRIORITY_HIGHEST  
 
     .while TRUE
         invoke WaitForSingleObject, hEvent, INFINITE
         .if eax != WAIT_FAILED
 
             .break .if g_fbExitNow == TRUE
 
             invoke DeviceIoControl, g_hDevice, IOCTL_GET_PROCESS_DATA, NULL, 0, \
                         addr ProcessData, sizeof ProcessData, addr dwBytesReturned, NULL
 
             .if eax != 0
                 invoke FillProcessInfo, addr ProcessData
             .endif
 
         .else
             invoke MessageBox, g_hwndDlg, \
                 $CTA0(&quot;Wait for event failed. Thread now exits. Restart application.&quot;), \
                 NULL, MB_ICONERROR
             .break
         .endif
     .endw
 
     invoke ExitThread, 0
     ret                         ; Never executed.
 
 WaitForProcessData endp
     
 ;:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
 ;                            &#1044; &#1048; &#1040; &#1051; &#1054; &#1043; &#1054; &#1042; &#1040; &#1071;    &#1055; &#1056; &#1054; &#1062; &#1045; &#1044; &#1059; &#1056; &#1040;                               
 ;:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
 
 DlgProc proc hDlg:HWND, uMsg:UINT, wParam:WPARAM, lParam:LPARAM
 
 local rect:RECT
 
     mov eax, uMsg
     .if eax == WM_INITDIALOG
 
         push hDlg
         pop g_hwndDlg
 
         invoke LoadIcon, g_hInstance, IDI_ICON
         invoke SendMessage, hDlg, WM_SETICON, ICON_BIG, eax
 
         invoke GetDlgItem, hDlg, IDC_LISTVIEW
         mov g_hwndListView, eax
         invoke SetFocus, g_hwndListView
 
         invoke GetClientRect, hDlg, addr rect
         invoke MoveWindow, g_hwndListView, rect.left, rect.top, rect.right, rect.bottom, FALSE
 
         ListView_SetExtendedListViewStyle g_hwndListView, LVS_EX_GRIDLINES + LVS_EX_FULLROWSELECT
 
         invoke ListViewInsertColumn
 
     .elseif eax == WM_SIZE
 
         mov eax, lParam
         mov ecx, eax
         and eax, 0FFFFh
         shr ecx, 16
         invoke MoveWindow, g_hwndListView, 0, 0, eax, ecx, TRUE
 
     .elseif eax == WM_COMMAND
 
         mov eax, wParam
         and eax, 0FFFFh
         .if eax == IDCANCEL
             invoke MessageBox, hDlg, $CTA0(&quot;Sure want to exit?&quot;), \
                     $CTA0(&quot;Exit Confirmation&quot;), MB_YESNO + MB_ICONQUESTION + MB_DEFBUTTON1
             .if eax == IDYES
                 invoke EndDialog, hDlg, 0
             .endif
         .endif
 
     .elseif uMsg == WM_GETMINMAXINFO
 
         mov ecx, lParam
         mov (MINMAXINFO PTR [ecx]).ptMinTrackSize.x, 380
         mov (MINMAXINFO PTR [ecx]).ptMinTrackSize.y, 150
 
     .else
 
         xor eax, eax
         ret
     
     .endif
 
     xor eax, eax
     inc eax
     ret
     
 DlgProc endp
 
 ;:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
 ;                                         start                                                     
 ;:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
 
 start proc
 
 local acModulePath[MAX_PATH]:CHAR
 local _ss:SERVICE_STATUS
 local dwBytesReturned:DWORD
 
     CTA  &quot;This program was tested on Windows 2000+sp2/sp3/sp4,\n&quot;, szExecutionConfirmation
     CTA  &quot;Windows XP no sp, Windows Server 2003 Std and\n&quot;
     CTA  &quot;seems to be workable. But it uses undocumented\n&quot;
     CTA  &quot;tricks in kernel mode and may crash your system\:\n&quot;
     CTA  &quot;\n&quot;
     CTA0 &quot;Are your shure you want to run it?\n&quot;
 
     invoke MessageBox, NULL, addr szExecutionConfirmation, \
         $CTA0(&quot;Execution Confirmation&quot;), MB_YESNO + MB_ICONQUESTION + MB_DEFBUTTON2
     .if eax == IDNO
         invoke ExitProcess, 0
     .endif
      
     invoke SetUnhandledExceptionFilter, MyUnhandledExceptionFilter
 
     invoke OpenSCManager, NULL, NULL, SC_MANAGER_ALL_ACCESS
     .if eax != NULL
         mov g_hSCManager, eax
 
         push eax
         invoke GetFullPathName, $CTA0(&quot;ProcessMon.sys&quot;), sizeof acModulePath, addr acModulePath, esp
         pop eax
 
         invoke CreateService, g_hSCManager, $CTA0(&quot;ProcessMon&quot;), \
             $CTA0(&quot;Process creation/destruction monitor&quot;), \
             SERVICE_START + SERVICE_STOP + DELETE, SERVICE_KERNEL_DRIVER, SERVICE_DEMAND_START, \
             SERVICE_ERROR_IGNORE, addr acModulePath, NULL, NULL, NULL, NULL, NULL
 
         .if eax != NULL
             mov g_hService, eax
 
             invoke StartService, g_hService, 0, NULL
             .if eax != 0
 
                 invoke CreateFile, $CTA0(&quot;\\\\.\\ProcessMon&quot;), \
                         GENERIC_READ + GENERIC_WRITE, 0, NULL, OPEN_EXISTING, 0, NULL
 
                 .if eax != INVALID_HANDLE_VALUE
                     mov g_hDevice, eax
 
                     invoke DeleteService, g_hService

                     invoke CreateEvent, NULL, FALSE, FALSE, NULL
                     mov g_hEvent, eax
 
                     and g_fbExitNow, FALSE

                     push eax
                     invoke CreateThread, NULL, 0, offset WaitForProcessData, g_hEvent, 0, esp
                     pop ecx
                     .if eax != NULL
                     
                         invoke CloseHandle, eax                             
 
                         ;:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
 
                         invoke DeviceIoControl, g_hDevice, IOCTL_SET_NOTIFY, \
                                 addr g_hEvent, sizeof g_hEvent, NULL, 0, addr dwBytesReturned, NULL
 
                         .if eax != 0
 
                             invoke GetModuleHandle, NULL
                             mov g_hInstance, eax
                             invoke DialogBoxParam, g_hInstance, IDD_MAIN, NULL, addr DlgProc, 0
 
                             invoke DeviceIoControl, g_hDevice, IOCTL_REMOVE_NOTIFY, \
                                         NULL, 0, NULL, 0, addr dwBytesReturned, NULL
                         .else
                             invoke MessageBox, NULL, \
                                     $CTA0(&quot;Can't set notify.&quot;), NULL, MB_ICONSTOP
                         .endif
 
                         ;:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
 
                         mov g_fbExitNow, TRUE
                         invoke SetEvent, g_hEvent
                     
                         invoke Sleep, 100
                     
                     .else
                         invoke MessageBox, NULL, $CTA0(&quot;Can't create thread.&quot;), NULL, MB_ICONSTOP
                     .endif
 
                     invoke CloseHandle, g_hEvent
                     invoke CloseHandle, g_hDevice
                 .else
                     invoke MessageBox, NULL, $CTA0(&quot;Can't open device.&quot;), NULL, MB_ICONSTOP
                 .endif
                 invoke ControlService, g_hService, SERVICE_CONTROL_STOP, addr _ss
             .else
                 invoke MessageBox, NULL, $CTA0(&quot;Can't start driver.&quot;), NULL, MB_ICONSTOP
             .endif
 
             invoke DeleteService, g_hService
             invoke CloseServiceHandle, g_hService
 
         .else
             invoke MessageBox, NULL, $CTA0(&quot;Can't register driver.&quot;), NULL, MB_ICONSTOP
         .endif
         invoke CloseServiceHandle, g_hSCManager
     .else
         invoke MessageBox, NULL, \
             $CTA0(&quot;Can't connect to SCM.&quot;), NULL, MB_ICONSTOP
     .endif
 
     invoke ExitProcess, 0
     invoke InitCommonControls
     ret
 
 start endp
 
 ;:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
 ;                                                                                                   
 ;:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
 
 end start
 
 :make
 
 set exe=ProcessMon
 
 :makerc
 if exist rsrc.obj goto final
     \masm32\bin\rc /v rsrc.rc
     \masm32\bin\cvtres /machine:ix86 rsrc.res
     if errorlevel 0 goto final
         echo.
         pause
         exit
 
 :final
 
 if exist rsrc.res del rsrc.res
 if exist ..\%exe%.exe del ..\%exe%.exe
 
 \masm32\bin\ml /nologo /c /coff %exe%.bat
 \masm32\bin\link /nologo /subsystem:windows %exe%.obj rsrc.obj
 
 del %exe%.obj
 move %exe%.exe ..
 if exist %exe%.exe del %exe%.exe
 
 echo.
 pause

</b></font></pre>
<!--mstheme--><font face="Arial, Arial, Helvetica"></code><br>
<br>
<p>&nbsp;<!--mstheme--></font>
<h2><!--mstheme--><font face="Arial, Arial, Helvetica" color="#CCCCCC">14.3
&#1056;&#1072;&#1079;&#1073;&#1080;&#1088;&#1072;&#1077;&#1084;
&#1087;&#1088;&#1086;&#1075;&#1088;&#1072;&#1084;&#1084;&#1091;
&#1091;&#1087;&#1088;&#1072;&#1074;&#1083;&#1077;&#1085;&#1080;&#1103;
&#1076;&#1088;&#1072;&#1081;&#1074;&#1077;&#1088;&#1086;&#1084;<!--mstheme--></font></h2>
<!--mstheme--><font face="Arial, Arial, Helvetica">
<p>&nbsp;</p>
<code><!--mstheme--></font>
<pre>     invoke SetUnhandledExceptionFilter, MyUnhandledExceptionFilter

</pre>
<!--mstheme--><font face="Arial, Arial, Helvetica"></code>
<p>&#1059;&#1089;&#1090;&#1072;&#1085;&#1072;&#1074;&#1083;&#1080;&#1074;&#1072;&#1077;&#1084;
&#1086;&#1073;&#1088;&#1072;&#1073;&#1086;&#1090;&#1095;&#1080;&#1082;
&#1080;&#1089;&#1082;&#1083;&#1102;&#1095;&#1077;&#1085;&#1080;&#1081;,
&#1087;&#1086;&#1082;&#1088;&#1099;&#1074;&#1072;&#1102;&#1097;&#1080;&#1081;
&#1074;&#1089;&#1077; &#1087;&#1086;&#1090;&#1086;&#1082;&#1080;
&#1087;&#1088;&#1086;&#1094;&#1077;&#1089;&#1089;&#1072; (&#1087;&#1086;&#1076;&#1088;&#1086;&#1073;&#1085;&#1077;&#1077;
&#1089;&#1084;. &#1063;&#1072;&#1089;&#1090;&#1100; 9). &#1055;&#1088;&#1080;
&#1074;&#1086;&#1079;&#1085;&#1080;&#1082;&#1085;&#1086;&#1074;&#1077;&#1085;&#1080;&#1080;
&#1080;&#1089;&#1082;&#1083;&#1102;&#1095;&#1077;&#1085;&#1080;&#1103; &#1074;
&#1083;&#1102;&#1073;&#1086;&#1084; &#1080;&#1079;
&#1087;&#1086;&#1090;&#1086;&#1082;&#1086;&#1074;
&#1087;&#1088;&#1086;&#1094;&#1077;&#1089;&#1089;&#1072; &#1085;&#1072;&#1096;
&#1086;&#1073;&#1088;&#1072;&#1073;&#1086;&#1090;&#1095;&#1080;&#1082;
&#1087;&#1086;&#1087;&#1099;&#1090;&#1072;&#1077;&#1090;&#1089;&#1103;
&#1087;&#1088;&#1080;&#1074;&#1077;&#1089;&#1090;&#1080;
&#1089;&#1080;&#1089;&#1090;&#1077;&#1084;&#1091; &#1074;
&#1089;&#1086;&#1089;&#1090;&#1086;&#1103;&#1085;&#1080;&#1077;,
&#1087;&#1088;&#1077;&#1076;&#1096;&#1077;&#1089;&#1090;&#1074;&#1086;&#1074;&#1072;&#1074;&#1096;&#1077;&#1077;
&#1079;&#1072;&#1087;&#1091;&#1089;&#1082;&#1091;
&#1087;&#1088;&#1086;&#1075;&#1088;&#1072;&#1084;&#1084;&#1099;.</p>
<p>&#1042; &#1063;&#1072;&#1089;&#1090;&#1080; 9 &quot;&#1041;&#1072;&#1079;&#1086;&#1074;&#1072;&#1103;
&#1090;&#1077;&#1093;&#1085;&#1080;&#1082;&#1072;:
&#1056;&#1072;&#1073;&#1086;&#1090;&#1072; &#1089;
&#1087;&#1072;&#1084;&#1103;&#1090;&#1100;&#1102;.
&#1056;&#1072;&#1079;&#1076;&#1077;&#1083;&#1103;&#1077;&#1084;&#1072;&#1103;
&#1087;&#1072;&#1084;&#1103;&#1090;&#1100;&quot; &#1074;
&#1086;&#1087;&#1088;&#1077;&#1076;&#1077;&#1083;&#1077;&#1085;&#1080;&#1080;
&#1092;&#1091;&#1085;&#1082;&#1094;&#1080;&#1080; MyUnhandledExceptionFilter
&#1073;&#1099;&#1083;&#1072;
&#1076;&#1086;&#1087;&#1091;&#1097;&#1077;&#1085;&#1072;
&#1086;&#1096;&#1080;&#1073;&#1082;&#1072;:
&#1092;&#1091;&#1085;&#1082;&#1094;&#1080;&#1103; &#1085;&#1077;
&#1087;&#1088;&#1080;&#1085;&#1080;&#1084;&#1072;&#1083;&#1072;
&#1087;&#1072;&#1088;&#1072;&#1084;&#1077;&#1090;&#1088;&#1086;&#1074;,
&#1093;&#1086;&#1090;&#1103; &#1089;&#1080;&#1089;&#1090;&#1077;&#1084;&#1072;
&#1087;&#1077;&#1088;&#1077;&#1076;&#1072;&#1077;&#1090;
&#1086;&#1073;&#1088;&#1072;&#1073;&#1086;&#1090;&#1095;&#1080;&#1082;&#1091;
&#1086;&#1076;&#1080;&#1085;
&#1087;&#1072;&#1088;&#1072;&#1084;&#1077;&#1090;&#1088; -
&#1091;&#1082;&#1072;&#1079;&#1072;&#1090;&#1077;&#1083;&#1100; &#1085;&#1072;
&#1089;&#1090;&#1088;&#1091;&#1082;&#1090;&#1091;&#1088;&#1091;
EXCEPTION_POINTERS. &#1042;
&#1088;&#1077;&#1079;&#1091;&#1083;&#1100;&#1090;&#1072;&#1090;&#1077;
&#1092;&#1091;&#1085;&#1082;&#1094;&#1080;&#1103; &#1085;&#1077;
&#1074;&#1086;&#1079;&#1074;&#1088;&#1072;&#1097;&#1072;&#1083;&#1072;
&#1089;&#1090;&#1077;&#1082; &#1074;
&#1080;&#1089;&#1093;&#1086;&#1076;&#1085;&#1086;&#1077;
&#1089;&#1086;&#1089;&#1090;&#1086;&#1103;&#1085;&#1080;&#1077;.
&#1045;&#1089;&#1083;&#1080; &#1073;&#1099;
&#1076;&#1077;&#1081;&#1089;&#1090;&#1074;&#1080;&#1090;&#1077;&#1083;&#1100;&#1085;&#1086;
&#1087;&#1088;&#1086;&#1080;&#1079;&#1086;&#1096;&#1083;&#1086;
&#1080;&#1089;&#1082;&#1083;&#1102;&#1095;&#1077;&#1085;&#1080;&#1077;,
&#1090;&#1086; &#1087;&#1086; &#1074;&#1099;&#1093;&#1086;&#1076;&#1077;
&#1080;&#1079;
&#1086;&#1073;&#1088;&#1072;&#1073;&#1086;&#1090;&#1095;&#1080;&#1082;&#1072;
&#1080;&#1079;-&#1079;&#1072;
&#1085;&#1077;&#1082;&#1086;&#1088;&#1088;&#1077;&#1082;&#1090;&#1085;&#1086;&#1075;&#1086;
&#1089;&#1086;&#1089;&#1090;&#1086;&#1103;&#1085;&#1080;&#1103;
&#1089;&#1090;&#1077;&#1082;&#1072;
&#1087;&#1088;&#1086;&#1080;&#1079;&#1086;&#1096;&#1083;&#1086; &#1073;&#1099;
&#1085;&#1086;&#1074;&#1086;&#1077;
&#1080;&#1089;&#1082;&#1083;&#1102;&#1095;&#1077;&#1085;&#1080;&#1077;,
&#1095;&#1090;&#1086; &#1087;&#1086;&#1074;&#1083;&#1077;&#1082;&#1083;&#1086;
&#1073;&#1099; &#1079;&#1072; &#1089;&#1086;&#1073;&#1086;&#1081;
&#1087;&#1086;&#1074;&#1090;&#1086;&#1088;&#1085;&#1099;&#1081;
&#1077;&#1075;&#1086; &#1074;&#1099;&#1079;&#1086;&#1074; &#1080;
&#1090;&#1072;&#1082; &#1076;&#1086;
&#1073;&#1077;&#1089;&#1082;&#1086;&#1085;&#1077;&#1095;&#1085;&#1086;&#1089;&#1090;&#1080;.
&#1058;&#1072;&#1082; &#1095;&#1090;&#1086;,
&#1086;&#1073;&#1088;&#1072;&#1090;&#1080;&#1090;&#1077;
&#1074;&#1085;&#1080;&#1084;&#1072;&#1085;&#1080;&#1077;:
&#1092;&#1091;&#1085;&#1082;&#1094;&#1080;&#1103; MyUnhandledExceptionFilter
&#1087;&#1088;&#1080;&#1085;&#1080;&#1084;&#1072;&#1077;&#1090;
&#1091;&#1082;&#1072;&#1079;&#1072;&#1090;&#1077;&#1083;&#1100; &#1085;&#1072;
&#1089;&#1090;&#1088;&#1091;&#1082;&#1090;&#1091;&#1088;&#1091;
EXCEPTION_POINTERS.</p>
<code><!--mstheme--></font>
<pre>                     invoke CreateEvent, NULL, FALSE, FALSE, NULL
                     mov g_hEvent, eax

</pre>
<!--mstheme--><font face="Arial, Arial, Helvetica"></code>
<p>&#1055;&#1086;&#1089;&#1083;&#1077;
&#1088;&#1077;&#1075;&#1080;&#1089;&#1090;&#1088;&#1072;&#1094;&#1080;&#1080;
&#1080; &#1079;&#1072;&#1087;&#1091;&#1089;&#1082;&#1072;
&#1076;&#1088;&#1072;&#1081;&#1074;&#1077;&#1088;&#1072;
&#1089;&#1086;&#1079;&#1076;&#1072;&#1077;&#1084;
&#1073;&#1077;&#1079;&#1099;&#1084;&#1103;&#1085;&#1085;&#1099;&#1081;
&#1086;&#1073;&#1098;&#1077;&#1082;&#1090; &quot;&#1089;&#1086;&#1073;&#1099;&#1090;&#1080;&#1077;&quot;
&#1089;
&#1072;&#1074;&#1090;&#1086;&#1084;&#1072;&#1090;&#1080;&#1095;&#1077;&#1089;&#1082;&#1080;&#1084;
&#1089;&#1073;&#1088;&#1086;&#1089;&#1086;&#1084; &#1080; &#1074; &#1085;&#1077;
&#1089;&#1080;&#1075;&#1085;&#1072;&#1083;&#1100;&#1085;&#1086;&#1084;
&#1089;&#1086;&#1089;&#1090;&#1086;&#1103;&#1085;&#1080;&#1080; (nonsignaled).
&#1048;&#1084;&#1077;&#1085;&#1085;&#1086; &#1101;&#1090;&#1086;&#1090;
&#1086;&#1073;&#1098;&#1077;&#1082;&#1090; &#1080;
&#1073;&#1091;&#1076;&#1077;&#1090;
&#1089;&#1086;&#1074;&#1084;&#1077;&#1089;&#1090;&#1085;&#1086;
&#1080;&#1089;&#1087;&#1086;&#1083;&#1100;&#1079;&#1086;&#1074;&#1072;&#1090;&#1100;&#1089;&#1103;.</p>
<p>&#1043;&#1086;&#1074;&#1086;&#1088;&#1103; &quot;&#1074; &#1085;&#1077;
&#1089;&#1080;&#1075;&#1085;&#1072;&#1083;&#1100;&#1085;&#1086;&#1084;
&#1089;&#1086;&#1089;&#1090;&#1086;&#1103;&#1085;&#1080;&#1080;&quot; &#1103;
&#1089;&#1086;&#1079;&#1085;&#1072;&#1090;&#1077;&#1083;&#1100;&#1085;&#1086;
&#1086;&#1090;&#1089;&#1090;&#1091;&#1087;&#1072;&#1102; &#1086;&#1090;
&#1090;&#1088;&#1072;&#1076;&#1080;&#1094;&#1080;&#1080;
&#1080;&#1089;&#1087;&#1086;&#1083;&#1100;&#1079;&#1086;&#1074;&#1072;&#1090;&#1100;
&#1090;&#1086;&#1083;&#1100;&#1082;&#1086;
&#1086;&#1092;&#1080;&#1094;&#1080;&#1072;&#1083;&#1100;&#1085;&#1086;
&#1091;&#1089;&#1090;&#1086;&#1103;&#1074;&#1096;&#1080;&#1077;&#1089;&#1103;
&#1090;&#1077;&#1088;&#1084;&#1080;&#1085;&#1099;. &#1042;
&#1091;&#1084;&#1085;&#1099;&#1093;
&#1082;&#1085;&#1080;&#1078;&#1082;&#1072;&#1093;, &#1074;
&#1076;&#1072;&#1085;&#1085;&#1086;&#1084;
&#1089;&#1083;&#1091;&#1095;&#1072;&#1077;, &#1073;&#1099;&#1083; &#1073;&#1099;
&#1091;&#1087;&#1086;&#1090;&#1088;&#1077;&#1073;&#1083;&#1077;&#1085;
&#1090;&#1077;&#1088;&#1084;&#1080;&#1085; &quot;&#1074;
&#1079;&#1072;&#1085;&#1103;&#1090;&#1086;&#1084;
&#1089;&#1086;&#1089;&#1090;&#1086;&#1103;&#1085;&#1080;&#1080;&quot;.
&#1069;&#1090;&#1086;&#1090; &#1090;&#1077;&#1088;&#1084;&#1080;&#1085;
&#1080;&#1089;&#1087;&#1086;&#1083;&#1100;&#1079;&#1091;&#1077;&#1090;&#1089;&#1103;
&#1076;&#1083;&#1103; &#1074;&#1089;&#1077;&#1093;
&#1086;&#1073;&#1098;&#1077;&#1082;&#1090;&#1086;&#1074;
&#1089;&#1080;&#1085;&#1093;&#1088;&#1086;&#1085;&#1080;&#1079;&#1072;&#1094;&#1080;&#1080;,
&#1085;&#1086; &#1082; &#1086;&#1076;&#1085;&#1080;&#1084; &#1086;&#1085;
&#1087;&#1086;&#1076;&#1093;&#1086;&#1076;&#1080;&#1090;, &#1072; &#1082;
&#1076;&#1088;&#1091;&#1075;&#1080;&#1084; &#1085;&#1077;&#1090;.
&#1055;&#1086;&#1101;&#1090;&#1086;&#1084;&#1091;,
&#1095;&#1090;&#1086;&#1073;&#1099;
&#1080;&#1079;&#1073;&#1077;&#1078;&#1072;&#1090;&#1100;
&#1083;&#1080;&#1096;&#1085;&#1077;&#1081;
&#1087;&#1091;&#1090;&#1072;&#1085;&#1080;&#1094;&#1099;
&#1073;&#1091;&#1076;&#1077;&#1084;
&#1075;&#1086;&#1074;&#1086;&#1088;&#1080;&#1090;&#1100; &quot;&#1074;
&#1089;&#1080;&#1075;&#1085;&#1072;&#1083;&#1100;&#1085;&#1086;&#1084;
&#1089;&#1086;&#1089;&#1090;&#1086;&#1103;&#1085;&#1080;&#1080;&quot;
&#1080;&#1083;&#1080; &quot;&#1074; &#1085;&#1077;
&#1089;&#1080;&#1075;&#1085;&#1072;&#1083;&#1100;&#1085;&#1086;&#1084;
&#1089;&#1086;&#1089;&#1090;&#1086;&#1103;&#1085;&#1080;&#1080;&quot;.</p>
<code><!--mstheme--></font>
<pre>                     and g_fbExitNow, FALSE

</pre>
<!--mstheme--><font face="Arial, Arial, Helvetica"></code>
<p>&#1071;&#1074;&#1085;&#1086;
&#1089;&#1073;&#1088;&#1072;&#1089;&#1099;&#1074;&#1072;&#1077;&#1084;
&#1075;&#1083;&#1086;&#1073;&#1072;&#1083;&#1100;&#1085;&#1099;&#1081;
&#1092;&#1083;&#1072;&#1075;, &#1082;&#1086;&#1090;&#1086;&#1088;&#1099;&#1081;
&#1087;&#1086;&#1090;&#1088;&#1077;&#1073;&#1091;&#1077;&#1090;&#1089;&#1103;
&#1076;&#1083;&#1103; &#1090;&#1086;&#1075;&#1086;,
&#1095;&#1090;&#1086;&#1073;&#1099;
&#1089;&#1086;&#1086;&#1073;&#1097;&#1080;&#1090;&#1100;
&#1088;&#1072;&#1073;&#1086;&#1095;&#1077;&#1084;&#1091;
&#1087;&#1086;&#1090;&#1086;&#1082;&#1091; &#1086;
&#1087;&#1088;&#1077;&#1082;&#1088;&#1072;&#1097;&#1077;&#1085;&#1080;&#1080;
&#1088;&#1072;&#1073;&#1086;&#1090;&#1099;.</p>
<code><!--mstheme--></font>
<pre>                     push eax
                     invoke CreateThread, NULL, 0, offset WaitForProcessData, g_hEvent, 0, esp
                     pop ecx

</pre>
<!--mstheme--><font face="Arial, Arial, Helvetica"></code>
<p>&#1057;&#1086;&#1079;&#1076;&#1072;&#1077;&#1084;
&#1088;&#1072;&#1073;&#1086;&#1095;&#1080;&#1081;
&#1087;&#1086;&#1090;&#1086;&#1082;. &#1069;&#1090;&#1086;&#1090;
&#1087;&#1086;&#1090;&#1086;&#1082; &#1073;&#1091;&#1076;&#1077;&#1090;
&#1078;&#1076;&#1072;&#1090;&#1100; &#1085;&#1072;
&#1086;&#1087;&#1080;&#1089;&#1072;&#1090;&#1077;&#1083;&#1077; g_hEvent &#1080;
&#1087;&#1086; &#1089;&#1080;&#1075;&#1085;&#1072;&#1083;&#1091;
&#1079;&#1072;&#1073;&#1080;&#1088;&#1072;&#1090;&#1100; &#1091;
&#1076;&#1088;&#1072;&#1081;&#1074;&#1077;&#1088;&#1072;
&#1089;&#1090;&#1072;&#1090;&#1080;&#1089;&#1090;&#1080;&#1082;&#1091;.</p>
<code><!--mstheme--></font>
<pre>                         invoke DeviceIoControl, g_hDevice, IOCTL_SET_NOTIFY, \
                                 addr g_hEvent, sizeof g_hEvent, NULL, 0, addr dwBytesReturned, NULL

</pre>
<!--mstheme--><font face="Arial, Arial, Helvetica"></code>
<p>&#1064;&#1083;&#1077;&#1084;
&#1076;&#1088;&#1072;&#1081;&#1074;&#1077;&#1088;&#1091;
&#1091;&#1087;&#1088;&#1072;&#1074;&#1083;&#1103;&#1102;&#1097;&#1080;&#1081;
&#1082;&#1086;&#1076; IOCTL_SET_NOTIFY,
&#1087;&#1077;&#1088;&#1077;&#1076;&#1072;&#1074;&#1072;&#1103;
&#1077;&#1084;&#1091;
&#1086;&#1087;&#1080;&#1089;&#1072;&#1090;&#1077;&#1083;&#1100;
&#1085;&#1072;&#1096;&#1077;&#1075;&#1086;
&#1086;&#1073;&#1098;&#1077;&#1082;&#1090;&#1072; &quot;&#1089;&#1086;&#1073;&#1099;&#1090;&#1080;&#1077;&quot;.
&#1044;&#1088;&#1072;&#1081;&#1074;&#1077;&#1088;
&#1076;&#1086;&#1083;&#1078;&#1077;&#1085;
&#1085;&#1072;&#1095;&#1072;&#1090;&#1100;
&#1089;&#1083;&#1077;&#1078;&#1077;&#1085;&#1080;&#1077; &#1079;&#1072;
&#1089;&#1086;&#1079;&#1076;&#1072;&#1085;&#1080;&#1077;&#1084;/&#1091;&#1076;&#1072;&#1083;&#1077;&#1085;&#1080;&#1077;&#1084;
&#1087;&#1088;&#1086;&#1094;&#1077;&#1089;&#1089;&#1086;&#1074;.
&#1055;&#1088;&#1080; &#1089;&#1086;&#1079;&#1076;&#1072;&#1085;&#1080;&#1080;
&#1080;&#1083;&#1080; &#1091;&#1076;&#1072;&#1083;&#1077;&#1085;&#1080;&#1080;
&#1082;&#1072;&#1082;&#1086;&#1075;&#1086;-&#1083;&#1080;&#1073;&#1086;
&#1087;&#1088;&#1086;&#1094;&#1077;&#1089;&#1089;&#1072;,
&#1076;&#1088;&#1072;&#1081;&#1074;&#1077;&#1088;
&#1073;&#1091;&#1076;&#1077;&#1090;
&#1091;&#1089;&#1090;&#1072;&#1085;&#1072;&#1074;&#1083;&#1080;&#1074;&#1072;&#1090;&#1100;
&#1086;&#1073;&#1098;&#1077;&#1082;&#1090; &quot;&#1089;&#1086;&#1073;&#1099;&#1090;&#1080;&#1077;&quot;
&#1074; &#1089;&#1080;&#1075;&#1085;&#1072;&#1083;&#1100;&#1085;&#1086;&#1077;
&#1089;&#1086;&#1089;&#1090;&#1086;&#1103;&#1085;&#1080;&#1077;.</p>
<code><!--mstheme--></font>
<pre>                         .if eax != 0

                             invoke GetModuleHandle, NULL
                             mov g_hInstance, eax
                             invoke DialogBoxParam, g_hInstance, IDD_MAIN, NULL, addr DlgProc, 0

</pre>
<!--mstheme--><font face="Arial, Arial, Helvetica"></code>
<p>&#1045;&#1089;&#1083;&#1080;
&#1089;&#1083;&#1077;&#1078;&#1077;&#1085;&#1080;&#1077;
&#1091;&#1089;&#1090;&#1072;&#1085;&#1086;&#1074;&#1083;&#1077;&#1085;&#1086;,
&#1079;&#1072;&#1087;&#1091;&#1089;&#1082;&#1072;&#1077;&#1084;
&#1076;&#1080;&#1072;&#1083;&#1086;&#1075;. &#1042;
&#1089;&#1072;&#1084;&#1086;&#1081;
&#1076;&#1080;&#1072;&#1083;&#1086;&#1075;&#1086;&#1074;&#1086;&#1081;
&#1087;&#1088;&#1086;&#1094;&#1077;&#1076;&#1091;&#1088;&#1077;
&#1085;&#1077;&#1090; &#1085;&#1080;&#1095;&#1077;&#1075;&#1086;
&#1080;&#1085;&#1090;&#1077;&#1088;&#1077;&#1089;&#1085;&#1086;&#1075;&#1086;.</p>
<code><!--mstheme--></font>
<pre>                             invoke DeviceIoControl, g_hDevice, IOCTL_REMOVE_NOTIFY, \
                                         NULL, 0, NULL, 0, addr dwBytesReturned, NULL

</pre>
<!--mstheme--><font face="Arial, Arial, Helvetica"></code>
<p>&#1055;&#1086;&#1089;&#1083;&#1077;
&#1079;&#1072;&#1082;&#1088;&#1099;&#1090;&#1080;&#1103;
&#1076;&#1080;&#1072;&#1083;&#1086;&#1075;&#1072;
&#1079;&#1072;&#1089;&#1090;&#1072;&#1074;&#1083;&#1103;&#1077;&#1084;
&#1076;&#1088;&#1072;&#1081;&#1074;&#1077;&#1088;
&#1087;&#1088;&#1077;&#1082;&#1088;&#1072;&#1090;&#1080;&#1090;&#1100;
&#1089;&#1083;&#1077;&#1078;&#1077;&#1085;&#1080;&#1077;.</p>
<code><!--mstheme--></font>
<pre>                         mov g_fbExitNow, TRUE
                         invoke SetEvent, g_hEvent

</pre>
<!--mstheme--><font face="Arial, Arial, Helvetica"></code>
<p>&#1059;&#1089;&#1090;&#1072;&#1085;&#1072;&#1074;&#1083;&#1080;&#1074;&#1072;&#1077;&#1084;
&#1092;&#1083;&#1072;&#1075; g_fbExitNow &#1080;
&#1087;&#1077;&#1088;&#1077;&#1074;&#1086;&#1076;&#1080;&#1084;
&#1086;&#1073;&#1098;&#1077;&#1082;&#1090; &quot;&#1089;&#1086;&#1073;&#1099;&#1090;&#1080;&#1077;&quot;
&#1074; &#1089;&#1080;&#1075;&#1085;&#1072;&#1083;&#1100;&#1085;&#1086;&#1077;
&#1089;&#1086;&#1089;&#1090;&#1086;&#1103;&#1085;&#1080;&#1077;.
&#1069;&#1090;&#1086; &#1087;&#1088;&#1086;&#1073;&#1091;&#1076;&#1080;&#1090;
&#1088;&#1072;&#1073;&#1086;&#1095;&#1080;&#1081;
&#1087;&#1086;&#1090;&#1086;&#1082;, &#1086;&#1085;
&#1091;&#1074;&#1080;&#1076;&#1080;&#1090;
&#1091;&#1089;&#1090;&#1072;&#1085;&#1086;&#1074;&#1083;&#1077;&#1085;&#1085;&#1099;&#1081;
&#1092;&#1083;&#1072;&#1075; &#1080;
&#1087;&#1088;&#1077;&#1082;&#1088;&#1072;&#1090;&#1080;&#1090;
&#1088;&#1072;&#1073;&#1086;&#1090;&#1091;.</p>
<code><!--mstheme--></font>
<pre>                         invoke Sleep, 100

</pre>
<!--mstheme--><font face="Arial, Arial, Helvetica"></code>
<p>&#1053;&#1077;&#1084;&#1085;&#1086;&#1075;&#1086;
&#1087;&#1086;&#1076;&#1086;&#1078;&#1076;&#1077;&#1084;,
&#1087;&#1086;&#1082;&#1072; &#1088;&#1072;&#1073;&#1086;&#1095;&#1080;&#1081;
&#1087;&#1086;&#1090;&#1086;&#1082;
&#1079;&#1072;&#1074;&#1077;&#1088;&#1096;&#1072;&#1077;&#1090;&#1089;&#1103;.
&#1061;&#1086;&#1090;&#1103; &#1086;&#1085; &#1080;
&#1080;&#1084;&#1077;&#1077;&#1090; &#1073;&#1086;&#1083;&#1077;&#1077;
&#1074;&#1099;&#1089;&#1086;&#1082;&#1080;&#1081;
&#1087;&#1088;&#1080;&#1086;&#1088;&#1080;&#1090;&#1077;&#1090;,
&#1085;&#1077;&#1073;&#1086;&#1083;&#1100;&#1096;&#1072;&#1103;
&#1079;&#1072;&#1076;&#1077;&#1088;&#1078;&#1082;&#1072; &#1085;&#1077;
&#1087;&#1086;&#1074;&#1088;&#1077;&#1076;&#1080;&#1090;.</p>
<br>
<br>
<p>&nbsp;<!--mstheme--></font>
<h2><!--mstheme--><font face="Arial, Arial, Helvetica" color="#CCCCCC">14.4
&#1055;&#1088;&#1086;&#1094;&#1077;&#1076;&#1091;&#1088;&#1072;
&#1088;&#1072;&#1073;&#1086;&#1095;&#1077;&#1075;&#1086;
&#1087;&#1086;&#1090;&#1086;&#1082;&#1072;<!--mstheme--></font></h2>
<!--mstheme--><font face="Arial, Arial, Helvetica">
<p>&nbsp;</p>
<p>&#1055;&#1086;&#1089;&#1084;&#1086;&#1090;&#1088;&#1080;&#1084;
&#1090;&#1077;&#1087;&#1077;&#1088;&#1100; &#1085;&#1072;
&#1087;&#1088;&#1086;&#1094;&#1077;&#1076;&#1091;&#1088;&#1091;
&#1088;&#1072;&#1073;&#1086;&#1095;&#1077;&#1075;&#1086;
&#1087;&#1086;&#1090;&#1086;&#1082;&#1072;.</p>
<code><!--mstheme--></font>
<pre>     invoke GetCurrentThread
     invoke SetThreadPriority, eax, THREAD_PRIORITY_HIGHEST

</pre>
<!--mstheme--><font face="Arial, Arial, Helvetica"></code>
<p>&#1055;&#1086;&#1074;&#1099;&#1096;&#1072;&#1077;&#1084;
&#1087;&#1088;&#1080;&#1086;&#1088;&#1080;&#1090;&#1077;&#1090;
&#1087;&#1086;&#1090;&#1086;&#1082;&#1072;, &#1090;.&#1082;.
&#1077;&#1089;&#1083;&#1080; &#1091;
&#1076;&#1088;&#1072;&#1081;&#1074;&#1077;&#1088;&#1072;
&#1087;&#1086;&#1103;&#1074;&#1103;&#1090;&#1089;&#1103;
&#1089;&#1074;&#1077;&#1078;&#1080;&#1077;
&#1076;&#1072;&#1085;&#1085;&#1099;&#1077;,
&#1093;&#1086;&#1090;&#1077;&#1083;&#1086;&#1089;&#1100; &#1073;&#1099;
&#1085;&#1077; &#1091;&#1087;&#1091;&#1089;&#1090;&#1080;&#1090;&#1100;
&#1101;&#1090;&#1086;&#1090; &#1084;&#1086;&#1084;&#1077;&#1085;&#1090;.
&#1044;&#1077;&#1083;&#1086; &#1074; &#1090;&#1086;&#1084;,
&#1095;&#1090;&#1086; &#1076;&#1088;&#1072;&#1081;&#1074;&#1077;&#1088; (&#1076;&#1083;&#1103;
&#1091;&#1087;&#1088;&#1086;&#1097;&#1077;&#1085;&#1080;&#1103;
&#1087;&#1088;&#1080;&#1084;&#1077;&#1088;&#1072;)
&#1093;&#1088;&#1072;&#1085;&#1080;&#1090;
&#1080;&#1085;&#1092;&#1086;&#1088;&#1084;&#1072;&#1094;&#1080;&#1102;
&#1090;&#1086;&#1083;&#1100;&#1082;&#1086; &#1086;&#1073;
&#1086;&#1076;&#1085;&#1086;&#1084;
&#1087;&#1086;&#1089;&#1083;&#1077;&#1076;&#1085;&#1077;&#1084;
&#1089;&#1086;&#1079;&#1076;&#1072;&#1085;&#1085;&#1086;&#1084;/&#1091;&#1076;&#1072;&#1083;&#1077;&#1085;&#1085;&#1086;&#1084;
&#1087;&#1088;&#1086;&#1094;&#1077;&#1089;&#1089;&#1077;.
&#1059;&#1095;&#1080;&#1090;&#1099;&#1074;&#1072;&#1103; &#1090;&#1086;,
&#1095;&#1090;&#1086; &#1101;&#1090;&#1086;
&#1087;&#1088;&#1086;&#1080;&#1089;&#1093;&#1086;&#1076;&#1080;&#1090;
&#1086;&#1090;&#1085;&#1086;&#1089;&#1080;&#1090;&#1077;&#1083;&#1100;&#1085;&#1086;
&#1088;&#1077;&#1076;&#1082;&#1086;, &#1074;&#1088;&#1103;&#1076; &#1083;&#1080;
&#1084;&#1099; &#1087;&#1088;&#1086;&#1087;&#1091;&#1089;&#1090;&#1080;&#1084;
&#1101;&#1090;&#1086;&#1090; &#1084;&#1086;&#1084;&#1077;&#1085;&#1090;,
&#1076;&#1072;&#1078;&#1077; &#1085;&#1077;
&#1087;&#1086;&#1074;&#1099;&#1096;&#1072;&#1103;
&#1087;&#1088;&#1080;&#1086;&#1088;&#1080;&#1090;&#1077;&#1090;. &#1048;
&#1090;&#1077;&#1084; &#1085;&#1077; &#1084;&#1077;&#1085;&#1077;&#1077;.</p>
<code><!--mstheme--></font>
<pre>     .while TRUE
         invoke WaitForSingleObject, hEvent, INFINITE
         .if eax != WAIT_FAILED

</pre>
<!--mstheme--><font face="Arial, Arial, Helvetica"></code>
<p>&#1042;
&#1073;&#1077;&#1089;&#1082;&#1086;&#1085;&#1077;&#1095;&#1085;&#1086;&#1084;
&#1094;&#1080;&#1082;&#1083;&#1077; &#1078;&#1076;&#1077;&#1084; &#1085;&#1072;
&#1086;&#1073;&#1098;&#1077;&#1082;&#1090;&#1077; &quot;&#1089;&#1086;&#1073;&#1099;&#1090;&#1080;&#1077;&quot;.</p>
<code><!--mstheme--></font>
<pre>             .break .if g_fbExitNow == TRUE

</pre>
<!--mstheme--><font face="Arial, Arial, Helvetica"></code>
<p>&#1045;&#1089;&#1083;&#1080; &#1087;&#1086;&#1088;&#1072;
&#1074;&#1099;&#1093;&#1086;&#1076;&#1080;&#1090;&#1100;,
&#1087;&#1088;&#1077;&#1088;&#1099;&#1074;&#1072;&#1077;&#1084;
&#1094;&#1080;&#1082;&#1083;.</p>
<code><!--mstheme--></font>
<pre>             invoke DeviceIoControl, g_hDevice, IOCTL_GET_PROCESS_DATA, NULL, 0, \
                         addr ProcessData, sizeof ProcessData, addr dwBytesReturned, NULL

</pre>
<!--mstheme--><font face="Arial, Arial, Helvetica"></code>
<p>&#1047;&#1072;&#1073;&#1080;&#1088;&#1072;&#1077;&#1084; &#1091;
&#1076;&#1088;&#1072;&#1081;&#1074;&#1077;&#1088;&#1072;
&#1089;&#1074;&#1077;&#1078;&#1080;&#1077;
&#1076;&#1072;&#1085;&#1085;&#1099;&#1077;.</p>
<code><!--mstheme--></font>
<pre>             .if eax != 0
                 invoke FillProcessInfo, addr ProcessData
             .endif

</pre>
<!--mstheme--><font face="Arial, Arial, Helvetica"></code>
<p>&#1042;&#1099;&#1074;&#1086;&#1076;&#1080;&#1084;,
&#1087;&#1086;&#1083;&#1091;&#1095;&#1077;&#1085;&#1085;&#1091;&#1102;
&#1086;&#1090; &#1076;&#1088;&#1072;&#1081;&#1074;&#1077;&#1088;&#1072;
&#1080;&#1085;&#1092;&#1086;&#1088;&#1084;&#1072;&#1094;&#1080;&#1102;.</p>
<br>
<br>
<p>&nbsp;<!--mstheme--></font>
<h2><!--mstheme--><font face="Arial, Arial, Helvetica" color="#CCCCCC">14.5
&#1060;&#1091;&#1085;&#1082;&#1094;&#1080;&#1103; FillProcessInfo<!--mstheme--></font></h2>
<!--mstheme--><font face="Arial, Arial, Helvetica">
<p>&nbsp;</p>
<p>&#1057;&#1083;&#1091;&#1095;&#1072;&#1077;&#1090;&#1089;&#1103;,
&#1095;&#1090;&#1086; &#1076;&#1088;&#1072;&#1081;&#1074;&#1077;&#1088;
&#1074;&#1086;&#1079;&#1074;&#1088;&#1072;&#1097;&#1072;&#1077;&#1090; &quot;&#1082;&#1086;&#1088;&#1086;&#1090;&#1082;&#1080;&#1081;&quot;
&#1087;&#1091;&#1090;&#1100;.
&#1053;&#1072;&#1087;&#1088;&#1080;&#1084;&#1077;&#1088;, &quot;C:\PROGRA~1\WinZip\WinZip32.EXE&quot;.
&#1044;&#1077;&#1090;&#1072;&#1083;&#1100;&#1085;&#1086; &#1074;
&#1087;&#1088;&#1080;&#1095;&#1080;&#1085;&#1072;&#1093;
&#1101;&#1090;&#1086;&#1075;&#1086;
&#1103;&#1074;&#1083;&#1077;&#1085;&#1080;&#1103; &#1103; &#1085;&#1077;
&#1088;&#1072;&#1079;&#1073;&#1080;&#1088;&#1072;&#1083;&#1089;&#1103;.
&#1042;&#1080;&#1076;&#1080;&#1084;&#1086;, &#1077;&#1089;&#1083;&#1080;
&#1087;&#1088;&#1080; &#1089;&#1086;&#1079;&#1076;&#1072;&#1085;&#1080;&#1080;
&#1087;&#1088;&#1086;&#1094;&#1077;&#1089;&#1089;&#1072; &#1077;&#1075;&#1086;
&#1088;&#1086;&#1076;&#1080;&#1090;&#1077;&#1083;&#1100;
&#1079;&#1072;&#1087;&#1091;&#1089;&#1082;&#1072;&#1077;&#1090;
&#1077;&#1075;&#1086; (&#1090;&#1086;&#1095;&#1085;&#1077;&#1077;
&#1077;&#1075;&#1086;
&#1080;&#1089;&#1087;&#1086;&#1083;&#1085;&#1080;&#1084;&#1099;&#1081;
&#1086;&#1073;&#1088;&#1072;&#1079;) &#1087;&#1086; &quot;&#1082;&#1086;&#1088;&#1086;&#1090;&#1082;&#1086;&#1084;&#1091;&quot;
&#1087;&#1091;&#1090;&#1080;, &#1090;&#1086; &#1101;&#1090;&#1086;&#1090;
&#1087;&#1091;&#1090;&#1100; &#1080;
&#1087;&#1086;&#1087;&#1072;&#1076;&#1072;&#1077;&#1090; &#1074;
&#1089;&#1086;&#1086;&#1090;&#1074;&#1077;&#1090;&#1089;&#1090;&#1074;&#1091;&#1102;&#1097;&#1077;&#1077;
&#1087;&#1086;&#1083;&#1077; FILE_OBJECT. &#1052;&#1099;
&#1087;&#1088;&#1086;&#1089;&#1090;&#1086;
&#1074;&#1099;&#1079;&#1086;&#1074;&#1077;&#1084;
&#1092;&#1091;&#1085;&#1082;&#1094;&#1080;&#1102; GetLongPathName,
&#1082;&#1086;&#1090;&#1086;&#1088;&#1072;&#1103; &#1074;&#1089;&#1105;
&#1089;&#1076;&#1077;&#1083;&#1072;&#1077;&#1090; &#1089;&#1072;&#1084;&#1072;.
&#1045;&#1089;&#1083;&#1080; &#1073;&#1091;&#1092;&#1077;&#1088;&#1072;
&#1088;&#1072;&#1079;&#1084;&#1077;&#1088;&#1086;&#1084; 1024
&#1073;&#1072;&#1081;&#1090;, &#1074;&#1076;&#1088;&#1091;&#1075;
&#1086;&#1082;&#1072;&#1078;&#1077;&#1090;&#1089;&#1103;
&#1085;&#1077;&#1076;&#1086;&#1089;&#1090;&#1072;&#1090;&#1086;&#1095;&#1085;&#1086;,
&#1090;&#1086; &#1087;&#1088;&#1086;&#1089;&#1090;&#1086;
&#1087;&#1086;&#1082;&#1072;&#1078;&#1077;&#1084; &#1090;&#1086;&#1090;
&#1087;&#1091;&#1090;&#1100;, &#1082;&#1086;&#1090;&#1086;&#1088;&#1099;&#1081;
&#1074;&#1077;&#1088;&#1085;&#1091;&#1083;
&#1076;&#1088;&#1072;&#1081;&#1074;&#1077;&#1088;. &#1044;&#1083;&#1103;
&#1087;&#1088;&#1086;&#1089;&#1090;&#1086;&#1090;&#1099;, &#1103; &#1085;&#1077;
&#1089;&#1090;&#1072;&#1083;
&#1074;&#1099;&#1076;&#1077;&#1083;&#1103;&#1090;&#1100;
&#1076;&#1086;&#1087;&#1086;&#1083;&#1085;&#1080;&#1090;&#1077;&#1083;&#1100;&#1085;&#1091;&#1102;
&#1087;&#1072;&#1084;&#1103;&#1090;&#1100; &#1080;
&#1074;&#1099;&#1079;&#1099;&#1074;&#1072;&#1090;&#1100; GetLongPathName
&#1089;&#1085;&#1086;&#1074;&#1072;.</p>
<code><!--mstheme--></font>
<pre> local buffer[1024]:CHAR

 . . .
 
     invoke GetLongPathName, addr [esi].szProcessName, addr buffer, sizeof buffer
     .if ( eax == 0 ) || ( eax &gt;= sizeof buffer )
         lea ecx, [esi].szProcessName
     .else
         lea ecx, buffer
     .endif

     and lvi.iSubItem, 0
     mov lvi.pszText, ecx
     ListView_InsertItem g_hwndListView, addr lvi

</pre>
<!--mstheme--><font face="Arial, Arial, Helvetica"></code><br>
<br>
<p>&nbsp;<!--mstheme--></font>
<h2><!--mstheme--><font face="Arial, Arial, Helvetica" color="#CCCCCC">14.6
&#1048;&#1089;&#1093;&#1086;&#1076;&#1085;&#1099;&#1081;
&#1090;&#1077;&#1082;&#1089;&#1090;
&#1076;&#1088;&#1072;&#1081;&#1074;&#1077;&#1088;&#1072; ProcessMon<!--mstheme--></font></h2>
<!--mstheme--><font face="Arial, Arial, Helvetica">
<p>&nbsp;</p>
<p>&#1052;&#1086;&#1076;&#1091;&#1083;&#1100; ProcessMon.bat</p>
<code><!--mstheme--></font>
<pre> <font size="2"><b>;@echo off
 ;goto make
 
 ;:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
 ;
 ;  ProcessMon - &#1055;&#1088;&#1080;&#1084;&#1077;&#1088; &#1090;&#1086;&#1075;&#1086;, &#1082;&#1072;&#1082; &#1076;&#1088;&#1072;&#1081;&#1074;&#1077;&#1088; &#1084;&#1086;&#1078;&#1077;&#1090; &#1089;&#1086;&#1086;&#1073;&#1097;&#1080;&#1090;&#1100;
 ;                  &#1088;&#1077;&#1078;&#1080;&#1084;&#1091; &#1087;&#1086;&#1083;&#1100;&#1079;&#1086;&#1074;&#1072;&#1090;&#1077;&#1083;&#1103; &#1086; &#1085;&#1072;&#1089;&#1090;&#1091;&#1087;&#1083;&#1077;&#1085;&#1080;&#1080; &#1080;&#1085;&#1090;&#1077;&#1088;&#1077;&#1089;&#1091;&#1102;&#1097;&#1077;&#1075;&#1086; &#1077;&#1075;&#1086; &#1089;&#1086;&#1073;&#1099;&#1090;&#1080;&#1103; &#1080; &#1085;&#1077; &#1090;&#1086;&#1083;&#1100;&#1082;&#1086; &#1101;&#1090;&#1086;.
 ;
 ;:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
 
 .386
 .model flat, stdcall
 option casemap:none
 
 ;:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
 ;                               &#1042; &#1050; &#1051; &#1070; &#1063; &#1040; &#1045; &#1052; &#1067; &#1045;    &#1060; &#1040; &#1049; &#1051; &#1067;
 ;:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
 
 include \masm32\include\w2k\ntstatus.inc
 include \masm32\include\w2k\ntddk.inc
 include \masm32\include\w2k\ntoskrnl.inc
 
 includelib \masm32\lib\w2k\ntoskrnl.lib
 
 include \masm32\Macros\Strings.mac

 include ..\common.inc
 include ProcPath.asm

 ;:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
 ;                             &#1053; &#1045; &#1048; &#1047; &#1052; &#1045; &#1053; &#1071; &#1045; &#1052; &#1067; &#1045;    &#1044; &#1040; &#1053; &#1053; &#1067; &#1045;                                
 ;:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
 
 .const
 
 CCOUNTED_UNICODE_STRING &quot;\\Device\\ProcessMon&quot;, g_usDeviceName, 4
 CCOUNTED_UNICODE_STRING &quot;\\DosDevices\\ProcessMon&quot;, g_usSymbolicLinkName, 4
 
 ;:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
 ;                     &#1053; &#1045; &#1048; &#1053; &#1048; &#1062; &#1048; &#1040; &#1051; &#1048; &#1047; &#1048; &#1056; &#1054; &#1042; &#1040; &#1053; &#1053; &#1067; &#1045;    &#1044; &#1040; &#1053; &#1053; &#1067; &#1045;                        
 ;:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
 
 .data?
 
 g_pkEventObject         PKEVENT         ?
 g_dwProcessNameOffset   DWORD           ?
 g_fbNotifyRoutineSet    BOOL            ?
 
 g_ProcessData           PROCESS_DATA    &lt;&gt;
 
 ;:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
 ;                                           &#1050; &#1054; &#1044;                                                   
 ;:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
 
 .code
 
 ;:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
 ;                                   DispatchCreateClose                                             
 ;:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
 
 DispatchCreateClose proc pDeviceObject:PDEVICE_OBJECT, pIrp:PIRP
 
     mov ecx, pIrp
     mov (_IRP PTR [ecx]).IoStatus.Status, STATUS_SUCCESS
     and (_IRP PTR [ecx]).IoStatus.Information, 0
 
     fastcall IofCompleteRequest, ecx, IO_NO_INCREMENT
 
     mov eax, STATUS_SUCCESS
     ret
 
 DispatchCreateClose endp
 
 ;:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
 ;                                     ProcessNotifyRoutine                                          
 ;:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
 
 ProcessNotifyRoutine proc dwParentId:DWORD, dwProcessId:DWORD, bCreate:BOOL ; BOOLEAN
 
 local peProcess:PVOID               ; PEPROCESS
 local fbDereference:BOOL
 local us:UNICODE_STRING
 local as:ANSI_STRING
 
     push eax
     invoke PsLookupProcessByProcessId, dwProcessId, esp
     pop peProcess
     .if eax == STATUS_SUCCESS
         mov fbDereference, TRUE
     .else
         invoke IoGetCurrentProcess
         mov peProcess, eax
         and fbDereference, FALSE
     .endif
 
     mov eax, dwProcessId
     mov g_ProcessData.dwProcessId, eax
 
     mov eax, bCreate
     mov g_ProcessData.bCreate, eax
 
     invoke memset, addr g_ProcessData.szProcessName, 0, IMAGE_FILE_PATH_LEN
 
     invoke GetImageFilePath, peProcess, addr us
     .if eax == STATUS_SUCCESS
 
         lea eax, g_ProcessData.szProcessName
         mov as.Buffer,          eax
         mov as.MaximumLength,   IMAGE_FILE_PATH_LEN
         and as._Length,         0
 
         invoke RtlUnicodeStringToAnsiString, addr as, addr us, FALSE
 
         invoke ExFreePool, us.Buffer
     .else
 
         mov eax, g_dwImageFileNameOffset
         .if eax != 0
             add eax, peProcess
             invoke memcpy, addr g_ProcessData.szProcessName, eax, 16
         .endif
 
     .endif
 
     .if fbDereference
         fastcall ObfDereferenceObject, peProcess
     .endif
 
     invoke KeSetEvent, g_pkEventObject, 0, FALSE
 
     ret
 
 ProcessNotifyRoutine endp
 
 ;:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
 ;                                     DispatchControl                                               
 ;:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
 
 DispatchControl proc uses esi edi pDeviceObject:PDEVICE_OBJECT, pIrp:PIRP
 
 local liDelayTime:LARGE_INTEGER
 
     mov esi, pIrp
     assume esi:ptr _IRP
 
     mov [esi].IoStatus.Status, STATUS_UNSUCCESSFUL
     and [esi].IoStatus.Information, 0
 
     IoGetCurrentIrpStackLocation esi
     mov edi, eax
     assume edi:ptr IO_STACK_LOCATION
 
     .if [edi].Parameters.DeviceIoControl.IoControlCode == IOCTL_SET_NOTIFY
         .if [edi].Parameters.DeviceIoControl.InputBufferLength &gt;= sizeof HANDLE
 
             .if g_fbNotifyRoutineSet == FALSE
 
                 mov edx, [esi].AssociatedIrp.SystemBuffer
                 mov edx, [edx]
 
                 mov ecx, ExEventObjectType
                 mov ecx, [ecx]
                 mov ecx, [ecx]
 
                 invoke ObReferenceObjectByHandle, edx, EVENT_MODIFY_STATE, ecx, \
                                         UserMode, addr g_pkEventObject, NULL
                 .if eax == STATUS_SUCCESS
 
                     invoke PsSetCreateProcessNotifyRoutine, ProcessNotifyRoutine, FALSE
                     mov [esi].IoStatus.Status, eax
 
                     .if eax == STATUS_SUCCESS
 
                         mov g_fbNotifyRoutineSet, TRUE
 
                         invoke DbgPrint, \
                                 $CTA0(&quot;ProcessMon: Notification was set\n&quot;)
     
                         mov eax, pDeviceObject
                         mov eax, (DEVICE_OBJECT PTR [eax]).DriverObject
                         and (DRIVER_OBJECT PTR [eax]).DriverUnload, NULL
 
                     .else
                         invoke DbgPrint, \
                         $CTA0(&quot;ProcessMon: Couldn't set notification\n&quot;)
                     .endif
 
                 .else
                     mov [esi].IoStatus.Status, eax
                     invoke DbgPrint, \
                     $CTA0(&quot;ProcessMon: Couldn't reference user event object. Status: %08X\n&quot;), \
                     eax
                 .endif
             .endif
         .else
             mov [esi].IoStatus.Status, STATUS_BUFFER_TOO_SMALL
         .endif
 
     .elseif [edi].Parameters.DeviceIoControl.IoControlCode == IOCTL_REMOVE_NOTIFY
 
         .if g_fbNotifyRoutineSet == TRUE
 
             invoke PsSetCreateProcessNotifyRoutine, ProcessNotifyRoutine, TRUE
             mov [esi].IoStatus.Status, eax
 
             .if eax == STATUS_SUCCESS
 
                 and g_fbNotifyRoutineSet, FALSE
 
                 invoke DbgPrint, $CTA0(&quot;ProcessMon: Notification was removed\n&quot;)
 
                 or liDelayTime.HighPart, -1
                 mov liDelayTime.LowPart, -500000
     
                 invoke KeDelayExecutionThread, KernelMode, FALSE, addr liDelayTime
 
                 mov eax, pDeviceObject
                 mov eax, (DEVICE_OBJECT PTR [eax]).DriverObject
                 mov (DRIVER_OBJECT PTR [eax]).DriverUnload, offset DriverUnload
 
                 .if g_pkEventObject != NULL
                     invoke ObDereferenceObject, g_pkEventObject
                     and g_pkEventObject, NULL
                 .endif
             .else
                 invoke DbgPrint, \
                 $CTA0(&quot;ProcessMon: Couldn't remove notification\n&quot;)
             .endif
             
         .endif
 
     .elseif [edi].Parameters.DeviceIoControl.IoControlCode == IOCTL_GET_PROCESS_DATA
         .if [edi].Parameters.DeviceIoControl.OutputBufferLength &gt;= sizeof PROCESS_DATA
 
             mov eax, [esi].AssociatedIrp.SystemBuffer
             invoke memcpy, eax, offset g_ProcessData, sizeof g_ProcessData
     
             mov [esi].IoStatus.Status, STATUS_SUCCESS
             mov [esi].IoStatus.Information, sizeof g_ProcessData
 
         .else
             mov [esi].IoStatus.Status, STATUS_BUFFER_TOO_SMALL
         .endif
 
     .else
         mov [esi].IoStatus.Status, STATUS_INVALID_DEVICE_REQUEST
     .endif
 
     push [esi].IoStatus.Status
     
     assume edi:nothing
     assume esi:nothing
 
     fastcall IofCompleteRequest, esi, IO_NO_INCREMENT
 
     pop eax
     ret
 
 DispatchControl endp
 
 ;:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
 ;                                       DriverUnload                                                
 ;:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
 
 DriverUnload proc pDriverObject:PDRIVER_OBJECT
 
     invoke IoDeleteSymbolicLink, addr g_usSymbolicLinkName
 
     mov eax, pDriverObject
     invoke IoDeleteDevice, (DRIVER_OBJECT PTR [eax]).DeviceObject
 
     ret
 
 DriverUnload endp
 
 ;:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
 ;                              D I S C A R D A B L E   C O D E                                      
 ;:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
 
 .code INIT
 
 ;:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
 ;                                    GetImageFileNameOffset                                         
 ;:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
 
 GetImageFileNameOffset proc uses esi ebx
 
     invoke IoGetCurrentProcess
     mov esi, eax
 
     xor ebx, ebx
     .while ebx &lt; 1000h
         lea eax, [esi+ebx]
         invoke _strnicmp, eax, $CTA0(&quot;system&quot;), 6
         .break .if eax == 0
         inc ebx
     .endw
 
     .if eax == 0
         mov eax, ebx
     .else
         xor eax, eax
     .endif
 
     ret
 
 GetImageFileNameOffset endp
 
 ;:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
 ;                                       DriverEntry                                                 
 ;:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
 
 DriverEntry proc pDriverObject:PDRIVER_OBJECT, pusRegistryPath:PUNICODE_STRING
 
 local status:NTSTATUS
 local pDeviceObject:PDEVICE_OBJECT
 
     mov status, STATUS_DEVICE_CONFIGURATION_ERROR
 
     invoke IoCreateDevice, pDriverObject, 0, addr g_usDeviceName, \
                 FILE_DEVICE_UNKNOWN, 0, TRUE, addr pDeviceObject
     .if eax == STATUS_SUCCESS
         invoke IoCreateSymbolicLink, addr g_usSymbolicLinkName, addr g_usDeviceName
         .if eax == STATUS_SUCCESS
             mov eax, pDriverObject
             assume eax:ptr DRIVER_OBJECT
             mov [eax].MajorFunction[IRP_MJ_CREATE*(sizeof PVOID)],          offset DispatchCreateClose
             mov [eax].MajorFunction[IRP_MJ_CLOSE*(sizeof PVOID)],           offset DispatchCreateClose
             mov [eax].MajorFunction[IRP_MJ_DEVICE_CONTROL*(sizeof PVOID)],  offset DispatchControl
             mov [eax].DriverUnload,                                         offset DriverUnload
             assume eax:nothing
 
             and g_fbNotifyRoutineSet, FALSE
             invoke memset, addr g_ProcessData, 0, sizeof g_ProcessData
         
             invoke GetImageFileNameOffset
             mov g_dwImageFileNameOffset, eax
 
             mov status, STATUS_SUCCESS
         .else
             invoke IoDeleteDevice, pDeviceObject
         .endif
     .endif
 
     mov eax, status
     ret
 
 DriverEntry endp
 
 ;:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
 ;                                                                                                   
 ;:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
 
 end DriverEntry
 
 :make
 
 set drv=ProcessMon
 
 \masm32\bin\ml /nologo /c /coff %drv%.bat
 \masm32\bin\link /nologo /driver /base:0x10000 /align:32 /out:%drv%.sys /subsystem:native /ignore:4078 %drv%.obj
 
 del %drv%.obj
 move %drv%.sys ..
 
 echo.
 pause

</b></font></pre>
<!--mstheme--><font face="Arial, Arial, Helvetica"></code>
<p><font size="2"><b>&#1052;&#1086;&#1076;&#1091;&#1083;&#1100; ProcPath.asm</b></font></p>
<code><!--mstheme--></font>
<pre><font size="2"><b> ;:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
 ;                                      &#1057; &#1058; &#1056; &#1059; &#1050; &#1058; &#1059; &#1056; &#1067;                                            
 ;:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
 
 OBJECT_HEADER STRUCT                        ; sizeof = 018h
     PointerCount            SDWORD      ?   ; 0000h
     union
         HandleCount         SDWORD      ?   ; 0004h
         SEntry              PVOID       ?   ; 0004h PTR SINGLE_LIST_ENTRY
     ends
     _Type                   PVOID       ?   ; 0008h PTR OBJECT_TYPE
     NameInfoOffset          BYTE        ?   ; 000Ch
     HandleInfoOffset        BYTE        ?   ; 000Dh
     QuotaInfoOffset         BYTE        ?   ; 000Eh
     Flags                   BYTE        ?   ; 000Fh
     union
         ObjectCreateInfo    PVOID       ?   ; 0010h PTR OBJECT_CREATE_INFORMATION
         QuotaBlockCharged   PVOID       ?   ; 0010h
     ends
     SecurityDescriptor      PVOID       ?   ; 0014h
 ;   Body                    QUAD        &lt;&gt;  ; 0018h
 OBJECT_HEADER ENDS
 
 _SEGMENT STRUCT                             ; sizeof = 40h
     ControlArea             PVOID       ?   ; 000 PTR CONTROL_AREA
     SegmentBaseAddress      PVOID       ?   ; 004
     TotalNumberOfPtes       DWORD       ?   ; 008
     NonExtendedPtes         DWORD       ?   ; 00C
     SizeOfSegment           QWORD       ?   ; 010 ULONG64
     ImageCommitment         DWORD       ?   ; 018
     ImageInformation        PVOID       ?   ; 01C PTR SECTION_IMAGE_INFORMATION
     SystemImageBase         PVOID       ?   ; 020
     NumberOfCommittedPages  DWORD       ?   ; 024
     SegmentPteTemplate      DWORD       ?   ; 028 MMPTE
     BasedAddress            PVOID       ?   ; 02C
     ExtendInfo              PVOID       ?   ; 030 PTR MMEXTEND_INFO
     PrototypePte            PVOID       ?   ; 034 PTR MMPTE
     ThePtes                 DWORD 1 dup(?)  ; 038 array of MMPTE
 _SEGMENT ENDS
 
 CONTROL_AREA STRUCT                             ; sizeof = 38h
     _Segment                    PVOID       ?   ; 000 PTR _SEGMENT
     DereferenceList             LIST_ENTRY  &lt;&gt;  ; 004
     NumberOfSectionReferences   DWORD       ?   ; 00C
     NumberOfPfnReferences       DWORD       ?   ; 010
     NumberOfMappedViews         DWORD       ?   ; 014
     NumberOfSubsections         WORD        ?   ; 018
     FlushInProgressCount        WORD        ?   ; 01A
     NumberOfUserReferences      DWORD       ?   ; 01C
     union u
         LongFlags               DWORD       ?   ; 020
         Flags                   DWORD       ?   ; 020 MMSECTION_FLAGS
     ends
     FilePointer                 PVOID       ?   ; 024 PTR FILE_OBJECT
     WaitingForDeletion          PVOID       ?   ; 028 PTR EVENT_COUNTER
     ModifiedWriteCount          WORD        ?   ; 02C
     NumberOfSystemCacheViews    WORD        ?   ; 02E
     PagedPoolUsage              DWORD       ?   ; 030
     NonPagedPoolUsage           DWORD       ?   ; 034
 CONTROL_AREA ENDS
 
 MMADDRESS_NODE STRUCT                           ; sizeof = 14h
     StartingVpn                 DWORD       ?   ; 00 ULONG_PTR
     EndingVpn                   DWORD       ?   ; 04 ULONG_PTR
     Parent                      PVOID       ?   ; 08 PTR MMADDRESS_NODE
     LeftChild                   PVOID       ?   ; 0C PTR MMADDRESS_NODE
     RightChild                  PVOID       ?   ; 10 PTR MMADDRESS_NODE
 MMADDRESS_NODE ENDS
 PMMADDRESS_NODE typedef ptr MMADDRESS_NODE
 
 SECTION STRUCT                                      ; sizeof = 28h
     Address                     MMADDRESS_NODE  &lt;&gt;  ; 00
     _Segment                    PVOID           ?   ; 14 PTR _SEGMENT
     SizeOfSection               LARGE_INTEGER   &lt;&gt;  ; 18
     union u
         LongFlags               DWORD           ?   ; 20
         Flags                   DWORD           ?   ; 20 MMSECTION_FLAGS
     ends
     InitialPageProtection       DWORD           ?   ; 24
 SECTION ENDS
 PSECTION typedef ptr SECTION
 
 ;:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
 ;                                      &#1050; &#1054; &#1053; &#1057; &#1058; &#1040; &#1053; &#1058; &#1067;                                            
 ;:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
 
 WINVER_UNINITIALIZED    equ -1
 WINVER_2K               equ 0
 WINVER_XP_OR_HIGHER     equ 1
 
 ;:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
 ;                 &#1048; &#1053; &#1048; &#1062; &#1048; &#1040; &#1051; &#1048; &#1047; &#1048; &#1056; &#1054; &#1042; &#1040; &#1053; &#1053; &#1067; &#1045;    &#1044; &#1040; &#1053; &#1053; &#1053; &#1067; &#1045;                              
 ;:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
 
 .data
 
 g_dwWinVer  DWORD   WINVER_UNINITIALIZED
 
 ;:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
 ;                                           &#1050; &#1054; &#1044;                                                   
 ;:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
 
 .code
 
 ;:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
 ;                                  IsAddressInPoolRanges                                            
 ;:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
 
 IsAddressInPoolRanges proc uses ebx pAddress:PVOID
 
 local fOk:BOOL
 
     and fOk, FALSE
 
     mov eax, MmSystemRangeStart
     mov eax, [eax]
     mov eax, [eax]
 
     .if eax == 80000000h
              
         mov ebx, pAddress
 
         xor ecx, ecx
         xor edx, edx
 
         .if ( ebx &gt; 80000000h ) &amp;&amp; ( ebx &lt; 0A0000000h )
             inc ecx
         .endif
 
         .if ( ebx &gt; 0E1000000h ) &amp;&amp; ( ebx &lt; 0FFBE0000h )
             inc edx
         .endif
 
         or ecx, edx
         .if !ZERO?
             mov fOk, TRUE   ; OK
         .endif
 
     .endif
 
     mov eax, fOk
     ret
 
 IsAddressInPoolRanges endp
 
 ;:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
 ;                                     IsLikeObjectPointer                                           
 ;:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
 
 IsLikeObjectPointer proc uses esi pObject:PVOID
 
 local fOk:BOOL
 
     and fOk, FALSE
 
     mov esi, pObject
 
     invoke IsAddressInPoolRanges, esi
     .if eax == TRUE
 
         mov eax, esi
         and eax, (8 - 1)
         .if eax == 0
                 
             invoke MmIsAddressValid, esi
             .if al
 
                 mov eax, esi
                 and eax, (PAGE_SIZE-1)
                 .if eax &lt; sizeof OBJECT_HEADER
 
                     sub esi, sizeof OBJECT_HEADER
     
                     invoke MmIsAddressValid, esi
                     .if al
 
                         mov fOk, TRUE
 
                     .endif
 
                 .else
                 
                     mov fOk, TRUE
 
                 .endif
             .endif
         .endif
     .endif
 
     mov eax, fOk
     ret
 
 IsLikeObjectPointer endp
 
 ;:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
 ;                                     GetImageFilePath                                              
 ;:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
 
 GetImageFilePath proc uses ebx esi edi peProcess:PVOID, pusImageFilePath:PUNICODE_STRING
 
 local status:NTSTATUS
 local pSection:PVOID            ; PTR SECTION
 local usDosName:UNICODE_STRING
 
     mov status, STATUS_UNSUCCESSFUL
 
     PROCESS_QUERY_INFORMATION equ 400h  ; winnt.inc
 
     mov ecx, PsProcessType
     mov ecx, [ecx]
     mov ecx, [ecx]
 
     invoke ObReferenceObjectByPointer, peProcess, PROCESS_QUERY_INFORMATION, ecx, UserMode
     .if eax == STATUS_SUCCESS
 
         .if g_dwWinVer == WINVER_UNINITIALIZED
 
             invoke IoIsWdmVersionAvailable, 1, 20h
             .if al
                 mov g_dwWinVer, WINVER_XP_OR_HIGHER
             .else
                 mov g_dwWinVer, WINVER_2K
             .endif
 
         .endif
 
         .if g_dwWinVer == WINVER_XP_OR_HIGHER
 
             mov esi, peProcess
             mov ebx, 80h            ; Start at offset 80h
             .while ebx &lt; 204h
 
                 ; Filter unreasonable candidates
 
                 mov edi, [esi][ebx]
                 invoke IsLikeObjectPointer, edi
                 .if eax == TRUE
 
                     mov eax, edi
                     sub eax, sizeof OBJECT_HEADER
 
                     .if ([OBJECT_HEADER PTR [eax]].PointerCount &lt;= 4)
                     .if ([OBJECT_HEADER PTR [eax]].HandleCount &lt;= 1)
 
                         mov ecx, MmSectionObjectType
                         mov ecx, [ecx]
                         mov ecx, [ecx]
 
                         invoke ObReferenceObjectByPointer, edi, SECTION_QUERY, ecx, UserMode
                         .if eax == STATUS_SUCCESS
 
                             mov status, eax
                             mov pSection, edi
 
                              .break
                         .endif
                     .endif
                     .endif
                 .endif
 
                 add ebx, 4

             .endw
 
         .else
 
             xor ebx, ebx
             mov edi, 4
             .while ebx &lt; 3
 
                 invoke IoGetCurrentProcess
                 .if eax == peProcess
                     
                     mov ecx, MmSectionObjectType
                     mov ecx, [ecx]
                     mov ecx, [ecx]  ; PTR OBJECT_TYPE
                 
                     invoke ObReferenceObjectByHandle, edi, SECTION_QUERY, ecx, KernelMode, addr pSection, NULL
                     mov status, eax
 
                 .else
 
                     invoke KeAttachProcess, peProcess
 
                     mov ecx, MmSectionObjectType
                     mov ecx, [ecx]
                     mov ecx, [ecx]
 
                     invoke ObReferenceObjectByHandle, edi, SECTION_QUERY, ecx, KernelMode, addr pSection, NULL
                     mov status, eax
 
                     invoke KeDetachProcess
 
                 .endif
 
                 .break .if status == STATUS_SUCCESS
                     
                 .if ebx == 0
                     
                     mov edi, 03F8h  ; Try 03F8h handle.
                         
                 .elseif ebx == 1
                     
                     mov eax, peProcess
                     add eax, 01ACh
                     mov eax, [eax]
                     mov edi, eax
 
                     and eax, (4 - 1)
                     .break .if ( eax != 0 ) || ( edi &gt;= 800h )
                         
                 .endif
                 
                 inc ebx
             .endw
 
         .endif
 
         .if status == STATUS_SUCCESS
 
             mov status, STATUS_UNSUCCESSFUL
 
             mov ebx, pSection
             mov ebx, (SECTION PTR [ebx])._Segment
 
             invoke IsAddressInPoolRanges, ebx
             push eax
             invoke MmIsAddressValid, ebx
             pop ecx
             .if al &amp;&amp; ( ecx == TRUE )
 
                 mov esi, ebx
 
                 mov ebx, (_SEGMENT PTR [ebx]).ControlArea
 
                 invoke IsAddressInPoolRanges, ebx
                 push eax
                 invoke MmIsAddressValid, ebx
                 pop ecx
                 .if al &amp;&amp; ( ecx == TRUE ) &amp;&amp; ([CONTROL_AREA PTR [ebx]]._Segment == esi )
 
                     mov ebx, (CONTROL_AREA PTR [ebx]).FilePointer
 
                     invoke IsLikeObjectPointer, ebx
                     .if eax == TRUE
 
                         mov ecx, IoFileObjectType
                         mov ecx, [ecx]
                         mov ecx, [ecx]          ; PTR OBJECT_TYPE
 
                         invoke ObReferenceObjectByPointer, ebx, FILE_READ_ATTRIBUTES, ecx, UserMode
                         .if eax == STATUS_SUCCESS
 
                             invoke ExAllocatePool, PagedPool, (IMAGE_FILE_PATH_LEN+1) * sizeof WCHAR
                             .if eax != NULL
 
                                 mov edi, pusImageFilePath
                                 assume edi:ptr UNICODE_STRING
 
                                 mov [edi].Buffer, eax
 
                                 invoke memset, eax, 0, (IMAGE_FILE_PATH_LEN+1) * sizeof WCHAR
 
                                 mov [edi].MaximumLength,    IMAGE_FILE_PATH_LEN * sizeof WCHAR
                                 and [edi]._Length,          0

                                 invoke RtlVolumeDeviceToDosName, \
                                         (FILE_OBJECT PTR [ebx]).DeviceObject, addr usDosName
                                 .if eax == STATUS_SUCCESS
  
                                     invoke RtlCopyUnicodeString, edi, addr usDosName
                                     invoke ExFreePool, usDosName.Buffer

                                 .endif
 
                                 invoke RtlAppendUnicodeStringToString, edi, \
                                                 addr (FILE_OBJECT PTR [ebx]).FileName
 
                                 assume edi:nothing
 
                                 mov status, STATUS_SUCCESS
 
                             .endif
 
                             invoke ObDereferenceObject, ebx
                         .endif
                     .endif
                 .endif
             .endif
 
             invoke ObDereferenceObject, pSection
         .endif
 
         invoke ObDereferenceObject, peProcess
     .endif
 
     mov eax, status
     ret
 
 GetImageFilePath endp

</b></font></pre>
<!--mstheme--><font face="Arial, Arial, Helvetica"></code><br>
<br>
<p>&nbsp;<!--mstheme--></font>
<h2><!--mstheme--><font face="Arial, Arial, Helvetica" color="#CCCCCC">14.7
&#1055;&#1088;&#1086;&#1094;&#1077;&#1076;&#1091;&#1088;&#1072; DriverEntry<!--mstheme--></font></h2>
<!--mstheme--><font face="Arial, Arial, Helvetica">
<p>&nbsp;</p>
<p>&#1050;&#1088;&#1086;&#1084;&#1077; &#1074;&#1089;&#1077;&#1075;&#1086;
&#1087;&#1088;&#1086;&#1095;&#1077;&#1075;&#1086; &#1074;
&#1087;&#1088;&#1086;&#1094;&#1077;&#1076;&#1091;&#1088;&#1077; DriverEntry
&#1085;&#1072;&#1084; &#1085;&#1072;&#1076;&#1086;
&#1087;&#1086;&#1083;&#1091;&#1095;&#1080;&#1090;&#1100;
&#1089;&#1084;&#1077;&#1097;&#1077;&#1085;&#1080;&#1077;
&#1087;&#1086;&#1083;&#1103; ImageFileName
&#1089;&#1090;&#1088;&#1091;&#1082;&#1090;&#1091;&#1088;&#1099; EPROCESS.</p>
<code><!--mstheme--></font>
<pre> EPROCESS STRUCT
 . . .
     ImageFileName BYTE 16 dup(?)
 . . .
 EPROCESS ENDS

</pre>
<!--mstheme--><font face="Arial, Arial, Helvetica"></code>
<p>ImageFileName &#1093;&#1088;&#1072;&#1085;&#1080;&#1090;
&#1080;&#1084;&#1103; &#1086;&#1073;&#1088;&#1072;&#1079;&#1072;,
&#1089;&#1086;&#1079;&#1076;&#1072;&#1074;&#1096;&#1077;&#1075;&#1086;
&#1087;&#1088;&#1086;&#1094;&#1077;&#1089;&#1089;. &#1050;&#1072;&#1082;
&#1074;&#1080;&#1076;&#1080;&#1090;&#1077;, &#1101;&#1090;&#1086;
&#1087;&#1086;&#1083;&#1077;
&#1087;&#1086;&#1079;&#1074;&#1086;&#1083;&#1103;&#1077;&#1090;
&#1093;&#1088;&#1072;&#1085;&#1080;&#1090;&#1100;
&#1074;&#1089;&#1077;&#1075;&#1086; 16
&#1089;&#1080;&#1084;&#1074;&#1086;&#1083;&#1086;&#1074;.
&#1041;&#1086;&#1083;&#1077;&#1077;
&#1076;&#1083;&#1080;&#1085;&#1085;&#1099;&#1077;
&#1080;&#1084;&#1077;&#1085;&#1072;
&#1091;&#1089;&#1077;&#1082;&#1072;&#1102;&#1090;&#1089;&#1103; &#1076;&#1086;
16 &#1089;&#1080;&#1084;&#1074;&#1086;&#1083;&#1086;&#1074; &#1080;, &#1074;
&#1101;&#1090;&#1086;&#1084; &#1089;&#1083;&#1091;&#1095;&#1072;&#1077;,
&#1079;&#1072;&#1074;&#1077;&#1088;&#1096;&#1072;&#1102;&#1097;&#1080;&#1081;
&#1085;&#1086;&#1083;&#1100; &#1085;&#1077;
&#1080;&#1089;&#1087;&#1086;&#1083;&#1100;&#1079;&#1091;&#1077;&#1090;&#1089;&#1103;.
&#1057;&#1086;&#1076;&#1077;&#1088;&#1078;&#1080;&#1084;&#1086;&#1077;
&#1101;&#1090;&#1086;&#1075;&#1086; &#1087;&#1086;&#1083;&#1103; &#1084;&#1099;
&#1073;&#1091;&#1076;&#1077;&#1084;
&#1082;&#1086;&#1087;&#1080;&#1088;&#1086;&#1074;&#1072;&#1090;&#1100; &#1074;
&#1085;&#1072;&#1096;&#1091;
&#1089;&#1090;&#1088;&#1091;&#1082;&#1090;&#1091;&#1088;&#1091; PROCESS_DATA,
&#1085;&#1086; &#1090;&#1086;&#1083;&#1100;&#1082;&#1086; &#1074;
&#1090;&#1086;&#1084; &#1089;&#1083;&#1091;&#1095;&#1072;&#1077;,
&#1077;&#1089;&#1083;&#1080; &#1085;&#1077;
&#1091;&#1076;&#1072;&#1089;&#1090;&#1089;&#1103;
&#1087;&#1086;&#1083;&#1091;&#1095;&#1080;&#1090;&#1100;
&#1087;&#1086;&#1083;&#1085;&#1099;&#1081; &#1087;&#1091;&#1090;&#1100; &#1082;
&#1086;&#1073;&#1088;&#1072;&#1079;&#1091;.
&#1055;&#1086;&#1083;&#1086;&#1078;&#1077;&#1085;&#1080;&#1077;
&#1101;&#1090;&#1086;&#1075;&#1086; &#1087;&#1086;&#1083;&#1103; &#1074;
&#1089;&#1090;&#1088;&#1091;&#1082;&#1090;&#1091;&#1088;&#1077; EPROCESS
&#1086;&#1090;&#1083;&#1080;&#1095;&#1072;&#1077;&#1090;&#1089;&#1103;
&#1085;&#1072; &#1088;&#1072;&#1079;&#1085;&#1099;&#1093;
&#1074;&#1077;&#1088;&#1089;&#1080;&#1103;&#1093;
&#1089;&#1080;&#1089;&#1090;&#1077;&#1084;&#1099; (&#1076;&#1083;&#1103; w2k,
wxp &#1080; w2k3 &#1086;&#1085;&#1086; &#1088;&#1072;&#1074;&#1085;&#1086;
01FCh, 0174h &#1080; 0154h,
&#1089;&#1086;&#1086;&#1090;&#1074;&#1077;&#1090;&#1089;&#1090;&#1074;&#1077;&#1085;&#1085;&#1086;),
&#1085;&#1086; &#1077;&#1089;&#1090;&#1100; &#1086;&#1095;&#1077;&#1085;&#1100;
&#1087;&#1088;&#1086;&#1089;&#1090;&#1086;&#1081; &#1080;
&#1093;&#1086;&#1088;&#1086;&#1096;&#1086;
&#1080;&#1079;&#1074;&#1077;&#1089;&#1090;&#1085;&#1099;&#1081;
&#1089;&#1087;&#1086;&#1089;&#1086;&#1073; &#1077;&#1075;&#1086;
&#1085;&#1072;&#1081;&#1090;&#1080;. &#1044;&#1083;&#1103;
&#1101;&#1090;&#1086;&#1075;&#1086; &#1085;&#1072;&#1076;&#1086;
&#1087;&#1088;&#1086;&#1089;&#1082;&#1072;&#1085;&#1080;&#1088;&#1086;&#1074;&#1072;&#1090;&#1100;
&#1089;&#1090;&#1088;&#1091;&#1082;&#1090;&#1091;&#1088;&#1091; EPROCESS
&#1087;&#1088;&#1086;&#1094;&#1077;&#1089;&#1089;&#1072; System &#1080;
&#1085;&#1072;&#1081;&#1090;&#1080; &#1090;&#1072;&#1084;
&#1089;&#1090;&#1088;&#1086;&#1082;&#1091; &quot;System&quot; -
&#1101;&#1090;&#1086; &#1080; &#1073;&#1091;&#1076;&#1077;&#1090;
&#1087;&#1086;&#1083;&#1077; ImageFileName.
&#1056;&#1072;&#1079;&#1091;&#1084;&#1077;&#1077;&#1090;&#1089;&#1103;,
&#1101;&#1090;&#1086;&#1090; &#1090;&#1088;&#1102;&#1082;
&#1073;&#1091;&#1076;&#1077;&#1090;
&#1088;&#1072;&#1073;&#1086;&#1090;&#1072;&#1090;&#1100;
&#1090;&#1086;&#1083;&#1100;&#1082;&#1086; &#1074; &#1090;&#1086;&#1084;
&#1089;&#1083;&#1091;&#1095;&#1072;&#1077;, &#1077;&#1089;&#1083;&#1080;
&#1101;&#1090;&#1086; &#1087;&#1086;&#1083;&#1077;
&#1087;&#1088;&#1077;&#1076;&#1085;&#1072;&#1084;&#1077;&#1088;&#1077;&#1085;&#1085;&#1086;
&#1082;&#1077;&#1084;-&#1090;&#1086; &#1085;&#1077;
&#1080;&#1079;&#1084;&#1077;&#1085;&#1077;&#1085;&#1086;. &#1042;
&#1087;&#1086;&#1089;&#1083;&#1077;&#1076;&#1085;&#1077;&#1077;
&#1074;&#1088;&#1077;&#1084;&#1103; &#1089;&#1090;&#1072;&#1083;&#1086;
&#1084;&#1086;&#1076;&#1085;&#1086;
&#1079;&#1072;&#1083;&#1077;&#1079;&#1072;&#1090;&#1100; &#1074;
&#1103;&#1076;&#1088;&#1086; &#1080;
&#1074;&#1099;&#1090;&#1074;&#1086;&#1088;&#1103;&#1090;&#1100;
&#1090;&#1072;&#1084; &#1074;&#1089;&#1103;&#1082;&#1080;&#1077;
&#1075;&#1083;&#1091;&#1087;&#1086;&#1089;&#1090;&#1080;.
&#1041;&#1091;&#1076;&#1077;&#1084;
&#1089;&#1095;&#1080;&#1090;&#1072;&#1090;&#1100;, &#1095;&#1090;&#1086;
&#1085;&#1072;&#1096;&#1072; &#1089;&#1080;&#1089;&#1090;&#1077;&#1084;&#1072;
&#1076;&#1077;&#1074;&#1089;&#1090;&#1074;&#1077;&#1085;&#1085;&#1086;
&#1095;&#1080;&#1089;&#1090;&#1072;. &#1042;
&#1087;&#1088;&#1086;&#1090;&#1080;&#1074;&#1085;&#1086;&#1084;
&#1089;&#1083;&#1091;&#1095;&#1072;&#1077;
&#1087;&#1088;&#1080;&#1076;&#1077;&#1090;&#1089;&#1103;
&#1080;&#1079;&#1086;&#1073;&#1088;&#1077;&#1090;&#1072;&#1090;&#1100;
&#1089;&#1087;&#1086;&#1089;&#1086;&#1073;
&#1087;&#1086;&#1093;&#1080;&#1090;&#1088;&#1077;&#1077;.</p>
<p>&#1048;&#1090;&#1072;&#1082;, &#1089;&#1077;&#1081;&#1095;&#1072;&#1089;
&#1084;&#1099; &#1074;
&#1087;&#1088;&#1086;&#1094;&#1077;&#1076;&#1091;&#1088;&#1077; DriverEntry,
&#1090;.&#1077;. &#1074;
&#1082;&#1086;&#1085;&#1090;&#1077;&#1082;&#1089;&#1090;&#1077;
&#1087;&#1088;&#1086;&#1094;&#1077;&#1089;&#1089;&#1072; System.</p>
<code><!--mstheme--></font>
<pre>             invoke GetImageFileNameOffset
             mov g_dwImageFileNameOffset, eax

</pre>
<!--mstheme--><font face="Arial, Arial, Helvetica"></code>
<p>&#1042;&#1099;&#1079;&#1099;&#1074;&#1072;&#1077;&#1084;
&#1087;&#1088;&#1086;&#1094;&#1077;&#1076;&#1091;&#1088;&#1091;
GetImageFileNameOffset, &#1082;&#1086;&#1090;&#1086;&#1088;&#1072;&#1103;
&#1074;&#1077;&#1088;&#1085;&#1077;&#1090; &#1085;&#1072;&#1084;
&#1089;&#1084;&#1077;&#1097;&#1077;&#1085;&#1080;&#1077;
&#1087;&#1086;&#1083;&#1103; ImageFileName &#1086;&#1090;
&#1085;&#1072;&#1095;&#1072;&#1083;&#1072;
&#1089;&#1090;&#1088;&#1091;&#1082;&#1090;&#1091;&#1088;&#1099; EPROCESS
&#1080;&#1083;&#1080; &#1085;&#1086;&#1083;&#1100;, &#1077;&#1089;&#1083;&#1080;
&#1085;&#1077; &#1089;&#1084;&#1086;&#1078;&#1077;&#1090; &#1077;&#1075;&#1086;
&#1085;&#1072;&#1081;&#1090;&#1080;.
&#1055;&#1088;&#1086;&#1094;&#1077;&#1076;&#1091;&#1088;&#1072;
GetImageFileNameOffset &#1087;&#1088;&#1086;&#1089;&#1090;&#1072; &#1080;
&#1076;&#1077;&#1083;&#1072;&#1077;&#1090;
&#1089;&#1083;&#1077;&#1076;&#1091;&#1102;&#1097;&#1077;&#1077;.</p>
<code><!--mstheme--></font>
<pre>     invoke IoGetCurrentProcess
     mov esi, eax

</pre>
<!--mstheme--><font face="Arial, Arial, Helvetica"></code>
<p>&#1055;&#1086;&#1083;&#1091;&#1095;&#1072;&#1077;&#1084;
&#1091;&#1082;&#1072;&#1079;&#1072;&#1090;&#1077;&#1083;&#1100; &#1085;&#1072;
&#1089;&#1090;&#1088;&#1091;&#1082;&#1090;&#1091;&#1088;&#1099; EPROCESS
&#1090;&#1077;&#1082;&#1091;&#1097;&#1077;&#1075;&#1086;
&#1087;&#1088;&#1086;&#1094;&#1077;&#1089;&#1089;&#1072;, &#1090;.&#1077;.
&#1087;&#1088;&#1086;&#1094;&#1077;&#1089;&#1089;&#1072; System.</p>
<code><!--mstheme--></font>
<pre>     xor ebx, ebx
     .while ebx &lt; 1000h
         lea eax, [esi+ebx]
         invoke _strnicmp, eax, $CTA0(&quot;system&quot;), 6
         .break .if eax == 0
         inc ebx
     .endw

</pre>
<!--mstheme--><font face="Arial, Arial, Helvetica"></code>
<p>&#1048;&#1097;&#1077;&#1084; &#1074;
&#1087;&#1077;&#1088;&#1074;&#1086;&#1081;
&#1089;&#1090;&#1088;&#1072;&#1085;&#1080;&#1094;&#1077; &#1086;&#1090;
&#1085;&#1072;&#1095;&#1072;&#1083;&#1072;
&#1089;&#1090;&#1088;&#1086;&#1082;&#1091; &quot;system&quot;,
&#1087;&#1088;&#1080;&#1095;&#1077;&#1084;
&#1080;&#1089;&#1087;&#1086;&#1083;&#1100;&#1079;&#1091;&#1077;&#1084;
&#1092;&#1091;&#1085;&#1082;&#1094;&#1080;&#1102; _strnicmp,
&#1082;&#1086;&#1090;&#1086;&#1088;&#1072;&#1103;
&#1089;&#1088;&#1072;&#1074;&#1085;&#1080;&#1074;&#1072;&#1077;&#1090;
&#1089;&#1090;&#1088;&#1086;&#1075;&#1086;
&#1086;&#1087;&#1088;&#1077;&#1076;&#1077;&#1083;&#1077;&#1085;&#1085;&#1086;&#1077;
&#1082;&#1086;&#1083;&#1080;&#1095;&#1077;&#1089;&#1090;&#1074;&#1086;
&#1089;&#1080;&#1084;&#1074;&#1086;&#1083;&#1086;&#1074; (6 &#1074;
&#1076;&#1072;&#1085;&#1085;&#1086;&#1084;
&#1089;&#1083;&#1091;&#1095;&#1072;&#1077;) &#1080; &#1085;&#1077;
&#1091;&#1095;&#1080;&#1090;&#1099;&#1074;&#1072;&#1077;&#1090; &#1080;&#1093;
&#1088;&#1077;&#1075;&#1080;&#1089;&#1090;&#1088;.</p>
<code><!--mstheme--></font>
<pre>     .if eax == 0
         mov eax, ebx
     .else
         xor eax, eax
     .endif
 
     ret
 
</pre>
<!--mstheme--><font face="Arial, Arial, Helvetica"></code>
<p>&#1045;&#1089;&#1083;&#1080; &#1090;&#1072;&#1082;&#1072;&#1103;
&#1089;&#1090;&#1088;&#1086;&#1082;&#1072;
&#1085;&#1072;&#1081;&#1076;&#1077;&#1085;&#1072;, &#1090;&#1086;
&#1101;&#1090;&#1086; &#1087;&#1086;&#1083;&#1077; ImageFileName -
&#1074;&#1086;&#1079;&#1074;&#1088;&#1072;&#1097;&#1072;&#1077;&#1084;
&#1077;&#1075;&#1086; &#1089;&#1084;&#1077;&#1097;&#1077;&#1085;&#1080;&#1077;
&#1080;&#1083;&#1080; &#1085;&#1086;&#1083;&#1100; &#1074;
&#1089;&#1083;&#1091;&#1095;&#1072;&#1077;
&#1085;&#1077;&#1091;&#1076;&#1072;&#1095;&#1080;.</p>
<br>
<br>
<p>&nbsp;<!--mstheme--></font>
<h2><!--mstheme--><font face="Arial, Arial, Helvetica" color="#CCCCCC">14.8
&#1054;&#1073;&#1088;&#1072;&#1073;&#1072;&#1090;&#1099;&#1074;&#1072;&#1077;&#1084;
IOCTL_SET_NOTIFY<!--mstheme--></font></h2>
<!--mstheme--><font face="Arial, Arial, Helvetica">
<p>&nbsp;</p>
<p>&#1055;&#1086;&#1083;&#1091;&#1095;&#1080;&#1074;
&#1091;&#1087;&#1088;&#1072;&#1074;&#1083;&#1103;&#1102;&#1097;&#1080;&#1081;
&#1082;&#1086;&#1076; IOCTL_SET_NOTIFY, &#1084;&#1099;
&#1076;&#1086;&#1083;&#1078;&#1085;&#1099;
&#1091;&#1089;&#1090;&#1072;&#1085;&#1086;&#1074;&#1080;&#1090;&#1100;
&#1089;&#1083;&#1077;&#1078;&#1077;&#1085;&#1080;&#1077; &#1079;&#1072;
&#1089;&#1086;&#1079;&#1076;&#1072;&#1085;&#1080;&#1077;&#1084;/&#1091;&#1076;&#1072;&#1083;&#1077;&#1085;&#1080;&#1077;&#1084;
&#1087;&#1088;&#1086;&#1094;&#1077;&#1089;&#1089;&#1086;&#1074;.</p>
<code><!--mstheme--></font>
<pre>             .if g_fbNotifyRoutineSet == FALSE

</pre>
<!--mstheme--><font face="Arial, Arial, Helvetica"></code>
<p>&#1053;&#1072; &#1074;&#1089;&#1103;&#1082;&#1080;&#1081;
&#1089;&#1083;&#1091;&#1095;&#1072;&#1081;,
&#1087;&#1088;&#1086;&#1074;&#1077;&#1088;&#1080;&#1084;
&#1092;&#1083;&#1072;&#1075; g_fbNotifyRoutineSet -
&#1074;&#1086;&#1079;&#1084;&#1086;&#1078;&#1085;&#1086;
&#1089;&#1083;&#1077;&#1078;&#1077;&#1085;&#1080;&#1077; &#1091;&#1078;&#1077;
&#1091;&#1089;&#1090;&#1072;&#1085;&#1086;&#1074;&#1083;&#1077;&#1085;&#1086;.</p>
<code><!--mstheme--></font>
<pre>                 mov edx, [esi].AssociatedIrp.SystemBuffer
                 mov edx, [edx]

</pre>
<!--mstheme--><font face="Arial, Arial, Helvetica"></code>
<p>&#1048;&#1079;&#1074;&#1083;&#1077;&#1082;&#1072;&#1077;&#1084;,
&#1087;&#1077;&#1088;&#1077;&#1076;&#1072;&#1085;&#1085;&#1099;&#1081;
&#1085;&#1072;&#1084; &#1080;&#1079; &#1088;&#1077;&#1078;&#1080;&#1084;&#1072;
&#1087;&#1086;&#1083;&#1100;&#1079;&#1086;&#1074;&#1072;&#1090;&#1077;&#1083;&#1103;
&#1086;&#1087;&#1080;&#1089;&#1072;&#1090;&#1077;&#1083;&#1100;
&#1086;&#1073;&#1098;&#1077;&#1082;&#1090;&#1072; &quot;&#1089;&#1086;&#1073;&#1099;&#1090;&#1080;&#1077;&quot;.</p>
<p>&#1042;
&#1076;&#1072;&#1083;&#1100;&#1085;&#1077;&#1081;&#1096;&#1077;&#1084;
&#1084;&#1099; &#1073;&#1091;&#1076;&#1077;&#1084;
&#1086;&#1087;&#1077;&#1088;&#1080;&#1088;&#1086;&#1074;&#1072;&#1090;&#1100;
&#1091;&#1082;&#1072;&#1079;&#1072;&#1090;&#1077;&#1083;&#1077;&#1084;
&#1085;&#1072; &#1086;&#1073;&#1098;&#1077;&#1082;&#1090;, &#1072;
&#1085;&#1077;
&#1086;&#1087;&#1080;&#1089;&#1072;&#1090;&#1077;&#1083;&#1077;&#1084;,
&#1082;&#1072;&#1082; &#1080;
&#1087;&#1086;&#1083;&#1072;&#1075;&#1072;&#1077;&#1090;&#1089;&#1103;
&#1076;&#1088;&#1072;&#1081;&#1074;&#1077;&#1088;&#1072;&#1084;.
&#1055;&#1086;&#1101;&#1090;&#1086;&#1084;&#1091; &#1084;&#1099;
&#1076;&#1086;&#1083;&#1078;&#1085;&#1099; &#1101;&#1090;&#1086;&#1090;
&#1091;&#1082;&#1072;&#1079;&#1072;&#1090;&#1077;&#1083;&#1100;
&#1087;&#1086;&#1083;&#1091;&#1095;&#1080;&#1090;&#1100; &#1080;
&#1079;&#1072;&#1086;&#1076;&#1085;&#1086;
&#1087;&#1088;&#1086;&#1074;&#1077;&#1088;&#1080;&#1090;&#1100;,
&#1076;&#1077;&#1081;&#1089;&#1090;&#1074;&#1080;&#1090;&#1077;&#1083;&#1100;&#1085;&#1086;
&#1083;&#1080;
&#1087;&#1077;&#1088;&#1077;&#1076;&#1072;&#1085;&#1085;&#1086;&#1077;
&#1085;&#1072;&#1084; &#1095;&#1080;&#1089;&#1083;&#1086;
&#1103;&#1074;&#1083;&#1103;&#1077;&#1090;&#1089;&#1103;
&#1086;&#1087;&#1080;&#1089;&#1072;&#1090;&#1077;&#1083;&#1077;&#1084;
&#1086;&#1073;&#1098;&#1077;&#1082;&#1090;&#1072; &quot;&#1089;&#1086;&#1073;&#1099;&#1090;&#1080;&#1077;&quot;.
&#1055;&#1088;&#1086;&#1074;&#1077;&#1088;&#1082;&#1072;
&#1083;&#1102;&#1073;&#1099;&#1093; &#1076;&#1072;&#1085;&#1085;&#1099;&#1093;
&#1087;&#1086;&#1083;&#1091;&#1095;&#1077;&#1085;&#1085;&#1099;&#1093;
&#1080;&#1079; &#1088;&#1077;&#1078;&#1080;&#1084;&#1072;
&#1087;&#1086;&#1083;&#1100;&#1079;&#1086;&#1074;&#1072;&#1090;&#1077;&#1083;&#1103;
- &#1101;&#1090;&#1086;
&#1086;&#1073;&#1103;&#1079;&#1072;&#1090;&#1077;&#1083;&#1100;&#1085;&#1086;&#1077;
&#1091;&#1089;&#1083;&#1086;&#1074;&#1080;&#1077; &#1076;&#1083;&#1103;
&#1089;&#1090;&#1072;&#1073;&#1080;&#1083;&#1100;&#1085;&#1086;&#1081;
&#1088;&#1072;&#1073;&#1086;&#1090;&#1099;
&#1083;&#1102;&#1073;&#1086;&#1075;&#1086;
&#1076;&#1088;&#1072;&#1081;&#1074;&#1077;&#1088;&#1072;. &#1054;&#1073;&#1077;
&#1101;&#1090;&#1080; &#1079;&#1072;&#1076;&#1072;&#1095;&#1080;, &#1074;
&#1076;&#1072;&#1085;&#1085;&#1086;&#1084;
&#1089;&#1083;&#1091;&#1095;&#1072;&#1077;, &#1084;&#1086;&#1078;&#1085;&#1086;
&#1088;&#1077;&#1096;&#1080;&#1090;&#1100; &#1086;&#1076;&#1085;&#1080;&#1084;
&#1074;&#1099;&#1079;&#1086;&#1074;&#1086;&#1084;
&#1092;&#1091;&#1085;&#1082;&#1094;&#1080;&#1080; ObReferenceObjectByHandle.
&#1044;&#1083;&#1103; &#1101;&#1090;&#1086;&#1075;&#1086; &#1085;&#1072;&#1084;
&#1087;&#1086;&#1090;&#1088;&#1077;&#1073;&#1091;&#1077;&#1090;&#1089;&#1103;
&#1091;&#1082;&#1072;&#1079;&#1072;&#1090;&#1077;&#1083;&#1100; &#1085;&#1072;
&#1089;&#1090;&#1088;&#1091;&#1082;&#1090;&#1091;&#1088;&#1091; OBJECT_TYPE,
&#1086;&#1087;&#1080;&#1089;&#1099;&#1074;&#1072;&#1102;&#1097;&#1091;&#1102;
&#1086;&#1073;&#1098;&#1077;&#1082;&#1090; &quot;&#1090;&#1080;&#1087;&quot; (object
type) (&#1074; &#1076;&#1072;&#1085;&#1085;&#1086;&#1084;
&#1089;&#1083;&#1091;&#1095;&#1072;&#1077; &#1086;&#1085;
&#1090;&#1080;&#1087;&#1080;&#1079;&#1080;&#1088;&#1091;&#1077;&#1090;
&#1086;&#1073;&#1098;&#1077;&#1082;&#1090;&#1099; &quot;&#1089;&#1086;&#1073;&#1099;&#1090;&#1080;&#1077;&quot;).
&#1063;&#1090;&#1086;&#1073;&#1099; &#1087;&#1086;&#1085;&#1103;&#1090;&#1100;,
&#1095;&#1090;&#1086; &#1101;&#1090;&#1086; &#1090;&#1072;&#1082;&#1086;&#1077;
&#1089;&#1076;&#1077;&#1083;&#1072;&#1077;&#1084;
&#1085;&#1077;&#1073;&#1086;&#1083;&#1100;&#1096;&#1086;&#1077;
&#1083;&#1080;&#1088;&#1080;&#1095;&#1077;&#1089;&#1082;&#1086;&#1077;
&#1086;&#1090;&#1089;&#1090;&#1091;&#1087;&#1083;&#1077;&#1085;&#1080;&#1077;
&#1074; &#1089;&#1090;&#1086;&#1088;&#1086;&#1085;&#1091;
&#1084;&#1080;&#1088;&#1072;
&#1086;&#1073;&#1098;&#1077;&#1082;&#1090;&#1086;&#1074; Windows (&#1073;&#1086;&#1083;&#1077;&#1077;
&#1087;&#1086;&#1076;&#1088;&#1086;&#1073;&#1085;&#1086; &#1089;&#1084;.
&#1082;&#1085;&#1080;&#1075;&#1091; &#1057;&#1074;&#1077;&#1085;&#1072;
&#1064;&#1088;&#1072;&#1081;&#1073;&#1077;&#1088;&#1072; &quot;&#1053;&#1077;&#1076;&#1086;&#1082;&#1091;&#1084;&#1077;&#1085;&#1090;&#1080;&#1088;&#1086;&#1074;&#1072;&#1085;&#1085;&#1099;&#1077;
&#1074;&#1086;&#1079;&#1084;&#1086;&#1078;&#1085;&#1086;&#1089;&#1090;&#1080;
Windows 2000&quot;).</p>
<br>
<br>
<p>&nbsp;<!--mstheme--></font>
<h2><!--mstheme--><font face="Arial, Arial, Helvetica" color="#CCCCCC">14.9
&#1054;&#1073;&#1098;&#1077;&#1082;&#1090; &quot;&#1090;&#1080;&#1087;&quot;<!--mstheme--></font></h2>
<!--mstheme--><font face="Arial, Arial, Helvetica">
<p>&nbsp;</p>
<p>&#1048;&#1090;&#1072;&#1082;, &#1095;&#1090;&#1086;
&#1090;&#1072;&#1082;&#1086;&#1077; &#1086;&#1073;&#1098;&#1077;&#1082;&#1090;
&quot;&#1090;&#1080;&#1087;&quot;? &#1069;&#1090;&#1086;&#1090;
&#1086;&#1073;&#1098;&#1077;&#1082;&#1090;
&#1086;&#1087;&#1080;&#1089;&#1099;&#1074;&#1072;&#1077;&#1090;
&#1086;&#1073;&#1097;&#1080;&#1077;
&#1093;&#1072;&#1088;&#1072;&#1082;&#1090;&#1077;&#1088;&#1080;&#1089;&#1090;&#1080;&#1082;&#1080;
&#1076;&#1083;&#1103; &#1074;&#1089;&#1077;&#1093;
&#1086;&#1073;&#1098;&#1077;&#1082;&#1090;&#1086;&#1074;
&#1082;&#1072;&#1082;&#1086;&#1075;&#1086;-&#1090;&#1086;
&#1090;&#1080;&#1087;&#1072;. &#1042;&#1089;&#1077;&#1075;&#1086; &#1074;
Windows 2000
&#1089;&#1091;&#1097;&#1077;&#1089;&#1090;&#1074;&#1091;&#1077;&#1090; 27
&#1090;&#1080;&#1087;&#1086;&#1074;
&#1086;&#1073;&#1098;&#1077;&#1082;&#1090;&#1086;&#1074; (&#1074; xp &#1080;
w2k3 &#1080;&#1093; &#1091;&#1078;&#1077; 29).
&#1047;&#1072;&#1087;&#1091;&#1089;&#1090;&#1080;&#1074; WinObjEx (&#1089;&#1084;.
&#1074; &#1088;&#1072;&#1079;&#1076;&#1077;&#1083;&#1077; &quot;&#1048;&#1053;&#1057;&#1058;&#1056;&#1059;&#1052;&#1045;&#1053;&#1058;&#1067;
&gt; &#1059;&#1075;&#1086;&#1083;&#1086;&#1082; NT+&quot; wasm.ru) &#1080;
&#1088;&#1072;&#1089;&#1082;&#1088;&#1099;&#1074;
&#1082;&#1072;&#1090;&#1072;&#1083;&#1086;&#1075; \ObjectTypes &#1084;&#1099;
&#1091;&#1074;&#1080;&#1076;&#1080;&#1084;
&#1089;&#1083;&#1077;&#1076;&#1091;&#1102;&#1097;&#1091;&#1102;
&#1082;&#1072;&#1088;&#1090;&#1080;&#1085;&#1091;:</p>
<p align="center"><img src="file:///L:/Xack/Assembler,C,%20Delphi%20&#1056;&#1105;%20&#1057;&#1027;&#1056;&#1105;&#1057;&#1027;.&#1056;&#1111;&#1057;&#1026;&#1056;&#1109;&#1056;&#1110;&#1057;&#1026;&#1056;&#1056;&#1112;&#1056;&#1112;&#1056;&#1105;&#1057;&#1026;&#1056;&#1109;&#1056;&#1030;&#1056;&#1056;&#1029;&#1056;&#1105;&#1056;%20Forever!!!/[W%20A%20S%20M%20_%20R%20U]%20&#1057;&#1058;&#1040;&#1058;&#1068;&#1048;%20%20&#1057;&#1077;&#1082;&#1088;&#1077;&#1090;&#1099;%20Win32%20%20&#1044;&#1088;&#1072;&#1081;&#1074;&#1077;&#1088;&#1099;%20&#1088;&#1077;&#1078;&#1080;&#1084;&#1072;%20&#1103;&#1076;&#1088;&#1072;%20&#1063;&#1072;&#1089;&#1090;&#1100;%2014%20&#1041;&#1072;&#1079;&#1086;&#1074;&#1072;&#1103;%20&#1090;&#1077;&#1093;&#1085;&#1080;&#1082;&#1072;_%20&#1057;&#1080;&#1085;&#1093;&#1088;&#1086;&#1085;&#1080;&#1079;&#1072;&#1094;&#1080;&#1103;%20&#1048;&#1089;&#1087;&#1086;&#1083;&#1100;&#1079;&#1086;&#1074;&#1072;&#1085;&#1080;&#1077;%20&#1086;&#1073;&#1098;&#1077;&#1082;&#1090;&#1072;%20&#1089;&#1086;&#1073;&#1099;&#1090;&#1080;&#1077;%20&#1076;&#1083;&#1103;%20&#1074;&#1079;&#1072;&#1080;&#1084;&#1086;&#1076;&#1077;&#1081;&#1089;&#1090;&#1074;&#1080;&#1103;%20&#1076;&#1088;&#1072;&#1081;&#1074;&#1077;&#1088;&#1072;%20&#1089;%20&#1087;&#1088;&#1086;&#1075;&#1088;&#1072;&#1084;&#1084;&#1086;&#1081;%20&#1091;&#1087;&#1088;&#1072;&#1074;&#1083;&#1077;&#1085;&#1080;&#1103;.files/kmd14-1.png"><center>
<p><b>&#1056;&#1080;&#1089;. 14-1.</b>
&#1054;&#1073;&#1098;&#1077;&#1082;&#1090;&#1099; &quot;&#1090;&#1080;&#1087;&quot;
&#1074;
&#1087;&#1088;&#1086;&#1089;&#1090;&#1088;&#1072;&#1085;&#1089;&#1090;&#1074;&#1077;
&#1080;&#1084;&#1077;&#1085;
&#1076;&#1080;&#1089;&#1087;&#1077;&#1090;&#1095;&#1077;&#1088;&#1072;
&#1086;&#1073;&#1098;&#1077;&#1082;&#1090;&#1086;&#1074;</center>
<p>&#1069;&#1090;&#1086; &#1090;&#1080;&#1087;&#1099;
&#1086;&#1073;&#1098;&#1077;&#1082;&#1090;&#1086;&#1074;,
&#1089;&#1091;&#1097;&#1077;&#1089;&#1090;&#1074;&#1091;&#1102;&#1097;&#1080;&#1077;
&#1074; &#1089;&#1080;&#1089;&#1090;&#1077;&#1084;&#1077;.
&#1065;&#1077;&#1083;&#1082;&#1085;&#1091;&#1074; &#1085;&#1072;
&#1083;&#1102;&#1073;&#1086;&#1084; &#1080;&#1079; &#1085;&#1080;&#1093;
&#1084;&#1086;&#1078;&#1085;&#1086;
&#1087;&#1086;&#1083;&#1091;&#1095;&#1080;&#1090;&#1100; &#1082;&#1086;&#1077;-&#1082;&#1072;&#1082;&#1091;&#1102;
&#1076;&#1086;&#1087;&#1086;&#1083;&#1085;&#1080;&#1090;&#1077;&#1083;&#1100;&#1085;&#1091;&#1102;
&#1080;&#1085;&#1092;&#1086;&#1088;&#1084;&#1072;&#1094;&#1080;&#1102;.
&#1050;&#1072;&#1078;&#1076;&#1086;&#1084;&#1091;
&#1090;&#1072;&#1082;&#1086;&#1084;&#1091;
&#1086;&#1073;&#1098;&#1077;&#1082;&#1090;&#1091;
&#1089;&#1086;&#1086;&#1090;&#1074;&#1077;&#1090;&#1089;&#1090;&#1074;&#1091;&#1077;&#1090;
&#1089;&#1090;&#1088;&#1091;&#1082;&#1090;&#1091;&#1088;&#1072; OBJECT_TYPE.</p>
<code><!--mstheme--></font>
<pre> OBJECT_TYPE_INITIALIZER STRUCT                       ; sizeof = 04Ch
      _Length                     WORD        ?       ; 0000h
      UseDefaultObject            BYTE        ?       ; 0002h
      Reserved                    BYTE        ?       ; 0003h
      InvalidAttributes           DWORD       ?       ; 0004h
      GenericMapping              GENERIC_MAPPING &lt;&gt;  ; 0008h
      ValidAccessMask             DWORD       ?       ; 0018h
      SecurityRequired            BYTE        ?       ; 001Ch
      MaintainHandleCount         BYTE        ?       ; 001Dh
      MaintainTypeList            BYTE        ?       ; 001Eh
                                  db 1 dup(?)         ; padding
      PoolType                    SDWORD      ?       ; 0020h
      DefaultPagedPoolCharge      DWORD       ?       ; 0024h
      DefaultNonPagedPoolCharge   DWORD       ?       ; 0028h
      . . .
  OBJECT_TYPE_INITIALIZER ENDS

  OBJECT_TYPE STRUCT                                  ; sizeof = 0B0h
      Mutex                       ERESOURCE       &lt;&gt;  ; 0000h
      TypeList                    LIST_ENTRY      &lt;&gt;  ; 0038h
      _Name                       UNICODE_STRING  &lt;&gt;  ; 0040h
      DefaultObject               PVOID           ?   ; 0048h
      Index                       DWORD           ?   ; 004Ch
      TotalNumberOfObjects        DWORD           ?   ; 0050h
      TotalNumberOfHandles        DWORD           ?   ; 0054h
      HighWaterNumberOfObjects    DWORD           ?   ; 0058h
      HighWaterNumberOfHandles    DWORD           ?   ; 005Ch
      TypeInfo                    OBJECT_TYPE_INITIALIZER &lt;&gt;  ; 0060h
      Key                         DWORD           ?   ; 00ACh
  OBJECT_TYPE ENDS

</pre>
<!--mstheme--><font face="Arial, Arial, Helvetica"></code>
<p>&#1050;&#1086;&#1075;&#1076;&#1072;
&#1089;&#1080;&#1089;&#1090;&#1077;&#1084;&#1077;
&#1090;&#1088;&#1077;&#1073;&#1091;&#1077;&#1090;&#1089;&#1103;
&#1089;&#1086;&#1079;&#1076;&#1072;&#1090;&#1100;
&#1085;&#1086;&#1074;&#1099;&#1081; &#1086;&#1073;&#1098;&#1077;&#1082;&#1090;,
&#1086;&#1085;&#1072;
&#1086;&#1073;&#1088;&#1072;&#1097;&#1072;&#1077;&#1090;&#1089;&#1103; &#1082;
&#1089;&#1090;&#1088;&#1091;&#1082;&#1090;&#1091;&#1088;&#1077;,
&#1089;&#1086;&#1086;&#1090;&#1074;&#1077;&#1090;&#1089;&#1090;&#1074;&#1091;&#1102;&#1097;&#1077;&#1081;
&#1101;&#1090;&#1086;&#1084;&#1091; &#1090;&#1080;&#1087;&#1091;
&#1086;&#1073;&#1098;&#1077;&#1082;&#1090;&#1086;&#1074;.
&#1040;&#1076;&#1088;&#1077;&#1089;&#1072;
&#1089;&#1090;&#1088;&#1091;&#1082;&#1090;&#1091;&#1088;
&#1085;&#1077;&#1082;&#1086;&#1090;&#1086;&#1088;&#1099;&#1093;
&#1086;&#1073;&#1098;&#1077;&#1082;&#1090;&#1086;&#1074; &quot;&#1090;&#1080;&#1087;&quot;
&#1101;&#1082;&#1089;&#1087;&#1086;&#1088;&#1090;&#1080;&#1088;&#1091;&#1102;&#1090;&#1089;&#1103;.
&#1053;&#1072;&#1087;&#1088;&#1080;&#1084;&#1077;&#1088;, &#1076;&#1083;&#1103;
&#1086;&#1073;&#1098;&#1077;&#1082;&#1090;&#1086;&#1074;
&#1090;&#1080;&#1087;&#1072; WindowStation &#1072;&#1076;&#1088;&#1077;&#1089;
&#1089;&#1090;&#1088;&#1091;&#1082;&#1090;&#1091;&#1088;&#1099; OBJECT_TYPE,
&#1086;&#1087;&#1080;&#1089;&#1099;&#1074;&#1072;&#1102;&#1097;&#1077;&#1081;
&#1074;&#1089;&#1077; &#1086;&#1073;&#1098;&#1077;&#1082;&#1090;&#1099;
&#1101;&#1090;&#1086;&#1075;&#1086; &#1090;&#1080;&#1087;&#1072;,
&#1093;&#1088;&#1072;&#1085;&#1080;&#1090;&#1089;&#1103; &#1074;
&#1101;&#1082;&#1089;&#1087;&#1086;&#1088;&#1090;&#1080;&#1088;&#1091;&#1077;&#1084;&#1086;&#1081;
&#1087;&#1077;&#1088;&#1077;&#1084;&#1077;&#1085;&#1085;&#1086;&#1081;
&#1103;&#1076;&#1088;&#1072; ExWindowStationObjectType, &#1072;
&#1076;&#1083;&#1103; &#1086;&#1073;&#1098;&#1077;&#1082;&#1090;&#1086;&#1074;
Event - ExEventObjectType.</p>
<code><!--mstheme--></font>
<pre>                 pushad
                 mov ecx, ExEventObjectType
                 mov ecx, [ecx]
                 mov ecx, [ecx]
                 invoke DbgPrint, $CTA0(&quot;\nExEventObjectType: %08X\n&quot;), ecx
                 popad

</pre>
<!--mstheme--><font face="Arial, Arial, Helvetica"></code>
<p>&#1044;&#1086;&#1073;&#1072;&#1074;&#1080;&#1074; &#1074;
&#1076;&#1088;&#1072;&#1081;&#1074;&#1077;&#1088;
&#1074;&#1099;&#1096;&#1077;&#1087;&#1088;&#1080;&#1074;&#1077;&#1076;&#1077;&#1085;&#1085;&#1099;&#1081;
&#1082;&#1086;&#1076;, &#1084;&#1086;&#1078;&#1085;&#1086;
&#1087;&#1086;&#1083;&#1091;&#1095;&#1080;&#1090;&#1100;
&#1072;&#1076;&#1088;&#1077;&#1089;
&#1089;&#1090;&#1088;&#1091;&#1082;&#1090;&#1091;&#1088;&#1099; OBJECT_TYPE
&#1076;&#1083;&#1103; &#1086;&#1073;&#1098;&#1077;&#1082;&#1090;&#1086;&#1074;
&quot;&#1089;&#1086;&#1073;&#1099;&#1090;&#1080;&#1077;&quot;.
&#1044;&#1083;&#1103; &#1084;&#1077;&#1085;&#1103; &#1101;&#1090;&#1086;&#1090;
&#1072;&#1076;&#1088;&#1077;&#1089;
&#1086;&#1082;&#1072;&#1079;&#1072;&#1083;&#1089;&#1103;
&#1088;&#1072;&#1074;&#1085;&#1099;&#1084; 8188C200h.
&#1047;&#1085;&#1072;&#1103;, &#1095;&#1090;&#1086; &#1085;&#1072;
&#1084;&#1072;&#1096;&#1080;&#1085;&#1072;&#1093; &#1089;
&#1086;&#1073;&#1098;&#1077;&#1084;&#1086;&#1084;
&#1086;&#1087;&#1077;&#1088;&#1072;&#1090;&#1080;&#1074;&#1085;&#1086;&#1081;
&#1087;&#1072;&#1084;&#1103;&#1090;&#1080; 128 &#1080;
&#1073;&#1086;&#1083;&#1077;&#1077; (&#1076;&#1083;&#1103; xp 256 &#1080;
&#1073;&#1086;&#1083;&#1077;&#1077;, &#1093;&#1086;&#1090;&#1103;
&#1101;&#1090;&#1086; &#1085;&#1077; &#1090;&#1086;&#1095;&#1085;&#1099;&#1077;
&#1076;&#1072;&#1085;&#1085;&#1099;&#1077;)
&#1084;&#1077;&#1075;&#1072;&#1073;&#1072;&#1081;&#1090;
&#1103;&#1076;&#1088;&#1086;
&#1086;&#1090;&#1086;&#1073;&#1088;&#1072;&#1078;&#1072;&#1077;&#1090;&#1089;&#1103;
&#1074; &#1073;&#1086;&#1083;&#1100;&#1096;&#1080;&#1077; (&#1087;&#1086; 4&#1052;&#1073;)
&#1089;&#1090;&#1088;&#1072;&#1085;&#1080;&#1094;&#1099;, &#1080;
&#1079;&#1085;&#1072;&#1103;, &#1095;&#1090;&#1086; &#1085;&#1072;
&#1074;&#1080;&#1088;&#1090;&#1091;&#1072;&#1083;&#1100;&#1085;&#1099;&#1077;
&#1072;&#1076;&#1088;&#1077;&#1089;&#1072; 80000000h - 9FFFFFFFh
&#1086;&#1090;&#1086;&#1073;&#1088;&#1072;&#1078;&#1072;&#1077;&#1090;&#1089;&#1103;
&#1092;&#1080;&#1079;&#1080;&#1095;&#1077;&#1089;&#1082;&#1072;&#1103;
&#1087;&#1072;&#1084;&#1103;&#1090;&#1100; &#1087;&#1086;
&#1072;&#1076;&#1088;&#1077;&#1089;&#1072;&#1084; 00000000h - 01FFFFFFFh
&#1084;&#1099; &#1084;&#1086;&#1078;&#1077;&#1084;
&#1074;&#1086;&#1089;&#1087;&#1086;&#1083;&#1100;&#1079;&#1086;&#1074;&#1072;&#1090;&#1100;&#1089;&#1103;
&#1091;&#1089;&#1083;&#1091;&#1075;&#1072;&#1084;&#1080; PhysMemBrowser (&#1074;&#1093;&#1086;&#1076;&#1080;&#1090;
&#1074; &#1089;&#1086;&#1089;&#1090;&#1072;&#1074; KmdKit). &#1071;
&#1076;&#1086;&#1074;&#1086;&#1083;&#1100;&#1085;&#1086;
&#1095;&#1072;&#1089;&#1090;&#1086; &#1080;&#1084;
&#1087;&#1086;&#1083;&#1100;&#1079;&#1091;&#1102;&#1089;&#1100;, &#1090;.&#1082;.
&#1080;&#1085;&#1086;&#1075;&#1076;&#1072; &#1101;&#1090;&#1086;
&#1079;&#1085;&#1072;&#1095;&#1080;&#1090;&#1077;&#1083;&#1100;&#1085;&#1086;
&#1073;&#1099;&#1089;&#1090;&#1088;&#1077;&#1077; &#1080;
&#1091;&#1076;&#1086;&#1073;&#1085;&#1077;&#1077; &#1095;&#1077;&#1084;
&#1080;&#1089;&#1087;&#1086;&#1083;&#1100;&#1079;&#1086;&#1074;&#1072;&#1090;&#1100;
&#1086;&#1090;&#1083;&#1072;&#1076;&#1095;&#1080;&#1082;.</p>
<p>&#1048;&#1090;&#1072;&#1082;, &#1085;&#1072;
&#1074;&#1080;&#1088;&#1090;&#1091;&#1072;&#1083;&#1100;&#1085;&#1099;&#1081;
&#1072;&#1076;&#1088;&#1077;&#1089; 8188C200h
&#1086;&#1090;&#1086;&#1073;&#1088;&#1072;&#1078;&#1077;&#1085;
&#1092;&#1080;&#1079;&#1080;&#1095;&#1077;&#1089;&#1082;&#1080;&#1081;
&#1072;&#1076;&#1088;&#1077;&#1089; 0188C200h.
&#1042;&#1074;&#1086;&#1076;&#1080;&#1084; &#1101;&#1090;&#1086;
&#1079;&#1085;&#1072;&#1095;&#1077;&#1085;&#1080;&#1077; &#1074; PhysMemBrowser
&#1080; &#1087;&#1086;&#1083;&#1091;&#1095;&#1072;&#1077;&#1084;
&#1076;&#1072;&#1084;&#1087;
&#1089;&#1090;&#1088;&#1091;&#1082;&#1090;&#1091;&#1088;&#1099; OBJECT_TYPE
&#1076;&#1083;&#1103; &#1086;&#1073;&#1098;&#1077;&#1082;&#1090;&#1086;&#1074;
&#1090;&#1080;&#1087;&#1072; &quot;&#1089;&#1086;&#1073;&#1099;&#1090;&#1080;&#1077;&quot;:</p>
<p align="center"><img src="file:///L:/Xack/Assembler,C,%20Delphi%20&#1056;&#1105;%20&#1057;&#1027;&#1056;&#1105;&#1057;&#1027;.&#1056;&#1111;&#1057;&#1026;&#1056;&#1109;&#1056;&#1110;&#1057;&#1026;&#1056;&#1056;&#1112;&#1056;&#1112;&#1056;&#1105;&#1057;&#1026;&#1056;&#1109;&#1056;&#1030;&#1056;&#1056;&#1029;&#1056;&#1105;&#1056;%20Forever!!!/[W%20A%20S%20M%20_%20R%20U]%20&#1057;&#1058;&#1040;&#1058;&#1068;&#1048;%20%20&#1057;&#1077;&#1082;&#1088;&#1077;&#1090;&#1099;%20Win32%20%20&#1044;&#1088;&#1072;&#1081;&#1074;&#1077;&#1088;&#1099;%20&#1088;&#1077;&#1078;&#1080;&#1084;&#1072;%20&#1103;&#1076;&#1088;&#1072;%20&#1063;&#1072;&#1089;&#1090;&#1100;%2014%20&#1041;&#1072;&#1079;&#1086;&#1074;&#1072;&#1103;%20&#1090;&#1077;&#1093;&#1085;&#1080;&#1082;&#1072;_%20&#1057;&#1080;&#1085;&#1093;&#1088;&#1086;&#1085;&#1080;&#1079;&#1072;&#1094;&#1080;&#1103;%20&#1048;&#1089;&#1087;&#1086;&#1083;&#1100;&#1079;&#1086;&#1074;&#1072;&#1085;&#1080;&#1077;%20&#1086;&#1073;&#1098;&#1077;&#1082;&#1090;&#1072;%20&#1089;&#1086;&#1073;&#1099;&#1090;&#1080;&#1077;%20&#1076;&#1083;&#1103;%20&#1074;&#1079;&#1072;&#1080;&#1084;&#1086;&#1076;&#1077;&#1081;&#1089;&#1090;&#1074;&#1080;&#1103;%20&#1076;&#1088;&#1072;&#1081;&#1074;&#1077;&#1088;&#1072;%20&#1089;%20&#1087;&#1088;&#1086;&#1075;&#1088;&#1072;&#1084;&#1084;&#1086;&#1081;%20&#1091;&#1087;&#1088;&#1072;&#1074;&#1083;&#1077;&#1085;&#1080;&#1103;.files/kmd14-2.png"><center>
<p><b>&#1056;&#1080;&#1089;. 14-2.</b> &#1044;&#1072;&#1084;&#1087;
&#1086;&#1073;&#1098;&#1077;&#1082;&#1090;&#1072; &quot;&#1090;&#1080;&#1087;&quot;</center>
<p>&#1055;&#1086; &#1072;&#1076;&#1088;&#1077;&#1089;&#1091; E1007C48h
&#1084;&#1086;&#1078;&#1085;&#1086;
&#1086;&#1073;&#1085;&#1072;&#1088;&#1091;&#1078;&#1080;&#1090;&#1100;
&#1089;&#1090;&#1088;&#1086;&#1082;&#1091; &quot;Event&quot;, &#1090;.&#1077;.
&#1080;&#1084;&#1103; &#1086;&#1073;&#1098;&#1077;&#1082;&#1090;&#1072; &quot;&#1090;&#1080;&#1087;&quot;.
&#1047;&#1085;&#1072;&#1095;&#1077;&#1085;&#1080;&#1103; TotalNumberOfObjects (&#1086;&#1073;&#1097;&#1077;&#1077;
&#1082;&#1086;&#1083;-&#1074;&#1086;
&#1086;&#1073;&#1098;&#1077;&#1082;&#1090;&#1086;&#1074;
&#1090;&#1080;&#1087;&#1072; &quot;&#1089;&#1086;&#1073;&#1099;&#1090;&#1080;&#1077;&quot;
&#1074; &#1089;&#1080;&#1089;&#1090;&#1077;&#1084;&#1077;), TotalNumberOfHandles
(&#1086;&#1073;&#1097;&#1077;&#1077; &#1082;&#1086;&#1083;-&#1074;&#1086;
&#1086;&#1090;&#1082;&#1088;&#1099;&#1090;&#1099;&#1093;
&#1086;&#1087;&#1080;&#1089;&#1072;&#1090;&#1077;&#1083;&#1077;&#1081;
&#1086;&#1073;&#1098;&#1077;&#1082;&#1090;&#1086;&#1074;
&#1090;&#1080;&#1087;&#1072; &quot;&#1089;&#1086;&#1073;&#1099;&#1090;&#1080;&#1077;&quot;
&#1074; &#1089;&#1080;&#1089;&#1090;&#1077;&#1084;&#1077;),
HighWaterNumberOfObjects (&#1087;&#1080;&#1082;&#1086;&#1074;&#1086;&#1077;
&#1082;&#1086;&#1083;-&#1074;&#1086;
&#1086;&#1073;&#1098;&#1077;&#1082;&#1090;&#1086;&#1074;
&#1090;&#1080;&#1087;&#1072; &quot;&#1089;&#1086;&#1073;&#1099;&#1090;&#1080;&#1077;&quot;,
&#1089;&#1091;&#1097;&#1077;&#1089;&#1090;&#1074;&#1086;&#1074;&#1072;&#1074;&#1096;&#1080;&#1093;
&#1074; &#1089;&#1080;&#1089;&#1090;&#1077;&#1084;&#1077;),
HighWaterNumberOfHandles (&#1087;&#1080;&#1082;&#1086;&#1074;&#1086;&#1077;
&#1082;&#1086;&#1083;-&#1074;&#1086;
&#1086;&#1090;&#1082;&#1088;&#1099;&#1090;&#1099;&#1093;
&#1086;&#1087;&#1080;&#1089;&#1072;&#1090;&#1077;&#1083;&#1077;&#1081;
&#1086;&#1073;&#1098;&#1077;&#1082;&#1090;&#1086;&#1074;
&#1090;&#1080;&#1087;&#1072; &quot;&#1089;&#1086;&#1073;&#1099;&#1090;&#1080;&#1077;&quot;
&#1089;&#1091;&#1097;&#1077;&#1089;&#1090;&#1074;&#1086;&#1074;&#1072;&#1074;&#1096;&#1080;&#1093;
&#1074; &#1089;&#1080;&#1089;&#1090;&#1077;&#1084;&#1077;)
&#1088;&#1072;&#1074;&#1085;&#1099; (&#1074;&#1099;&#1076;&#1077;&#1083;&#1077;&#1085;&#1099;)
646h, 67Eh, 66Bh, 6A1h
&#1089;&#1086;&#1086;&#1090;&#1074;&#1077;&#1090;&#1089;&#1090;&#1074;&#1077;&#1085;&#1085;&#1086;.
&#1045;&#1089;&#1083;&#1080;
&#1097;&#1077;&#1083;&#1082;&#1085;&#1091;&#1090;&#1100; &#1085;&#1072;
&#1086;&#1073;&#1098;&#1077;&#1082;&#1090;&#1077; &quot;&#1090;&#1080;&#1087;&quot;
Event &#1074; &#1086;&#1082;&#1085;&#1077; WinObjEx, &#1090;&#1086;
&#1084;&#1086;&#1078;&#1085;&#1086;
&#1091;&#1074;&#1080;&#1076;&#1077;&#1090;&#1100; &#1101;&#1090;&#1080;
&#1078;&#1077; &#1089;&#1072;&#1084;&#1099;&#1077;
&#1079;&#1085;&#1072;&#1095;&#1077;&#1085;&#1080;&#1103;,
&#1090;&#1086;&#1083;&#1100;&#1082;&#1086; &#1074;
&#1076;&#1077;&#1089;&#1103;&#1090;&#1080;&#1095;&#1085;&#1086;&#1081;
&#1092;&#1086;&#1088;&#1084;&#1077;.</p>
<p align="center"><img src="file:///L:/Xack/Assembler,C,%20Delphi%20&#1056;&#1105;%20&#1057;&#1027;&#1056;&#1105;&#1057;&#1027;.&#1056;&#1111;&#1057;&#1026;&#1056;&#1109;&#1056;&#1110;&#1057;&#1026;&#1056;&#1056;&#1112;&#1056;&#1112;&#1056;&#1105;&#1057;&#1026;&#1056;&#1109;&#1056;&#1030;&#1056;&#1056;&#1029;&#1056;&#1105;&#1056;%20Forever!!!/[W%20A%20S%20M%20_%20R%20U]%20&#1057;&#1058;&#1040;&#1058;&#1068;&#1048;%20%20&#1057;&#1077;&#1082;&#1088;&#1077;&#1090;&#1099;%20Win32%20%20&#1044;&#1088;&#1072;&#1081;&#1074;&#1077;&#1088;&#1099;%20&#1088;&#1077;&#1078;&#1080;&#1084;&#1072;%20&#1103;&#1076;&#1088;&#1072;%20&#1063;&#1072;&#1089;&#1090;&#1100;%2014%20&#1041;&#1072;&#1079;&#1086;&#1074;&#1072;&#1103;%20&#1090;&#1077;&#1093;&#1085;&#1080;&#1082;&#1072;_%20&#1057;&#1080;&#1085;&#1093;&#1088;&#1086;&#1085;&#1080;&#1079;&#1072;&#1094;&#1080;&#1103;%20&#1048;&#1089;&#1087;&#1086;&#1083;&#1100;&#1079;&#1086;&#1074;&#1072;&#1085;&#1080;&#1077;%20&#1086;&#1073;&#1098;&#1077;&#1082;&#1090;&#1072;%20&#1089;&#1086;&#1073;&#1099;&#1090;&#1080;&#1077;%20&#1076;&#1083;&#1103;%20&#1074;&#1079;&#1072;&#1080;&#1084;&#1086;&#1076;&#1077;&#1081;&#1089;&#1090;&#1074;&#1080;&#1103;%20&#1076;&#1088;&#1072;&#1081;&#1074;&#1077;&#1088;&#1072;%20&#1089;%20&#1087;&#1088;&#1086;&#1075;&#1088;&#1072;&#1084;&#1084;&#1086;&#1081;%20&#1091;&#1087;&#1088;&#1072;&#1074;&#1083;&#1077;&#1085;&#1080;&#1103;.files/kmd14-3.png"><center>
<p><b>&#1056;&#1080;&#1089;. 14-3.</b>
&#1057;&#1074;&#1086;&#1081;&#1089;&#1090;&#1074;&#1072;
&#1086;&#1073;&#1098;&#1077;&#1082;&#1090;&#1072; &quot;&#1090;&#1080;&#1087;&quot;</center>
<p>&#1048;&#1084;&#1077;&#1081;&#1090;&#1077; &#1074;
&#1074;&#1080;&#1076;&#1091; &#1090;&#1086;, &#1095;&#1090;&#1086;
&#1082;&#1086;&#1083;&#1080;&#1095;&#1077;&#1089;&#1090;&#1074;&#1086;
&#1086;&#1073;&#1098;&#1077;&#1082;&#1090;&#1086;&#1074;
&#1087;&#1086;&#1089;&#1090;&#1086;&#1103;&#1085;&#1085;&#1086;
&#1084;&#1077;&#1085;&#1103;&#1077;&#1090;&#1089;&#1103;. &#1071;
&#1087;&#1088;&#1086;&#1089;&#1090;&#1086;
&#1089;&#1076;&#1077;&#1083;&#1072;&#1083; &#1074;&#1089;&#1105; &#1074;
&#1085;&#1091;&#1078;&#1085;&#1086;&#1084;
&#1087;&#1086;&#1088;&#1103;&#1076;&#1082;&#1077;,
&#1087;&#1086;&#1101;&#1090;&#1086;&#1084;&#1091; &#1091;
&#1084;&#1077;&#1085;&#1103;
&#1079;&#1085;&#1072;&#1095;&#1077;&#1085;&#1080;&#1103;
&#1090;&#1086;&#1095;&#1085;&#1086;
&#1089;&#1086;&#1074;&#1087;&#1072;&#1076;&#1072;&#1102;&#1090;.</p>
<p>Pool Type
&#1089;&#1086;&#1086;&#1090;&#1074;&#1077;&#1090;&#1089;&#1090;&#1074;&#1091;&#1077;&#1090;
&#1087;&#1086;&#1083;&#1102; PoolType, Paged Pool Usage -
&#1087;&#1086;&#1083;&#1102; DefaultPagedPoolCharge, NonPaged Pool Usage -
&#1087;&#1086;&#1083;&#1102; DefaultNonPagedPoolCharge, &#1072; Maintain Handle
Database
&#1089;&#1086;&#1086;&#1090;&#1074;&#1077;&#1090;&#1089;&#1090;&#1074;&#1091;&#1077;&#1090;
&#1087;&#1086;&#1083;&#1102; MaintainHandleCount.</p>
<p>WinObjEx &#1090;&#1072;&#1082;&#1078;&#1077;
&#1087;&#1086;&#1082;&#1072;&#1078;&#1077;&#1090; &#1074;
&#1091;&#1076;&#1086;&#1073;&#1085;&#1086;&#1081;
&#1092;&#1086;&#1088;&#1084;&#1077;
&#1089;&#1086;&#1076;&#1077;&#1088;&#1078;&#1080;&#1084;&#1086;&#1077;
&#1087;&#1086;&#1083;&#1077;&#1081; InvalidAttributes, GenericMapping &#1080;
ValidAccessMask. &#1057;&#1088;&#1072;&#1074;&#1085;&#1080;&#1090;&#1077;
&#1089; &#1076;&#1072;&#1084;&#1087;&#1086;&#1084; &#1080;
&#1091;&#1074;&#1080;&#1076;&#1080;&#1090;&#1077;, &#1095;&#1090;&#1086;
&#1074;&#1089;&#1077; &#1079;&#1085;&#1072;&#1095;&#1077;&#1085;&#1080;&#1103;
&#1089;&#1086;&#1074;&#1087;&#1072;&#1076;&#1072;&#1102;&#1090;.</p>
<p>&#1053;&#1072;&#1076;&#1077;&#1102;&#1089;&#1100;, &#1095;&#1090;&#1086;
&#1089; &#1086;&#1073;&#1098;&#1077;&#1082;&#1090;&#1086;&#1084; &quot;&#1090;&#1080;&#1087;&quot;
&#1082;&#1086;&#1077;-&#1095;&#1090;&#1086;
&#1087;&#1088;&#1086;&#1103;&#1089;&#1085;&#1080;&#1083;&#1086;&#1089;&#1100;.
&#1042;&#1077;&#1088;&#1085;&#1077;&#1084;&#1089;&#1103; &#1082;
&#1082;&#1086;&#1076;&#1091;
&#1076;&#1088;&#1072;&#1081;&#1074;&#1077;&#1088;&#1072;.</p>
<br>
<br>
<p>&nbsp;<!--mstheme--></font>
<h2><!--mstheme--><font face="Arial, Arial, Helvetica" color="#CCCCCC">14.10
&#1055;&#1088;&#1086;&#1076;&#1086;&#1083;&#1078;&#1072;&#1077;&#1084;
&#1086;&#1073;&#1088;&#1072;&#1073;&#1072;&#1090;&#1099;&#1074;&#1072;&#1090;&#1100;
IOCTL_SET_NOTIFY<!--mstheme--></font></h2>
<!--mstheme--><font face="Arial, Arial, Helvetica">
<p>&nbsp;</p>
<code><!--mstheme--></font>
<pre>                 mov ecx, ExEventObjectType
                 mov ecx, [ecx]
                 mov ecx, [ecx]

                 invoke ObReferenceObjectByHandle, edx, EVENT_MODIFY_STATE, ecx, \
                                         UserMode, addr g_pkEventObject, NULL

</pre>
<!--mstheme--><font face="Arial, Arial, Helvetica"></code>
<p>&#1042;&#1099;&#1079;&#1099;&#1074;&#1072;&#1077;&#1084;
ObReferenceObjectByHandle. &#1055;&#1077;&#1088;&#1074;&#1099;&#1081;
&#1087;&#1072;&#1088;&#1072;&#1084;&#1077;&#1090;&#1088; -
&#1086;&#1087;&#1080;&#1089;&#1072;&#1090;&#1077;&#1083;&#1100;
&#1086;&#1073;&#1098;&#1077;&#1082;&#1090;&#1072; &quot;&#1089;&#1086;&#1073;&#1099;&#1090;&#1080;&#1077;&quot;,
&#1082;&#1086;&#1090;&#1086;&#1088;&#1099;&#1081; &#1084;&#1099;
&#1087;&#1086;&#1083;&#1091;&#1095;&#1080;&#1083;&#1080; &#1086;&#1090;
&#1087;&#1088;&#1086;&#1075;&#1088;&#1072;&#1084;&#1084;&#1099;
&#1091;&#1087;&#1088;&#1072;&#1074;&#1083;&#1077;&#1085;&#1080;&#1103;.
&#1042;&#1090;&#1086;&#1088;&#1086;&#1081;
&#1087;&#1072;&#1088;&#1072;&#1084;&#1077;&#1090;&#1088; -
&#1090;&#1088;&#1077;&#1073;&#1091;&#1077;&#1084;&#1099;&#1081;
&#1090;&#1080;&#1087; &#1076;&#1086;&#1089;&#1090;&#1091;&#1087;&#1072;.
&#1058;&#1088;&#1077;&#1090;&#1080;&#1081; -
&#1091;&#1082;&#1072;&#1079;&#1072;&#1090;&#1077;&#1083;&#1100; &#1085;&#1072;
&#1089;&#1090;&#1088;&#1091;&#1082;&#1090;&#1091;&#1088;&#1091; OBJECT_TYPE
&#1076;&#1083;&#1103; &#1086;&#1073;&#1098;&#1077;&#1082;&#1090;&#1086;&#1074;
&#1090;&#1080;&#1087;&#1072; &quot;&#1089;&#1086;&#1073;&#1099;&#1090;&#1080;&#1077;&quot;.
&#1048;&#1089;&#1087;&#1086;&#1083;&#1100;&#1079;&#1091;&#1103;
&#1080;&#1084;&#1077;&#1085;&#1085;&#1086; &#1101;&#1090;&#1086;&#1090;
&#1091;&#1082;&#1072;&#1079;&#1072;&#1090;&#1077;&#1083;&#1100;,
&#1089;&#1080;&#1089;&#1090;&#1077;&#1084;&#1072;
&#1073;&#1091;&#1076;&#1077;&#1090;
&#1087;&#1088;&#1086;&#1074;&#1077;&#1088;&#1103;&#1090;&#1100;, &#1072;
&#1076;&#1077;&#1081;&#1089;&#1090;&#1074;&#1080;&#1090;&#1077;&#1083;&#1100;&#1085;&#1086;
&#1083;&#1080; &#1086;&#1087;&#1080;&#1089;&#1072;&#1090;&#1077;&#1083;&#1100;
&#1089;&#1086;&#1086;&#1090;&#1074;&#1077;&#1090;&#1089;&#1090;&#1074;&#1091;&#1077;&#1090;
&#1086;&#1073;&#1098;&#1077;&#1082;&#1090;&#1091; &quot;&#1089;&#1086;&#1073;&#1099;&#1090;&#1080;&#1077;&quot;
&#1080; &#1077;&#1089;&#1083;&#1080; &#1076;&#1072;, &#1090;&#1086;
&#1074;&#1077;&#1088;&#1085;&#1077;&#1090; &#1085;&#1072;&#1084; &#1074;
&#1087;&#1077;&#1088;&#1077;&#1084;&#1077;&#1085;&#1085;&#1086;&#1081;
g_pkEventObject &#1089;&#1089;&#1099;&#1083;&#1082;&#1091; &#1085;&#1072;
&#1101;&#1090;&#1086;&#1090; &#1086;&#1073;&#1098;&#1077;&#1082;&#1090;.
&#1063;&#1077;&#1090;&#1074;&#1077;&#1088;&#1090;&#1099;&#1081;
&#1087;&#1072;&#1088;&#1072;&#1084;&#1077;&#1090;&#1088;
&#1086;&#1087;&#1088;&#1077;&#1076;&#1077;&#1083;&#1103;&#1077;&#1090;, &#1074;
&#1082;&#1072;&#1082;&#1086;&#1081;
&#1090;&#1072;&#1073;&#1083;&#1080;&#1094;&#1077;
&#1086;&#1087;&#1080;&#1089;&#1072;&#1090;&#1077;&#1083;&#1077;&#1081;
&#1089;&#1083;&#1077;&#1076;&#1091;&#1077;&#1090;
&#1080;&#1089;&#1082;&#1072;&#1090;&#1100;
&#1086;&#1073;&#1098;&#1077;&#1082;&#1090;. &#1045;&#1089;&#1083;&#1080;
&#1101;&#1090;&#1086; KernelMode, &#1090;&#1086;
&#1073;&#1091;&#1076;&#1077;&#1090;
&#1087;&#1088;&#1086;&#1089;&#1084;&#1072;&#1090;&#1088;&#1080;&#1074;&#1072;&#1090;&#1100;&#1089;&#1103;
&#1090;&#1072;&#1073;&#1083;&#1080;&#1094;&#1072;
&#1086;&#1087;&#1080;&#1089;&#1072;&#1090;&#1077;&#1083;&#1077;&#1081;
&#1103;&#1076;&#1088;&#1072; (&#1087;&#1086;&#1076;&#1088;&#1086;&#1073;&#1085;&#1077;&#1077;
&#1089;&#1084;. &#1095;&#1072;&#1089;&#1090;&#1100; 11), &#1072;
&#1101;&#1090;&#1086; &#1089;&#1086;&#1074;&#1089;&#1077;&#1084; &#1085;&#1077;
&#1090;&#1086;, &#1095;&#1090;&#1086; &#1085;&#1072;&#1084;
&#1085;&#1091;&#1078;&#1085;&#1086;. &#1045;&#1089;&#1083;&#1080;
&#1101;&#1090;&#1086; UserMode, &#1090;&#1086;
&#1089;&#1080;&#1089;&#1090;&#1077;&#1084;&#1072;
&#1073;&#1091;&#1076;&#1077;&#1090;
&#1080;&#1089;&#1089;&#1083;&#1077;&#1076;&#1086;&#1074;&#1072;&#1090;&#1100;
&#1090;&#1072;&#1073;&#1083;&#1080;&#1094;&#1091;
&#1086;&#1087;&#1080;&#1089;&#1072;&#1090;&#1077;&#1083;&#1077;&#1081;
&#1090;&#1077;&#1082;&#1091;&#1097;&#1077;&#1075;&#1086;
&#1087;&#1088;&#1086;&#1094;&#1077;&#1089;&#1089;&#1072;, &#1095;&#1090;&#1086;
&#1085;&#1072;&#1084; &#1080; &#1085;&#1091;&#1078;&#1085;&#1086;.
&#1053;&#1072;&#1076;&#1077;&#1102;&#1089;&#1100;, &#1074;&#1099;
&#1087;&#1086;&#1084;&#1085;&#1080;&#1090;&#1077;, &#1095;&#1090;&#1086;
&#1087;&#1088;&#1080;
&#1086;&#1073;&#1088;&#1072;&#1073;&#1086;&#1090;&#1082;&#1077;
IRP_MJ_DEVICE_CONTROL &#1084;&#1099; &#1082;&#1072;&#1082;
&#1086;&#1076;&#1085;&#1086;&#1091;&#1088;&#1086;&#1074;&#1085;&#1077;&#1074;&#1099;&#1081;
&#1076;&#1088;&#1072;&#1081;&#1074;&#1077;&#1088;
&#1085;&#1072;&#1093;&#1086;&#1076;&#1080;&#1084;&#1089;&#1103; &#1074;
&#1082;&#1086;&#1085;&#1090;&#1077;&#1082;&#1089;&#1090;&#1077;
&#1074;&#1099;&#1079;&#1099;&#1074;&#1072;&#1102;&#1097;&#1077;&#1075;&#1086;
&#1087;&#1088;&#1086;&#1094;&#1077;&#1089;&#1089;&#1072;.
&#1055;&#1086;&#1089;&#1083;&#1077;&#1076;&#1085;&#1080;&#1081;
&#1087;&#1072;&#1088;&#1072;&#1084;&#1077;&#1090;&#1088;
&#1092;&#1091;&#1085;&#1082;&#1094;&#1080;&#1080; ObReferenceObjectByHandle -
&#1101;&#1090;&#1086;
&#1091;&#1082;&#1072;&#1079;&#1072;&#1090;&#1077;&#1083;&#1100; &#1085;&#1072;
&#1089;&#1090;&#1088;&#1091;&#1082;&#1090;&#1091;&#1088;&#1091;
OBJECT_HANDLE_INFORMATION. &#1042; DDK
&#1085;&#1072;&#1087;&#1080;&#1089;&#1072;&#1085;&#1086;, &#1095;&#1090;&#1086;
&#1085;&#1072;&#1084; &#1089;&#1083;&#1077;&#1076;&#1091;&#1077;&#1090;
&#1074;&#1089;&#1077;&#1075;&#1076;&#1072;
&#1074;&#1099;&#1089;&#1090;&#1072;&#1074;&#1083;&#1103;&#1090;&#1100;
&#1077;&#1075;&#1086; &#1074; NULL. &#1053;&#1091;, &#1074;&#1099;
&#1079;&#1085;&#1072;&#1077;&#1090;&#1077;, &#1082;&#1072;&#1082;
&#1086;&#1090;&#1085;&#1086;&#1089;&#1080;&#1090;&#1100;&#1089;&#1103; &#1082;
&#1087;&#1086;&#1076;&#1086;&#1073;&#1085;&#1099;&#1084;
&#1082;&#1072;&#1090;&#1077;&#1075;&#1086;&#1088;&#1080;&#1095;&#1085;&#1099;&#1084;
&#1079;&#1072;&#1103;&#1074;&#1083;&#1077;&#1085;&#1080;&#1103;&#1084; :)
&#1042; &#1076;&#1072;&#1085;&#1085;&#1086;&#1084;
&#1089;&#1083;&#1091;&#1095;&#1072;&#1077;, &#1085;&#1072;&#1084; &#1085;&#1077;
&#1090;&#1088;&#1077;&#1073;&#1091;&#1077;&#1090;&#1089;&#1103;
&#1101;&#1090;&#1072;
&#1080;&#1085;&#1092;&#1086;&#1088;&#1084;&#1072;&#1094;&#1080;&#1103;.</p>
<code><!--mstheme--></font>
<pre>                 .if eax == STATUS_SUCCESS

</pre>
<!--mstheme--><font face="Arial, Arial, Helvetica"></code>
<p>&#1045;&#1089;&#1083;&#1080; &#1074;
&#1090;&#1072;&#1073;&#1083;&#1080;&#1094;&#1077;
&#1086;&#1087;&#1080;&#1089;&#1072;&#1090;&#1077;&#1083;&#1077;&#1081;
&#1090;&#1077;&#1082;&#1091;&#1097;&#1077;&#1075;&#1086;
&#1087;&#1088;&#1086;&#1094;&#1077;&#1089;&#1089;&#1072;
&#1077;&#1089;&#1090;&#1100; &#1090;&#1072;&#1082;&#1086;&#1081;
&#1086;&#1087;&#1080;&#1089;&#1072;&#1090;&#1077;&#1083;&#1100;, &#1080;
&#1086;&#1085;
&#1089;&#1086;&#1086;&#1090;&#1074;&#1077;&#1090;&#1089;&#1090;&#1074;&#1091;&#1077;&#1090;
&#1086;&#1073;&#1098;&#1077;&#1082;&#1090;&#1091; &quot;&#1089;&#1086;&#1073;&#1099;&#1090;&#1080;&#1077;&quot;
&#1080;
&#1079;&#1072;&#1087;&#1088;&#1072;&#1096;&#1080;&#1074;&#1072;&#1077;&#1084;&#1099;&#1081;
&#1090;&#1080;&#1087; &#1076;&#1086;&#1089;&#1090;&#1091;&#1087;&#1072;
&#1084;&#1086;&#1078;&#1077;&#1090; &#1073;&#1099;&#1090;&#1100;
&#1087;&#1088;&#1077;&#1076;&#1086;&#1089;&#1090;&#1072;&#1074;&#1083;&#1077;&#1085;,
&#1084;&#1099; &#1087;&#1086;&#1083;&#1091;&#1095;&#1080;&#1084; &#1074;
&#1087;&#1077;&#1088;&#1077;&#1084;&#1077;&#1085;&#1085;&#1086;&#1081;
g_pkEventObject
&#1085;&#1077;&#1086;&#1073;&#1093;&#1086;&#1076;&#1080;&#1084;&#1099;&#1081;
&#1085;&#1072;&#1084;
&#1091;&#1082;&#1072;&#1079;&#1072;&#1090;&#1077;&#1083;&#1100; &#1085;&#1072;
&#1086;&#1073;&#1098;&#1077;&#1082;&#1090;.</p>
<code><!--mstheme--></font>
<pre>                     invoke PsSetCreateProcessNotifyRoutine, ProcessNotifyRoutine, FALSE
                     mov [esi].IoStatus.Status, eax

</pre>
<!--mstheme--><font face="Arial, Arial, Helvetica"></code>
<p>&#1042;&#1099;&#1079;&#1086;&#1074;
&#1092;&#1091;&#1085;&#1082;&#1094;&#1080;&#1080;
PsSetCreateProcessNotifyRoutine
&#1079;&#1072;&#1089;&#1090;&#1072;&#1074;&#1083;&#1103;&#1077;&#1090;
&#1089;&#1080;&#1089;&#1090;&#1077;&#1084;&#1091;
&#1087;&#1086;&#1084;&#1077;&#1089;&#1090;&#1080;&#1090;&#1100;/&#1091;&#1076;&#1072;&#1083;&#1080;&#1090;&#1100;
&#1072;&#1076;&#1088;&#1077;&#1089; &#1085;&#1072;&#1096;&#1077;&#1081;
&#1087;&#1088;&#1086;&#1094;&#1077;&#1076;&#1091;&#1088;&#1099;
ProcessNotifyRoutine &#1074;/&#1080;&#1079;
&#1089;&#1087;&#1080;&#1089;&#1086;&#1082;
&#1087;&#1088;&#1086;&#1094;&#1077;&#1076;&#1091;&#1088;,
&#1082;&#1086;&#1090;&#1086;&#1088;&#1099;&#1077; &#1086;&#1085;&#1072; (&#1089;&#1080;&#1089;&#1090;&#1077;&#1084;&#1072;)
&#1073;&#1091;&#1076;&#1077;&#1090;
&#1074;&#1099;&#1079;&#1099;&#1074;&#1072;&#1090;&#1100; &#1087;&#1088;&#1080;
&#1089;&#1086;&#1079;&#1076;&#1072;&#1085;&#1080;&#1080; &#1080;&#1083;&#1080;
&#1091;&#1076;&#1072;&#1083;&#1077;&#1085;&#1080;&#1080;
&#1087;&#1088;&#1086;&#1094;&#1077;&#1089;&#1089;&#1072;. &#1050;
&#1089;&#1086;&#1078;&#1072;&#1083;&#1077;&#1085;&#1080;&#1102;,
&#1101;&#1090;&#1086;&#1090; &#1089;&#1087;&#1080;&#1089;&#1086;&#1082;
&#1086;&#1075;&#1088;&#1072;&#1085;&#1080;&#1095;&#1080;&#1074;&#1072;&#1077;&#1090;&#1089;&#1103;
&#1074;&#1086;&#1089;&#1100;&#1084;&#1100;&#1102;
&#1095;&#1083;&#1077;&#1085;&#1072;&#1084;&#1080;. &#1045;&#1089;&#1083;&#1080;
&#1074;&#1090;&#1086;&#1088;&#1086;&#1081;
&#1087;&#1072;&#1088;&#1072;&#1084;&#1077;&#1090;&#1088; FALSE,
&#1087;&#1088;&#1086;&#1094;&#1077;&#1076;&#1091;&#1088;&#1072;
&#1076;&#1086;&#1073;&#1072;&#1074;&#1083;&#1103;&#1077;&#1090;&#1089;&#1103;
&#1074; &#1089;&#1087;&#1080;&#1089;&#1086;&#1082;, &#1077;&#1089;&#1083;&#1080;
TRUE - &#1091;&#1076;&#1072;&#1083;&#1103;&#1077;&#1090;&#1089;&#1103;
&#1080;&#1079; &#1089;&#1087;&#1080;&#1089;&#1082;&#1072;. &#1042; DDK
&#1085;&#1072;&#1087;&#1080;&#1089;&#1072;&#1085;&#1086;, &#1095;&#1090;&#1086;
&#1077;&#1089;&#1083;&#1080; &#1076;&#1088;&#1072;&#1081;&#1074;&#1077;&#1088;
&#1091;&#1089;&#1087;&#1077;&#1096;&#1085;&#1086;
&#1079;&#1072;&#1088;&#1077;&#1075;&#1080;&#1089;&#1090;&#1088;&#1080;&#1088;&#1086;&#1074;&#1072;&#1083;
&#1089;&#1074;&#1086;&#1102;
&#1087;&#1088;&#1086;&#1094;&#1077;&#1076;&#1091;&#1088;&#1091;, &#1086;&#1085;
&#1076;&#1086;&#1083;&#1078;&#1077;&#1085;
&#1086;&#1089;&#1090;&#1072;&#1074;&#1072;&#1090;&#1100;&#1089;&#1103; &#1074;
&#1087;&#1072;&#1084;&#1103;&#1090;&#1080; &#1076;&#1086;
&#1074;&#1099;&#1082;&#1083;&#1102;&#1095;&#1077;&#1085;&#1080;&#1103;
&#1089;&#1080;&#1089;&#1090;&#1077;&#1084;&#1099;. &#1044;&#1083;&#1103;
&#1072;&#1085;&#1072;&#1083;&#1086;&#1075;&#1080;&#1095;&#1085;&#1099;&#1093;
&#1092;&#1091;&#1085;&#1082;&#1094;&#1080;&#1081; PsSetCreateThreadNotifyRoutine
&#1080; PsSetLoadImageNotifyRoutine &#1101;&#1090;&#1086;
&#1076;&#1077;&#1081;&#1089;&#1090;&#1074;&#1080;&#1090;&#1077;&#1083;&#1100;&#1085;&#1086;
&#1090;&#1072;&#1082; (&#1091; &#1085;&#1080;&#1093;
&#1074;&#1086;&#1086;&#1073;&#1097;&#1077; &#1085;&#1077;&#1090;
&#1087;&#1072;&#1088;&#1072;&#1084;&#1077;&#1090;&#1088;&#1072; Remove),
&#1085;&#1086; &#1076;&#1083;&#1103; PsSetCreateProcessNotifyRoutine
&#1085;&#1077;&#1090;. &#1055;&#1086;&#1089;&#1083;&#1077;
&#1089;&#1085;&#1103;&#1090;&#1080;&#1103;
&#1079;&#1072;&#1088;&#1077;&#1075;&#1080;&#1089;&#1090;&#1088;&#1080;&#1088;&#1086;&#1074;&#1072;&#1085;&#1085;&#1086;&#1081;
&#1087;&#1088;&#1086;&#1094;&#1077;&#1076;&#1091;&#1088;&#1099;,
&#1076;&#1088;&#1072;&#1081;&#1074;&#1077;&#1088;
&#1084;&#1086;&#1078;&#1077;&#1090; &#1073;&#1099;&#1090;&#1100;
&#1074;&#1099;&#1075;&#1088;&#1091;&#1078;&#1077;&#1085;.</p>
<code><!--mstheme--></font>
<pre>                     .if eax == STATUS_SUCCESS
 
                         mov g_fbNotifyRoutineSet, TRUE

</pre>
<!--mstheme--><font face="Arial, Arial, Helvetica"></code>
<p>&#1045;&#1089;&#1083;&#1080; &#1084;&#1099;
&#1091;&#1076;&#1072;&#1095;&#1085;&#1086;
&#1079;&#1072;&#1088;&#1077;&#1075;&#1080;&#1089;&#1090;&#1088;&#1080;&#1088;&#1086;&#1074;&#1072;&#1083;&#1080;&#1089;&#1100;,
&#1074;&#1099;&#1089;&#1090;&#1072;&#1074;&#1083;&#1103;&#1077;&#1084;
&#1075;&#1083;&#1086;&#1073;&#1072;&#1083;&#1100;&#1085;&#1099;&#1081;
&#1092;&#1083;&#1072;&#1075;.</p>
<code><!--mstheme--></font>
<pre>                         mov eax, pDeviceObject
                         mov eax, (DEVICE_OBJECT PTR [eax]).DriverObject
                         and (DRIVER_OBJECT PTR [eax]).DriverUnload, NULL

</pre>
<!--mstheme--><font face="Arial, Arial, Helvetica"></code>
<p>&#1044;&#1077;&#1083;&#1072;&#1077;&#1084;
&#1076;&#1088;&#1072;&#1081;&#1074;&#1077;&#1088;
&#1085;&#1077;&#1074;&#1099;&#1075;&#1088;&#1091;&#1078;&#1072;&#1077;&#1084;&#1099;&#1084;.
&#1069;&#1090;&#1086; &#1086;&#1095;&#1077;&#1085;&#1100;
&#1087;&#1088;&#1086;&#1089;&#1090;&#1086;&#1081; &#1080;
&#1101;&#1092;&#1092;&#1077;&#1082;&#1090;&#1080;&#1074;&#1085;&#1099;&#1081;
&#1089;&#1087;&#1086;&#1089;&#1086;&#1073;
&#1087;&#1088;&#1077;&#1076;&#1086;&#1090;&#1074;&#1088;&#1072;&#1090;&#1080;&#1090;&#1100;
&#1087;&#1088;&#1077;&#1078;&#1076;&#1077;&#1074;&#1088;&#1077;&#1084;&#1077;&#1085;&#1085;&#1091;&#1102;
&#1074;&#1099;&#1075;&#1088;&#1091;&#1079;&#1082;&#1091;
&#1076;&#1088;&#1072;&#1081;&#1074;&#1077;&#1088;&#1072;.
&#1045;&#1089;&#1083;&#1080; &#1085;&#1072;&#1096;&#1072;
&#1087;&#1088;&#1086;&#1075;&#1088;&#1072;&#1084;&#1084;&#1072;
&#1091;&#1087;&#1088;&#1072;&#1074;&#1083;&#1077;&#1085;&#1080;&#1103; (&#1087;&#1086;
&#1086;&#1096;&#1080;&#1073;&#1082;&#1077;) &#1080;&#1083;&#1080;
&#1082;&#1090;&#1086;-&#1090;&#1086; &#1076;&#1088;&#1091;&#1075;&#1086;&#1081;
&#1074;&#1099;&#1075;&#1088;&#1091;&#1079;&#1080;&#1090;
&#1076;&#1088;&#1072;&#1081;&#1074;&#1077;&#1088;, &#1090;&#1086;
&#1087;&#1088;&#1080;
&#1089;&#1083;&#1077;&#1076;&#1091;&#1102;&#1097;&#1077;&#1084;
&#1089;&#1086;&#1079;&#1076;&#1072;&#1085;&#1080;&#1080;/&#1091;&#1076;&#1072;&#1083;&#1077;&#1085;&#1080;&#1080;
&#1087;&#1088;&#1086;&#1094;&#1077;&#1089;&#1089;&#1072;
&#1073;&#1091;&#1076;&#1077;&#1090;
&#1074;&#1099;&#1079;&#1074;&#1072;&#1085;&#1072;
&#1087;&#1088;&#1086;&#1094;&#1077;&#1076;&#1091;&#1088;&#1072;,
&#1085;&#1072;&#1093;&#1086;&#1076;&#1080;&#1074;&#1096;&#1072;&#1103;&#1089;&#1103;
&#1074; &#1090;&#1077;&#1083;&#1077;
&#1076;&#1088;&#1072;&#1081;&#1074;&#1077;&#1088;&#1072; &#1052;&#1099;
&#1085;&#1077; &#1084;&#1086;&#1078;&#1077;&#1084;
&#1101;&#1090;&#1086;&#1075;&#1086;
&#1076;&#1086;&#1087;&#1091;&#1089;&#1090;&#1080;&#1090;&#1100;.</p>
<p>&#1048;&#1090;&#1072;&#1082;, &#1074;&#1089;&#1105;
&#1087;&#1088;&#1086;&#1096;&#1083;&#1086;
&#1091;&#1089;&#1087;&#1077;&#1096;&#1085;&#1086; &#1080; &#1084;&#1099;
&#1078;&#1076;&#1077;&#1084; &#1084;&#1086;&#1084;&#1077;&#1085;&#1090;&#1072;,
&#1082;&#1086;&#1075;&#1076;&#1072;
&#1082;&#1086;&#1083;&#1080;&#1095;&#1077;&#1089;&#1090;&#1074;&#1086;
&#1087;&#1088;&#1086;&#1094;&#1077;&#1089;&#1089;&#1086;&#1074; &#1074;
&#1089;&#1080;&#1089;&#1090;&#1077;&#1084;&#1077;
&#1080;&#1079;&#1084;&#1077;&#1085;&#1080;&#1090;&#1089;&#1103;.
&#1050;&#1072;&#1082; &#1090;&#1086;&#1083;&#1100;&#1082;&#1086;
&#1101;&#1090;&#1086;
&#1087;&#1088;&#1086;&#1080;&#1079;&#1086;&#1081;&#1076;&#1077;&#1090;,
&#1073;&#1091;&#1076;&#1077;&#1090;
&#1074;&#1099;&#1079;&#1074;&#1072;&#1085;&#1072; &#1085;&#1072;&#1096;&#1072;
ProcessNotifyRoutine.</p>
<br>
<br>
<p>&nbsp;<!--mstheme--></font>
<h2><!--mstheme--><font face="Arial, Arial, Helvetica" color="#CCCCCC">14.11
&#1055;&#1088;&#1086;&#1094;&#1077;&#1076;&#1091;&#1088;&#1072;
ProcessNotifyRoutine<!--mstheme--></font></h2>
<!--mstheme--><font face="Arial, Arial, Helvetica">
<p>&nbsp;</p>
<code><!--mstheme--></font>
<pre>     push eax
     invoke PsLookupProcessByProcessId, dwProcessId, esp
     pop peProcess
     .if eax == STATUS_SUCCESS
         mov fbDereference, TRUE
     .else
         invoke IoGetCurrentProcess
         mov peProcess, eax
         and fbDereference, FALSE
     .endif

</pre>
<!--mstheme--><font face="Arial, Arial, Helvetica"></code>
<p>&#1042; &#1087;&#1072;&#1088;&#1072;&#1084;&#1077;&#1090;&#1088;&#1077;
dwProcessId &#1089;&#1080;&#1089;&#1090;&#1077;&#1084;&#1072;
&#1087;&#1077;&#1088;&#1077;&#1076;&#1072;&#1077;&#1090; &#1085;&#1072;&#1084;
&#1080;&#1076;&#1077;&#1085;&#1090;&#1080;&#1092;&#1080;&#1082;&#1072;&#1090;&#1086;&#1088;
&#1089;&#1086;&#1079;&#1076;&#1072;&#1074;&#1072;&#1077;&#1084;&#1086;&#1075;&#1086;/&#1091;&#1076;&#1072;&#1083;&#1103;&#1077;&#1084;&#1086;&#1075;&#1086;
&#1087;&#1088;&#1086;&#1094;&#1077;&#1089;&#1089;&#1072;, &#1072;
&#1085;&#1072;&#1084; &#1085;&#1091;&#1078;&#1077;&#1085;
&#1091;&#1082;&#1072;&#1079;&#1072;&#1090;&#1077;&#1083;&#1100; &#1085;&#1072;
&#1086;&#1073;&#1098;&#1077;&#1082;&#1090; &quot;&#1087;&#1088;&#1086;&#1094;&#1077;&#1089;&#1089;&quot;.
&#1044;&#1083;&#1103; &#1085;&#1072;&#1095;&#1072;&#1083;&#1072;
&#1074;&#1099;&#1079;&#1099;&#1074;&#1072;&#1077;&#1084;
PsLookupProcessByProcessId, &#1080; &#1077;&#1089;&#1083;&#1080;
&#1086;&#1085;&#1072; &#1074;&#1077;&#1088;&#1085;&#1077;&#1090;
&#1086;&#1096;&#1080;&#1073;&#1082;&#1091; - IoGetCurrentProcess.
&#1044;&#1077;&#1083;&#1086; &#1074; &#1090;&#1086;&#1084;,
&#1095;&#1090;&#1086; &#1074; Windows 2000 PsLookupProcessByProcessId
&#1085;&#1077; &#1088;&#1072;&#1073;&#1086;&#1090;&#1072;&#1077;&#1090;,
&#1077;&#1089;&#1083;&#1080; &#1074;&#1099;&#1079;&#1074;&#1072;&#1085;&#1072;
&#1074; &#1082;&#1086;&#1085;&#1090;&#1077;&#1082;&#1089;&#1090;&#1077;
&#1087;&#1088;&#1086;&#1094;&#1077;&#1089;&#1089;&#1072;,
&#1080;&#1076;&#1077;&#1085;&#1090;&#1080;&#1092;&#1080;&#1082;&#1072;&#1090;&#1086;&#1088;
&#1082;&#1086;&#1090;&#1086;&#1088;&#1086;&#1075;&#1086; &#1077;&#1081;
&#1087;&#1077;&#1088;&#1077;&#1076;&#1072;&#1085; (&#1074;&#1086;&#1079;&#1084;&#1086;&#1078;&#1085;&#1086;,
&#1101;&#1090;&#1086; &#1090;&#1072;&#1082;
&#1090;&#1086;&#1083;&#1100;&#1082;&#1086; &#1085;&#1072;
&#1101;&#1090;&#1072;&#1087;&#1077;
&#1091;&#1076;&#1072;&#1083;&#1077;&#1085;&#1080;&#1103;
&#1087;&#1088;&#1086;&#1094;&#1077;&#1089;&#1089;&#1072; - &#1103;
&#1101;&#1090;&#1086;&#1075;&#1086; &#1085;&#1077;
&#1087;&#1088;&#1086;&#1074;&#1077;&#1088;&#1103;&#1083;). &#1069;&#1090;&#1086;
&#1073;&#1091;&#1076;&#1077;&#1090;
&#1087;&#1088;&#1086;&#1080;&#1089;&#1093;&#1086;&#1076;&#1080;&#1090;&#1100;
&#1087;&#1088;&#1080; &#1091;&#1076;&#1072;&#1083;&#1077;&#1085;&#1080;&#1080;
&#1087;&#1088;&#1086;&#1094;&#1077;&#1089;&#1089;&#1072;. &#1055;&#1088;&#1080;
&#1089;&#1086;&#1079;&#1076;&#1072;&#1085;&#1080;&#1080; &#1084;&#1099;
&#1086;&#1082;&#1072;&#1078;&#1077;&#1084;&#1089;&#1103; &#1074;
&#1082;&#1086;&#1085;&#1090;&#1077;&#1082;&#1089;&#1090;&#1077;
&#1087;&#1088;&#1086;&#1094;&#1077;&#1089;&#1089;&#1072;-&#1088;&#1086;&#1076;&#1080;&#1090;&#1077;&#1083;&#1103;.
&#1058;.&#1086;. &#1090;&#1077;&#1084; &#1080;&#1083;&#1080;
&#1080;&#1085;&#1099;&#1084;
&#1089;&#1087;&#1086;&#1089;&#1086;&#1073;&#1086;&#1084; &#1084;&#1099;
&#1074;&#1089;&#1105; &#1078;&#1077;
&#1087;&#1086;&#1083;&#1091;&#1095;&#1072;&#1077;&#1084;
&#1091;&#1082;&#1072;&#1079;&#1072;&#1090;&#1077;&#1083;&#1100; &#1085;&#1072;
&#1080;&#1085;&#1090;&#1077;&#1088;&#1077;&#1089;&#1091;&#1102;&#1097;&#1080;&#1081;
&#1085;&#1072;&#1089; &#1086;&#1073;&#1098;&#1077;&#1082;&#1090;.
&#1055;&#1086;&#1089;&#1082;&#1086;&#1083;&#1100;&#1082;&#1091;
PsLookupProcessByProcessId
&#1091;&#1074;&#1077;&#1083;&#1080;&#1095;&#1080;&#1074;&#1072;&#1077;&#1090;
&#1089;&#1095;&#1077;&#1090;&#1095;&#1080;&#1082;
&#1089;&#1089;&#1099;&#1083;&#1086;&#1082; &#1085;&#1072;
&#1086;&#1073;&#1098;&#1077;&#1082;&#1090;, &#1072; IoGetCurrentProcess
&#1085;&#1077;&#1090;,
&#1080;&#1089;&#1087;&#1086;&#1083;&#1100;&#1079;&#1091;&#1077;&#1084;
&#1092;&#1083;&#1072;&#1075; fbDereference.</p>
<code><!--mstheme--></font>
<pre>     mov eax, dwProcessId
     mov g_ProcessData.dwProcessId, eax
 
     mov eax, bCreate
     mov g_ProcessData.bCreate, eax

</pre>
<!--mstheme--><font face="Arial, Arial, Helvetica"></code>
<p>&#1047;&#1072;&#1087;&#1080;&#1089;&#1099;&#1074;&#1072;&#1077;&#1084;
&#1074; &#1089;&#1090;&#1088;&#1091;&#1082;&#1090;&#1091;&#1088;&#1091;
PROCESS_DATA
&#1080;&#1076;&#1077;&#1085;&#1090;&#1080;&#1092;&#1080;&#1082;&#1072;&#1090;&#1086;&#1088;
&#1087;&#1088;&#1086;&#1094;&#1077;&#1089;&#1089;&#1072; &#1080;
&#1092;&#1083;&#1072;&#1075;,
&#1086;&#1087;&#1088;&#1077;&#1076;&#1077;&#1083;&#1103;&#1102;&#1097;&#1080;&#1081;,
&#1089;&#1086;&#1079;&#1076;&#1072;&#1077;&#1090;&#1089;&#1103;
&#1087;&#1088;&#1086;&#1094;&#1077;&#1089;&#1089; &#1080;&#1083;&#1080;
&#1091;&#1076;&#1072;&#1083;&#1103;&#1077;&#1090;&#1089;&#1103;.</p>
<code><!--mstheme--></font>
<pre>     invoke memset, addr g_ProcessData.szProcessPath, 0, IMAGE_FILE_PATH_LEN

</pre>
<!--mstheme--><font face="Arial, Arial, Helvetica"></code>
<p>&#1043;&#1086;&#1090;&#1086;&#1074;&#1080;&#1084;
&#1084;&#1077;&#1089;&#1090;&#1086; &#1076;&#1083;&#1103;
&#1087;&#1091;&#1090;&#1080; &#1082; &#1086;&#1073;&#1088;&#1072;&#1079;&#1091;.</p>
<code><!--mstheme--></font>
<pre>     invoke GetImageFilePath, peProcess, addr us
     .if eax == STATUS_SUCCESS
 
         lea eax, g_ProcessData.szProcessPath
         mov as.Buffer,          eax
         mov as.MaximumLength,   IMAGE_FILE_PATH_LEN
         and as._Length,         0
 
         invoke RtlUnicodeStringToAnsiString, addr as, addr us, FALSE
 
         invoke ExFreePool, us.Buffer

</pre>
<!--mstheme--><font face="Arial, Arial, Helvetica"></code>
<p>&#1059;&#1076;&#1072;&#1095;&#1085;&#1099;&#1081;
&#1074;&#1099;&#1079;&#1086;&#1074; GetImageFilePath
&#1074;&#1077;&#1088;&#1085;&#1077;&#1090; &#1085;&#1072;&#1084; &#1074;
us.Buffer unicode-&#1089;&#1090;&#1088;&#1086;&#1082;&#1091; &#1089;
&#1087;&#1086;&#1083;&#1085;&#1099;&#1084; &#1087;&#1091;&#1090;&#1077;&#1084;
&#1082; &#1086;&#1073;&#1088;&#1072;&#1079;&#1091;
&#1089;&#1086;&#1079;&#1076;&#1072;&#1074;&#1096;&#1077;&#1084;&#1091;
&#1087;&#1088;&#1086;&#1094;&#1077;&#1089;&#1089;.
&#1055;&#1088;&#1077;&#1086;&#1073;&#1088;&#1072;&#1079;&#1091;&#1077;&#1084;
&#1077;&#1105; &#1074; ansi-&#1089;&#1090;&#1088;&#1086;&#1082;&#1091; &#1080;
&#1079;&#1072;&#1087;&#1080;&#1096;&#1077;&#1084; &#1087;&#1086;
&#1072;&#1076;&#1088;&#1077;&#1089;&#1091; g_ProcessData.szProcessPath
&#1086;&#1076;&#1085;&#1080;&#1084;
&#1074;&#1099;&#1079;&#1086;&#1074;&#1086;&#1084;
&#1092;&#1091;&#1085;&#1082;&#1094;&#1080;&#1080; RtlUnicodeStringToAnsiString.
&#1058;.&#1082;. GetImageFilePath &#1089;&#1072;&#1084;&#1072;
&#1074;&#1099;&#1076;&#1077;&#1083;&#1103;&#1077;&#1090;
&#1073;&#1091;&#1092;&#1077;&#1088;, &#1090;&#1086;
&#1087;&#1086;&#1089;&#1083;&#1077;
&#1091;&#1076;&#1072;&#1095;&#1085;&#1086;&#1075;&#1086; &#1077;&#1105;
&#1074;&#1099;&#1079;&#1086;&#1074;&#1072; &#1101;&#1090;&#1086;&#1090;
&#1073;&#1091;&#1092;&#1077;&#1088;
&#1085;&#1077;&#1086;&#1073;&#1093;&#1086;&#1076;&#1080;&#1084;&#1086;
&#1086;&#1089;&#1074;&#1086;&#1073;&#1086;&#1076;&#1080;&#1090;&#1100;.</p>
<code><!--mstheme--></font>
<pre>     .else
 
         mov eax, g_dwImageFileNameOffset
         .if eax != 0
             add eax, peProcess
             invoke memcpy, addr g_ProcessData.szProcessPath, eax, 16
         .endif
 
     .endif

</pre>
<!--mstheme--><font face="Arial, Arial, Helvetica"></code>
<p>&#1045;&#1089;&#1083;&#1080; &#1085;&#1072;&#1084; &#1085;&#1077;
&#1091;&#1076;&#1072;&#1077;&#1090;&#1089;&#1103;
&#1087;&#1086;&#1083;&#1091;&#1095;&#1080;&#1090;&#1100;
&#1087;&#1086;&#1083;&#1085;&#1099;&#1081; &#1087;&#1091;&#1090;&#1100;,
&#1090;&#1086; &#1073;&#1091;&#1076;&#1077;&#1084;
&#1076;&#1086;&#1074;&#1086;&#1083;&#1100;&#1089;&#1090;&#1074;&#1086;&#1074;&#1072;&#1090;&#1100;&#1089;&#1103;
&#1090;&#1086;&#1083;&#1100;&#1082;&#1086;
&#1080;&#1084;&#1077;&#1085;&#1077;&#1084;
&#1087;&#1088;&#1086;&#1094;&#1077;&#1089;&#1089;&#1072;,
&#1080;&#1079;&#1074;&#1083;&#1077;&#1082;&#1072;&#1077;&#1084;&#1099;&#1084;
&#1080;&#1079; &#1089;&#1090;&#1088;&#1091;&#1082;&#1090;&#1091;&#1088;&#1099;
EPROCESS. &#1053;&#1072;&#1087;&#1086;&#1084;&#1080;&#1085;&#1072;&#1102;
&#1086; &#1090;&#1086;&#1084;, &#1095;&#1090;&#1086;
&#1077;&#1089;&#1083;&#1080; &#1076;&#1083;&#1080;&#1085;&#1072;
&#1101;&#1090;&#1086;&#1075;&#1086; &#1080;&#1084;&#1077;&#1085;&#1080;
&#1087;&#1088;&#1077;&#1074;&#1099;&#1096;&#1072;&#1077;&#1090; 16
&#1089;&#1080;&#1084;&#1074;&#1086;&#1083;&#1086;&#1074; (ansi), &#1090;&#1086;
&#1086;&#1085;&#1086;
&#1091;&#1089;&#1077;&#1082;&#1072;&#1077;&#1090;&#1089;&#1103; &#1080;, &#1074;
&#1101;&#1090;&#1086;&#1084; &#1089;&#1083;&#1091;&#1095;&#1072;&#1077;,
&#1085;&#1077;
&#1079;&#1072;&#1074;&#1077;&#1088;&#1096;&#1072;&#1077;&#1090;&#1089;&#1103;
&#1085;&#1091;&#1083;&#1077;&#1084;.
&#1055;&#1086;&#1101;&#1090;&#1086;&#1084;&#1091;
&#1082;&#1086;&#1087;&#1080;&#1088;&#1091;&#1077;&#1084;
&#1088;&#1086;&#1074;&#1085;&#1086; 16 &#1073;&#1072;&#1081;&#1090;.</p>
<code><!--mstheme--></font>
<pre>     .if fbDereference
         fastcall ObfDereferenceObject, peProcess
     .endif

</pre>
<!--mstheme--><font face="Arial, Arial, Helvetica"></code>
<p>&#1045;&#1089;&#1083;&#1080; &#1092;&#1083;&#1072;&#1075; fbDereference
&#1091;&#1089;&#1090;&#1072;&#1085;&#1086;&#1074;&#1083;&#1077;&#1085;,
&#1091;&#1084;&#1077;&#1085;&#1100;&#1096;&#1072;&#1077;&#1084;
&#1089;&#1095;&#1077;&#1090;&#1095;&#1080;&#1082;
&#1089;&#1089;&#1099;&#1083;&#1086;&#1082; &#1085;&#1072;
&#1086;&#1073;&#1098;&#1077;&#1082;&#1090;.</p>
<code><!--mstheme--></font>
<pre>     invoke KeSetEvent, g_pkEventObject, 0, FALSE

</pre>
<!--mstheme--><font face="Arial, Arial, Helvetica"></code>
<p>&#1058;&#1077;&#1087;&#1077;&#1088;&#1100;
&#1084;&#1086;&#1078;&#1085;&#1086; &quot;&#1087;&#1086;&#1089;&#1080;&#1075;&#1085;&#1072;&#1083;&#1080;&#1090;&#1100;&quot;
&#1085;&#1072;&#1096;&#1077;&#1081;
&#1087;&#1088;&#1086;&#1075;&#1088;&#1072;&#1084;&#1084;&#1077;
&#1091;&#1087;&#1088;&#1072;&#1074;&#1083;&#1077;&#1085;&#1080;&#1103;.
&#1055;&#1077;&#1088;&#1077;&#1074;&#1086;&#1076;
&#1086;&#1073;&#1098;&#1077;&#1082;&#1090;&#1072; &quot;&#1089;&#1086;&#1073;&#1099;&#1090;&#1080;&#1077;&quot;
&#1074; &#1089;&#1080;&#1075;&#1085;&#1072;&#1083;&#1100;&#1085;&#1086;&#1077;
&#1089;&#1086;&#1089;&#1090;&#1086;&#1103;&#1085;&#1080;&#1077;
&#1087;&#1088;&#1086;&#1073;&#1091;&#1078;&#1076;&#1072;&#1077;&#1090;
&#1087;&#1086;&#1083;&#1100;&#1079;&#1086;&#1074;&#1072;&#1090;&#1077;&#1083;&#1100;&#1089;&#1082;&#1080;&#1081;
&#1088;&#1072;&#1073;&#1086;&#1095;&#1080;&#1081;
&#1087;&#1086;&#1090;&#1086;&#1082;.
&#1055;&#1088;&#1086;&#1073;&#1091;&#1076;&#1080;&#1074;&#1096;&#1080;&#1089;&#1100;,
&#1086;&#1085; &#1087;&#1086;&#1096;&#1083;&#1077;&#1090;
&#1076;&#1088;&#1072;&#1081;&#1074;&#1077;&#1088;&#1091;
&#1091;&#1087;&#1088;&#1072;&#1074;&#1083;&#1103;&#1102;&#1097;&#1080;&#1081;
&#1082;&#1086;&#1076; IOCTL_GET_PROCESS_DATA &#1080;
&#1079;&#1072;&#1073;&#1077;&#1088;&#1077;&#1090;
&#1080;&#1085;&#1092;&#1086;&#1088;&#1084;&#1072;&#1094;&#1080;&#1102; &#1086;
&#1087;&#1088;&#1086;&#1094;&#1077;&#1089;&#1089;&#1077;.</p>
<br>
<br>
<p>&nbsp;<!--mstheme--></font>
<h2><!--mstheme--><font face="Arial, Arial, Helvetica" color="#CCCCCC">14.12
&#1054;&#1073;&#1088;&#1072;&#1073;&#1072;&#1090;&#1099;&#1074;&#1072;&#1077;&#1084;
IOCTL_REMOVE_NOTIFY<!--mstheme--></font></h2>
<!--mstheme--><font face="Arial, Arial, Helvetica">
<p>&nbsp;</p>
<p>&#1058;&#1091;&#1090; &#1074;&#1089;&#1105; &#1090;&#1086; &#1078;&#1077;
&#1089;&#1072;&#1084;&#1086;&#1077;, &#1095;&#1090;&#1086; &#1084;&#1099;
&#1076;&#1077;&#1083;&#1072;&#1083;&#1080; &#1087;&#1088;&#1080;
&#1086;&#1073;&#1088;&#1072;&#1073;&#1086;&#1090;&#1082;&#1077; IOCTL_SET_NOTIFY,
&#1085;&#1086; &#1085;&#1072;&#1086;&#1073;&#1086;&#1088;&#1086;&#1090;.</p>
<code><!--mstheme--></font>
<pre>			invoke PsSetCreateProcessNotifyRoutine, ProcessNotifyRoutine, TRUE
			mov [esi].IoStatus.Status, eax

</pre>
<!--mstheme--><font face="Arial, Arial, Helvetica"></code>
<p>&#1059;&#1074;&#1077;&#1076;&#1086;&#1084;&#1083;&#1077;&#1085;&#1080;&#1103;
&#1089;&#1080;&#1089;&#1090;&#1077;&#1084;&#1099; &#1086;
&#1089;&#1086;&#1079;&#1076;&#1072;&#1085;&#1080;&#1080;/&#1091;&#1076;&#1072;&#1083;&#1077;&#1085;&#1080;&#1080;
&#1087;&#1088;&#1086;&#1094;&#1077;&#1089;&#1089;&#1086;&#1074;
&#1085;&#1072;&#1084; &#1073;&#1086;&#1083;&#1100;&#1096;&#1077; &#1085;&#1077;
&#1085;&#1091;&#1078;&#1085;&#1099;. &#1050;&#1072;&#1082; &#1103;
&#1091;&#1078;&#1077; &#1089;&#1082;&#1072;&#1079;&#1072;&#1083;, DDK
&#1085;&#1072;&#1089;
&#1086;&#1073;&#1084;&#1072;&#1085;&#1099;&#1074;&#1072;&#1077;&#1090;, &#1080;
&#1089;&#1085;&#1103;&#1090;&#1100;
&#1091;&#1074;&#1077;&#1076;&#1086;&#1084;&#1083;&#1077;&#1085;&#1080;&#1077;
&#1074;&#1089;&#1105; &#1078;&#1077; &#1084;&#1086;&#1078;&#1085;&#1086;.</p>
<code><!--mstheme--></font>
<pre>				or liDelayTime.HighPart, -1
				mov liDelayTime.LowPart, -1000000
	
				invoke KeDelayExecutionThread, KernelMode, FALSE, addr liDelayTime

</pre>
<!--mstheme--><font face="Arial, Arial, Helvetica"></code>
<p>&#1053;&#1072; &#1074;&#1089;&#1103;&#1082;&#1080;&#1081;
&#1089;&#1083;&#1091;&#1095;&#1072;&#1081;, &#1095;&#1091;&#1090;&#1100;-&#1095;&#1091;&#1090;&#1100;
&#1087;&#1086;&#1076;&#1086;&#1078;&#1076;&#1077;&#1084;, &#1090;.&#1082;.
&#1090;&#1077;&#1086;&#1088;&#1077;&#1090;&#1080;&#1095;&#1077;&#1089;&#1082;&#1080;
&#1074;&#1086;&#1079;&#1084;&#1086;&#1078;&#1085;&#1086;, &#1095;&#1090;&#1086;
&#1082;&#1072;&#1082; &#1088;&#1072;&#1079; &#1074; &#1101;&#1090;&#1086;&#1090;
&#1084;&#1086;&#1084;&#1077;&#1085;&#1090;
&#1089;&#1080;&#1089;&#1090;&#1077;&#1084;&#1072;
&#1089;&#1086;&#1079;&#1076;&#1072;&#1077;&#1090; &#1080;&#1083;&#1080;
&#1091;&#1076;&#1072;&#1083;&#1103;&#1077;&#1090;
&#1082;&#1072;&#1082;&#1086;&#1081;-&#1085;&#1080;&#1073;&#1091;&#1076;&#1100;
&#1087;&#1088;&#1086;&#1094;&#1077;&#1089;&#1089; &#1080;
&#1085;&#1072;&#1093;&#1086;&#1076;&#1080;&#1090;&#1089;&#1103;
&#1082;&#1072;&#1082; &#1088;&#1072;&#1079; &#1074;
&#1085;&#1072;&#1096;&#1077;&#1081;
&#1087;&#1088;&#1086;&#1094;&#1077;&#1076;&#1091;&#1088;&#1077;
ProcessNotifyRoutine. &#1053;&#1072; &#1089;&#1072;&#1084;&#1086;&#1084;
&#1076;&#1077;&#1083;&#1077; &#1103; &#1091;&#1074;&#1077;&#1088;&#1077;&#1085;,
&#1095;&#1090;&#1086; &#1090;&#1072;&#1082;&#1072;&#1103;
&#1089;&#1080;&#1090;&#1091;&#1072;&#1094;&#1080;&#1103;
&#1085;&#1077;&#1074;&#1086;&#1079;&#1084;&#1086;&#1078;&#1085;&#1072;,
&#1085;&#1086; &#1076;&#1083;&#1103; &#1090;&#1086;&#1075;&#1086;
&#1095;&#1090;&#1086;&#1073;&#1099; &#1101;&#1090;&#1086;
&#1091;&#1090;&#1074;&#1077;&#1088;&#1078;&#1076;&#1072;&#1090;&#1100;
&#1085;&#1072;&#1076;&#1086;
&#1087;&#1086;&#1090;&#1088;&#1072;&#1090;&#1080;&#1090;&#1100;
&#1085;&#1077;&#1082;&#1086;&#1090;&#1086;&#1088;&#1086;&#1077;
&#1074;&#1088;&#1077;&#1084;&#1103; &#1085;&#1072;
&#1080;&#1089;&#1089;&#1083;&#1077;&#1076;&#1086;&#1074;&#1072;&#1085;&#1080;&#1103;,
&#1072; &#1077;&#1075;&#1086; &#1082;&#1072;&#1082;
&#1074;&#1089;&#1077;&#1075;&#1076;&#1072; &#1085;&#1077;
&#1093;&#1074;&#1072;&#1090;&#1072;&#1077;&#1090;. &#1042;
&#1083;&#1102;&#1073;&#1086;&#1084; &#1089;&#1083;&#1091;&#1095;&#1072;&#1077;,
&#1085;&#1077;&#1073;&#1086;&#1083;&#1100;&#1096;&#1072;&#1103;
&#1079;&#1072;&#1076;&#1077;&#1088;&#1078;&#1082;&#1072; &#1085;&#1077;
&#1087;&#1086;&#1074;&#1088;&#1077;&#1076;&#1080;&#1090;.</p>
<code><!--mstheme--></font>
<pre>				mov eax, pDeviceObject
				mov eax, (DEVICE_OBJECT PTR [eax]).DriverObject
				mov (DRIVER_OBJECT PTR [eax]).DriverUnload, offset DriverUnload

				.if g_pkEventObject != NULL
					invoke ObDereferenceObject, g_pkEventObject
					and g_pkEventObject, NULL
				.endif

</pre>
<!--mstheme--><font face="Arial, Arial, Helvetica"></code>
<p>&#1058;&#1077;&#1087;&#1077;&#1088;&#1100;
&#1076;&#1088;&#1072;&#1081;&#1074;&#1077;&#1088;
&#1084;&#1086;&#1078;&#1085;&#1086;
&#1073;&#1077;&#1079;&#1086;&#1087;&#1072;&#1089;&#1085;&#1086;
&#1074;&#1099;&#1075;&#1088;&#1091;&#1079;&#1080;&#1090;&#1100;, &#1072;
&#1089;&#1095;&#1077;&#1090;&#1095;&#1080;&#1082;
&#1089;&#1089;&#1099;&#1083;&#1086;&#1082; &#1085;&#1072;
&#1086;&#1073;&#1098;&#1077;&#1082;&#1090; &quot;&#1089;&#1086;&#1073;&#1099;&#1090;&#1080;&#1077;&quot;
&#1074;&#1077;&#1088;&#1085;&#1091;&#1090;&#1100; &#1074;
&#1087;&#1088;&#1077;&#1078;&#1085;&#1077;&#1077;
&#1089;&#1086;&#1089;&#1090;&#1086;&#1103;&#1085;&#1080;&#1077;.</p>
<p>&#1058;&#1072;&#1082;&#1080;&#1084;
&#1086;&#1073;&#1088;&#1072;&#1079;&#1086;&#1084;,
&#1086;&#1073;&#1098;&#1077;&#1082;&#1090; &quot;&#1089;&#1086;&#1073;&#1099;&#1090;&#1080;&#1077;&quot;
&#1080;&#1089;&#1087;&#1086;&#1083;&#1100;&#1079;&#1091;&#1077;&#1090;&#1089;&#1103;
&#1076;&#1088;&#1072;&#1081;&#1074;&#1077;&#1088;&#1086;&#1084;
&#1076;&#1083;&#1103;
&#1074;&#1079;&#1072;&#1080;&#1084;&#1086;&#1076;&#1077;&#1081;&#1089;&#1090;&#1074;&#1080;&#1103;
&#1089; &#1087;&#1088;&#1086;&#1075;&#1088;&#1072;&#1084;&#1084;&#1086;&#1081;
&#1091;&#1087;&#1088;&#1072;&#1074;&#1083;&#1077;&#1085;&#1080;&#1103;.
&#1042;&#1089;&#1105;, &#1095;&#1090;&#1086; &#1084;&#1099;
&#1086;&#1073;&#1089;&#1091;&#1076;&#1080;&#1084; &#1085;&#1080;&#1078;&#1077;,
&#1085;&#1086;&#1089;&#1080;&#1090;
&#1092;&#1072;&#1082;&#1091;&#1083;&#1100;&#1090;&#1072;&#1090;&#1080;&#1074;&#1085;&#1099;&#1081;
&#1093;&#1072;&#1088;&#1072;&#1082;&#1090;&#1077;&#1088; &#1080;
&#1087;&#1088;&#1103;&#1084;&#1086;&#1075;&#1086;
&#1086;&#1090;&#1085;&#1086;&#1096;&#1077;&#1085;&#1080;&#1103; &#1082;
&#1090;&#1077;&#1084;&#1077; &#1089;&#1090;&#1072;&#1090;&#1100;&#1080;
&#1085;&#1077; &#1080;&#1084;&#1077;&#1077;&#1090;.</p>
<br>
<br>
<p>&nbsp;<!--mstheme--></font>
<h2><!--mstheme--><font face="Arial, Arial, Helvetica" color="#CCCCCC">14.13
&#1048;&#1097;&#1077;&#1084; &#1087;&#1086;&#1083;&#1085;&#1099;&#1081;
&#1087;&#1091;&#1090;&#1100;<!--mstheme--></font></h2>
<!--mstheme--><font face="Arial, Arial, Helvetica">
<p>&nbsp;</p>
<p>&#1061;&#1086;&#1088;&#1086;&#1096;&#1086;, &#1095;&#1090;&#1086; &#1074;
&#1089;&#1090;&#1088;&#1091;&#1082;&#1090;&#1091;&#1088;&#1077; EPROCESS
&#1087;&#1088;&#1080;&#1089;&#1091;&#1090;&#1089;&#1090;&#1074;&#1091;&#1077;&#1090;
&#1080;&#1084;&#1103; &#1087;&#1088;&#1086;&#1094;&#1077;&#1089;&#1089;&#1072;.
&#1044;&#1086;&#1089;&#1090;&#1072;&#1090;&#1100; &#1077;&#1075;&#1086;
&#1086;&#1090;&#1090;&#1091;&#1076;&#1072; &#1085;&#1077;
&#1087;&#1088;&#1077;&#1076;&#1089;&#1090;&#1072;&#1074;&#1083;&#1103;&#1077;&#1090;
&#1073;&#1086;&#1083;&#1100;&#1096;&#1086;&#1075;&#1086;
&#1090;&#1088;&#1091;&#1076;&#1072;, &#1085;&#1086; &#1073;&#1099;&#1083;&#1086;
&#1073;&#1099; &#1085;&#1077;&#1087;&#1083;&#1086;&#1093;&#1086;
&#1087;&#1086;&#1083;&#1091;&#1095;&#1080;&#1090;&#1100;
&#1087;&#1086;&#1083;&#1085;&#1099;&#1081; &#1087;&#1091;&#1090;&#1100; &#1082;
&#1086;&#1073;&#1088;&#1072;&#1079;&#1091; &#1092;&#1072;&#1081;&#1083;&#1072;,
&#1089;&#1086;&#1079;&#1076;&#1072;&#1074;&#1096;&#1077;&#1084;&#1091;
&#1087;&#1088;&#1086;&#1094;&#1077;&#1089;&#1089;.
&#1057;&#1076;&#1077;&#1083;&#1072;&#1090;&#1100; &#1101;&#1090;&#1086;
&#1075;&#1086;&#1088;&#1072;&#1079;&#1076;&#1086;
&#1089;&#1083;&#1086;&#1078;&#1085;&#1077;&#1077;. &#1045;&#1089;&#1083;&#1080;
&#1082;&#1086;&#1088;&#1086;&#1090;&#1082;&#1086;, &#1080; &#1103;
&#1085;&#1077; &#1086;&#1090;&#1082;&#1088;&#1099;&#1074;&#1072;&#1102;
&#1079;&#1076;&#1077;&#1089;&#1100;
&#1040;&#1084;&#1077;&#1088;&#1080;&#1082;&#1091;, &#1090;&#1086;
&#1085;&#1077;&#1086;&#1073;&#1093;&#1086;&#1076;&#1080;&#1084;&#1086;
&#1087;&#1088;&#1086;&#1081;&#1090;&#1080; &#1087;&#1086;
&#1089;&#1083;&#1077;&#1076;&#1091;&#1102;&#1097;&#1077;&#1084;&#1091;
&#1084;&#1072;&#1088;&#1096;&#1088;&#1091;&#1090;&#1091;: SECTION.Segment -&gt;
SEGMENT.ControlArea -&gt; CONTROL_AREA.FilePointer -&gt; FILE_OBJECT.FileName
-&gt; UNICODE_STRING.Buffer.
&#1053;&#1077;&#1082;&#1086;&#1090;&#1086;&#1088;&#1099;&#1077;
&#1074;&#1079;&#1072;&#1080;&#1084;&#1086;&#1089;&#1074;&#1103;&#1079;&#1080;
&#1101;&#1090;&#1080;&#1093;
&#1089;&#1090;&#1088;&#1091;&#1082;&#1090;&#1091;&#1088;
&#1087;&#1086;&#1082;&#1072;&#1079;&#1072;&#1085;&#1099; &#1085;&#1072;
&#1088;&#1080;&#1089;&#1091;&#1085;&#1082;&#1077; 14-4.</p>
<p align="center"><img src="file:///L:/Xack/Assembler,C,%20Delphi%20&#1056;&#1105;%20&#1057;&#1027;&#1056;&#1105;&#1057;&#1027;.&#1056;&#1111;&#1057;&#1026;&#1056;&#1109;&#1056;&#1110;&#1057;&#1026;&#1056;&#1056;&#1112;&#1056;&#1112;&#1056;&#1105;&#1057;&#1026;&#1056;&#1109;&#1056;&#1030;&#1056;&#1056;&#1029;&#1056;&#1105;&#1056;%20Forever!!!/[W%20A%20S%20M%20_%20R%20U]%20&#1057;&#1058;&#1040;&#1058;&#1068;&#1048;%20%20&#1057;&#1077;&#1082;&#1088;&#1077;&#1090;&#1099;%20Win32%20%20&#1044;&#1088;&#1072;&#1081;&#1074;&#1077;&#1088;&#1099;%20&#1088;&#1077;&#1078;&#1080;&#1084;&#1072;%20&#1103;&#1076;&#1088;&#1072;%20&#1063;&#1072;&#1089;&#1090;&#1100;%2014%20&#1041;&#1072;&#1079;&#1086;&#1074;&#1072;&#1103;%20&#1090;&#1077;&#1093;&#1085;&#1080;&#1082;&#1072;_%20&#1057;&#1080;&#1085;&#1093;&#1088;&#1086;&#1085;&#1080;&#1079;&#1072;&#1094;&#1080;&#1103;%20&#1048;&#1089;&#1087;&#1086;&#1083;&#1100;&#1079;&#1086;&#1074;&#1072;&#1085;&#1080;&#1077;%20&#1086;&#1073;&#1098;&#1077;&#1082;&#1090;&#1072;%20&#1089;&#1086;&#1073;&#1099;&#1090;&#1080;&#1077;%20&#1076;&#1083;&#1103;%20&#1074;&#1079;&#1072;&#1080;&#1084;&#1086;&#1076;&#1077;&#1081;&#1089;&#1090;&#1074;&#1080;&#1103;%20&#1076;&#1088;&#1072;&#1081;&#1074;&#1077;&#1088;&#1072;%20&#1089;%20&#1087;&#1088;&#1086;&#1075;&#1088;&#1072;&#1084;&#1084;&#1086;&#1081;%20&#1091;&#1087;&#1088;&#1072;&#1074;&#1083;&#1077;&#1085;&#1080;&#1103;.files/kmd14-4.png"><center>
<p><b>&#1056;&#1080;&#1089;. 14-4.</b>
&#1053;&#1077;&#1082;&#1086;&#1090;&#1086;&#1088;&#1099;&#1077;
&#1074;&#1079;&#1072;&#1080;&#1084;&#1086;&#1089;&#1074;&#1103;&#1079;&#1080;
&#1089;&#1090;&#1088;&#1091;&#1082;&#1090;&#1091;&#1088; SECTION, SEGMENT,
CONTROL_AREA,FILE_OBJECT &#1080; SECTION_OBJECT_POINTERS</center>
<p>&#1053;&#1077;&#1082;&#1086;&#1090;&#1086;&#1088;&#1099;&#1077;
&#1080;&#1079; &#1101;&#1090;&#1080;&#1093;
&#1089;&#1090;&#1088;&#1091;&#1082;&#1090;&#1091;&#1088;
&#1076;&#1086;&#1082;&#1091;&#1084;&#1077;&#1085;&#1090;&#1080;&#1088;&#1086;&#1074;&#1072;&#1085;&#1099;,
&#1085;&#1077;&#1082;&#1086;&#1090;&#1086;&#1088;&#1099;&#1077;
&#1085;&#1077;&#1090;. &#1053;&#1086; &#1074;&#1089;&#1077;
&#1086;&#1085;&#1080;
&#1089;&#1091;&#1097;&#1077;&#1089;&#1090;&#1074;&#1091;&#1102;&#1090;
&#1073;&#1077;&#1079;
&#1080;&#1079;&#1084;&#1077;&#1085;&#1077;&#1085;&#1080;&#1081; (&#1087;&#1086;
&#1082;&#1088;&#1072;&#1081;&#1085;&#1077;&#1081; &#1084;&#1077;&#1088;&#1077;,
&#1080;&#1085;&#1090;&#1077;&#1088;&#1077;&#1089;&#1091;&#1102;&#1097;&#1080;&#1077;
&#1085;&#1072;&#1089; &#1087;&#1086;&#1083;&#1103;) &#1074; Windows 2000/XP/2003.
&#1048; &#1101;&#1090;&#1086; &#1086;&#1095;&#1077;&#1085;&#1100;
&#1093;&#1086;&#1088;&#1086;&#1096;&#1086;, &#1090;.&#1082;.
&#1082;&#1086;&#1076; &#1073;&#1091;&#1076;&#1077;&#1090;
&#1077;&#1076;&#1080;&#1085;&#1099;&#1084; (&#1087;&#1086;&#1095;&#1090;&#1080;).</p>
<p>&#1044;&#1083;&#1103; &#1085;&#1072;&#1095;&#1072;&#1083;&#1072;
&#1085;&#1072;&#1084; &#1085;&#1091;&#1078;&#1077;&#1085;
&#1091;&#1082;&#1072;&#1079;&#1072;&#1090;&#1077;&#1083;&#1100; &#1085;&#1072;
&#1089;&#1090;&#1088;&#1091;&#1082;&#1090;&#1091;&#1088;&#1091; SECTION,
&#1086;&#1087;&#1080;&#1089;&#1099;&#1074;&#1072;&#1102;&#1097;&#1091;&#1102;
&#1086;&#1073;&#1098;&#1077;&#1082;&#1090; &quot;&#1089;&#1077;&#1082;&#1094;&#1080;&#1103;&quot;.
&#1053;&#1072; &#1101;&#1090;&#1091; &#1089;&#1077;&#1082;&#1094;&#1080;&#1102;
&#1086;&#1090;&#1086;&#1073;&#1088;&#1072;&#1078;&#1072;&#1077;&#1090;&#1089;&#1103;
&#1080;&#1089;&#1087;&#1086;&#1083;&#1085;&#1103;&#1077;&#1084;&#1099;&#1081;
&#1092;&#1072;&#1081;&#1083;
&#1087;&#1088;&#1086;&#1094;&#1077;&#1089;&#1089;&#1072;.
&#1041;&#1091;&#1076;&#1077;&#1084;
&#1085;&#1072;&#1079;&#1099;&#1074;&#1072;&#1090;&#1100;
&#1101;&#1090;&#1086;&#1090; &#1086;&#1073;&#1098;&#1077;&#1082;&#1090;
&#1073;&#1072;&#1079;&#1086;&#1074;&#1086;&#1081;
&#1089;&#1077;&#1082;&#1094;&#1080;&#1077;&#1081;
&#1087;&#1088;&#1086;&#1094;&#1077;&#1089;&#1089;&#1072;. &#1069;&#1090;&#1086;
&#1089;&#1072;&#1084;&#1099;&#1081; &#1087;&#1077;&#1088;&#1074;&#1099;&#1081;
&#1086;&#1073;&#1098;&#1077;&#1082;&#1090;,
&#1089;&#1086;&#1079;&#1076;&#1072;&#1074;&#1072;&#1077;&#1084;&#1099;&#1081;
&#1087;&#1088;&#1080; &#1079;&#1072;&#1087;&#1091;&#1089;&#1082;&#1077;
&#1087;&#1088;&#1086;&#1094;&#1077;&#1089;&#1089;&#1072;. &#1042; Windows 2000 (&#1080;
NT4, &#1085;&#1072;&#1074;&#1077;&#1088;&#1085;&#1086;&#1077;,
&#1090;&#1086;&#1078;&#1077;)
&#1086;&#1087;&#1080;&#1089;&#1072;&#1090;&#1077;&#1083;&#1100;
&#1101;&#1090;&#1086;&#1075;&#1086;
&#1086;&#1073;&#1098;&#1077;&#1082;&#1090;&#1072;
&#1087;&#1086;&#1084;&#1077;&#1097;&#1072;&#1077;&#1090;&#1089;&#1103; &#1074;
EPROCESS.SectionHandle &#1080; &#1077;&#1075;&#1086;
&#1079;&#1085;&#1072;&#1095;&#1077;&#1085;&#1080;&#1077;
&#1074;&#1089;&#1077;&#1075;&#1076;&#1072; &#1088;&#1072;&#1074;&#1085;&#1086; 4
(&#1089; &#1086;&#1076;&#1085;&#1080;&#1084;
&#1080;&#1089;&#1082;&#1083;&#1102;&#1095;&#1077;&#1085;&#1080;&#1077;&#1084;
&#1074; SP4, &#1086; &#1095;&#1077;&#1084; &#1084;&#1099;
&#1087;&#1086;&#1075;&#1086;&#1074;&#1086;&#1088;&#1080;&#1084;
&#1087;&#1086;&#1079;&#1078;&#1077;). &#1052;&#1099;
&#1076;&#1072;&#1078;&#1077; &#1085;&#1077; &#1073;&#1091;&#1076;&#1077;&#1084;
&#1077;&#1075;&#1086; &#1090;&#1072;&#1084;
&#1080;&#1089;&#1082;&#1072;&#1090;&#1100;. &#1053;&#1072;
&#1101;&#1090;&#1086;&#1084; &#1092;&#1072;&#1082;&#1090;&#1077;,
&#1082;&#1089;&#1090;&#1072;&#1090;&#1080;,
&#1086;&#1089;&#1085;&#1086;&#1074;&#1072;&#1085;
&#1093;&#1086;&#1088;&#1086;&#1096;&#1086;
&#1080;&#1079;&#1074;&#1077;&#1089;&#1090;&#1085;&#1099;&#1081;
&#1090;&#1088;&#1102;&#1082;,
&#1087;&#1088;&#1080;&#1076;&#1091;&#1084;&#1072;&#1085;&#1085;&#1099;&#1081;
&#1043;&#1072;&#1088;&#1080;
&#1053;&#1077;&#1073;&#1073;&#1077;&#1090;&#1090;&#1086;&#1084;,
&#1082;&#1086;&#1075;&#1076;&#1072; exe-&#1084;&#1086;&#1076;&#1091;&#1083;&#1100;
&#1084;&#1086;&#1078;&#1077;&#1090; &#1089;&#1072;&#1084;
&#1089;&#1077;&#1073;&#1103; &#1091;&#1076;&#1072;&#1083;&#1080;&#1090;&#1100;
&#1089; &#1076;&#1080;&#1089;&#1082;&#1072;,
&#1074;&#1099;&#1079;&#1074;&#1072;&#1074; &#1074;
&#1085;&#1091;&#1078;&#1085;&#1086;&#1081;
&#1087;&#1086;&#1089;&#1083;&#1077;&#1076;&#1086;&#1074;&#1072;&#1090;&#1077;&#1083;&#1100;&#1085;&#1086;&#1089;&#1090;&#1100;
&#1085;&#1077;&#1089;&#1082;&#1086;&#1083;&#1100;&#1082;&#1086;
&#1089;&#1072;&#1084;&#1099;&#1093;
&#1086;&#1073;&#1099;&#1095;&#1085;&#1099;&#1093; API,
&#1082;&#1083;&#1102;&#1095;&#1077;&#1074;&#1086;&#1081; &#1080;&#1079;
&#1082;&#1086;&#1090;&#1086;&#1088;&#1099;&#1093;
&#1103;&#1074;&#1083;&#1103;&#1077;&#1090;&#1089;&#1103; CloseHandle(4).
&#1050;&#1072;&#1082; &#1074;&#1099;,
&#1085;&#1072;&#1074;&#1077;&#1088;&#1085;&#1086;&#1077;,
&#1076;&#1086;&#1075;&#1072;&#1076;&#1099;&#1074;&#1072;&#1077;&#1090;&#1077;&#1089;&#1100;,
&#1074; Windows XP &#1101;&#1090;&#1086;&#1090;
&#1092;&#1086;&#1082;&#1091;&#1089; &#1091;&#1078;&#1077; &#1085;&#1077;
&#1087;&#1088;&#1086;&#1093;&#1086;&#1076;&#1080;&#1090;, &#1080;&#1073;&#1086;
&#1086;&#1087;&#1080;&#1089;&#1072;&#1090;&#1077;&#1083;&#1103; &#1079;&#1072;
&#1085;&#1086;&#1084;&#1077;&#1088;&#1086;&#1084; 4
&#1090;&#1077;&#1087;&#1077;&#1088;&#1100; &#1085;&#1077;&#1090;, &#1072;
&#1079;&#1085;&#1072;&#1095;&#1080;&#1090;
&#1076;&#1086;&#1073;&#1088;&#1072;&#1090;&#1100;&#1089;&#1103; &#1076;&#1086;
&#1073;&#1072;&#1079;&#1086;&#1074;&#1086;&#1081;
&#1089;&#1077;&#1082;&#1094;&#1080;&#1080;
&#1087;&#1088;&#1086;&#1094;&#1077;&#1089;&#1089;&#1072; &#1080;&#1079;
&#1088;&#1077;&#1078;&#1080;&#1084;&#1072;
&#1087;&#1086;&#1083;&#1100;&#1079;&#1086;&#1074;&#1072;&#1090;&#1077;&#1083;&#1103;
&#1085;&#1077;&#1074;&#1086;&#1079;&#1084;&#1086;&#1078;&#1085;&#1086;.
&#1042;&#1079;&#1072;&#1084;&#1077;&#1085; &#1074;
&#1089;&#1090;&#1088;&#1091;&#1082;&#1090;&#1091;&#1088;&#1077; EPROCESS
&#1087;&#1086;&#1103;&#1074;&#1080;&#1083;&#1086;&#1089;&#1100;
&#1087;&#1086;&#1083;&#1077; SectionObject
&#1093;&#1088;&#1072;&#1085;&#1103;&#1097;&#1077;&#1077;
&#1091;&#1082;&#1072;&#1079;&#1072;&#1090;&#1077;&#1083;&#1100; &#1085;&#1072;
&#1073;&#1072;&#1079;&#1086;&#1074;&#1091;&#1102;
&#1089;&#1077;&#1082;&#1094;&#1080;&#1102;
&#1087;&#1088;&#1086;&#1094;&#1077;&#1089;&#1089;&#1072;. &#1042; Windows Server
2003 &#1101;&#1090;&#1072;
&#1090;&#1088;&#1072;&#1076;&#1080;&#1094;&#1080;&#1103;
&#1087;&#1088;&#1086;&#1076;&#1086;&#1083;&#1078;&#1077;&#1085;&#1072;,
&#1085;&#1086; &#1089;&#1084;&#1077;&#1097;&#1077;&#1085;&#1080;&#1077;
&#1087;&#1086;&#1083;&#1103; SectionObject
&#1077;&#1089;&#1090;&#1077;&#1089;&#1090;&#1074;&#1077;&#1085;&#1085;&#1086;
&#1080;&#1079;&#1084;&#1077;&#1085;&#1080;&#1083;&#1086;&#1089;&#1100;.
&#1053;&#1072;&#1084; &#1085;&#1091;&#1078;&#1085;&#1086;
&#1073;&#1091;&#1076;&#1077;&#1090; &#1077;&#1075;&#1086;
&#1085;&#1072;&#1081;&#1090;&#1080;.</p>
<p>&#1048;&#1084;&#1077;&#1103;
&#1091;&#1082;&#1072;&#1079;&#1072;&#1090;&#1077;&#1083;&#1100; &#1085;&#1072;
&#1073;&#1072;&#1079;&#1086;&#1074;&#1091;&#1102;
&#1089;&#1077;&#1082;&#1094;&#1080;&#1102;
&#1087;&#1088;&#1086;&#1094;&#1077;&#1089;&#1089;&#1072;, &#1080;
&#1087;&#1088;&#1086;&#1081;&#1076;&#1103; &#1087;&#1086;
&#1089;&#1074;&#1103;&#1079;&#1103;&#1084;
&#1080;&#1079;&#1086;&#1073;&#1088;&#1072;&#1078;&#1077;&#1085;&#1085;&#1099;&#1084;
&#1085;&#1072; &#1088;&#1080;&#1089;. 14-4, &#1084;&#1099;
&#1084;&#1086;&#1078;&#1077;&#1084;
&#1076;&#1086;&#1073;&#1088;&#1072;&#1090;&#1100;&#1089;&#1103; &#1076;&#1086;
&#1087;&#1086;&#1083;&#1085;&#1086;&#1075;&#1086; &#1087;&#1091;&#1090;&#1080;
&#1082; &#1084;&#1086;&#1076;&#1091;&#1083;&#1102;,
&#1089;&#1086;&#1079;&#1076;&#1072;&#1074;&#1096;&#1077;&#1084;&#1091;
&#1087;&#1088;&#1086;&#1094;&#1077;&#1089;&#1089;. &#1044;&#1083;&#1103;
&#1085;&#1072;&#1095;&#1072;&#1083;&#1072; &#1103;
&#1087;&#1088;&#1086;&#1076;&#1077;&#1083;&#1072;&#1083; &#1101;&#1090;&#1086;
&#1087;&#1091;&#1090;&#1077;&#1084; &#1089;
&#1087;&#1086;&#1084;&#1086;&#1097;&#1100;&#1102;
&#1091;&#1090;&#1080;&#1083;&#1080;&#1090;&#1099; NTObjects ( http://www.smidgeonsoft.com/
) &#1088;&#1080;&#1089;. 14-5.</p>
<p align="center"><img src="file:///L:/Xack/Assembler,C,%20Delphi%20&#1056;&#1105;%20&#1057;&#1027;&#1056;&#1105;&#1057;&#1027;.&#1056;&#1111;&#1057;&#1026;&#1056;&#1109;&#1056;&#1110;&#1057;&#1026;&#1056;&#1056;&#1112;&#1056;&#1112;&#1056;&#1105;&#1057;&#1026;&#1056;&#1109;&#1056;&#1030;&#1056;&#1056;&#1029;&#1056;&#1105;&#1056;%20Forever!!!/[W%20A%20S%20M%20_%20R%20U]%20&#1057;&#1058;&#1040;&#1058;&#1068;&#1048;%20%20&#1057;&#1077;&#1082;&#1088;&#1077;&#1090;&#1099;%20Win32%20%20&#1044;&#1088;&#1072;&#1081;&#1074;&#1077;&#1088;&#1099;%20&#1088;&#1077;&#1078;&#1080;&#1084;&#1072;%20&#1103;&#1076;&#1088;&#1072;%20&#1063;&#1072;&#1089;&#1090;&#1100;%2014%20&#1041;&#1072;&#1079;&#1086;&#1074;&#1072;&#1103;%20&#1090;&#1077;&#1093;&#1085;&#1080;&#1082;&#1072;_%20&#1057;&#1080;&#1085;&#1093;&#1088;&#1086;&#1085;&#1080;&#1079;&#1072;&#1094;&#1080;&#1103;%20&#1048;&#1089;&#1087;&#1086;&#1083;&#1100;&#1079;&#1086;&#1074;&#1072;&#1085;&#1080;&#1077;%20&#1086;&#1073;&#1098;&#1077;&#1082;&#1090;&#1072;%20&#1089;&#1086;&#1073;&#1099;&#1090;&#1080;&#1077;%20&#1076;&#1083;&#1103;%20&#1074;&#1079;&#1072;&#1080;&#1084;&#1086;&#1076;&#1077;&#1081;&#1089;&#1090;&#1074;&#1080;&#1103;%20&#1076;&#1088;&#1072;&#1081;&#1074;&#1077;&#1088;&#1072;%20&#1089;%20&#1087;&#1088;&#1086;&#1075;&#1088;&#1072;&#1084;&#1084;&#1086;&#1081;%20&#1091;&#1087;&#1088;&#1072;&#1074;&#1083;&#1077;&#1085;&#1080;&#1103;.files/kmd14-5.png"><center>
<p><b>&#1056;&#1080;&#1089;. 14-5.</b> &#1044;&#1072;&#1084;&#1087;&#1099;
&#1089;&#1090;&#1088;&#1091;&#1082;&#1090;&#1091;&#1088; SECTION, SEGMENT,
CONTROL_AREA,FILE_OBJECT &#1080; SECTION_OBJECT_POINTERS</center>
<p>NTObjects &#1087;&#1086;&#1079;&#1074;&#1086;&#1083;&#1103;&#1077;&#1090;
&#1074;
&#1086;&#1090;&#1085;&#1086;&#1089;&#1080;&#1090;&#1077;&#1083;&#1100;&#1085;&#1086;
&#1091;&#1076;&#1086;&#1073;&#1085;&#1086;&#1081;
&#1092;&#1086;&#1088;&#1084;&#1077;
&#1087;&#1088;&#1086;&#1089;&#1084;&#1086;&#1090;&#1088;&#1077;&#1090;&#1100;
&#1074;&#1089;&#1077; &#1086;&#1073;&#1098;&#1077;&#1082;&#1090;&#1099;,
&#1086;&#1087;&#1080;&#1089;&#1072;&#1090;&#1077;&#1083;&#1080;
&#1082;&#1086;&#1090;&#1086;&#1088;&#1099;&#1093;
&#1087;&#1086;&#1087;&#1072;&#1076;&#1072;&#1102;&#1090; &#1074;
&#1090;&#1072;&#1073;&#1083;&#1080;&#1094;&#1091;
&#1086;&#1087;&#1080;&#1089;&#1072;&#1090;&#1077;&#1083;&#1077;&#1081;
&#1087;&#1088;&#1086;&#1094;&#1077;&#1089;&#1089;&#1072;.
&#1055;&#1086;&#1101;&#1090;&#1086;&#1084;&#1091;
&#1074;&#1086;&#1089;&#1087;&#1086;&#1083;&#1100;&#1079;&#1086;&#1074;&#1072;&#1090;&#1100;&#1089;&#1103;
&#1077;&#1105; &#1091;&#1089;&#1083;&#1091;&#1075;&#1072;&#1084;&#1080;
&#1076;&#1083;&#1103;
&#1087;&#1088;&#1086;&#1089;&#1084;&#1086;&#1090;&#1088;&#1072;
&#1073;&#1072;&#1079;&#1086;&#1074;&#1086;&#1081;
&#1089;&#1077;&#1082;&#1094;&#1080;&#1080;
&#1087;&#1088;&#1086;&#1094;&#1077;&#1089;&#1089;&#1072; &#1074; Windows XP
&#1080; &#1074;&#1099;&#1096;&#1077; &#1085;&#1077;
&#1091;&#1076;&#1072;&#1089;&#1090;&#1089;&#1103; &#1080;
&#1087;&#1088;&#1080;&#1076;&#1077;&#1090;&#1089;&#1103;
&#1080;&#1089;&#1087;&#1086;&#1083;&#1100;&#1079;&#1086;&#1074;&#1072;&#1090;&#1100;
&#1082;&#1072;&#1082;&#1086;&#1081;-&#1085;&#1080;&#1073;&#1091;&#1076;&#1100;
&#1076;&#1088;&#1091;&#1075;&#1086;&#1081;
&#1080;&#1085;&#1089;&#1090;&#1088;&#1091;&#1084;&#1077;&#1085;&#1090;,
&#1085;&#1072;&#1087;&#1088;&#1080;&#1084;&#1077;&#1088;, SoftICE.</p>
<br>
<br>
<p>&nbsp;<!--mstheme--></font>
<h2><!--mstheme--><font face="Arial, Arial, Helvetica" color="#CCCCCC">14.14
&#1055;&#1088;&#1086;&#1094;&#1077;&#1076;&#1091;&#1088;&#1072; GetImageFilePath<!--mstheme--></font></h2>
<!--mstheme--><font face="Arial, Arial, Helvetica">
<p>&nbsp;</p>
<p>&#1042;&#1077;&#1089;&#1100; &#1082;&#1086;&#1076;,
&#1086;&#1090;&#1074;&#1077;&#1095;&#1072;&#1102;&#1097;&#1080;&#1081;
&#1079;&#1072; &#1087;&#1086;&#1083;&#1091;&#1095;&#1077;&#1085;&#1080;&#1077;
&#1087;&#1086;&#1083;&#1085;&#1086;&#1075;&#1086; &#1087;&#1091;&#1090;&#1080;,
&#1087;&#1086;&#1084;&#1077;&#1097;&#1077;&#1085; &#1074;
&#1086;&#1090;&#1076;&#1077;&#1083;&#1100;&#1085;&#1099;&#1081;
&#1092;&#1072;&#1081;&#1083; ProcPath.asm. &#1071; &#1085;&#1077;
&#1085;&#1072;&#1089;&#1090;&#1072;&#1080;&#1074;&#1072;&#1102; &#1085;&#1072;
&#1090;&#1086;&#1084;, &#1095;&#1090;&#1086;
&#1087;&#1088;&#1077;&#1076;&#1083;&#1072;&#1075;&#1072;&#1077;&#1084;&#1099;&#1081;
&#1089;&#1087;&#1086;&#1089;&#1086;&#1073;
&#1077;&#1076;&#1080;&#1085;&#1089;&#1090;&#1074;&#1077;&#1085;&#1085;&#1086;
&#1074;&#1086;&#1079;&#1084;&#1086;&#1078;&#1085;&#1099;&#1081;. &#1042;
&#1076;&#1072;&#1085;&#1085;&#1086;&#1084;
&#1082;&#1086;&#1085;&#1082;&#1088;&#1077;&#1090;&#1085;&#1086;&#1084;
&#1089;&#1083;&#1091;&#1095;&#1072;&#1077;, &#1084;&#1086;&#1078;&#1085;&#1086;
&#1073;&#1099;&#1083;&#1086; &#1073;&#1099;
&#1086;&#1075;&#1088;&#1072;&#1085;&#1080;&#1095;&#1080;&#1090;&#1089;&#1103;
&#1076;&#1074;&#1091;&#1084;&#1103; &#1078;&#1077;&#1089;&#1090;&#1082;&#1086;
&#1079;&#1072;&#1096;&#1080;&#1090;&#1099;&#1084;&#1080;
&#1089;&#1084;&#1077;&#1097;&#1077;&#1085;&#1080;&#1103;&#1084;&#1080; (&#1076;&#1083;&#1103;
XP &#1080; 2003). &#1053;&#1086;
&#1074;&#1086;&#1079;&#1084;&#1086;&#1078;&#1085;&#1086;, &#1074;&#1072;&#1084;
&#1087;&#1088;&#1080;&#1093;&#1086;&#1076;&#1080;&#1083;&#1086;&#1089;&#1100;
&#1074;&#1089;&#1090;&#1088;&#1077;&#1095;&#1072;&#1090;&#1100;
&#1085;&#1077;&#1087;&#1083;&#1086;&#1093;&#1080;&#1077;
&#1080;&#1085;&#1089;&#1090;&#1088;&#1091;&#1084;&#1077;&#1085;&#1090;&#1099;,
&#1088;&#1072;&#1073;&#1086;&#1090;&#1072;&#1102;&#1097;&#1080;&#1077; &#1074;
&#1086;&#1076;&#1085;&#1086;&#1081; &#1074;&#1077;&#1088;&#1089;&#1080;&#1080;
&#1089;&#1080;&#1089;&#1090;&#1077;&#1084;&#1099; &#1080; &#1085;&#1077;
&#1088;&#1072;&#1073;&#1086;&#1090;&#1072;&#1102;&#1097;&#1080;&#1077; &#1074;
&#1076;&#1088;&#1091;&#1075;&#1086;&#1081;. &#1069;&#1090;&#1086;
&#1088;&#1077;&#1079;&#1091;&#1083;&#1100;&#1090;&#1072;&#1090;
&#1087;&#1086;&#1088;&#1086;&#1095;&#1085;&#1086;&#1081;
&#1087;&#1088;&#1072;&#1082;&#1090;&#1080;&#1082;&#1080;
&#1080;&#1089;&#1087;&#1086;&#1083;&#1100;&#1079;&#1086;&#1074;&#1072;&#1085;&#1080;&#1103;
&#1092;&#1080;&#1082;&#1089;&#1080;&#1088;&#1086;&#1074;&#1072;&#1085;&#1085;&#1099;&#1093;
&#1089;&#1084;&#1077;&#1097;&#1077;&#1085;&#1080;&#1081;,
&#1072;&#1076;&#1088;&#1077;&#1089;&#1086;&#1074;
&#1092;&#1091;&#1085;&#1082;&#1094;&#1080;&#1081; &#1080; &#1090;.&#1087;.
&#1045;&#1089;&#1083;&#1080; &#1077;&#1089;&#1090;&#1100;
&#1084;&#1072;&#1083;&#1077;&#1081;&#1096;&#1072;&#1103;
&#1074;&#1086;&#1079;&#1084;&#1086;&#1078;&#1085;&#1086;&#1089;&#1090;&#1100;
&#1076;&#1080;&#1085;&#1072;&#1084;&#1080;&#1095;&#1077;&#1089;&#1082;&#1080;
&#1085;&#1072;&#1081;&#1090;&#1080; &#1082;&#1072;&#1082;&#1086;&#1077;-&#1083;&#1080;&#1073;&#1086;
&#1085;&#1077;&#1076;&#1086;&#1082;&#1091;&#1084;&#1077;&#1085;&#1090;&#1080;&#1088;&#1086;&#1074;&#1072;&#1085;&#1085;&#1086;&#1077;
&#1087;&#1086;&#1083;&#1077;
&#1089;&#1090;&#1088;&#1091;&#1082;&#1090;&#1091;&#1088;&#1099;
&#1080;&#1083;&#1080; &#1085;&#1077;
&#1101;&#1082;&#1089;&#1087;&#1086;&#1088;&#1090;&#1080;&#1088;&#1091;&#1077;&#1084;&#1091;&#1102;
&#1092;&#1091;&#1085;&#1082;&#1094;&#1080;&#1102;,
&#1087;&#1086;&#1095;&#1077;&#1084;&#1091; &#1073;&#1099; &#1085;&#1080;
&#1087;&#1086;&#1087;&#1088;&#1086;&#1073;&#1086;&#1074;&#1072;&#1090;&#1100;
&#1101;&#1090;&#1086; &#1089;&#1076;&#1077;&#1083;&#1072;&#1090;&#1100;.</p>
<code><!--mstheme--></font>
<pre>     PROCESS_QUERY_INFORMATION equ 400h

     mov ecx, PsProcessType
     mov ecx, [ecx]
     mov ecx, [ecx]

     invoke ObReferenceObjectByPointer, peProcess, PROCESS_QUERY_INFORMATION, ecx, UserMode
     .if eax == STATUS_SUCCESS

</pre>
<!--mstheme--><font face="Arial, Arial, Helvetica"></code>
<p>&#1055;&#1088;&#1086;&#1074;&#1077;&#1088;&#1080;&#1084;,
&#1103;&#1074;&#1083;&#1103;&#1077;&#1090;&#1089;&#1103; &#1083;&#1080;
&#1072;&#1076;&#1088;&#1077;&#1089;,
&#1087;&#1077;&#1088;&#1077;&#1076;&#1072;&#1085;&#1085;&#1099;&#1081;
&#1085;&#1072;&#1084; &#1074;
&#1087;&#1077;&#1088;&#1077;&#1084;&#1077;&#1085;&#1085;&#1086;&#1081; peProcess,
&#1091;&#1082;&#1072;&#1079;&#1072;&#1090;&#1077;&#1083;&#1077;&#1084;
&#1085;&#1072; &#1086;&#1073;&#1098;&#1077;&#1082;&#1090; &quot;&#1087;&#1088;&#1086;&#1094;&#1077;&#1089;&#1089;&quot;.
&#1058;.&#1082;. &#1084;&#1099;
&#1089;&#1086;&#1073;&#1080;&#1088;&#1072;&#1077;&#1084;&#1089;&#1103; &quot;&#1082;&#1086;&#1087;&#1072;&#1090;&#1100;&#1089;&#1103;&quot;
&#1074; &#1089;&#1072;&#1084;&#1099;&#1093;
&#1085;&#1077;&#1076;&#1088;&#1072;&#1093;
&#1089;&#1080;&#1089;&#1090;&#1077;&#1084;&#1099; &#1073;&#1077;&#1079;
&#1077;&#1105;
&#1088;&#1072;&#1079;&#1088;&#1077;&#1096;&#1077;&#1085;&#1080;&#1103;,
&#1087;&#1088;&#1080;&#1076;&#1077;&#1090;&#1089;&#1103;
&#1076;&#1074;&#1080;&#1075;&#1072;&#1090;&#1100;&#1089;&#1103; &#1089;
&#1084;&#1072;&#1082;&#1089;&#1080;&#1084;&#1072;&#1083;&#1100;&#1085;&#1086;&#1081;
&#1086;&#1089;&#1090;&#1086;&#1088;&#1086;&#1078;&#1085;&#1086;&#1089;&#1090;&#1100;&#1102;.</p>
<p>&#1056;&#1077;&#1072;&#1083;&#1100;&#1085;&#1086;&#1077;
&#1087;&#1086;&#1074;&#1077;&#1076;&#1077;&#1085;&#1080;&#1077;
&#1092;&#1091;&#1085;&#1082;&#1094;&#1080;&#1080; ObReferenceObjectByPointer
&#1074;&#1077;&#1089;&#1100;&#1084;&#1072;
&#1079;&#1085;&#1072;&#1095;&#1080;&#1090;&#1077;&#1083;&#1100;&#1085;&#1086;
&#1086;&#1090;&#1083;&#1080;&#1095;&#1072;&#1077;&#1090;&#1089;&#1103;
&#1086;&#1090; &#1090;&#1086;&#1075;&#1086;, &#1095;&#1090;&#1086;
&#1084;&#1086;&#1078;&#1085;&#1086; &#1085;&#1072;&#1081;&#1090;&#1080; &#1074;
DDK.</p>
<p>&#1042;&#1086;-&#1087;&#1077;&#1088;&#1074;&#1099;&#1093;, DDK
&#1079;&#1072;&#1103;&#1074;&#1083;&#1103;&#1077;&#1090;, &#1095;&#1090;&#1086;
&#1074;&#1090;&#1086;&#1088;&#1086;&#1081;
&#1087;&#1072;&#1088;&#1072;&#1084;&#1077;&#1090;&#1088;
&#1076;&#1086;&#1083;&#1078;&#1077;&#1085;
&#1089;&#1086;&#1076;&#1077;&#1088;&#1078;&#1072;&#1090;&#1100;
&#1079;&#1072;&#1087;&#1088;&#1072;&#1096;&#1080;&#1074;&#1072;&#1077;&#1084;&#1099;&#1077;
&#1087;&#1088;&#1072;&#1074;&#1072;
&#1076;&#1086;&#1089;&#1090;&#1091;&#1087;&#1072; &#1082;
&#1086;&#1073;&#1098;&#1077;&#1082;&#1090;&#1091;. &#1069;&#1090;&#1086;
&#1085;&#1077; &#1090;&#1072;&#1082;. ObReferenceObjectByPointer
&#1074;&#1086;&#1086;&#1073;&#1097;&#1077;
&#1080;&#1075;&#1085;&#1086;&#1088;&#1080;&#1088;&#1091;&#1077;&#1090;
&#1101;&#1090;&#1086;&#1090;
&#1087;&#1072;&#1088;&#1072;&#1084;&#1077;&#1090;&#1088; &#1080; &#1074;
&#1085;&#1077;&#1084; &#1084;&#1086;&#1078;&#1085;&#1086;
&#1087;&#1077;&#1088;&#1077;&#1076;&#1072;&#1090;&#1100; &#1095;&#1090;&#1086;
&#1091;&#1075;&#1086;&#1076;&#1085;&#1086;. &#1053;&#1086; &#1084;&#1099;
&#1074;&#1089;&#1105; &#1088;&#1072;&#1074;&#1085;&#1086;
&#1073;&#1091;&#1076;&#1077;&#1084;
&#1087;&#1077;&#1088;&#1077;&#1076;&#1072;&#1074;&#1072;&#1090;&#1100;
&#1085;&#1077;&#1086;&#1073;&#1093;&#1086;&#1076;&#1080;&#1084;&#1091;&#1102;
&#1084;&#1072;&#1089;&#1082;&#1091;
&#1076;&#1086;&#1089;&#1090;&#1091;&#1087;&#1072;, &#1090;.&#1082;.
&#1087;&#1086;&#1074;&#1077;&#1076;&#1077;&#1085;&#1080;&#1077;
&#1092;&#1091;&#1085;&#1082;&#1094;&#1080;&#1080; ObReferenceObjectByPointer
&#1084;&#1086;&#1078;&#1077;&#1090;
&#1080;&#1079;&#1084;&#1077;&#1085;&#1080;&#1090;&#1100;&#1089;&#1103; &#1074;
&#1073;&#1091;&#1076;&#1091;&#1097;&#1077;&#1084;.</p>
<p>&#1042;&#1086;-&#1074;&#1090;&#1086;&#1088;&#1099;&#1093;, DDK
&#1079;&#1072;&#1103;&#1074;&#1083;&#1103;&#1077;&#1090;, &#1095;&#1090;&#1086;
&#1090;&#1088;&#1077;&#1090;&#1080;&#1081;
&#1087;&#1072;&#1088;&#1072;&#1084;&#1077;&#1090;&#1088;
&#1084;&#1086;&#1078;&#1077;&#1090; &#1073;&#1099;&#1090;&#1100;
&#1091;&#1082;&#1072;&#1079;&#1072;&#1090;&#1077;&#1083;&#1077;&#1084;
&#1090;&#1086;&#1083;&#1100;&#1082;&#1086; &#1085;&#1072; &#1076;&#1074;&#1072;
&#1086;&#1073;&#1098;&#1077;&#1082;&#1090;&#1072; &quot;&#1090;&#1080;&#1087;&quot;,
&#1089;&#1086;&#1086;&#1090;&#1074;&#1077;&#1090;&#1089;&#1090;&#1074;&#1091;&#1102;&#1097;&#1080;&#1077;
&#1086;&#1073;&#1098;&#1077;&#1082;&#1090;&#1072;&#1084; &quot;&#1092;&#1072;&#1081;&#1083;&quot;
&#1080; &quot;&#1089;&#1086;&#1073;&#1099;&#1090;&#1080;&#1077;&quot;.
&#1069;&#1090;&#1080;
&#1091;&#1082;&#1072;&#1079;&#1072;&#1090;&#1077;&#1083;&#1080;
&#1084;&#1086;&#1078;&#1085;&#1086;
&#1080;&#1079;&#1074;&#1083;&#1077;&#1095;&#1100; &#1080;&#1079;
&#1101;&#1082;&#1089;&#1087;&#1086;&#1088;&#1090;&#1080;&#1088;&#1091;&#1077;&#1084;&#1099;&#1093;
&#1087;&#1077;&#1088;&#1077;&#1084;&#1077;&#1085;&#1085;&#1099;&#1093;
IoFileObjectType &#1080; ExEventObjectType,
&#1089;&#1086;&#1086;&#1090;&#1074;&#1077;&#1090;&#1089;&#1090;&#1074;&#1077;&#1085;&#1085;&#1086;.
&#1069;&#1090;&#1086; &#1090;&#1086;&#1078;&#1077; &#1085;&#1077;
&#1090;&#1072;&#1082; &#1080;
&#1087;&#1077;&#1088;&#1077;&#1076;&#1072;&#1074;&#1072;&#1090;&#1100;
&#1084;&#1086;&#1078;&#1085;&#1086;
&#1091;&#1082;&#1072;&#1079;&#1072;&#1090;&#1077;&#1083;&#1100; &#1085;&#1072;
&#1083;&#1102;&#1073;&#1086;&#1081; &#1086;&#1073;&#1098;&#1077;&#1082;&#1090;
&quot;&#1090;&#1080;&#1087;&quot;. &#1048; &#1101;&#1090;&#1086;
&#1087;&#1088;&#1086;&#1089;&#1090;&#1086;
&#1079;&#1072;&#1084;&#1077;&#1095;&#1072;&#1090;&#1077;&#1083;&#1100;&#1085;&#1086;,
&#1090;.&#1082;. &#1087;&#1086;&#1079;&#1074;&#1086;&#1083;&#1080;&#1090;
&#1085;&#1072;&#1084;
&#1087;&#1088;&#1086;&#1074;&#1077;&#1088;&#1103;&#1090;&#1100;
&#1089;&#1083;&#1091;&#1095;&#1072;&#1081;&#1085;&#1099;&#1077;
&#1091;&#1082;&#1072;&#1079;&#1072;&#1090;&#1077;&#1083;&#1080; &quot;&#1085;&#1072;
&#1074;&#1096;&#1080;&#1074;&#1086;&#1089;&#1090;&#1100;&quot;. &#1048;&#1079;
27-&#1084;&#1080; &#1090;&#1080;&#1087;&#1086;&#1074;
&#1086;&#1073;&#1098;&#1077;&#1082;&#1090;&#1086;&#1074; &#1074; Windows 2000
&#1080; 29-&#1090;&#1080; &#1074; Windows XP/2003
&#1101;&#1082;&#1089;&#1087;&#1086;&#1088;&#1090;&#1080;&#1088;&#1091;&#1077;&#1090;&#1089;&#1103;
&#1086;&#1082;&#1086;&#1083;&#1086; 15
&#1091;&#1082;&#1072;&#1079;&#1072;&#1090;&#1077;&#1083;&#1077;&#1081;
&#1085;&#1072; &#1086;&#1073;&#1098;&#1077;&#1082;&#1090;&#1099; &quot;&#1090;&#1080;&#1087;&quot;.
&#1057;&#1088;&#1077;&#1076;&#1080;
&#1101;&#1082;&#1089;&#1087;&#1086;&#1088;&#1090;&#1080;&#1088;&#1091;&#1077;&#1084;&#1099;&#1093;
&#1080;&#1084;&#1077;&#1102;&#1090;&#1089;&#1103; &#1074;&#1089;&#1077;
&#1085;&#1091;&#1078;&#1085;&#1099;&#1077; &#1085;&#1072;&#1084;, &#1072;
&#1080;&#1084;&#1077;&#1085;&#1085;&#1086;: IoDeviceObjectType, PsProcessType,
MmSectionObjectType, IoFileObjectType. &#1048; &#1101;&#1090;&#1086;
&#1090;&#1086;&#1078;&#1077; &#1079;&#1076;&#1086;&#1088;&#1086;&#1074;&#1086;.</p>
<p>&#1042;-&#1090;&#1088;&#1077;&#1090;&#1100;&#1080;&#1093;,
&#1095;&#1090;&#1086;-&#1090;&#1086;
&#1089;&#1086;&#1074;&#1077;&#1088;&#1096;&#1077;&#1085;&#1085;&#1086;
&#1085;&#1077;&#1074;&#1085;&#1103;&#1090;&#1085;&#1086;&#1077;
&#1089;&#1082;&#1072;&#1079;&#1072;&#1085;&#1086; &#1087;&#1088;&#1086;
&#1087;&#1086;&#1089;&#1083;&#1077;&#1076;&#1085;&#1080;&#1081;
&#1087;&#1072;&#1088;&#1072;&#1084;&#1077;&#1090;&#1088;. &#1052;&#1085;&#1077;,
&#1083;&#1080;&#1095;&#1085;&#1086;, &#1077;&#1075;&#1086;
&#1087;&#1088;&#1080;&#1089;&#1091;&#1090;&#1089;&#1090;&#1074;&#1080;&#1077;
&#1074;&#1086;&#1086;&#1073;&#1097;&#1077;
&#1085;&#1077;&#1087;&#1086;&#1085;&#1103;&#1090;&#1085;&#1086;.
&#1054;&#1073;&#1099;&#1095;&#1085;&#1086; &#1087;&#1088;&#1080;
&#1086;&#1073;&#1088;&#1072;&#1097;&#1077;&#1085;&#1080;&#1080; &#1082;
&#1086;&#1073;&#1098;&#1077;&#1082;&#1090;&#1072;&#1084;
&#1088;&#1077;&#1078;&#1080;&#1084;
&#1076;&#1086;&#1089;&#1090;&#1091;&#1087;&#1072;
&#1080;&#1084;&#1077;&#1077;&#1090; &#1089;&#1084;&#1099;&#1089;&#1083;
&#1091;&#1082;&#1072;&#1079;&#1099;&#1074;&#1072;&#1090;&#1100;
&#1087;&#1088;&#1080; &#1087;&#1077;&#1088;&#1077;&#1093;&#1086;&#1076;&#1077;
&#1086;&#1090; &#1088;&#1077;&#1078;&#1080;&#1084;&#1072;
&#1087;&#1086;&#1083;&#1100;&#1079;&#1086;&#1074;&#1072;&#1090;&#1077;&#1083;&#1103;
&#1082; &#1088;&#1077;&#1078;&#1080;&#1084;&#1091; &#1103;&#1076;&#1088;&#1072;.
&#1058;.&#1077;. &#1087;&#1088;&#1080;
&#1087;&#1088;&#1077;&#1086;&#1073;&#1088;&#1072;&#1079;&#1086;&#1074;&#1072;&#1085;&#1080;&#1080;
&#1086;&#1087;&#1080;&#1089;&#1072;&#1090;&#1077;&#1083;&#1103; &#1074;
&#1091;&#1082;&#1072;&#1079;&#1072;&#1090;&#1077;&#1083;&#1100;.
&#1053;&#1072;&#1087;&#1088;&#1080;&#1084;&#1077;&#1088;, &#1074;
&#1092;&#1091;&#1085;&#1082;&#1094;&#1080;&#1080; ObReferenceObjectByHandle
&#1087;&#1072;&#1088;&#1072;&#1084;&#1077;&#1090;&#1088; AccessMode
&#1074;&#1087;&#1086;&#1083;&#1085;&#1077;
&#1083;&#1086;&#1075;&#1080;&#1095;&#1077;&#1085;. &#1053;&#1086;
&#1077;&#1089;&#1083;&#1080; &#1091; &#1085;&#1072;&#1089; &#1091;&#1078;&#1077;
&#1077;&#1089;&#1090;&#1100;
&#1091;&#1082;&#1072;&#1079;&#1072;&#1090;&#1077;&#1083;&#1100;, &#1090;&#1086;
&#1079;&#1072;&#1095;&#1077;&#1084;
&#1091;&#1082;&#1072;&#1079;&#1099;&#1074;&#1072;&#1090;&#1100;
&#1087;&#1088;&#1072;&#1074;&#1072;
&#1076;&#1086;&#1089;&#1090;&#1091;&#1087;&#1072;? &#1040;
&#1074;&#1086;&#1089;&#1087;&#1086;&#1083;&#1100;&#1079;&#1086;&#1074;&#1072;&#1090;&#1100;&#1089;&#1103;
&#1091;&#1082;&#1072;&#1079;&#1072;&#1090;&#1077;&#1083;&#1077;&#1084; &#1074;
&#1088;&#1077;&#1078;&#1080;&#1084;&#1077;
&#1087;&#1086;&#1083;&#1100;&#1079;&#1086;&#1074;&#1072;&#1090;&#1077;&#1083;&#1103;
&#1074;&#1089;&#1105; &#1088;&#1072;&#1074;&#1085;&#1086;
&#1085;&#1077;&#1074;&#1086;&#1079;&#1084;&#1086;&#1078;&#1085;&#1086; (&#1042;&#1086;
&#1074;&#1089;&#1103;&#1082;&#1086;&#1084;
&#1089;&#1083;&#1091;&#1095;&#1072;&#1077;,
&#1076;&#1086;&#1082;&#1091;&#1084;&#1077;&#1085;&#1090;&#1080;&#1088;&#1086;&#1074;&#1072;&#1085;&#1085;&#1099;&#1084;&#1080;
&#1089;&#1088;&#1077;&#1076;&#1089;&#1090;&#1074;&#1072;&#1084;&#1080;.
&#1050;&#1089;&#1090;&#1072;&#1090;&#1080;,
&#1080;&#1089;&#1087;&#1086;&#1083;&#1100;&#1079;&#1091;&#1103; Physical Memory
Browser &#1084;&#1099;
&#1086;&#1073;&#1088;&#1072;&#1090;&#1080;&#1083;&#1080;&#1089;&#1100; &#1082;
&#1086;&#1073;&#1098;&#1077;&#1082;&#1090;&#1091;
&#1087;&#1088;&#1103;&#1084;&#1086; &#1080;&#1079;
&#1088;&#1077;&#1078;&#1080;&#1084;&#1072;
&#1087;&#1086;&#1083;&#1100;&#1079;&#1086;&#1074;&#1072;&#1090;&#1077;&#1083;&#1103;).
&#1045;&#1089;&#1083;&#1080; &#1074;&#1099; &#1085;&#1077;
&#1087;&#1086;&#1083;&#1077;&#1085;&#1080;&#1090;&#1077;&#1089;&#1100; &#1080;
&#1079;&#1072;&#1075;&#1083;&#1103;&#1085;&#1080;&#1090;&#1077; &#1074;
&#1076;&#1080;&#1079;&#1072;&#1089;&#1089;&#1077;&#1084;&#1073;&#1083;&#1080;&#1088;&#1086;&#1074;&#1085;&#1085;&#1099;&#1081;
&#1083;&#1080;&#1089;&#1090;&#1080;&#1085;&#1075;
&#1092;&#1091;&#1085;&#1082;&#1094;&#1080;&#1080; ObReferenceObjectByPointer,
&#1090;&#1086; &#1091;&#1073;&#1077;&#1076;&#1080;&#1090;&#1077;&#1089;&#1100;
&#1074; &#1074;&#1077;&#1089;&#1100;&#1084;&#1072;
&#1089;&#1090;&#1088;&#1072;&#1085;&#1085;&#1086;&#1084; &#1077;&#1105;
&#1087;&#1086;&#1074;&#1077;&#1076;&#1077;&#1085;&#1080;&#1080;, &#1074;
&#1089;&#1083;&#1091;&#1095;&#1072;&#1077; &#1077;&#1089;&#1083;&#1080;
&#1087;&#1072;&#1088;&#1072;&#1084;&#1077;&#1090;&#1088; AccessMode = KernelMode,
&#1072; &#1080;&#1084;&#1077;&#1085;&#1085;&#1086;
&#1045;&#1089;&#1083;&#1080; &#1074;
&#1087;&#1072;&#1088;&#1072;&#1084;&#1077;&#1090;&#1088;&#1077; Object
&#1087;&#1077;&#1088;&#1077;&#1076;&#1072;&#1090;&#1100;
&#1091;&#1082;&#1072;&#1079;&#1072;&#1090;&#1077;&#1083;&#1100; &#1085;&#1072;
&#1083;&#1102;&#1073;&#1086;&#1081; &#1082;&#1091;&#1089;&#1086;&#1082;
&#1074;&#1072;&#1083;&#1080;&#1076;&#1085;&#1086;&#1081;
&#1087;&#1072;&#1084;&#1103;&#1090;&#1080;, &#1090;&#1086;
&#1092;&#1091;&#1085;&#1082;&#1094;&#1080;&#1103;,
&#1085;&#1080;&#1095;&#1077;&#1075;&#1086; &#1085;&#1077;
&#1087;&#1088;&#1086;&#1074;&#1077;&#1088;&#1103;&#1103;,
&#1087;&#1086;&#1089;&#1095;&#1080;&#1090;&#1072;&#1077;&#1090;,
&#1095;&#1090;&#1086; &#1101;&#1090;&#1086;
&#1074;&#1072;&#1083;&#1080;&#1076;&#1085;&#1099;&#1081;
&#1091;&#1082;&#1072;&#1079;&#1072;&#1090;&#1077;&#1083;&#1100; &#1085;&#1072;
&#1090;&#1077;&#1083;&#1086; &#1086;&#1073;&#1098;&#1077;&#1082;&#1090;&#1072;.
&#1042;&#1099;&#1095;&#1090;&#1077;&#1090; &#1080;&#1079;
&#1101;&#1090;&#1086;&#1075;&#1086;
&#1091;&#1082;&#1072;&#1079;&#1072;&#1090;&#1077;&#1083;&#1103;
&#1088;&#1072;&#1079;&#1084;&#1077;&#1088;
&#1089;&#1090;&#1088;&#1091;&#1082;&#1090;&#1091;&#1088;&#1099; OBJECT_HEADER,
&#1090;.&#1077;. &#1087;&#1086;&#1083;&#1091;&#1095;&#1080;&#1090;
&#1091;&#1082;&#1072;&#1079;&#1072;&#1090;&#1077;&#1083;&#1100; &#1085;&#1072;
&#1079;&#1072;&#1075;&#1086;&#1083;&#1086;&#1074;&#1086;&#1082;
&#1086;&#1073;&#1098;&#1077;&#1082;&#1090;&#1072; &#1080;
&#1091;&#1074;&#1077;&#1083;&#1080;&#1095;&#1080;&#1090; &#1085;&#1072;
&#1077;&#1076;&#1080;&#1085;&#1080;&#1094;&#1091; &#1087;&#1086;&#1083;&#1077;
PointerCount. &#1058;.&#1077;. &#1092;&#1091;&#1085;&#1082;&#1094;&#1080;&#1103;
&#1089;&#1095;&#1080;&#1090;&#1072;&#1077;&#1090;, &#1095;&#1090;&#1086;
&#1077;&#1089;&#1083;&#1080; AccessMode = KernelMode, &#1090;&#1086;
&#1091;&#1078;&#1077;
&#1080;&#1084;&#1077;&#1102;&#1097;&#1080;&#1081;&#1089;&#1103; &#1091;
&#1085;&#1072;&#1089;
&#1091;&#1082;&#1072;&#1079;&#1072;&#1090;&#1077;&#1083;&#1100; &#1085;&#1072;
&#1086;&#1073;&#1098;&#1077;&#1082;&#1090; &#1073;&#1099;&#1083;
&#1087;&#1086;&#1083;&#1091;&#1095;&#1077;&#1085; &#1075;&#1076;&#1077;-&#1090;&#1086;
&#1088;&#1072;&#1085;&#1077;&#1077; &#1080;
&#1074;&#1072;&#1083;&#1080;&#1076;&#1077;&#1085;. &#1058;.&#1086;.
&#1077;&#1089;&#1083;&#1080; AccessMode = KernelMode,
&#1087;&#1077;&#1088;&#1077;&#1076;&#1072;&#1074;&#1072;&#1090;&#1100;
&#1089;&#1083;&#1091;&#1095;&#1072;&#1081;&#1085;&#1099;&#1081;
&#1091;&#1082;&#1072;&#1079;&#1072;&#1090;&#1077;&#1083;&#1100; &#1085;&#1080;
&#1074; &#1082;&#1086;&#1077;&#1084; &#1089;&#1083;&#1091;&#1095;&#1072;&#1077;
&#1085;&#1077;&#1083;&#1100;&#1079;&#1103;. &#1040; &#1074;&#1086;&#1090;
&#1077;&#1089;&#1083;&#1080; AccessMode = UserMode,
&#1092;&#1091;&#1085;&#1082;&#1094;&#1080;&#1103; &#1090;&#1072;&#1082;&#1080;
&#1087;&#1088;&#1086;&#1074;&#1077;&#1088;&#1080;&#1090;,
&#1089;&#1086;&#1086;&#1090;&#1074;&#1077;&#1090;&#1089;&#1090;&#1074;&#1091;&#1077;&#1090;
&#1083;&#1080; &#1090;&#1080;&#1087;
&#1086;&#1073;&#1098;&#1077;&#1082;&#1090;&#1072;
&#1079;&#1072;&#1103;&#1074;&#1083;&#1077;&#1085;&#1085;&#1086;&#1084;&#1091;.
&#1069;&#1090;&#1086;
&#1086;&#1073;&#1089;&#1090;&#1086;&#1103;&#1090;&#1077;&#1083;&#1100;&#1089;&#1090;&#1074;&#1086;
&#1080; &#1087;&#1086;&#1079;&#1074;&#1086;&#1083;&#1080;&#1090;
&#1085;&#1072;&#1084;
&#1087;&#1088;&#1086;&#1074;&#1077;&#1088;&#1103;&#1090;&#1100;
&#1089;&#1083;&#1091;&#1095;&#1072;&#1081;&#1085;&#1099;&#1077;
&#1091;&#1082;&#1072;&#1079;&#1072;&#1090;&#1077;&#1083;&#1080;. &#1042;
&#1083;&#1102;&#1073;&#1086;&#1084; &#1089;&#1083;&#1091;&#1095;&#1072;&#1077;
&#1074;&#1089;&#1105;
&#1074;&#1099;&#1096;&#1077;&#1089;&#1082;&#1072;&#1079;&#1072;&#1085;&#1085;&#1086;&#1077;,
&#1084;&#1103;&#1075;&#1082;&#1086; &#1075;&#1086;&#1074;&#1086;&#1088;&#1103;,
&#1085;&#1077;&#1084;&#1085;&#1086;&#1075;&#1086;
&#1086;&#1090;&#1083;&#1080;&#1095;&#1072;&#1077;&#1090;&#1089;&#1103;
&#1086;&#1090; &#1090;&#1086;&#1075;&#1086;, &#1095;&#1090;&#1086;
&#1085;&#1072;&#1087;&#1080;&#1089;&#1072;&#1085;&#1086; &#1074; DDK.</p>
<p>&#1055;&#1088;&#1080; &#1093;&#1086;&#1088;&#1086;&#1096;&#1077;&#1084;
&#1079;&#1085;&#1072;&#1085;&#1080;&#1080;
&#1089;&#1090;&#1088;&#1091;&#1082;&#1090;&#1091;&#1088; &#1080;
&#1087;&#1088;&#1080;&#1085;&#1094;&#1080;&#1087;&#1086;&#1074;
&#1086;&#1088;&#1075;&#1072;&#1085;&#1080;&#1079;&#1072;&#1094;&#1080;&#1080;
&#1086;&#1073;&#1098;&#1077;&#1082;&#1090;&#1086;&#1074;
&#1084;&#1086;&#1078;&#1085;&#1086; &#1073;&#1077;&#1079;
&#1086;&#1089;&#1086;&#1073;&#1086;&#1075;&#1086;
&#1090;&#1088;&#1091;&#1076;&#1072;
&#1085;&#1072;&#1087;&#1080;&#1089;&#1072;&#1090;&#1100;
&#1089;&#1074;&#1086;&#1102; &#1092;&#1091;&#1085;&#1082;&#1094;&#1080;&#1102;
&#1087;&#1088;&#1086;&#1074;&#1077;&#1088;&#1082;&#1080;. &#1040;
&#1087;&#1086;&#1082;&#1072;
&#1074;&#1086;&#1089;&#1087;&#1086;&#1083;&#1100;&#1079;&#1091;&#1077;&#1084;&#1089;&#1103;
&#1091;&#1089;&#1083;&#1091;&#1075;&#1072;&#1084;&#1080;
ObReferenceObjectByPointer.<code><!--mstheme--></font>
<pre>         .if g_dwWinVer == WINVER_UNINITIALIZED
         
             invoke IoIsWdmVersionAvailable, 1, 20h
             .if al
                 mov g_dwWinVer, WINVER_XP_OR_HIGHER
             .else
                 mov g_dwWinVer, WINVER_2K
             .endif
 
         .endif

</pre>
<!--mstheme--><font face="Arial, Arial, Helvetica"></code>
<p>&#1057;&#1084;&#1086;&#1090;&#1088;&#1080;&#1084;, &#1074;
&#1082;&#1072;&#1082;&#1086;&#1081; &#1074;&#1077;&#1088;&#1089;&#1080;&#1080;
&#1089;&#1080;&#1089;&#1090;&#1077;&#1084;&#1099; &#1084;&#1099;
&#1085;&#1072;&#1093;&#1086;&#1076;&#1080;&#1084;&#1089;&#1103;.
&#1063;&#1090;&#1086;&#1073;&#1099; &#1085;&#1077;
&#1076;&#1077;&#1083;&#1072;&#1090;&#1100; &#1101;&#1090;&#1086;
&#1082;&#1072;&#1078;&#1076;&#1099;&#1081; &#1088;&#1072;&#1079;,
&#1080;&#1089;&#1087;&#1086;&#1083;&#1100;&#1079;&#1091;&#1077;&#1084;
&#1087;&#1077;&#1088;&#1077;&#1084;&#1077;&#1085;&#1085;&#1091;&#1102;
g_dwWinVer.</p>
<code><!--mstheme--></font>
<pre>         .if g_dwWinVer == WINVER_XP_OR_HIGHER
  
             mov esi, peProcess
             mov ebx, 80h
             .while ebx &lt; 204h

</pre>
<!--mstheme--><font face="Arial, Arial, Helvetica"></code>
<p>&#1045;&#1089;&#1083;&#1080; &#1084;&#1099;
&#1086;&#1082;&#1072;&#1079;&#1072;&#1083;&#1080;&#1089;&#1100; &#1074; XP
&#1080; &#1074;&#1099;&#1096;&#1077;, &#1073;&#1091;&#1076;&#1077;&#1084;
&#1080;&#1089;&#1082;&#1072;&#1090;&#1100; &#1087;&#1086;&#1083;&#1077;
SectionObject &#1074;
&#1089;&#1090;&#1088;&#1091;&#1082;&#1090;&#1091;&#1088;&#1077; EPROCESS &#1074;
&#1087;&#1088;&#1077;&#1076;&#1077;&#1083;&#1072;&#1093; 80h - 200h (&#1085;&#1072;&#1076;&#1077;&#1102;&#1089;&#1100;,
&#1095;&#1090;&#1086; &#1101;&#1090;&#1086;&#1075;&#1086;
&#1076;&#1080;&#1072;&#1087;&#1072;&#1079;&#1086;&#1085;&#1072;
&#1073;&#1091;&#1076;&#1077;&#1090;
&#1076;&#1086;&#1089;&#1090;&#1072;&#1090;&#1086;&#1095;&#1085;&#1086;
&#1076;&#1083;&#1103; &#1074;&#1089;&#1077;&#1093;
&#1086;&#1073;&#1085;&#1086;&#1074;&#1083;&#1077;&#1085;&#1080;&#1081;).</p>
<code><!--mstheme--></font>
<pre>                 mov edi, [esi][ebx]
                 invoke IsLikeObjectPointer, edi
                 .if eax == TRUE

</pre>
<!--mstheme--><font face="Arial, Arial, Helvetica"></code>
<p>&#1055;&#1088;&#1086;&#1094;&#1077;&#1076;&#1091;&#1088;&#1072;
IsLikeObjectPointer
&#1086;&#1090;&#1089;&#1077;&#1080;&#1074;&#1072;&#1077;&#1090; &quot;&#1084;&#1091;&#1089;&#1086;&#1088;&quot;.
&#1045;&#1089;&#1083;&#1080; &#1086;&#1085;&#1072;
&#1074;&#1077;&#1088;&#1085;&#1091;&#1083;&#1072; TRUE, &#1090;&#1086;
&#1074;&#1087;&#1086;&#1083;&#1085;&#1077;
&#1074;&#1077;&#1088;&#1086;&#1103;&#1090;&#1085;&#1086;, &#1095;&#1090;&#1086;
&#1074; &#1088;&#1077;&#1075;&#1080;&#1089;&#1090;&#1088;&#1077; edi
&#1089;&#1086;&#1076;&#1077;&#1088;&#1078;&#1080;&#1090;&#1089;&#1103;
&#1091;&#1082;&#1072;&#1079;&#1072;&#1090;&#1077;&#1083;&#1100; &#1085;&#1072;
&#1086;&#1073;&#1098;&#1077;&#1082;&#1090;.</p>
<code><!--mstheme--></font>
<pre>                     mov eax, edi
                     sub eax, sizeof OBJECT_HEADER
 
                     .if ([OBJECT_HEADER PTR [eax]].PointerCount &lt;= 4)
                     .if ([OBJECT_HEADER PTR [eax]].HandleCount &lt;= 1)

</pre>
<!--mstheme--><font face="Arial, Arial, Helvetica"></code>
<p>&#1045;&#1089;&#1083;&#1080; &#1084;&#1099; &#1085;&#1072;
&#1089;&#1090;&#1072;&#1076;&#1080;&#1080;
&#1089;&#1086;&#1079;&#1076;&#1072;&#1085;&#1080;&#1103;
&#1087;&#1088;&#1086;&#1094;&#1077;&#1089;&#1089;&#1072;, &#1090;&#1086;
&#1089;&#1095;&#1077;&#1090;&#1095;&#1080;&#1082;
&#1089;&#1089;&#1099;&#1083;&#1086;&#1082;
&#1073;&#1072;&#1079;&#1086;&#1074;&#1086;&#1081;
&#1089;&#1077;&#1082;&#1094;&#1080;&#1080; &#1073;&#1091;&#1076;&#1077;&#1090;
&#1088;&#1072;&#1074;&#1077;&#1085; 3, &#1072;
&#1089;&#1095;&#1077;&#1090;&#1095;&#1080;&#1082;
&#1086;&#1087;&#1080;&#1089;&#1072;&#1090;&#1077;&#1083;&#1077;&#1081; 1.
&#1045;&#1089;&#1083;&#1080; &#1087;&#1088;&#1086;&#1094;&#1077;&#1089;&#1089;
&#1091;&#1076;&#1072;&#1083;&#1103;&#1077;&#1090;&#1089;&#1103;, &#1090;&#1086;
2 &#1080; 0,
&#1089;&#1086;&#1086;&#1090;&#1074;&#1077;&#1090;&#1089;&#1090;&#1074;&#1077;&#1085;&#1085;&#1086;.
&#1069;&#1090;&#1080; &#1087;&#1088;&#1086;&#1074;&#1077;&#1088;&#1082;&#1080;
&#1087;&#1086;&#1079;&#1074;&#1086;&#1083;&#1103;&#1090; &#1077;&#1097;&#1105;
&#1089;&#1080;&#1083;&#1100;&#1085;&#1077;&#1077;
&#1086;&#1075;&#1088;&#1072;&#1085;&#1080;&#1095;&#1080;&#1090;&#1100;
&#1095;&#1080;&#1089;&#1083;&#1086;
&#1074;&#1086;&#1079;&#1084;&#1086;&#1078;&#1085;&#1099;&#1093;
&#1082;&#1072;&#1085;&#1076;&#1080;&#1076;&#1072;&#1090;&#1086;&#1074;
&#1085;&#1072; &#1086;&#1073;&#1098;&#1077;&#1082;&#1090; &quot;&#1089;&#1077;&#1082;&#1094;&#1080;&#1103;&quot;.
&#1071; &#1085;&#1072;&#1082;&#1080;&#1085;&#1091;&#1083;
&#1077;&#1076;&#1080;&#1085;&#1080;&#1095;&#1082;&#1091; &#1082;
&#1089;&#1095;&#1077;&#1090;&#1095;&#1080;&#1082;&#1091; - &#1085;&#1072;
&#1074;&#1089;&#1103;&#1082;&#1080;&#1081;
&#1089;&#1083;&#1091;&#1095;&#1072;&#1081;. &#1050;&#1072;&#1082; &#1103;
&#1091;&#1078;&#1077; &#1075;&#1086;&#1074;&#1086;&#1088;&#1080;&#1083;,
&#1087;&#1088;&#1080; &#1093;&#1086;&#1088;&#1086;&#1096;&#1077;&#1084;
&#1091;&#1088;&#1086;&#1074;&#1085;&#1077;
&#1079;&#1085;&#1072;&#1085;&#1080;&#1081; &#1084;&#1086;&#1078;&#1085;&#1086;
&#1085;&#1072;&#1087;&#1080;&#1089;&#1072;&#1090;&#1100;
&#1087;&#1088;&#1086;&#1094;&#1077;&#1076;&#1091;&#1088;&#1091;,
&#1087;&#1088;&#1072;&#1082;&#1090;&#1080;&#1095;&#1077;&#1089;&#1082;&#1080;
&#1086;&#1076;&#1085;&#1086;&#1079;&#1085;&#1072;&#1095;&#1085;&#1086;
&#1080;&#1076;&#1077;&#1085;&#1090;&#1080;&#1092;&#1080;&#1094;&#1080;&#1088;&#1091;&#1102;&#1097;&#1091;&#1102;
&#1086;&#1073;&#1098;&#1077;&#1082;&#1090;, &#1085;&#1086;
&#1076;&#1072;&#1073;&#1099; &#1085;&#1077;
&#1091;&#1089;&#1083;&#1086;&#1078;&#1085;&#1103;&#1090;&#1100; &#1080;
&#1073;&#1077;&#1079; &#1090;&#1086;&#1075;&#1086;
&#1085;&#1077;&#1087;&#1088;&#1086;&#1089;&#1090;&#1086;&#1081;
&#1082;&#1086;&#1076; &#1084;&#1099; &#1080;&#1076;&#1077;&#1084;
&#1083;&#1077;&#1075;&#1082;&#1080;&#1084;&#1080;
&#1087;&#1091;&#1090;&#1103;&#1084;&#1080;. &#1044;&#1083;&#1103;
&#1090;&#1086;&#1075;&#1086; &#1095;&#1090;&#1086;&#1073;&#1099;
&#1086;&#1082;&#1086;&#1085;&#1095;&#1072;&#1090;&#1077;&#1083;&#1100;&#1085;&#1086;
&#1091;&#1073;&#1077;&#1076;&#1080;&#1090;&#1100;&#1089;&#1103; &#1074;
&#1090;&#1086;&#1084;, &#1095;&#1090;&#1086;
&#1088;&#1077;&#1075;&#1080;&#1089;&#1090;&#1088; edi
&#1089;&#1086;&#1076;&#1077;&#1088;&#1078;&#1080;&#1090;
&#1091;&#1082;&#1072;&#1079;&#1072;&#1090;&#1077;&#1083;&#1100; &#1085;&#1072;
&#1086;&#1073;&#1098;&#1077;&#1082;&#1090; &quot;&#1089;&#1077;&#1082;&#1094;&#1080;&#1103;&quot;,
&#1080;&#1089;&#1087;&#1086;&#1083;&#1100;&#1079;&#1091;&#1077;&#1084;
ObReferenceObjectByPointer.</p>
<code><!--mstheme--></font>
<pre>                         mov ecx, MmSectionObjectType
                         mov ecx, [ecx]
                         mov ecx, [ecx]
 
                         invoke ObReferenceObjectByPointer, edi, SECTION_QUERY, ecx, UserMode
                         .if eax == STATUS_SUCCESS

</pre>
<!--mstheme--><font face="Arial, Arial, Helvetica"></code>
<p>&#1047;&#1076;&#1077;&#1089;&#1100; &#1084;&#1099; &#1091;&#1078;&#1077;
&#1091;&#1074;&#1077;&#1088;&#1077;&#1085;&#1099;, &#1095;&#1090;&#1086;
&#1085;&#1072;&#1096;&#1083;&#1080; &#1090;&#1086;, &#1095;&#1090;&#1086;
&#1080;&#1089;&#1082;&#1072;&#1083;&#1080;.</p>
<code><!--mstheme--></font>
<pre>                             mov status, eax
                             mov pSection, edi
 
                             .break
                         .endif
                     .endif
                     .endif
                 .endif
 
                 add ebx, 4

             .endw

</pre>
<!--mstheme--><font face="Arial, Arial, Helvetica"></code>
<p>&#1045;&#1089;&#1083;&#1080; &#1087;&#1086;&#1083;&#1077; SectionObject
&#1074;&#1089;&#1105; &#1077;&#1097;&#1105; &#1085;&#1077;
&#1085;&#1072;&#1081;&#1076;&#1077;&#1085;&#1086;,
&#1087;&#1088;&#1086;&#1076;&#1086;&#1083;&#1078;&#1072;&#1077;&#1084;
&#1087;&#1086;&#1080;&#1089;&#1082;.
&#1059;&#1082;&#1072;&#1079;&#1072;&#1090;&#1077;&#1083;&#1080; &#1074;
&#1089;&#1090;&#1088;&#1091;&#1082;&#1090;&#1091;&#1088;&#1072;&#1093;
&#1074;&#1089;&#1077;&#1075;&#1076;&#1072;
&#1074;&#1099;&#1088;&#1086;&#1074;&#1085;&#1077;&#1085;&#1099; &#1087;&#1086;
&#1076;&#1074;&#1086;&#1081;&#1085;&#1086;&#1084;&#1091;
&#1089;&#1083;&#1086;&#1074;&#1091;.
&#1055;&#1086;&#1101;&#1090;&#1086;&#1084;&#1091;
&#1076;&#1074;&#1080;&#1075;&#1072;&#1077;&#1084;&#1089;&#1103; DWORD'&#1072;&#1084;&#1080;.</p>
<code><!--mstheme--></font>
<pre>         .else

</pre>
<!--mstheme--><font face="Arial, Arial, Helvetica"></code>
<p>&#1045;&#1089;&#1083;&#1080; &#1084;&#1099; &#1074; Windows 2000,
&#1090;&#1086; &#1090;&#1091;&#1090; &#1090;&#1086;&#1078;&#1077; &#1085;&#1077;
&#1074;&#1089;&#1105; &#1090;&#1072;&#1082;
&#1087;&#1088;&#1086;&#1089;&#1090;&#1086;, &#1082;&#1072;&#1082;
&#1093;&#1086;&#1090;&#1077;&#1083;&#1086;&#1089;&#1100; &#1073;&#1099;.
&#1058;&#1086;&#1095;&#1085;&#1077;&#1077;,
&#1089;&#1083;&#1086;&#1078;&#1085;&#1086;&#1089;&#1090;&#1080;
&#1085;&#1072;&#1095;&#1080;&#1085;&#1072;&#1102;&#1090;&#1089;&#1103; &#1089;
&#1089;&#1077;&#1088;&#1074;&#1080;&#1089; &#1087;&#1072;&#1082;&#1072;
&#8470;4. &#1044;&#1086; &#1101;&#1090;&#1086;&#1075;&#1086;
&#1079;&#1083;&#1086;&#1089;&#1095;&#1072;&#1089;&#1090;&#1085;&#1086;&#1075;&#1086;
SP4 &#1074;&#1089;&#1105; &#1087;&#1088;&#1086;&#1089;&#1090;&#1086;.
&#1044;&#1086;&#1089;&#1090;&#1072;&#1090;&#1086;&#1095;&#1085;&#1086; &quot;&#1085;&#1072;&#1090;&#1088;&#1072;&#1074;&#1080;&#1090;&#1100;&quot;
&#1092;&#1091;&#1085;&#1082;&#1094;&#1080;&#1102; ObReferenceObjectByHandle
&#1085;&#1072; &#1094;&#1080;&#1092;&#1088;&#1091; 4 &#1080;
&#1087;&#1086;&#1083;&#1091;&#1095;&#1080;&#1090;&#1100;
&#1091;&#1082;&#1072;&#1079;&#1072;&#1090;&#1077;&#1083;&#1100; &#1085;&#1072;
&#1073;&#1072;&#1079;&#1086;&#1074;&#1091;&#1102;
&#1089;&#1077;&#1082;&#1094;&#1080;&#1102;
&#1087;&#1088;&#1086;&#1094;&#1077;&#1089;&#1089;&#1072;. &#1053;&#1086;
&#1085;&#1072; SP4, &#1074; &#1089;&#1083;&#1091;&#1095;&#1072;&#1077;
&#1077;&#1089;&#1083;&#1080; &#1087;&#1088;&#1086;&#1094;&#1077;&#1089;&#1089;
&#1079;&#1072;&#1087;&#1091;&#1089;&#1082;&#1072;&#1077;&#1090;&#1089;&#1103;
&#1080;&#1079; &#1082;&#1086;&#1084;&#1072;&#1085;&#1076;&#1085;&#1086;&#1081;
&#1089;&#1090;&#1088;&#1086;&#1082;&#1080; &#1080;&#1083;&#1080; bat-&#1092;&#1072;&#1081;&#1083;&#1086;&#1084;,
&#1086;&#1087;&#1080;&#1089;&#1072;&#1090;&#1077;&#1083;&#1100;
&#1073;&#1072;&#1079;&#1086;&#1074;&#1086;&#1081;
&#1089;&#1077;&#1082;&#1094;&#1080;&#1080;
&#1087;&#1088;&#1086;&#1094;&#1077;&#1089;&#1089;&#1072;,
&#1080;&#1084;&#1077;&#1077;&#1090;
&#1079;&#1085;&#1072;&#1095;&#1077;&#1085;&#1080;&#1077; 03E8h.
&#1055;&#1088;&#1080;&#1095;&#1077;&#1084; &#1086;&#1085;&#1086;
&#1090;&#1072;&#1082;&#1078;&#1077;
&#1092;&#1080;&#1082;&#1089;&#1080;&#1088;&#1086;&#1074;&#1072;&#1085;&#1086;.
&#1055;&#1086; &#1082;&#1088;&#1072;&#1081;&#1085;&#1077;&#1081;
&#1084;&#1077;&#1088;&#1077;, &#1085;&#1072; &#1084;&#1086;&#1077;&#1081;
&#1084;&#1072;&#1096;&#1080;&#1085;&#1077; &#1080; &#1085;&#1072;
&#1077;&#1097;&#1105; 5 &#1084;&#1072;&#1096;&#1080;&#1085;&#1072;&#1093;
&#1085;&#1072;&#1096;&#1080;&#1093;
&#1091;&#1074;&#1072;&#1078;&#1072;&#1077;&#1084;&#1099;&#1093;
&#1082;&#1086;&#1083;&#1083;&#1077;&#1075;,
&#1083;&#1102;&#1073;&#1077;&#1079;&#1085;&#1086;
&#1089;&#1086;&#1075;&#1083;&#1072;&#1089;&#1080;&#1074;&#1096;&#1080;&#1093;&#1089;&#1103;
&#1087;&#1088;&#1086;&#1090;&#1077;&#1089;&#1090;&#1080;&#1088;&#1086;&#1074;&#1072;&#1090;&#1100;
&#1101;&#1090;&#1086;&#1090; &#1087;&#1088;&#1080;&#1084;&#1077;&#1088; (<b>nerst</b>,
<b>Noble Ghost</b>, <b>hGoblin</b>, <b>mokc0der</b>, <b>Vladimir</b>),
&#1079;&#1085;&#1072;&#1095;&#1077;&#1085;&#1080;&#1077;
&#1073;&#1099;&#1083;&#1086; &#1080;&#1084;&#1077;&#1085;&#1085;&#1086;
&#1090;&#1072;&#1082;&#1080;&#1084;. &#1054;&#1090;&#1082;&#1091;&#1076;&#1072;
&#1073;&#1077;&#1088;&#1077;&#1090;&#1089;&#1103;
&#1090;&#1072;&#1082;&#1086;&#1077;
&#1089;&#1090;&#1088;&#1072;&#1085;&#1085;&#1086;&#1077;
&#1079;&#1085;&#1072;&#1095;&#1077;&#1085;&#1080;&#1077;?</p>
<p>&#1054;&#1087;&#1080;&#1089;&#1072;&#1090;&#1077;&#1083;&#1100;
&#1086;&#1073;&#1098;&#1077;&#1082;&#1090;&#1072;
&#1087;&#1088;&#1077;&#1076;&#1089;&#1090;&#1072;&#1074;&#1083;&#1103;&#1077;&#1090;
&#1089;&#1086;&#1073;&#1086;&#1081; &#1080;&#1085;&#1076;&#1077;&#1082;&#1089;
&#1074; &#1090;&#1072;&#1073;&#1083;&#1080;&#1094;&#1077;
&#1086;&#1087;&#1080;&#1089;&#1072;&#1090;&#1077;&#1083;&#1077;&#1081;
&#1087;&#1088;&#1086;&#1094;&#1077;&#1089;&#1089;&#1072;.
&#1058;&#1072;&#1073;&#1083;&#1080;&#1094;&#1072;
&#1086;&#1087;&#1080;&#1089;&#1072;&#1090;&#1077;&#1083;&#1077;&#1081;
&#1088;&#1077;&#1072;&#1083;&#1080;&#1079;&#1086;&#1074;&#1072;&#1085;&#1072;
&#1087;&#1086;
&#1090;&#1088;&#1077;&#1093;&#1091;&#1088;&#1086;&#1074;&#1085;&#1077;&#1074;&#1086;&#1081;
&#1089;&#1093;&#1077;&#1084;&#1077;
&#1072;&#1085;&#1072;&#1083;&#1086;&#1075;&#1080;&#1095;&#1085;&#1086;
&#1088;&#1077;&#1072;&#1083;&#1080;&#1079;&#1072;&#1094;&#1080;&#1080;
&#1084;&#1077;&#1093;&#1072;&#1085;&#1080;&#1079;&#1084;&#1072;
&#1090;&#1088;&#1072;&#1085;&#1089;&#1083;&#1103;&#1094;&#1080;&#1080;
&#1072;&#1076;&#1088;&#1077;&#1089;&#1086;&#1074; &#1074; x86
&#1089;&#1080;&#1089;&#1090;&#1077;&#1084;&#1072;&#1093;.
&#1052;&#1083;&#1072;&#1076;&#1096;&#1080;&#1077; 24
&#1073;&#1080;&#1090;&#1072;
&#1086;&#1087;&#1080;&#1089;&#1072;&#1090;&#1077;&#1083;&#1103;
&#1080;&#1085;&#1090;&#1077;&#1088;&#1087;&#1088;&#1077;&#1090;&#1080;&#1088;&#1091;&#1102;&#1090;&#1089;&#1103;
&#1082;&#1072;&#1082; &#1090;&#1088;&#1080; 8-&#1073;&#1080;&#1090;&#1085;&#1099;&#1093;
&#1080;&#1085;&#1076;&#1077;&#1082;&#1089;&#1072; &#1076;&#1083;&#1103;
&#1082;&#1072;&#1078;&#1076;&#1086;&#1075;&#1086;
&#1091;&#1088;&#1086;&#1074;&#1085;&#1103;.
&#1055;&#1077;&#1088;&#1074;&#1099;&#1077; &#1076;&#1074;&#1072;
&#1091;&#1088;&#1086;&#1074;&#1085;&#1103;
&#1089;&#1086;&#1089;&#1090;&#1086;&#1103;&#1090; &#1080;&#1079;
&#1084;&#1072;&#1089;&#1089;&#1080;&#1074;&#1086;&#1074; &#1087;&#1086; 256
&#1101;&#1083;&#1077;&#1084;&#1077;&#1085;&#1090;&#1086;&#1074;,
&#1082;&#1086;&#1090;&#1086;&#1088;&#1099;&#1077;
&#1089;&#1086;&#1076;&#1077;&#1088;&#1078;&#1072;&#1090;
&#1091;&#1082;&#1072;&#1079;&#1072;&#1090;&#1077;&#1083;&#1080; &#1085;&#1072;
&#1084;&#1072;&#1089;&#1089;&#1080;&#1074;
&#1089;&#1083;&#1077;&#1076;&#1091;&#1102;&#1097;&#1077;&#1075;&#1086;
&#1091;&#1088;&#1086;&#1074;&#1085;&#1103;.
&#1052;&#1072;&#1089;&#1089;&#1080;&#1074;
&#1089;&#1072;&#1084;&#1086;&#1075;&#1086;
&#1085;&#1080;&#1078;&#1085;&#1077;&#1075;&#1086;
&#1091;&#1088;&#1086;&#1074;&#1085;&#1103; - &#1101;&#1090;&#1086;
&#1090;&#1072;&#1073;&#1083;&#1080;&#1094;&#1072;
&#1074;&#1090;&#1086;&#1088;&#1080;&#1095;&#1085;&#1099;&#1093;
&#1086;&#1087;&#1080;&#1089;&#1072;&#1090;&#1077;&#1083;&#1077;&#1081; &#1080;
&#1089;&#1086;&#1076;&#1077;&#1088;&#1078;&#1080;&#1090;
&#1089;&#1086;&#1073;&#1089;&#1090;&#1074;&#1077;&#1085;&#1085;&#1086;
&#1101;&#1083;&#1077;&#1084;&#1077;&#1085;&#1090;&#1099;
&#1090;&#1072;&#1073;&#1083;&#1080;&#1094;&#1099;
&#1086;&#1087;&#1080;&#1089;&#1072;&#1090;&#1077;&#1083;&#1077;&#1081;,
&#1082;&#1072;&#1078;&#1076;&#1099;&#1081; &#1080;&#1079;
&#1082;&#1086;&#1090;&#1086;&#1088;&#1099;&#1093;
&#1080;&#1084;&#1077;&#1077;&#1090; &#1088;&#1072;&#1079;&#1084;&#1077;&#1088;
&#1074; &#1074;&#1086;&#1089;&#1077;&#1084;&#1100; &#1073;&#1072;&#1081;&#1090;
(&#1091;&#1082;&#1072;&#1079;&#1072;&#1090;&#1077;&#1083;&#1100; &#1085;&#1072;
&#1079;&#1072;&#1075;&#1086;&#1083;&#1086;&#1074;&#1086;&#1082;
&#1086;&#1073;&#1098;&#1077;&#1082;&#1090;&#1072; &#1080;
&#1092;&#1083;&#1072;&#1075;&#1080;). &#1057;&#1072;&#1084;&#1099;&#1081;
&#1087;&#1086;&#1089;&#1083;&#1077;&#1076;&#1085;&#1080;&#1081;
&#1101;&#1083;&#1077;&#1084;&#1077;&#1085;&#1090; (256-&#1086;&#1081;)
&#1082;&#1072;&#1078;&#1076;&#1086;&#1081;
&#1085;&#1077;&#1079;&#1072;&#1087;&#1086;&#1083;&#1085;&#1077;&#1085;&#1085;&#1086;&#1081;
&#1090;&#1072;&#1073;&#1083;&#1080;&#1094;&#1099;
&#1074;&#1090;&#1086;&#1088;&#1080;&#1095;&#1085;&#1099;&#1093;
&#1086;&#1087;&#1080;&#1089;&#1072;&#1090;&#1077;&#1083;&#1077;&#1081;
&#1080;&#1085;&#1080;&#1094;&#1080;&#1072;&#1083;&#1080;&#1079;&#1080;&#1088;&#1091;&#1077;&#1090;&#1089;&#1103;
&#1079;&#1085;&#1072;&#1095;&#1077;&#1085;&#1080;&#1077;&#1084; -1.
&#1055;&#1086;&#1089;&#1082;&#1086;&#1083;&#1100;&#1082;&#1091;
&#1091;&#1082;&#1072;&#1079;&#1072;&#1090;&#1077;&#1083;&#1100;
&#1080;&#1084;&#1077;&#1077;&#1090; &#1088;&#1072;&#1079;&#1084;&#1077;&#1088;
&#1074; &#1095;&#1077;&#1090;&#1099;&#1088;&#1077;
&#1073;&#1072;&#1081;&#1090;&#1072;, &#1090;&#1086; &#1080;
&#1086;&#1087;&#1080;&#1089;&#1072;&#1090;&#1077;&#1083;&#1080;
&#1082;&#1088;&#1072;&#1090;&#1085;&#1099;
&#1095;&#1077;&#1090;&#1099;&#1088;&#1077;&#1084;.
&#1054;&#1087;&#1080;&#1089;&#1072;&#1090;&#1077;&#1083;&#1100; &#1089;&#1086;
&#1079;&#1085;&#1072;&#1095;&#1077;&#1085;&#1080;&#1077;&#1084; 0 (1-&#1099;&#1081;
&#1101;&#1083;&#1077;&#1084;&#1077;&#1085;&#1090; &#1074;
&#1087;&#1077;&#1088;&#1074;&#1086;&#1081;
&#1090;&#1072;&#1073;&#1083;&#1080;&#1094;&#1077;
&#1074;&#1090;&#1086;&#1088;&#1080;&#1095;&#1085;&#1099;&#1093;
&#1086;&#1087;&#1080;&#1089;&#1072;&#1090;&#1077;&#1083;&#1077;&#1081;)
&#1085;&#1077;
&#1080;&#1089;&#1087;&#1086;&#1083;&#1100;&#1079;&#1091;&#1077;&#1090;&#1089;&#1103;.
&#1058;.&#1086;. &#1089;&#1072;&#1084;&#1099;&#1081;
&#1087;&#1077;&#1088;&#1074;&#1099;&#1081;
&#1086;&#1073;&#1098;&#1077;&#1082;&#1090; &#1074;
&#1087;&#1088;&#1086;&#1094;&#1077;&#1089;&#1089;&#1077;
&#1087;&#1086;&#1083;&#1091;&#1095;&#1080;&#1090;
&#1086;&#1087;&#1080;&#1089;&#1072;&#1090;&#1077;&#1083;&#1100; 4 (2-&#1086;&#1081;
&#1101;&#1083;&#1077;&#1084;&#1077;&#1085;&#1090; &#1074;
&#1087;&#1077;&#1088;&#1074;&#1086;&#1081;
&#1090;&#1072;&#1073;&#1083;&#1080;&#1094;&#1077;
&#1074;&#1090;&#1086;&#1088;&#1080;&#1095;&#1085;&#1099;&#1093;
&#1086;&#1087;&#1080;&#1089;&#1072;&#1090;&#1077;&#1083;&#1077;&#1081;),
&#1074;&#1090;&#1086;&#1088;&#1086;&#1081; - 8 (3-&#1080;&#1081;
&#1101;&#1083;&#1077;&#1084;&#1077;&#1085;&#1090; &#1074;
&#1087;&#1077;&#1088;&#1074;&#1086;&#1081;
&#1090;&#1072;&#1073;&#1083;&#1080;&#1094;&#1077;
&#1074;&#1090;&#1086;&#1088;&#1080;&#1095;&#1085;&#1099;&#1093;
&#1086;&#1087;&#1080;&#1089;&#1072;&#1090;&#1077;&#1083;&#1077;&#1081;) &#1080;
&#1090;.&#1076;. &#1076;&#1086; 3F8h (255-&#1099;&#1081;
&#1101;&#1083;&#1077;&#1084;&#1077;&#1085;&#1090; &#1074;
&#1087;&#1077;&#1088;&#1074;&#1086;&#1081;
&#1090;&#1072;&#1073;&#1083;&#1080;&#1094;&#1077;
&#1074;&#1090;&#1086;&#1088;&#1080;&#1095;&#1085;&#1099;&#1093;
&#1086;&#1087;&#1080;&#1089;&#1072;&#1090;&#1077;&#1083;&#1077;&#1081;).
&#1044;&#1086;&#1081;&#1076;&#1103; &#1076;&#1086;
&#1086;&#1087;&#1080;&#1089;&#1072;&#1090;&#1077;&#1083;&#1103; 3FCh (256-&#1086;&#1081;
&#1080; &#1087;&#1086;&#1089;&#1083;&#1077;&#1076;&#1085;&#1080;&#1081;
&#1101;&#1083;&#1077;&#1084;&#1077;&#1085;&#1090; &#1074;
&#1087;&#1077;&#1088;&#1074;&#1086;&#1081;
&#1090;&#1072;&#1073;&#1083;&#1080;&#1094;&#1077;
&#1074;&#1090;&#1086;&#1088;&#1080;&#1095;&#1085;&#1099;&#1093;
&#1086;&#1087;&#1080;&#1089;&#1072;&#1090;&#1077;&#1083;&#1077;&#1081;)
&#1076;&#1080;&#1089;&#1087;&#1077;&#1090;&#1095;&#1077;&#1088;
&#1086;&#1073;&#1098;&#1077;&#1082;&#1090;&#1086;&#1074;
&#1091;&#1074;&#1080;&#1076;&#1080;&#1090; -1,
&#1074;&#1099;&#1076;&#1077;&#1083;&#1080;&#1090; &#1087;&#1088;&#1080;
&#1085;&#1077;&#1086;&#1073;&#1093;&#1086;&#1076;&#1080;&#1084;&#1086;&#1089;&#1090;&#1080;
&#1074;&#1090;&#1086;&#1088;&#1091;&#1102;
&#1090;&#1072;&#1073;&#1083;&#1080;&#1094;&#1091;
&#1074;&#1090;&#1086;&#1088;&#1080;&#1095;&#1085;&#1099;&#1093;
&#1086;&#1087;&#1080;&#1089;&#1072;&#1090;&#1077;&#1083;&#1077;&#1081; &#1080;
&#1079;&#1072;&#1087;&#1086;&#1083;&#1085;&#1080;&#1090; 256-&#1086;&#1081;
&#1101;&#1083;&#1077;&#1084;&#1077;&#1085;&#1090;
&#1087;&#1077;&#1088;&#1074;&#1086;&#1081; (&#1079;&#1072;&#1084;&#1077;&#1089;&#1090;&#1080;&#1074;
-1).
&#1055;&#1086;&#1089;&#1083;&#1077;&#1076;&#1091;&#1102;&#1097;&#1080;&#1077;
&#1086;&#1087;&#1080;&#1089;&#1072;&#1090;&#1077;&#1083;&#1080; (400h - 800h)
&#1073;&#1091;&#1076;&#1091;&#1090;
&#1087;&#1086;&#1087;&#1072;&#1076;&#1072;&#1090;&#1100; &#1074;&#1086;
&#1074;&#1090;&#1086;&#1088;&#1091;&#1102;
&#1090;&#1072;&#1073;&#1083;&#1080;&#1094;&#1091;
&#1074;&#1090;&#1086;&#1088;&#1080;&#1095;&#1085;&#1099;&#1093;
&#1086;&#1087;&#1080;&#1089;&#1072;&#1090;&#1077;&#1083;&#1077;&#1081; &#1080;
&#1090;.&#1076;.</p>
<p>&#1053;&#1086; &#1085;&#1072;
&#1089;&#1080;&#1089;&#1090;&#1077;&#1084;&#1072;&#1093; W2K+SP4
&#1087;&#1088;&#1080; &#1079;&#1072;&#1087;&#1091;&#1089;&#1082;&#1077;
&#1087;&#1088;&#1086;&#1094;&#1077;&#1089;&#1089;&#1072; &#1080;&#1079;
&#1082;&#1086;&#1084;&#1072;&#1085;&#1076;&#1085;&#1086;&#1081;
&#1089;&#1090;&#1088;&#1086;&#1082;&#1080;
&#1087;&#1077;&#1088;&#1074;&#1072;&#1103;
&#1090;&#1072;&#1073;&#1083;&#1080;&#1094;&#1072;
&#1074;&#1090;&#1086;&#1088;&#1080;&#1095;&#1085;&#1099;&#1093;
&#1086;&#1087;&#1080;&#1089;&#1072;&#1090;&#1077;&#1083;&#1077;&#1081;
&#1079;&#1072;&#1087;&#1086;&#1083;&#1085;&#1103;&#1077;&#1090;&#1089;&#1103;
&#1089;&#1074;&#1077;&#1088;&#1093;&#1091; &#1074;&#1085;&#1080;&#1079;: 3F8h -
4. &#1047;&#1072;&#1090;&#1077;&#1084;
&#1076;&#1080;&#1089;&#1087;&#1077;&#1090;&#1095;&#1077;&#1088;&#1091;
&#1086;&#1073;&#1098;&#1077;&#1082;&#1090;&#1086;&#1074;
&#1087;&#1088;&#1080;&#1093;&#1086;&#1076;&#1080;&#1090;&#1089;&#1103;
&#1090;&#1072;&#1082;&#1080;
&#1079;&#1072;&#1087;&#1086;&#1083;&#1085;&#1080;&#1090;&#1100;
&#1087;&#1086;&#1089;&#1083;&#1077;&#1076;&#1085;&#1080;&#1081;
&#1101;&#1083;&#1077;&#1084;&#1077;&#1085;&#1090; &#1074;
&#1087;&#1077;&#1088;&#1074;&#1086;&#1081;
&#1090;&#1072;&#1073;&#1083;&#1080;&#1094;&#1077;
&#1074;&#1090;&#1086;&#1088;&#1080;&#1095;&#1085;&#1099;&#1093;
&#1086;&#1087;&#1080;&#1089;&#1072;&#1090;&#1077;&#1083;&#1077;&#1081; 3FCh.
&#1048; &#1076;&#1072;&#1083;&#1100;&#1096;&#1077; &#1074;&#1089;&#1105;
&#1087;&#1088;&#1086;&#1076;&#1086;&#1083;&#1078;&#1072;&#1077;&#1090;&#1089;&#1103;
&#1082;&#1072;&#1082; &#1086;&#1073;&#1099;&#1095;&#1085;&#1086;: 400h - &#1080;
&#1076;&#1072;&#1083;&#1100;&#1096;&#1077; &#1087;&#1086;
&#1074;&#1086;&#1079;&#1088;&#1072;&#1089;&#1090;&#1072;&#1102;&#1097;&#1077;&#1081;.
&#1048;&#1085;&#1090;&#1077;&#1088;&#1077;&#1089;&#1072;
&#1088;&#1072;&#1076;&#1080;, &#1103;
&#1087;&#1086;&#1089;&#1084;&#1086;&#1090;&#1088;&#1077;&#1083;
&#1082;&#1072;&#1082; &#1101;&#1090;&#1086;
&#1087;&#1088;&#1086;&#1080;&#1089;&#1093;&#1086;&#1076;&#1080;&#1090;
&#1085;&#1072; Windows XP: 7FCh - 4, 804h - &#1080;
&#1076;&#1072;&#1083;&#1100;&#1096;&#1077; &#1087;&#1086;
&#1074;&#1086;&#1079;&#1088;&#1072;&#1089;&#1090;&#1072;&#1102;&#1097;&#1077;&#1081;.
&#1050;&#1091;&#1076;&#1072;
&#1087;&#1086;&#1076;&#1077;&#1074;&#1072;&#1083;&#1089;&#1103;
&#1086;&#1087;&#1080;&#1089;&#1072;&#1090;&#1077;&#1083;&#1100; 800h &#1103;
&#1085;&#1077; &#1079;&#1085;&#1072;&#1102;.</p>
<p>&#1071; &#1087;&#1088;&#1077;&#1082;&#1088;&#1072;&#1089;&#1085;&#1086;
&#1087;&#1086;&#1085;&#1080;&#1084;&#1072;&#1102;, &#1095;&#1090;&#1086;
&#1077;&#1089;&#1083;&#1080; &#1074;&#1099; &#1085;&#1077;
&#1079;&#1085;&#1072;&#1082;&#1086;&#1084;&#1099; &#1089;
&#1086;&#1088;&#1075;&#1072;&#1085;&#1080;&#1079;&#1072;&#1094;&#1080;&#1077;&#1081;
&#1090;&#1072;&#1073;&#1083;&#1080;&#1094;&#1099;
&#1086;&#1087;&#1080;&#1089;&#1072;&#1090;&#1077;&#1083;&#1077;&#1081;,
&#1090;&#1086; &#1074;&#1088;&#1103;&#1076; &#1083;&#1080; &#1095;&#1090;&#1086;-&#1090;&#1086;
&#1087;&#1086;&#1085;&#1103;&#1083;&#1080; &#1080;&#1079;
&#1101;&#1090;&#1086;&#1075;&#1086;
&#1086;&#1073;&#1098;&#1103;&#1089;&#1085;&#1077;&#1085;&#1080;&#1103;.
&#1063;&#1080;&#1090;&#1072;&#1081;&#1090;&#1077;
&#1088;&#1072;&#1079;&#1076;&#1077;&#1083; &quot;&#1054;&#1087;&#1080;&#1089;&#1072;&#1090;&#1077;&#1083;&#1080;
&#1086;&#1073;&#1098;&#1077;&#1082;&#1090;&#1086;&#1074; &#1080;
&#1090;&#1072;&#1073;&#1083;&#1080;&#1094;&#1072;
&#1086;&#1087;&#1080;&#1089;&#1072;&#1090;&#1077;&#1083;&#1077;&#1081;,
&#1087;&#1088;&#1080;&#1085;&#1072;&#1076;&#1083;&#1077;&#1078;&#1072;&#1097;&#1072;&#1103;
&#1087;&#1088;&#1086;&#1094;&#1077;&#1089;&#1089;&#1091;&quot; &#1074;
&#1082;&#1085;&#1080;&#1075;&#1077; &quot;&#1042;&#1085;&#1091;&#1090;&#1088;&#1077;&#1085;&#1085;&#1077;&#1077;
&#1091;&#1089;&#1090;&#1088;&#1086;&#1081;&#1089;&#1090;&#1074;&#1086; Microsoft
Windows 2000&quot;, &#1073;&#1077;&#1088;&#1080;&#1090;&#1077; &#1074;
&#1088;&#1091;&#1082;&#1080; SoftICE
&#1080;&#1089;&#1087;&#1086;&#1083;&#1100;&#1079;&#1091;&#1081;&#1090;&#1077;
&#1101;&#1090;&#1080;
&#1089;&#1090;&#1088;&#1091;&#1082;&#1090;&#1091;&#1088;&#1099; &#1080;
&#1084;&#1085;&#1086;&#1075;&#1086;&#1077;
&#1087;&#1088;&#1086;&#1103;&#1089;&#1085;&#1080;&#1090;&#1089;&#1103;.
&#1057;&#1084;&#1077;&#1097;&#1077;&#1085;&#1080;&#1077;
&#1087;&#1086;&#1083;&#1103; ObjectTable &#1088;&#1072;&#1074;&#1085;&#1086;
0128h, 00C4h &#1080; 00C4h &#1076;&#1083;&#1103; Windows 2000, XP &#1080; Server
2003
&#1089;&#1086;&#1086;&#1090;&#1074;&#1077;&#1090;&#1089;&#1090;&#1074;&#1077;&#1085;&#1085;&#1086;.
&#1055;&#1086;&#1083;&#1077; Table &#1093;&#1088;&#1072;&#1085;&#1080;&#1090;
&#1091;&#1082;&#1072;&#1079;&#1072;&#1090;&#1077;&#1083;&#1100; &#1085;&#1072;
&#1090;&#1088;&#1077;&#1093;&#1091;&#1088;&#1086;&#1074;&#1085;&#1077;&#1074;&#1091;&#1102;
&#1090;&#1072;&#1073;&#1083;&#1080;&#1094;&#1091;.</p>
<code><!--mstheme--></font>
<pre> EPROCESS STRUCT
 . . .
     ObjectTable    PVOID  ?   ; PTR HANDLE_TABLE
 . . .
 EPROCESS ENDS

 HANDLE_TABLE STRUCT
     Flags         DWORD   ?
     HandleCount   DWORD   ?
     Table         PVOID   ?   ; PTR PTR PTR HANDLE_TABLE_ENTRY
 . . .
 HANDLE_TABLE ENDS

</pre>
<!--mstheme--><font face="Arial, Arial, Helvetica"></code>
<p>&#1054;&#1090;&#1074;&#1077;&#1090; &#1085;&#1072;
&#1074;&#1086;&#1087;&#1088;&#1086;&#1089;,
&#1087;&#1086;&#1095;&#1077;&#1084;&#1091;
&#1076;&#1080;&#1089;&#1087;&#1077;&#1090;&#1095;&#1077;&#1088;
&#1086;&#1073;&#1098;&#1077;&#1082;&#1090;&#1086;&#1074;
&#1087;&#1086;&#1089;&#1090;&#1091;&#1087;&#1072;&#1077;&#1090;
&#1080;&#1084;&#1077;&#1085;&#1085;&#1086; &#1090;&#1072;&#1082;
&#1082;&#1072;&#1082; &#1086;&#1087;&#1080;&#1089;&#1072;&#1085;&#1086;
&#1074;&#1099;&#1096;&#1077;, &#1103;
&#1086;&#1089;&#1090;&#1072;&#1074;&#1083;&#1103;&#1102; &#1079;&#1072;
&#1074;&#1072;&#1084;&#1080;.</p>
<code><!--mstheme--></font>
<pre>             xor ebx, ebx
             mov edi, 4
             .while ebx &lt; 3

</pre>
<!--mstheme--><font face="Arial, Arial, Helvetica"></code>
<p>&#1044;&#1077;&#1083;&#1072;&#1077;&#1084; &#1090;&#1088;&#1080;
&#1087;&#1086;&#1087;&#1099;&#1090;&#1082;&#1080;
&#1087;&#1086;&#1083;&#1091;&#1095;&#1080;&#1090;&#1100;
&#1091;&#1082;&#1072;&#1079;&#1072;&#1090;&#1077;&#1083;&#1100; &#1085;&#1072;
&#1073;&#1072;&#1079;&#1086;&#1074;&#1091;&#1102;
&#1089;&#1077;&#1082;&#1094;&#1080;&#1102;
&#1087;&#1088;&#1086;&#1094;&#1077;&#1089;&#1089;&#1072;.
&#1057;&#1085;&#1072;&#1095;&#1072;&#1083;&#1072;
&#1087;&#1086;&#1087;&#1088;&#1086;&#1073;&#1091;&#1077;&#1084;
&#1086;&#1087;&#1080;&#1089;&#1072;&#1090;&#1077;&#1083;&#1100; &#1089;&#1086;
&#1079;&#1085;&#1072;&#1095;&#1077;&#1085;&#1080;&#1077;&#1084; 4.</p>
<code><!--mstheme--></font>
<pre>                 invoke IoGetCurrentProcess
                 .if eax == peProcess
                     
                     mov ecx, MmSectionObjectType
                     mov ecx, [ecx]
                     mov ecx, [ecx]
                 
                     invoke ObReferenceObjectByHandle, edi, SECTION_QUERY, ecx, KernelMode, addr pSection, NULL
                     mov status, eax
 
                 .else
 
                     invoke KeAttachProcess, peProcess
 
                     mov ecx, MmSectionObjectType
                     mov ecx, [ecx]
                     mov ecx, [ecx]
 
                     invoke ObReferenceObjectByHandle, edi, SECTION_QUERY, ecx, KernelMode, addr pSection, NULL
                     mov status, eax
 
                     invoke KeDetachProcess
 
                 .endif

</pre>
<!--mstheme--><font face="Arial, Arial, Helvetica"></code>
<p>&#1045;&#1089;&#1083;&#1080; &#1084;&#1099; &#1085;&#1077; &#1074;
&#1082;&#1086;&#1085;&#1090;&#1077;&#1082;&#1089;&#1090;&#1077;
&#1089;&#1086;&#1079;&#1076;&#1072;&#1074;&#1072;&#1077;&#1084;&#1086;&#1075;&#1086;/&#1091;&#1076;&#1072;&#1083;&#1103;&#1077;&#1084;&#1086;&#1075;&#1086;
&#1087;&#1088;&#1086;&#1094;&#1077;&#1089;&#1089;&#1072;,
&#1087;&#1077;&#1088;&#1077;&#1082;&#1083;&#1102;&#1095;&#1072;&#1077;&#1084;&#1089;&#1103;
&#1085;&#1072; &#1085;&#1077;&#1075;&#1086;
&#1074;&#1099;&#1079;&#1086;&#1074;&#1086;&#1084; KeAttachProcess.</p>
<code><!--mstheme--></font>
<pre>                 .break .if status == STATUS_SUCCESS

</pre>
<!--mstheme--><font face="Arial, Arial, Helvetica"></code>
<p>&#1045;&#1089;&#1083;&#1080;
&#1087;&#1086;&#1087;&#1099;&#1090;&#1082;&#1072;
&#1091;&#1076;&#1072;&#1083;&#1072;&#1089;&#1100;,
&#1074;&#1099;&#1093;&#1086;&#1076;&#1080;&#1084; &#1080;&#1079;
&#1094;&#1080;&#1082;&#1083;&#1072;.</p>
<code><!--mstheme--></font>
<pre>                 .if ebx == 0
                     
                     mov edi, 03F8h  ; Try 03F8h handle.

</pre>
<!--mstheme--><font face="Arial, Arial, Helvetica"></code>
<p>&#1045;&#1089;&#1083;&#1080; &#1085;&#1077;&#1090; -
&#1087;&#1086;&#1087;&#1088;&#1086;&#1073;&#1091;&#1077;&#1084; &#1090;&#1086;
&#1078;&#1077; &#1089;&#1072;&#1084;&#1086;&#1077; &#1089;&#1086;
&#1079;&#1085;&#1072;&#1095;&#1077;&#1085;&#1080;&#1077;&#1084; 03F8h.</p>
<code><!--mstheme--></font>
<pre>                 .elseif ebx == 1
                     
                     mov eax, peProcess
                     add eax, 01ACh
                     mov eax, [eax]
                     mov edi, eax

</pre>
<!--mstheme--><font face="Arial, Arial, Helvetica"></code>
<p>&#1055;&#1086;&#1089;&#1083;&#1077;&#1076;&#1085;&#1103;&#1103;
&#1087;&#1086;&#1087;&#1099;&#1090;&#1082;&#1072;.
&#1053;&#1080;&#1095;&#1077;&#1075;&#1086;
&#1076;&#1088;&#1091;&#1075;&#1086;&#1075;&#1086; &#1085;&#1077;
&#1086;&#1089;&#1090;&#1072;&#1077;&#1090;&#1089;&#1103;, &#1082;&#1072;&#1082;
&#1074;&#1079;&#1103;&#1090;&#1100;
&#1079;&#1085;&#1072;&#1095;&#1077;&#1085;&#1080;&#1077;
&#1086;&#1087;&#1080;&#1089;&#1072;&#1090;&#1077;&#1083;&#1103;
&#1087;&#1088;&#1103;&#1084;&#1086; &#1080;&#1079; &#1087;&#1086;&#1083;&#1103;
EPROCESS.SectionHandle.</p>
<code><!--mstheme--></font>
<pre>                     and eax, (4 - 1)
                     .break .if ( eax != 0 ) || ( edi &gt;= 800h )

</pre>
<!--mstheme--><font face="Arial, Arial, Helvetica"></code>
<p>&#1053;&#1072; &#1074;&#1089;&#1103;&#1082;&#1080;&#1081;
&#1089;&#1083;&#1091;&#1095;&#1072;&#1081;,
&#1087;&#1088;&#1086;&#1074;&#1077;&#1088;&#1080;&#1084;
&#1086;&#1087;&#1080;&#1089;&#1072;&#1090;&#1077;&#1083;&#1100; &#1085;&#1072;
&#1082;&#1088;&#1072;&#1090;&#1085;&#1086;&#1089;&#1090;&#1100;
&#1095;&#1077;&#1090;&#1099;&#1088;&#1077;&#1084; &#1080; &#1085;&#1072;
&#1074;&#1099;&#1093;&#1086;&#1076; &#1079;&#1072;
&#1088;&#1072;&#1079;&#1091;&#1084;&#1085;&#1099;&#1077;
&#1087;&#1088;&#1077;&#1076;&#1077;&#1083;&#1099;.</p>
<code><!--mstheme--></font>
<pre>                 .endif
                 
                 inc ebx
             .endw
 
         .endif
 
         .if status == STATUS_SUCCESS
 
             mov status, STATUS_UNSUCCESSFUL
 
             mov ebx, pSection
             mov ebx, (SECTION PTR [ebx])._Segment
 
             invoke IsAddressInPoolRanges, ebx
             push eax
             invoke MmIsAddressValid, ebx
             pop ecx
             .if al &amp;&amp; ( ecx == TRUE )
 
                 mov esi, ebx
 
                 mov ebx, (_SEGMENT PTR [ebx]).ControlArea
 
                 invoke IsAddressInPoolRanges, ebx
                 push eax
                 invoke MmIsAddressValid, ebx
                 pop ecx
                 .if al &amp;&amp; ( ecx == TRUE ) &amp;&amp; ([CONTROL_AREA PTR [ebx]]._Segment == esi )
 
                     mov ebx, (CONTROL_AREA PTR [ebx]).FilePointer
 
                     invoke IsLikeObjectPointer, ebx
                     .if eax == TRUE
 
                         mov ecx, IoFileObjectType
                         mov ecx, [ecx]
                         mov ecx, [ecx]          ; PTR OBJECT_TYPE
 
                         invoke ObReferenceObjectByPointer, ebx, FILE_READ_ATTRIBUTES, ecx, UserMode

</pre>
<!--mstheme--><font face="Arial, Arial, Helvetica"></code>
<p>&#1045;&#1089;&#1083;&#1080; &#1084;&#1099;
&#1087;&#1086;&#1080;&#1084;&#1077;&#1083;&#1080;
&#1091;&#1082;&#1072;&#1079;&#1072;&#1090;&#1077;&#1083;&#1100; &#1085;&#1072;
&#1073;&#1072;&#1079;&#1086;&#1074;&#1091;&#1102;
&#1089;&#1077;&#1082;&#1094;&#1080;&#1102;
&#1087;&#1088;&#1086;&#1094;&#1077;&#1089;&#1089;&#1072;, &#1090;&#1086;
&#1087;&#1086; &#1089;&#1093;&#1077;&#1084;&#1077; &#1085;&#1072;
&#1088;&#1080;&#1089;. 14-4
&#1087;&#1099;&#1090;&#1072;&#1077;&#1084;&#1089;&#1103;
&#1087;&#1086;&#1083;&#1091;&#1095;&#1080;&#1090;&#1100;
&#1091;&#1082;&#1072;&#1079;&#1072;&#1090;&#1077;&#1083;&#1100; &#1085;&#1072;
&#1089;&#1086;&#1086;&#1090;&#1074;&#1077;&#1090;&#1089;&#1090;&#1074;&#1091;&#1102;&#1097;&#1080;&#1081;
&#1092;&#1072;&#1081;&#1083;&#1086;&#1074;&#1099;&#1081;
&#1086;&#1073;&#1098;&#1077;&#1082;&#1090;. &#1047;&#1076;&#1077;&#1089;&#1100;
&#1076;&#1086;&#1083;&#1078;&#1085;&#1086; &#1073;&#1099;&#1090;&#1100;
&#1074;&#1089;&#1105; &#1087;&#1086;&#1085;&#1103;&#1090;&#1085;&#1086; &#1080;
&#1073;&#1077;&#1079;
&#1087;&#1086;&#1103;&#1089;&#1085;&#1077;&#1085;&#1080;&#1081;. &#1054;
&#1092;&#1091;&#1085;&#1082;&#1094;&#1080;&#1080; IsAddressInPoolRanges
&#1095;&#1091;&#1090;&#1100; &#1087;&#1086;&#1079;&#1078;&#1077;.</p>
<code><!--mstheme--></font>
<pre>                         .if eax == STATUS_SUCCESS
 
                             invoke ExAllocatePool, PagedPool, (IMAGE_FILE_PATH_LEN+1) * sizeof WCHAR
                             .if eax != NULL
 
                                 mov edi, pusImageFilePath
                                 assume edi:ptr UNICODE_STRING
 
                                 mov [edi].Buffer, eax
 
                                 invoke memset, eax, 0, (IMAGE_FILE_PATH_LEN+1) * sizeof WCHAR
 
                                 mov [edi].MaximumLength, IMAGE_FILE_PATH_LEN * sizeof WCHAR
                                 and [edi]._Length, 0

                                 invoke RtlVolumeDeviceToDosName, \
                                         (FILE_OBJECT PTR [ebx]).DeviceObject, addr usDosName

</pre>
<!--mstheme--><font face="Arial, Arial, Helvetica"></code>
<p>&#1055;&#1086;&#1083;&#1077; DeviceObject
&#1089;&#1090;&#1088;&#1091;&#1082;&#1090;&#1091;&#1088;&#1099; FILE_OBJECT
&#1093;&#1088;&#1072;&#1085;&#1080;&#1090;
&#1091;&#1082;&#1072;&#1079;&#1072;&#1090;&#1077;&#1083;&#1100; &#1085;&#1072;
&#1086;&#1073;&#1098;&#1077;&#1082;&#1090; &quot;&#1091;&#1089;&#1090;&#1088;&#1086;&#1081;&#1089;&#1090;&#1074;&#1086;&quot;,
&#1082;&#1086;&#1090;&#1086;&#1088;&#1086;&#1084;&#1091;
&#1087;&#1088;&#1080;&#1085;&#1072;&#1076;&#1083;&#1077;&#1078;&#1080;&#1090;
&#1092;&#1072;&#1081;&#1083;. &#1048;&#1079;
&#1086;&#1073;&#1098;&#1077;&#1082;&#1090;&#1072; &quot;&#1091;&#1089;&#1090;&#1088;&#1086;&#1081;&#1089;&#1090;&#1074;&#1086;&quot;
&#1084;&#1086;&#1078;&#1085;&#1086;
&#1080;&#1079;&#1074;&#1083;&#1077;&#1095;&#1100; &#1077;&#1075;&#1086;
&#1080;&#1084;&#1103;. &#1053;&#1086; &#1090;&#1086;&#1075;&#1076;&#1072;
&#1084;&#1099; &#1087;&#1086;&#1083;&#1091;&#1095;&#1080;&#1084;
&#1087;&#1091;&#1090;&#1100; &#1082; &#1092;&#1072;&#1081;&#1083;&#1091;
&#1086;&#1090;&#1085;&#1086;&#1089;&#1080;&#1090;&#1077;&#1083;&#1100;&#1085;&#1086;
&#1086;&#1073;&#1098;&#1077;&#1082;&#1090;&#1072; &quot;&#1091;&#1089;&#1090;&#1088;&#1086;&#1081;&#1089;&#1090;&#1074;&#1086;&quot;.
&#1053;&#1072;&#1087;&#1088;&#1080;&#1084;&#1077;&#1088;, &quot;\Device\HarddiskVolume1\WINNT\system32\notepad.exe&quot;.
&#1057; &#1087;&#1086;&#1084;&#1086;&#1097;&#1100;&#1102;
&#1092;&#1091;&#1085;&#1082;&#1094;&#1080;&#1080; RtlVolumeDeviceToDosName
&#1087;&#1088;&#1077;&#1086;&#1073;&#1088;&#1072;&#1079;&#1091;&#1077;&#1084;
&#1077;&#1075;&#1086; &#1074; &#1073;&#1086;&#1083;&#1077;&#1077;
&#1087;&#1088;&#1080;&#1074;&#1099;&#1095;&#1085;&#1099;&#1081; &quot;C:\ WINNT\system32\notepad.exe&quot;.
DDK &#1075;&#1086;&#1074;&#1086;&#1088;&#1080;&#1090;, &#1095;&#1090;&#1086;
&#1085;&#1072;&#1095;&#1080;&#1085;&#1072;&#1103; &#1089; XP &#1084;&#1099;
&#1076;&#1086;&#1083;&#1078;&#1085;&#1099;
&#1080;&#1089;&#1087;&#1086;&#1083;&#1100;&#1079;&#1086;&#1074;&#1072;&#1090;&#1100;
IoVolumeDeviceToDosName. &#1069;&#1090;&#1086; &#1085;&#1077;
&#1086;&#1073;&#1103;&#1079;&#1072;&#1090;&#1077;&#1083;&#1100;&#1085;&#1086;,
&#1090;.&#1082;. &#1076;&#1083;&#1103;
&#1086;&#1073;&#1088;&#1072;&#1090;&#1085;&#1086;&#1081;
&#1089;&#1086;&#1074;&#1084;&#1077;&#1089;&#1090;&#1080;&#1084;&#1086;&#1089;&#1090;&#1080;
&#1086;&#1073;&#1077; &#1092;&#1091;&#1085;&#1082;&#1094;&#1080;&#1080;
&#1080;&#1084;&#1077;&#1102;&#1090; &#1086;&#1076;&#1085;&#1091; &#1080;
&#1090;&#1091; &#1078;&#1077; &#1090;&#1086;&#1095;&#1082;&#1091;
&#1074;&#1093;&#1086;&#1076;&#1072;.</p>
<code><!--mstheme--></font>
<pre>                                 .if eax == STATUS_SUCCESS
  
                                     invoke RtlCopyUnicodeString, edi, addr usDosName
                                     invoke ExFreePool, usDosName.Buffer

                                 .endif
 
                                 invoke RtlAppendUnicodeStringToString, edi, \
                                                 addr (FILE_OBJECT PTR [ebx]).FileName
 
                                 assume edi:nothing
 
                                 mov status, STATUS_SUCCESS

</pre>
<!--mstheme--><font face="Arial, Arial, Helvetica"></code>
<p>&#1057;&#1086;&#1089;&#1090;&#1072;&#1074;&#1083;&#1103;&#1077;&#1084;
&#1087;&#1086;&#1083;&#1085;&#1099;&#1081; &#1087;&#1091;&#1090;&#1100; &#1082;
&#1086;&#1073;&#1088;&#1072;&#1079;&#1091;. DeviceToDosName
&#1089;&#1072;&#1084;&#1072;
&#1074;&#1099;&#1076;&#1077;&#1083;&#1103;&#1077;&#1090;
&#1073;&#1091;&#1092;&#1077;&#1088; &#1076;&#1083;&#1103;
&#1089;&#1090;&#1088;&#1086;&#1082;&#1080;,
&#1087;&#1086;&#1101;&#1090;&#1086;&#1084;&#1091;, &#1085;&#1077;
&#1079;&#1072;&#1073;&#1099;&#1074;&#1072;&#1077;&#1084; &#1077;&#1075;&#1086;
&#1086;&#1089;&#1074;&#1086;&#1073;&#1086;&#1076;&#1080;&#1090;&#1100;.</p>
<p>&#1058;&#1077;&#1087;&#1077;&#1088;&#1100;
&#1088;&#1072;&#1079;&#1073;&#1077;&#1088;&#1077;&#1084;
&#1086;&#1089;&#1090;&#1072;&#1090;&#1082;&#1080;. &quot;&#1056;&#1072;&#1079;&#1073;&#1077;&#1088;&#1077;&#1084;&quot;
- &#1089;&#1080;&#1083;&#1100;&#1085;&#1086;
&#1089;&#1082;&#1072;&#1079;&#1072;&#1085;&#1086;. &#1071; &#1091;&#1078;&#1077;
&#1076;&#1086;&#1074;&#1086;&#1083;&#1100;&#1085;&#1086;
&#1076;&#1072;&#1074;&#1085;&#1086; &#1087;&#1080;&#1096;&#1091;
&#1101;&#1090;&#1091; &#1089;&#1090;&#1072;&#1090;&#1100;&#1102;, &#1080;
&#1078;&#1077;&#1083;&#1072;&#1085;&#1080;&#1077;
&#1079;&#1072;&#1082;&#1086;&#1085;&#1095;&#1080;&#1090;&#1100; &#1077;&#1105;
&#1087;&#1086;&#1089;&#1082;&#1086;&#1088;&#1077;&#1081;
&#1088;&#1072;&#1089;&#1090;&#1077;&#1090; &#1074;&#1086; &#1084;&#1085;&#1077;
&#1089; &#1082;&#1072;&#1078;&#1076;&#1086;&#1081;
&#1085;&#1086;&#1074;&#1086;&#1081;
&#1089;&#1090;&#1088;&#1086;&#1095;&#1082;&#1086;&#1081; :)
&#1053;&#1072;&#1076;&#1077;&#1102;&#1089;&#1100;, &#1095;&#1090;&#1086;
&#1074;&#1099; &#1074;
&#1089;&#1086;&#1089;&#1090;&#1086;&#1103;&#1085;&#1080;&#1080;
&#1087;&#1086;&#1085;&#1103;&#1090;&#1100;, &#1095;&#1090;&#1086;
&#1076;&#1077;&#1083;&#1072;&#1102;&#1090;
&#1086;&#1089;&#1090;&#1072;&#1074;&#1096;&#1080;&#1077;&#1089;&#1103;
&#1085;&#1077;
&#1088;&#1072;&#1079;&#1086;&#1073;&#1088;&#1072;&#1085;&#1085;&#1099;&#1084;&#1080;
&#1092;&#1091;&#1085;&#1082;&#1094;&#1080;&#1080;. &#1071;
&#1083;&#1080;&#1096;&#1100; &#1089;&#1082;&#1072;&#1078;&#1091; &#1086;
&#1082;&#1072;&#1078;&#1076;&#1086;&#1081;
&#1085;&#1077;&#1089;&#1082;&#1086;&#1083;&#1100;&#1082;&#1086;
&#1089;&#1083;&#1086;&#1074;. &#1058;&#1072;&#1082;&#1078;&#1077; &#1074;
&#1080;&#1089;&#1093;&#1086;&#1076;&#1085;&#1086;&#1084;
&#1082;&#1086;&#1076;&#1077; &#1080;&#1084;&#1077;&#1077;&#1090;&#1089;&#1103;
&#1076;&#1086;&#1089;&#1090;&#1072;&#1090;&#1086;&#1095;&#1085;&#1086;&#1077;
&#1082;&#1086;&#1083;&#1080;&#1095;&#1077;&#1089;&#1090;&#1074;&#1086;
&#1082;&#1086;&#1084;&#1084;&#1077;&#1085;&#1090;&#1072;&#1088;&#1080;&#1077;&#1074;.</p>
<br>
<br>
<p>&nbsp;<!--mstheme--></font>
<h2><!--mstheme--><font face="Arial, Arial, Helvetica" color="#CCCCCC">14.15
&#1055;&#1088;&#1086;&#1094;&#1077;&#1076;&#1091;&#1088;&#1072;
IsAddressInPoolRanges<!--mstheme--></font></h2>
<!--mstheme--><font face="Arial, Arial, Helvetica">
<p>&nbsp;</p>
<p>&#1055;&#1088;&#1086;&#1094;&#1077;&#1076;&#1091;&#1088;&#1072;
IsAddressInPoolRanges &#1087;&#1088;&#1086;&#1089;&#1090;&#1072; &#1080;
&#1087;&#1088;&#1086;&#1074;&#1077;&#1088;&#1103;&#1077;&#1090;,
&#1085;&#1072;&#1093;&#1086;&#1076;&#1080;&#1090;&#1089;&#1103; &#1083;&#1080;
&#1087;&#1077;&#1088;&#1077;&#1076;&#1072;&#1085;&#1085;&#1099;&#1081;
&#1077;&#1081; &#1072;&#1076;&#1088;&#1077;&#1089; &#1074;
&#1075;&#1088;&#1072;&#1085;&#1080;&#1094;&#1072;&#1093;
&#1089;&#1080;&#1089;&#1090;&#1077;&#1084;&#1085;&#1099;&#1093;
&#1087;&#1091;&#1083;&#1086;&#1074;. &#1040;&#1076;&#1088;&#1077;&#1089;&#1072;
&#1085;&#1072;&#1095;&#1072;&#1083;&#1072; &#1080;
&#1082;&#1086;&#1085;&#1094;&#1072; &#1087;&#1091;&#1083;&#1086;&#1074;
&#1093;&#1086;&#1088;&#1086;&#1096;&#1086;
&#1080;&#1079;&#1074;&#1077;&#1089;&#1090;&#1085;&#1099;.
&#1055;&#1086;&#1076;&#1088;&#1086;&#1073;&#1085;&#1086;&#1089;&#1090;&#1080;
&#1084;&#1086;&#1078;&#1085;&#1086;
&#1087;&#1086;&#1095;&#1080;&#1090;&#1072;&#1090;&#1100; &#1074;
&#1082;&#1085;&#1080;&#1075;&#1077; &quot;&#1042;&#1085;&#1091;&#1090;&#1088;&#1077;&#1085;&#1085;&#1077;&#1077;
&#1091;&#1089;&#1090;&#1088;&#1086;&#1081;&#1089;&#1090;&#1074;&#1086; Microsoft
Windows 2000&quot;. &#1044;&#1086;&#1073;&#1072;&#1074;&#1083;&#1102;
&#1090;&#1086;&#1083;&#1100;&#1082;&#1086; &#1090;&#1086;, &#1095;&#1090;&#1086;
&#1086;&#1073;&#1098;&#1077;&#1082;&#1090;&#1099; &#1085;&#1077;
&#1103;&#1074;&#1083;&#1103;&#1102;&#1097;&#1080;&#1077;&#1089;&#1103;
&#1086;&#1073;&#1098;&#1077;&#1082;&#1090;&#1072;&#1084;&#1080;
&#1089;&#1080;&#1085;&#1093;&#1088;&#1086;&#1085;&#1080;&#1079;&#1072;&#1094;&#1080;&#1080;
(&#1082;&#1072;&#1082;&#1086;&#1074;&#1099;&#1084;
&#1086;&#1073;&#1098;&#1077;&#1082;&#1090;
&#1089;&#1077;&#1082;&#1094;&#1080;&#1103; &#1080;
&#1103;&#1074;&#1083;&#1103;&#1077;&#1090;&#1089;&#1103;),
&#1087;&#1086;&#1084;&#1077;&#1097;&#1072;&#1102;&#1090;&#1089;&#1103; &#1074;
&#1087;&#1086;&#1076;&#1082;&#1072;&#1095;&#1080;&#1074;&#1072;&#1077;&#1084;&#1099;&#1081;
&#1087;&#1091;&#1083;.
&#1055;&#1088;&#1086;&#1094;&#1077;&#1076;&#1091;&#1088;&#1072;
IsAddressInPoolRanges &#1078;&#1077;
&#1087;&#1088;&#1086;&#1074;&#1077;&#1088;&#1103;&#1077;&#1090;
&#1082;&#1072;&#1082;
&#1087;&#1086;&#1076;&#1082;&#1072;&#1095;&#1080;&#1074;&#1072;&#1077;&#1084;&#1099;&#1081;,
&#1090;&#1072;&#1082; &#1080;
&#1085;&#1077;&#1087;&#1086;&#1076;&#1082;&#1072;&#1095;&#1080;&#1074;&#1072;&#1077;&#1084;&#1099;&#1081;
&#1087;&#1091;&#1083;&#1099;. IsAddressInPoolRanges
&#1087;&#1088;&#1077;&#1076;&#1087;&#1086;&#1083;&#1072;&#1075;&#1072;&#1077;&#1090;,
&#1095;&#1090;&#1086;
&#1074;&#1099;&#1087;&#1086;&#1083;&#1085;&#1103;&#1077;&#1090;&#1089;&#1103;
&#1074; &#1089;&#1080;&#1089;&#1090;&#1077;&#1084;&#1077; &#1089; 2&#1043;&#1073;
&#1089;&#1080;&#1089;&#1090;&#1077;&#1084;&#1085;&#1099;&#1084;
&#1072;&#1076;&#1088;&#1077;&#1089;&#1085;&#1099;&#1084;
&#1087;&#1088;&#1086;&#1089;&#1090;&#1088;&#1072;&#1085;&#1089;&#1090;&#1074;&#1086;&#1084;.
&#1044;&#1083;&#1103; &#1089;&#1080;&#1089;&#1090;&#1077;&#1084; &#1089;
&#1087;&#1086;&#1076;&#1076;&#1077;&#1088;&#1078;&#1082;&#1086;&#1081; PAE (Physical
Address Extension) &#1080; &#1089;&#1080;&#1089;&#1090;&#1077;&#1084;
&#1079;&#1072;&#1087;&#1091;&#1097;&#1077;&#1085;&#1085;&#1099;&#1093; &#1089;
&#1082;&#1083;&#1102;&#1095;&#1086;&#1084; /3GB &#1074; boot.ini
&#1087;&#1088;&#1080;&#1076;&#1077;&#1090;&#1089;&#1103; &#1077;&#1105;
&#1085;&#1077;&#1089;&#1082;&#1086;&#1083;&#1100;&#1082;&#1086;
&#1074;&#1080;&#1076;&#1086;&#1080;&#1079;&#1084;&#1077;&#1085;&#1080;&#1090;&#1100;.</p>
<br>
<br>
<p>&nbsp;<!--mstheme--></font>
<h2><!--mstheme--><font face="Arial, Arial, Helvetica" color="#CCCCCC">14.16
&#1055;&#1088;&#1086;&#1094;&#1077;&#1076;&#1091;&#1088;&#1072;
IsLikeObjectPointer<!--mstheme--></font></h2>
<!--mstheme--><font face="Arial, Arial, Helvetica">
<p>&nbsp;</p>
<p>&#1069;&#1090;&#1072;
&#1087;&#1088;&#1086;&#1094;&#1077;&#1076;&#1091;&#1088;&#1072;
&#1076;&#1077;&#1083;&#1072;&#1077;&#1090;
&#1086;&#1073;&#1086;&#1089;&#1085;&#1086;&#1074;&#1072;&#1085;&#1085;&#1086;&#1077;
&#1079;&#1072;&#1082;&#1083;&#1102;&#1095;&#1077;&#1085;&#1080;&#1077; &#1086;
&#1090;&#1086;&#1084;, &#1084;&#1086;&#1078;&#1077;&#1090; &#1083;&#1080;
&#1087;&#1077;&#1088;&#1077;&#1076;&#1072;&#1085;&#1085;&#1099;&#1081;
&#1077;&#1081; &#1072;&#1076;&#1088;&#1077;&#1089;
&#1103;&#1074;&#1083;&#1103;&#1090;&#1100;&#1089;&#1103;
&#1091;&#1082;&#1072;&#1079;&#1072;&#1090;&#1077;&#1083;&#1077;&#1084;
&#1085;&#1072; &#1086;&#1073;&#1098;&#1077;&#1082;&#1090;.
&#1054;&#1073;&#1088;&#1072;&#1090;&#1080;&#1090;&#1077;
&#1074;&#1085;&#1080;&#1084;&#1072;&#1085;&#1080;&#1077;: &quot;&#1084;&#1086;&#1078;&#1077;&#1090;
&#1103;&#1074;&#1083;&#1103;&#1090;&#1100;&#1089;&#1103;&quot;, &#1085;&#1086;
&#1085;&#1077; &quot;&#1103;&#1074;&#1083;&#1103;&#1077;&#1090;&#1089;&#1103;&quot;.
&#1069;&#1090;&#1086; &#1077;&#1097;&#1105; &#1085;&#1072;&#1076;&#1086;
&#1087;&#1088;&#1086;&#1074;&#1077;&#1088;&#1080;&#1090;&#1100;
&#1074;&#1099;&#1079;&#1086;&#1074;&#1086;&#1084;
&#1092;&#1091;&#1085;&#1082;&#1094;&#1080;&#1080; ObReferenceObjectByPointer.
&#1040;&#1076;&#1088;&#1077;&#1089; &#1084;&#1086;&#1078;&#1077;&#1090;
&#1103;&#1074;&#1083;&#1103;&#1090;&#1100;&#1089;&#1103;
&#1091;&#1082;&#1072;&#1079;&#1072;&#1090;&#1077;&#1083;&#1077;&#1084;
&#1085;&#1072; &#1086;&#1073;&#1098;&#1077;&#1082;&#1090;,
&#1077;&#1089;&#1083;&#1080;</p>
<!--mstheme--></font>
<!--msthemelist--><table border="0" cellpadding="0" cellspacing="0" width="100%">
  <!--msthemelist--><tr>
    <!--msthemelist--><td valign="baseline" width="42"><img src="zerbul1a.gif" width="15" height="15" hspace="13"></td>
    <td valign="top" width="100%"><!--mstheme--><font face="Arial, Arial, Helvetica">&#1085;&#1072;&#1093;&#1086;&#1076;&#1080;&#1090;&#1089;&#1103;
      &#1074; &#1075;&#1088;&#1072;&#1085;&#1080;&#1094;&#1072;&#1093;
      &#1089;&#1080;&#1089;&#1090;&#1077;&#1084;&#1085;&#1099;&#1093;
      &#1087;&#1091;&#1083;&#1086;&#1074;;<!--mstheme--></font><!--msthemelist--></td>
  </tr>
  <!--msthemelist--><tr>
    <!--msthemelist--><td valign="baseline" width="42"><img src="zerbul1a.gif" width="15" height="15" hspace="13"></td>
    <td valign="top" width="100%"><!--mstheme--><font face="Arial, Arial, Helvetica">&#1082;&#1088;&#1072;&#1090;&#1077;&#1085;
      &#1082;&#1072;&#1082; &#1084;&#1080;&#1085;&#1080;&#1084;&#1091;&#1084; 8-&#1084;&#1080;
      &#1073;&#1072;&#1081;&#1090;&#1072;&#1084; (&#1087;&#1086;&#1076;&#1088;&#1086;&#1073;&#1085;&#1077;&#1077;
      &#1089;&#1084;.
      &#1082;&#1086;&#1084;&#1084;&#1077;&#1085;&#1090;&#1072;&#1088;&#1080;&#1081;
      &#1074; &#1080;&#1089;&#1093;&#1086;&#1076;&#1085;&#1080;&#1082;&#1077;);<!--mstheme--></font><!--msthemelist--></td>
  </tr>
  <!--msthemelist--><tr>
    <!--msthemelist--><td valign="baseline" width="42"><img src="zerbul1a.gif" width="15" height="15" hspace="13"></td>
    <td valign="top" width="100%"><!--mstheme--><font face="Arial, Arial, Helvetica">&#1103;&#1074;&#1083;&#1103;&#1077;&#1090;&#1089;&#1103;
      &#1076;&#1077;&#1081;&#1089;&#1090;&#1074;&#1080;&#1090;&#1077;&#1083;&#1100;&#1085;&#1099;&#1084;
      (&#1087;&#1072;&#1084;&#1103;&#1090;&#1100; &#1087;&#1086;
      &#1101;&#1090;&#1086;&#1084;&#1091;
      &#1072;&#1076;&#1088;&#1077;&#1089;&#1091;
      &#1074;&#1099;&#1076;&#1077;&#1083;&#1077;&#1085;&#1072;);<!--mstheme--></font><!--msthemelist--></td>
  </tr>
  <!--msthemelist--><tr>
    <!--msthemelist--><td valign="baseline" width="42"><img src="zerbul1a.gif" width="15" height="15" hspace="13"></td>
    <td valign="top" width="100%"><!--mstheme--><font face="Arial, Arial, Helvetica">&lt;&#1072;&#1076;&#1088;&#1077;&#1089;
      - 18h&gt;, &#1090;.&#1077;.
      &#1079;&#1072;&#1075;&#1086;&#1083;&#1086;&#1074;&#1086;&#1082;
      &#1087;&#1088;&#1077;&#1076;&#1087;&#1086;&#1083;&#1072;&#1075;&#1072;&#1077;&#1084;&#1086;&#1075;&#1086;
      &#1086;&#1073;&#1098;&#1077;&#1082;&#1090;&#1072;
      &#1090;&#1072;&#1082;&#1078;&#1077;
      &#1085;&#1072;&#1093;&#1086;&#1076;&#1080;&#1090;&#1089;&#1103; &#1074;
      &#1076;&#1077;&#1081;&#1089;&#1090;&#1074;&#1080;&#1090;&#1077;&#1083;&#1100;&#1085;&#1086;&#1081;
      &#1087;&#1072;&#1084;&#1103;&#1090;&#1080;.<!--mstheme--></font><!--msthemelist--></td>
  </tr>
<!--msthemelist--></table>
<!--mstheme--><font face="Arial, Arial, Helvetica">
<p align="center"><img src="file:///L:/Xack/Assembler,C,%20Delphi%20&#1056;&#1105;%20&#1057;&#1027;&#1056;&#1105;&#1057;&#1027;.&#1056;&#1111;&#1057;&#1026;&#1056;&#1109;&#1056;&#1110;&#1057;&#1026;&#1056;&#1056;&#1112;&#1056;&#1112;&#1056;&#1105;&#1057;&#1026;&#1056;&#1109;&#1056;&#1030;&#1056;&#1056;&#1029;&#1056;&#1105;&#1056;%20Forever!!!/[W%20A%20S%20M%20_%20R%20U]%20&#1057;&#1058;&#1040;&#1058;&#1068;&#1048;%20%20&#1057;&#1077;&#1082;&#1088;&#1077;&#1090;&#1099;%20Win32%20%20&#1044;&#1088;&#1072;&#1081;&#1074;&#1077;&#1088;&#1099;%20&#1088;&#1077;&#1078;&#1080;&#1084;&#1072;%20&#1103;&#1076;&#1088;&#1072;%20&#1063;&#1072;&#1089;&#1090;&#1100;%2014%20&#1041;&#1072;&#1079;&#1086;&#1074;&#1072;&#1103;%20&#1090;&#1077;&#1093;&#1085;&#1080;&#1082;&#1072;_%20&#1057;&#1080;&#1085;&#1093;&#1088;&#1086;&#1085;&#1080;&#1079;&#1072;&#1094;&#1080;&#1103;%20&#1048;&#1089;&#1087;&#1086;&#1083;&#1100;&#1079;&#1086;&#1074;&#1072;&#1085;&#1080;&#1077;%20&#1086;&#1073;&#1098;&#1077;&#1082;&#1090;&#1072;%20&#1089;&#1086;&#1073;&#1099;&#1090;&#1080;&#1077;%20&#1076;&#1083;&#1103;%20&#1074;&#1079;&#1072;&#1080;&#1084;&#1086;&#1076;&#1077;&#1081;&#1089;&#1090;&#1074;&#1080;&#1103;%20&#1076;&#1088;&#1072;&#1081;&#1074;&#1077;&#1088;&#1072;%20&#1089;%20&#1087;&#1088;&#1086;&#1075;&#1088;&#1072;&#1084;&#1084;&#1086;&#1081;%20&#1091;&#1087;&#1088;&#1072;&#1074;&#1083;&#1077;&#1085;&#1080;&#1103;.files/kmd14-6.png"><center>
<p><b>&#1056;&#1080;&#1089;. 14-6.</b>
&#1056;&#1077;&#1079;&#1091;&#1083;&#1100;&#1090;&#1072;&#1090;
&#1088;&#1072;&#1073;&#1086;&#1090;&#1099;
&#1087;&#1088;&#1086;&#1075;&#1088;&#1072;&#1084;&#1084;&#1099; ProcessMon.
&#1059;&#1089;&#1090;&#1072;&#1085;&#1086;&#1074;&#1082;&#1072;
&#1089;&#1077;&#1088;&#1074;&#1080;&#1089; &#1087;&#1072;&#1082;&#1086;&#1074;,
&#1086;&#1082;&#1072;&#1079;&#1099;&#1074;&#1072;&#1077;&#1090;&#1089;&#1103;,
&#1076;&#1086;&#1074;&#1086;&#1083;&#1100;&#1085;&#1086;
&#1078;&#1072;&#1076;&#1085;&#1072; &#1076;&#1086;
&#1087;&#1088;&#1086;&#1094;&#1077;&#1089;&#1089;&#1086;&#1074;.</center>
<p>&#1058;.&#1082;. &#1074; &#1087;&#1088;&#1080;&#1084;&#1077;&#1088;&#1077;
&#1080;&#1089;&#1087;&#1086;&#1083;&#1100;&#1079;&#1091;&#1102;&#1090;&#1089;&#1103;
&#1085;&#1077;&#1076;&#1086;&#1082;&#1091;&#1084;&#1077;&#1085;&#1090;&#1080;&#1088;&#1086;&#1074;&#1072;&#1085;&#1085;&#1099;&#1077;
&#1090;&#1088;&#1102;&#1082;&#1080;, &#1090;&#1086;, &#1074;&#1086;-&#1087;&#1077;&#1088;&#1074;&#1099;&#1093;,
&#1103; &#1085;&#1077;
&#1075;&#1072;&#1088;&#1072;&#1085;&#1090;&#1080;&#1088;&#1091;&#1102;
&#1077;&#1075;&#1086;
&#1089;&#1090;&#1072;&#1073;&#1080;&#1083;&#1100;&#1085;&#1091;&#1102;
&#1088;&#1072;&#1073;&#1086;&#1090;&#1091;, &#1072; &#1074;&#1086;-&#1074;&#1090;&#1086;&#1088;&#1099;&#1093;,
&#1084;&#1085;&#1077;
&#1080;&#1085;&#1090;&#1077;&#1088;&#1077;&#1089;&#1085;&#1086;
&#1079;&#1085;&#1072;&#1090;&#1100; &#1086; &#1083;&#1102;&#1073;&#1099;&#1093;
&#1087;&#1088;&#1086;&#1103;&#1074;&#1083;&#1077;&#1085;&#1080;&#1103;&#1093;
&#1085;&#1077;&#1089;&#1090;&#1072;&#1073;&#1080;&#1083;&#1100;&#1085;&#1086;&#1089;&#1090;&#1080;.
&#1055;&#1086;&#1101;&#1090;&#1086;&#1084;&#1091;,
&#1073;&#1086;&#1083;&#1100;&#1096;&#1072;&#1103;
&#1087;&#1088;&#1086;&#1089;&#1100;&#1073;&#1072;
&#1089;&#1086;&#1086;&#1073;&#1097;&#1080;&#1090;&#1100; &#1086;
&#1083;&#1102;&#1073;&#1099;&#1093;
&#1086;&#1073;&#1085;&#1072;&#1088;&#1091;&#1078;&#1077;&#1085;&#1085;&#1099;&#1093;
&#1073;&#1072;&#1075;&#1072;&#1093;.</p>
<p>&#1048;&#1089;&#1093;&#1086;&#1076;&#1085;&#1099;&#1081;
&#1082;&#1086;&#1076; &#1076;&#1088;&#1072;&#1081;&#1074;&#1077;&#1088;&#1072;
&#1074; <a href="http://wasm.ru/pub/21/files/kmd14.zip"><u>&#1072;&#1088;&#1093;&#1080;&#1074;&#1077;</u></a>.</p>
<p>&nbsp; [C] Four-F</p>
<!--mstheme--></font>

</body>

</html>
